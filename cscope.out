cscope 15 /host/.CODE/osu -q 0000001570 0000251594
	@functions.c

1 
	~<GL/glut.h
>

2 
	~<g°/g°.h
>

3 
	~<glib.h
>

4 
	~<°dlib.h
>

5 
	~<°dio.h
>

6 
	~<as£π.h
>

8 
	~<öc/game.h
>

9 
	~<öc/˚Œ.h
>

10 
	~<öc/sfx.h
>

11 
	~<öc/game_°©us.h
>

12 
	ggame_°©us
;

14 
	gcuºít_¶ide_°¨t
;

18 
	$di•œy
()

20 
	`glFlush
();

21 
	`glDißbÀ
(
GL_TEXTURE_2D
);

22 
	`glutSw≠Buf„rs
();

23 
	}
}

26 
	$ªsh≠e
(
w
, 
h
)

29 
	`glM©rixMode
(
GL_PROJECTION
);

30 
	`glLﬂdIdítôy
();

31 
	`glOπho
 (0, 
w
, 
h
, 0, 0, 1);

32 
	`glM©rixMode
(
GL_MODELVIEW
);

33 
	}
}

35 
	$døw_curs‹
(
x
, 
y
)

37 c⁄° 
curs‹_size
 = 50;

38 
hÆf
 = (
curs‹_size
 + 1) / 2 - 1;

39 
	`TEXTURE_DRAW_BEGIN
(
ãx_curs‹
);

40 
	`TEXTURE_PIN
(0.0, 0.0, 
x
 - 
hÆf
, 
y
 - half);

41 
	`TEXTURE_PIN
(0.0, 1.0, 
x
 + 
hÆf
, 
y
 - half);

42 
	`TEXTURE_PIN
(1.0, 1.0, 
x
 + 
hÆf
, 
y
 + half);

43 
	`TEXTURE_PIN
(1.0, 0.0, 
x
 - 
hÆf
, 
y
 + half);

44 
	`TEXTURE_DRAW_END
();

45 
	}
}

50 
	$mou£_døg
(
x
, 
y
)

52 
œ°_°øy
 = 0;

53 
göt64
 
pos
;

54 
mou£_x
 = 
x
, 
mou£_y
 = 
y
;

71 
	}
}

75 
	$mou£_move
(
x
, 
y
)

77 
mou£_x
 = 
x
, 
mou£_y
 = 
y
;

78 
	}
}

83 
	$mou£_˛ick
(
buâ⁄
, 
°©e
, 
x
, 
y
)

85 *
b
, *
s
;

86 
göt64
 
pos
;

87 
evít_id
;

88 
obje˘_ty≥
 
evít_ty≥
;

89 
obje˘_sc‹e
 
sc‹e
;

90 
buâ⁄
){

91 
GLUT_LEFT_BUTTON
:

92 
pos
 = 
	`sound_quîy_posôi⁄
(
bgm
) / 1000000;

93 i‡(
°©e
 =
GLUT_DOWN
){

94 
	`SET_GAME_STATUS
(
GAME_SF_MOUSE_DOWN
);

95 
sc‹e
 = 
	`mou£_judge_˛ick
(
mou£_judge
, 
x
,

96 
y
, 
pos
, &
evít_id
, &
evít_ty≥
);

106 i‡(
°©e
 =
GLUT_UP
){

107 
	`RESET_GAME_STATUS
(
GAME_SF_MOUSE_DOWN
);

109 
sc‹e
 = 
	`mou£_judge_up
(
mou£_judge
, 
x
,

110 
y
, 
pos
, &
evít_id
, &
evít_ty≥
);

121 
sc‹e
){

122 
sc‹e_300
:

123 
	`föish_evít
(
u_evíts
, 
evít_id
, 
HIT_300
, 
pos
, 
EVENT_SUCCESS
, 
£q
);

125 
sc‹e_100
:

127 
	`föish_evít
(
u_evíts
, 
evít_id
, 
HIT_100
, 
pos
, 
EVENT_SUCCESS
, 
£q
);

129 
sc‹e_50
:

131 
	`föish_evít
(
u_evíts
, 
evít_id
, 
HIT_50
, 
pos
, 
EVENT_SUCCESS
,
£q
);

133 
sc‹e_miss
:

135 
	`föish_evít
(
u_evíts
, 
evít_id
, 
HIT_miss
, 
pos
, 
EVENT_SUCCESS
,
£q
);

149 
	}
}

152 
	$keybﬂrd
 (
key
, 
x
, 
y
)

154 
t
;

155 
key
) {

158 
	`sfx_de°roy
();

159 
	`exô
(0);

167 
	}
}

	@game.c

1 
	~<as£π.h
>

2 
	~<öc/game.h
>

3 
	~<öc/ªs.h
>

4 
	gcﬁ‹_deföed
;

5 
	gcﬁ‹_num
;

6 
sound_t
 *
	gbgm
;

7 
GLuöt
 
	gãx_curs‹
;

10 
	gevít_num
;

11 
	gtick_num
;

12 
UnföEvít
 *
	gu_evíts
;

15 
time_£q_t
 *
	g£q
;

16 
	gmax_Àn
;

19 
	gmou£_x
, 
	gmou£_y
;

20 
mou£_judge_t
 *
	gmou£_judge
;

22 
	$ö£π_obje˘s
(
Obje˘Li°
 *
o
, 
time_£q_t
 *
£q
)

24 
HôObje˘s
 *
a
;

25 
i
 = 1;

26 
ãmp_tick
;

27 
cuºít_cﬁ‹
 = 0;

28 
evít_num
 = 0;

29 
tickøã
, 
¶idî_mu…ùlõr
, 
bót_Àngth
;

30 
cuºít_time_off£t
, 
√xt_time_off£t
;

31 
TimögPoötsLi°
 *
timög_poöts_li°
;

32 
TimögPoöts
 *
t
;

33 
Difficu…y
 *
d
;

34 
d
 = 
	`osu_gë_difficu…y
();

35 
tickøã
 = 
d
->
SlidîTickR©e
;

36 
¶idî_mu…ùlõr
 = 
d
->
SlidîMu…ùlõr
;

39 
timög_poöts_li°
 = 
	`osu_gë_timög_poöts
();

44 
t
 = 
	`TAILQ_FIRST
(
timög_poöts_li°
);

45 
bót_Àngth
 = 
t
->
bótLígth
;

46 
√xt_time_off£t
 = ((
t
 !
	`TAILQ_LAST
(
timög_poöts_li°
, 
TimögPoötsLi°
))?
	`TAILQ_NEXT
—, 
Tíåy
)->
off£t
:
max_Àn
);

47 
cuºít_time_off£t
 = 0 ;

48 
	`TAILQ_FOREACH
(
a
, 
o
, 
Híåy
)

50 if(
cuºít_time_off£t
 > 
√xt_time_off£t
){

51 
t
 = 
	`TAILQ_NEXT
—, 
Tíåy
);

52 if(
t
->
nŸInhîôed
)

53 
bót_Àngth
 = 
t
->
bótLígth
;

54 
√xt_time_off£t
 = ((
t
 !
	`TAILQ_LAST
(
timög_poöts_li°
, 
TimögPoötsLi°
))?
	`TAILQ_NEXT
—, 
Tíåy
)->
off£t
:
max_Àn
);

56 if(
	`is_HôCú˛e
(
a
))

59 
HôCú˛e
 *
b
 = &
a
->
hôCú˛e
;

60 
cuºít_time_off£t
 = 
b
->
°¨tTimeMs
;

63 if(
b
->
°¨tTimeMs
 > 
HITCIRCLE_EXIST_TIME
){

64 
	`¸óã_≠¥ﬂch_evít
(
b
->
xPos
, b->
yPos
, 
cuºít_cﬁ‹
, 
£q
, b->
°¨tTimeMs
/
TIME_INTERVAL
 - 
CIRCLE_CLOSE_TIME
);

65 
	`¸óã_cú˛íumbî_evít
(
b
->
xPos
, b->
yPos
, 
i
, 
£q
, b->
°¨tTimeMs
/
TIME_INTERVAL
 - 
HITCIRCLE_EXIST_TIME
, HITCIRCLE_EXIST_TIME);

66 
	`¸óã_hôcú˛e_evít
(
b
->
xPos
, b->
yPos
, 
cuºít_cﬁ‹
, 
£q
, b->
°¨tTimeMs
/
TIME_INTERVAL
 - 
HITCIRCLE_EXIST_TIME
, HITCIRCLE_EXIST_TIME, 1);

67 
	`mou£_judge_ö£π_hôobje˘
(
mou£_judge
, 
b
->
xPos
, b->
yPos
, b->
°¨tTimeMs
, 
obje˘_hô
, 
evít_num
);

70 
	`¸óã_≠¥ﬂch_evít
(
b
->
xPos
, b->
yPos
, 
cuºít_cﬁ‹
, 
£q
, 0);

71 
	`¸óã_cú˛íumbî_evít
(
b
->
xPos
, b->
yPos
, 
i
, 
£q
, 0, b->
°¨tTimeMs
);

72 
	`¸óã_hôcú˛e_evít
(
b
->
xPos
, b->
yPos
, 
cuºít_cﬁ‹
, 
£q
, 0, b->
°¨tTimeMs
, 1);

73 
	`mou£_judge_ö£π_hôobje˘
(
mou£_judge
, 
b
->
xPos
, b->
yPos
, b->
°¨tTimeMs
, 
obje˘_hô
, 
evít_num
);

75 
evít_num
 ++;

76 if(
b
->
obje˘Ty≥
 == 1){

77 
i
 ++;

79 if(
b
->
obje˘Ty≥
 == 5)

81 
i
 = 1;

82 
cuºít_cﬁ‹
 = (cuºít_cﬁ‹+1)%
cﬁ‹_num
;

85 
	`¥ötf
("wrong hit circleÅype !");

90 
DŸ
 *
poöts
;

91 
cú˛e_num
, 
j
, 
ãmp_tick
;

92 
cuºít_time_off£t
 = 
a
->
¶idî
.
°¨tTimeMs
;

93 if(
t
->
nŸInhîôed
){

94 
bót_Àngth
 = 
t
->
bótLígth
;

95 
cú˛e_num
 = 
	`curve_gë_¶idî_poöts
(&
a
->
¶idî
, 
¶idî_mu…ùlõr
, 
tickøã
, 
bót_Àngth
, &
poöts
);

98 
cú˛e_num
 = 
	`curve_gë_¶idî_poöts
(&
a
->
¶idî
, 
¶idî_mu…ùlõr
 * 100.0 / ( -
t
->
bótLígth
), 
tickøã
, 
bót_Àngth
, &
poöts
);

100 
	`¸óã_¶idî
(
poöts
, 
cú˛e_num
, 
£q
, 
cuºít_cﬁ‹
,
i
, 
a
->
¶idî
.
ª≥©Cou¡
,á->¶idî.
soundTy≥
);

102 
ãmp_tick
 = 0;

103 
j
 = 0 ; j < 
cú˛e_num
 ; j++){

104 if(
poöts
[
j
].
is_tick
)

105 
ãmp_tick
++;

107 
ãmp_tick
 =Åemp_tick * 
a
->
¶idî
.
ª≥©Cou¡
;

108 
	`mou£_judge_ö£π_¶idî
(
mou£_judge
, 
poöts
, 
cú˛e_num
, 
a
->
¶idî
.
ª≥©Cou¡
, 
evít_num
);

109 
evít_num
 +
ãmp_tick
;

110 
	`mou£_judge_ö£π_hôobje˘
(
mou£_judge
, 
poöts
[0].
x
,Öoöts[0].
y
,Öoöts[0].
time
, 
obje˘_¶ide_°¨t
, 
evít_num
);

111 
evít_num
 ++;

112 if(
a
->
¶idî
.
ª≥©Cou¡
 %2 == 1)

114 
	`mou£_judge_ö£π_hôobje˘
(
mou£_judge
, 
poöts
[
cú˛e_num
-1].
x
,Öoöts[cú˛e_num-1].
y
,Öoöts[cú˛e_num -1].
time
, 
obje˘_¶ide_íd
, 
evít_num
);

116 
	`mou£_judge_ö£π_hôobje˘
(
mou£_judge
, 
poöts
[0].
x
,Öoöts[0].
y
,Öoöts[0].
time
 + (poöts[
cú˛e_num
 - 1].timê-Öoöts[0].time)*
a
->
¶idî
.
ª≥©Cou¡
, 
obje˘_¶ide_íd
, 
evít_num
);

117 
evít_num
 ++;

118 if(
a
->
¶idî
.
obje˘Ty≥
 == 2){

119 
i
 ++;

121 if(
a
->
¶idî
.
obje˘Ty≥
 == 6)

123 
i
 = 1;

124 
cuºít_cﬁ‹
 = (cuºít_cﬁ‹+1)%
cﬁ‹_num
;

127 
	`¥ötf
("wrong hit circleÅype !");

133 
u_evíts
 = (
UnföEvít
 *)
	`mÆloc
((
evít_num
) * (UnfinEvent));

134 
i
 = 0;

135 
ãmp_tick
 = 0;

136 
cuºít_time_off£t
 = 0;

137 
t
 = 
	`TAILQ_FIRST
(
timög_poöts_li°
);

138 
bót_Àngth
 = 
t
->
bótLígth
;

139 
√xt_time_off£t
 = ((
t
 !
	`TAILQ_LAST
(
timög_poöts_li°
, 
TimögPoötsLi°
))?
	`TAILQ_NEXT
—, 
Tíåy
)->
off£t
:
max_Àn
);

140 
	`TAILQ_FOREACH
(
a
, 
o
, 
Híåy
)

142 if(
cuºít_time_off£t
 > 
√xt_time_off£t
){

143 
t
 = 
	`TAILQ_NEXT
—, 
Tíåy
);

144 if(
t
->
nŸInhîôed
)

145 
bót_Àngth
 = 
t
->
bótLígth
;

146 
√xt_time_off£t
 = ((
t
 !
	`TAILQ_LAST
(
timög_poöts_li°
, 
TimögPoötsLi°
))?
	`TAILQ_NEXT
—, 
Tíåy
)->
off£t
:
max_Àn
);

148 if(
	`is_HôCú˛e
(
a
)){

149 
cuºít_time_off£t
 = 
a
->
hôCú˛e
.
°¨tTimeMs
;

150 
	`add_unfö_evít
(
u_evíts
, 
i
+
ãmp_tick
, 
a
->
hôCú˛e
.
xPos
,á->hôCú˛e.
yPos
,a->hôCú˛e.
°¨tTimeMs
,á->hôCú˛e.
soundTy≥
, 
obje˘_hô
);

151 
i
++;

154 
DŸ
 *
poöts
;

155 
cú˛e_num
, 
j
, 
k
;

156 
cuºít_time_off£t
 = 
a
->
¶idî
.
°¨tTimeMs
;

157 if(
t
->
nŸInhîôed
){

158 
bót_Àngth
 = 
t
->
bótLígth
;

159 
cú˛e_num
 = 
	`curve_gë_¶idî_poöts
(&
a
->
¶idî
, 
¶idî_mu…ùlõr
, 
tickøã
, 
bót_Àngth
, &
poöts
);

162 
cú˛e_num
 = 
	`curve_gë_¶idî_poöts
(&
a
->
¶idî
, 
¶idî_mu…ùlõr
 * 100.0 / (-
t
->
bótLígth
), 
tickøã
, 
bót_Àngth
, &
poöts
);

164 
k
 = 0 ; k < 
a
->
¶idî
.
ª≥©Cou¡
 ;k ++){

165 if(
k
%2 == 0){

166 
j
 = 0 ; j < 
cú˛e_num
 ;j ++)

168 if(
poöts
[
j
].
is_tick
){

169 
	`add_unfö_evít
(
u_evíts
, 
i
, 
poöts
[
j
].
x
,Öoöts[j].
y
,Öoöts[j].
time
 + 
k
*’oöts[
cú˛e_num
 - 1].timê-Öoöts[0].time), 0, 
obje˘_¶ide_tick
);

170 
i
++;

175 
j
 = 
cú˛e_num
 -1 ; j>=0 ;j --)

177 if(
poöts
[
j
].
is_tick
){

178 
	`add_unfö_evít
(
u_evíts
,
i
, 
poöts
[
j
].
x
,Öoöts[j].
y
,Öoöts[j].
time
+ 
k
*’oöts[
cú˛e_num
 - 1].timê-Öoöts[0].time), 0, 
obje˘_¶ide_tick
);

179 
i
++;

184 if(
a
->
¶idî
.
ª≥©Cou¡
 %2 == 1){

185 
	`add_unfö_evít
(
u_evíts
, 
i
, 
poöts
[0].
x
,Öoöts[0].
y
,poöts[
cú˛e_num
 - 1].
time
 + (
a
->
¶idî
.
ª≥©Cou¡
-1)*’oöts[cú˛e_num-1].timê-Öoöts[0].timeË,á->¶idî.
soundTy≥
, 
obje˘_¶ide_°¨t
);

186 
i
++;

187 
	`add_unfö_evít
(
u_evíts
, 
i
, 
poöts
[
cú˛e_num
 - 1].
x
,Öoöts[cú˛e_num - 1].
y
,Öoöts[cú˛e_num - 1].
time
 + (
a
->
¶idî
.
ª≥©Cou¡
-1)*’oöts[cú˛e_num-1].timê-Öoöts[0].time),á->¶idî.
soundTy≥
, 
obje˘_¶ide_íd
);

188 
i
++;

191 
	`add_unfö_evít
(
u_evíts
, 
i
, 
poöts
[0].
x
,Öoöts[0].
y
,poöts[
cú˛e_num
 - 1].
time
 + (
a
->
¶idî
.
ª≥©Cou¡
-1)*’oöts[cú˛e_num-1].timê-Öoöts[0].time),á->¶idî.
soundTy≥
, 
obje˘_¶ide_°¨t
);

192 
i
++;

193 
	`add_unfö_evít
(
u_evíts
, 
i
, 
poöts
[0].
x
,Öoöts[0].
y
,Öoöts[
cú˛e_num
 - 1].
time
 + (
a
->
¶idî
.
ª≥©Cou¡
-1)*’oöts[cú˛e_num-1].timê-Öoöts[0].timeË+ 50,á->¶idî.
soundTy≥
, 
obje˘_¶ide_íd
);

194 
i
++;

198 
	}
}

201 
	$game_öô
(*
osu
, *
sound
, *
background_dú
)

203 
x
, 
y
, 
time
;

204 
i
;

205 
Obje˘Li°
 *
o
;

206 
Cﬁ‹Li°
 *
c
;

207 
FILE
* 
fö
;

208 
HôObje˘s
 *
œ°
;

209 *
background
;

210 
background_∑th
[200];

212 
Àn
;

213 
poöts
[100][3];

214 
ãmp_time
;

215 
fö
 = 
	`f›í
(
osu
, "r");

216 
	`as£π
(
fö
);

219 
	`osu_ªad
(
fö
);

220 
	`f˛o£
(
fö
);

221 
background
 = 
	`osu_gë_backGround
();

222 
	`•rötf
(
background_∑th
, "%s/%s", 
background_dú
, 
background
);

224 
o
 = 
	`osu_gë_obje˘_li°
();

225 
œ°
 = 
	`TAILQ_LAST
(
o
, 
Obje˘Li°
);

226 if(
	`is_HôCú˛e
(
œ°
)){

227 
max_Àn
 = 
œ°
->
hôCú˛e
.
°¨tTimeMs
 + 5000;

229 
max_Àn
 = 
œ°
->
¶idî
.
°¨tTimeMs
 + 5000;

232 
c
 = 
	`osu_gë_cﬁ‹_li°
();

233 if(
	`TAILQ_EMPTY
(
c
)){

234 
cﬁ‹_num
 = 6;

235 
cﬁ‹_deföed
 = 0;

238 
cﬁ‹_deföed
 = 1;

241 
mou£_judge
 = 
	`mou£_judge_öô
(
max_Àn
, 64, 120, 100,100,100,5);

242 
	`˚Œ_öô
();

243 
£q
 = 
	`time_£q_öô
(
max_Àn
);

244 
	`ö£π_obje˘s
(
o
, 
£q
);

245 
	`£t_cuºít_tick_time
(
u_evíts
, 
evít_num
, 0);

246 
	`sfx_öô
();

247 
	`¸óã_background
(
background_∑th
, 
£q
, 
max_Àn
);

249 
bgm
 = 
	`sound_lﬂd
(
sound
);

250 
	`¥ötf
("%s\n",
sound
);

251 
	`as£π
(
bgm
);

252 
ãx_curs‹
 = 
	`ãxtuª_lﬂd
(
	`STR
(
MATERIAL_DIR
/
curs‹
.
≤g
));

254 
	}
}

256 
	gnŸ_∂ayög
 = 1;

257 
göt64
 
	gœ°_time
 = 0;

258 c⁄° 
	gFPS
=200;

260 
	$idÀ
()

262 
göt64
 
pos
;

263 
ªÆ_time
, 
œ°_cou¡_time
 = 0,
cou¡
 = 0, 
œ°_‰ame_time
= 0;

264 if(!
œ°_cou¡_time
)

265 
œ°_cou¡_time
 = 
	`glutGë
(
GLUT_ELAPSED_TIME
);

266 if(!
œ°_‰ame_time
)

267 
œ°_‰ame_time
 = 
	`glutGë
(
GLUT_ELAPSED_TIME
);

268 
ªÆ_time
 = 
	`glutGë
(
GLUT_ELAPSED_TIME
);

269 i‡(
ªÆ_time
 - 
œ°_‰ame_time
 < 1000/
FPS
){

270 
	`u¶ìp
(1);

273 
œ°_‰ame_time
 = 
ªÆ_time
;

274 i‡(
ªÆ_time
 - 
œ°_cou¡_time
 > 1000){

276 
cou¡
 = 0;

277 
œ°_cou¡_time
 = 
ªÆ_time
;

279 
pos
 = 
	`sound_quîy_posôi⁄
(
bgm
);

280 
œ°_time
 = 
pos
;

281 
	`glCÀ¨Dïth
(1.0f);

282 
	`glE«bÀ
(
GL_TEXTURE_2D
);

283 
	`glBÀndFunc
(
GL_SRC_ALPHA
,
GL_ONE_MINUS_SRC_ALPHA
);

284 
	`glAÕhaFunc
(
GL_GREATER
, 0.9);

285 
	`glE«bÀ
(
GL_BLEND
);

287 
	`glCÀ¨
(
GL_COLOR_BUFFER_BIT
 | 
GL_DEPTH_BUFFER_BIT
);

289 
	`kûl_unfö_evít_bef‹e
(
u_evíts
, 
evít_num
, 
pos
/1000000, 
£q
);

290 if(
nŸ_∂ayög
 == 1){

291 if(
pos
/1000000 < 
max_Àn
 &&Öos/1000000 > 0)

292 
nŸ_∂ayög
 = 0;

295 
	`time_£q_åiggî_©
(
£q
, 
pos
/1000000);

297 
	`døw_curs‹
(
mou£_x
, 
mou£_y
);

299 
cou¡
++;

300 if(
pos
 >
	`sound_quîy_duøti⁄
(
bgm
))

301 
	`exô
(0);

302 
	`glutPo°Redi•œy
();

303 
	}
}

306 
	$gl_öô
(
¨gc
, **
¨gv
)

308 
	`glutInô
(&
¨gc
, 
¨gv
);

309 
	`glutInôDi•œyMode
(
GLUT_DOUBLE
 | 
GLUT_RGB
 | 
GLUT_DEPTH
);

310 
	`glutInôWödowSize
(640, 480);

311 
	`glutInôWödowPosôi⁄
(100, 100);

312 
	`glutCª©eWödow
(
¨gv
[0]);

313 
	`glutSëCurs‹
(
GLUT_CURSOR_NONE
);

314 
	`glDißbÀ
(
GL_DEPTH_TEST
);

315 
	`glCÀ¨Cﬁ‹
 (0.0, 0.0, 0.0, 0.0);

316 
	`glShadeModñ
(
GL_FLAT
);

317 
	`glPixñSt‹ei
(
GL_UNPACK_ALIGNMENT
, 1);

318 
	`glutDi•œyFunc
(
di•œy
);

319 
	`glutResh≠eFunc
(
ªsh≠e
);

320 
	`glutKeybﬂrdFunc
(
keybﬂrd
);

321 
	`glutMŸi⁄Func
(
mou£_døg
);

322 
	`glutPassiveMŸi⁄Func
(
mou£_move
);

323 
	`glutMou£Func
(
mou£_˛ick
);

324 
	`glutIdÀFunc
(
idÀ
);

325 
	}
}

327 
	$maö
(
¨gc
, ** 
¨gv
)

330 
	`g°_öô
 (&
¨gc
, &
¨gv
);

333 i‡(
¨gc
 != 4) {

334 
	`g_¥öãº
 ("Ußge: %†<Ogg/V‹bi†fûíame>\n", 
¨gv
[0]);

338 
	`gl_öô
(
¨gc
, 
¨gv
);

339 
	`glutMaöLo›
();

345 
	}
}

	@inc/audio.h

1 #i‚de‡
__AUDIO_H_


2 
	#__AUDIO_H_


	)

3 
	~<g°/g°.h
>

4 
	~<glib.h
>

5 
	ssound_t
{

6 
G°EÀmít
 *
	mpùñöe
,

7 *
	msour˚
,

8 *
	m∑r£r
,

9 *
	mdemuxî
,

10 *
	mdecodî
,

11 *
	mc⁄v
,

12 *
	msök
;

14 
sound_t
 *
sound_lﬂd
(c⁄° *
fûe
);

15 
göt64
 
sound_quîy_posôi⁄
(
sound_t
 *
sound
);

16 
göt64
 
sound_quîy_duøti⁄
(
sound_t
 *
sound
);

17 
sound_∂ay
(
sound_t
 *
sound
);

18 
sound_°›
(
sound_t
 *
sound
);

19 
sound_‰ì
(
sound_t
 *
sound
);

	@inc/cdefs.h

41 #i‚def 
_SYS_CDEFS_H_


42 
	#_SYS_CDEFS_H_


	)

44 #i‡
deföed
(
__˝lu•lus
)

45 
	#__BEGIN_DECLS
 "C" {

	)

46 
	#__END_DECLS
 }

	)

48 
	#__BEGIN_DECLS


	)

49 
	#__END_DECLS


	)

55 #i‡
deföed
(
__GNUC__
Ë&& !deföed(
__INTEL_COMPILER
)

56 
	#__GNUC_PREREQ__
(
ma
, 
mi
) \

57 (
__GNUC__
 > (
ma
Ë|| __GNUC__ =(maË&& 
__GNUC_MINOR__
 >(
mi
))

	)

59 
	#__GNUC_PREREQ__
(
ma
, 
mi
Ë0

	)

74 
	#__VM_CACHELINE_SIZE
 64

	)

75 
	#__VM_CACHELINE_ALIGN
(
n
) \

76 (((
n
Ë+ 
__VM_CACHELINE_SIZE
 - 1Ë/ __VM_CACHELINE_SIZE)

	)

90 #i‡
deföed
(
__STDC__
Ë|| deföed(
__˝lu•lus
)

91 
	#__P
(
¥Ÿos
Ë¥Ÿo†

	)

92 
	#__CONCAT1
(
x
,
y
Ëx ## 
	)
y

93 
	#__CONCAT
(
x
,
y
Ë
	`__CONCAT1
(x,y)

	)

94 
	#__STRING
(
x
Ë#x

	)

95 
	#__XSTRING
(
x
Ë
	`__STRING
(xË

	)

97 
	#__c⁄°
 c⁄°

	)

98 
	#__sig√d
 sig√d

	)

99 
	#__vﬁ©ûe
 vﬁ©ûe

	)

100 #i‡
deföed
(
__˝lu•lus
)

101 
	#__ölöe
 
ölöe


	)

103 #i‚de‡
__GNUC__


104 
	#__ölöe


	)

109 
	#__P
(
¥Ÿos
Ë(Ë

	)

110 
	#__CONCAT
(
x
,
y
Ëx 
	)
y

111 
	#__STRING
(
x
Ë"x"

	)

113 #i‚de‡
__GNUC__


114 
	#__c⁄°


	)

115 
	#__ölöe


	)

116 
	#__sig√d


	)

117 
	#__vﬁ©ûe


	)

126 #i‚def 
NO_ANSI_KEYWORDS


127 c⁄°

	)

128 
	#ölöe


	)

129 sig√d

	)

130 vﬁ©ûe

	)

142 #ifde‡
löt


144 
	#__dód2


	)

145 
	#__puª


	)

146 
	#__puª2


	)

147 
	#__unu£d


	)

148 
	#__∑cked


	)

149 
	#__Æig√d
(
x
)

	)

150 
	#__£˘i⁄
(
x
)

	)

151 
	#__Æways_ölöe


	)

152 
	#__n⁄nuŒ
(
x
)

	)

156 #i‡!
__GNUC_PREREQ__
(2, 7)

157 
	#__dód2


	)

158 
	#__puª2


	)

159 
	#__unu£d


	)

162 #i‡
__GNUC_PREREQ__
(2, 7)

163 
	#__dód2
 
	`__©åibuã__
((
__n‹ëu∫__
))

	)

164 
	#__puª2
 
	`__©åibuã__
((
__c⁄°__
))

	)

165 
	#__unu£d
 
	`__©åibuã__
((
__unu£d__
))

	)

166 
	#__∑cked
 
	`__©åibuã__
((
__∑cked__
))

	)

167 
	#__Æig√d
(
x
Ë
	`__©åibuã__
((
	`__Æig√d__
(x)))

	)

168 
	#__£˘i⁄
(
x
Ë
	`__©åibuã__
((
	`__£˘i⁄__
(x)))

	)

171 #i‡
__GNUC_PREREQ__
(2, 96)

172 
	#__puª
 
	`__©åibuã__
((
__puª__
))

	)

174 
	#__puª
 
__puª2


	)

177 #i‡
__GNUC_PREREQ__
(3, 1)

178 
	#__Æways_ölöe
 
	`__©åibuã__
((
__Æways_ölöe__
))

	)

179 
	#__noölöe
 
	`__©åibuã__
((
__noölöe__
))

	)

181 
	#__Æways_ölöe


	)

182 
	#__noölöe


	)

185 #i‡
__GNUC_PREREQ__
(3, 3)

186 
	#__n⁄nuŒ
(
x
Ë
	`__©åibuã__
((
	`__n⁄nuŒ__
(x)))

	)

187 
	#__u£d
 
	`__©åibuã__
((
__u£d__
))

	)

189 
	#__n⁄nuŒ
(
x
)

	)

190 
	#__u£d
 
__unu£d


	)

195 #i‡!
__GNUC_PREREQ__
(2, 7Ë&& 
__STDC_VERSION
 < 199901

196 
	#__func__
 
NULL


	)

199 #i‡(
__GNUC_PREREQ__
(2, 0Ë&& !
deföed
(
__STRICT_ANSI
)) || \

200 
__STDC_VERSION__
 >= 199901

201 
	#__LONG_LONG_SUPPORTED


	)

232 #i‡
__GNUC_PREREQ__
(2, 96)

233 
	#__¥edi˘_åue
(
exp
Ë
	`__buûtö_ex≥˘
(”xp), 1)

	)

234 
	#__¥edi˘_Ál£
(
exp
Ë
	`__buûtö_ex≥˘
(”xp), 0)

	)

236 
	#__¥edi˘_åue
(
exp
Ë”xp)

	)

237 
	#__¥edi˘_Ál£
(
exp
Ë”xp)

	)

246 #i‡!
__GNUC_PREREQ__
(2, 95)

247 #i‡
__STDC_VERSION__
 < 199901

248 
	#__ª°ri˘


	)

250 
	#__ª°ri˘
 
ª°ri˘


	)

262 #i‡!
__GNUC_PREREQ__
(2, 7)

263 
	#__¥ötÊike
(
fmèrg
, 
fú°v¨¨g
)

	)

264 
	#__sˇnÊike
(
fmèrg
, 
fú°v¨¨g
)

	)

265 
	#__¥ötf0like
(
fmèrg
, 
fú°v¨¨g
)

	)

266 
	#__f‹m©_¨g
(
fmèrg
)

	)

267 #ñi‡
__GNUC_PREREQ__
(3, 0)

268 
	#__¥ötÊike
(
fmèrg
, 
fú°v¨¨g
) \

269 
	`__©åibuã__
((
	`__n⁄nuŒ__
(
fmèrg
), \

270 
	`__f‹m©__
 (
__¥ötf__
, 
fmèrg
, 
fú°v¨¨g
)))

	)

271 
	#__¥ötf0like
(
fmèrg
, 
fú°v¨¨g
) \

272 
	`__©åibuã__
((
	`__f‹m©__
 (
__¥ötf__
, 
fmèrg
, 
fú°v¨¨g
)))

	)

273 
	#__sˇnÊike
(
fmèrg
, 
fú°v¨¨g
) \

274 
	`__©åibuã__
((
	`__f‹m©__
 (
__sˇnf__
, 
fmèrg
, 
fú°v¨¨g
)))

	)

275 
	#__f‹m©_¨g
(
fmèrg
) \

276 
	`__©åibuã__
((
	`__f‹m©_¨g__
 (
fmèrg
)))

	)

279 
	#__¥ötÊike
(
fmèrg
, 
fú°v¨¨g
) \

280 
	`__©åibuã__
((
	`__f‹m©__
 (
__¥ötf__
, 
fmèrg
, 
fú°v¨¨g
)))

	)

281 
	#__¥ötf0like
(
fmèrg
, 
fú°v¨¨g
) \

282 
	`__©åibuã__
((
	`__f‹m©__
 (
__¥ötf0__
, 
fmèrg
, 
fú°v¨¨g
)))

	)

283 
	#__sˇnÊike
(
fmèrg
, 
fú°v¨¨g
) \

284 
	`__©åibuã__
((
	`__f‹m©__
 (
__sˇnf__
, 
fmèrg
, 
fú°v¨¨g
)))

	)

285 
	#__f‹m©_¨g
(
fmèrg
) \

286 
	`__©åibuã__
((
	`__f‹m©_¨g__
 (
fmèrg
)))

	)

290 #i‡!
__GNUC_PREREQ__
(3, 0)

291 
	#__ARRAY_ZERO
 0

	)

293 
	#__ARRAY_ZERO


	)

300 #i‡
__GNUC_PREREQ__
(4, 3)

301 
	#__c⁄°ru˘‹
(
¥io
Ë
	`__©åibuã__
((
	`c⁄°ru˘‹
’rio)))

	)

303 
	#__c⁄°ru˘‹
(
¥io
Ë
	`__©åibuã__
((
c⁄°ru˘‹
))

	)

335 #ifde‡
__GNUC__


336 
	#__ˇchólign
 
	`__©åibuã__
((
	`__Æig√d__
(
__VM_CACHELINE_SIZE
)))

	)

337 
	#__u£ªg
 
	`__©åibuã__
((
	`__ªg∑rm__
(3)))

	)

339 
	#__ˇchólign


	)

340 
	#__u£ªg


	)

343 #ifde‡
__GNUC__


344 
	#__°r⁄g_ª„ªn˚
(
sym
,
Æüssym
) \

345 
	`__ty≥of
 (
sym
Ë
Æüssym
 
	`__©åibuã__
 ((
	`__Æüs__
 (#sym)));

	)

346 
	#__wók_ª„ªn˚
(
sym
,
Æüs
) \

347 
	`__asm__
(".weak " #alias); \

348 
	`__asm__
(".equ " #Æü†", " #sym)

	)

349 
	#__w¨n_ª„ªn˚s
(
sym
,
msg
) \

350 
	`__asm__
(".section .gnu.warning." #sym); \

351 
	`__asm__
(".asciz \"" 
msg
 "\""); \

352 
	`__asm__
(".¥evious")

	)

355 #i‡
deföed
(
__GNUC__
)

356 
	#__IDSTRING
(
«me
,
°rög
Ë
	`__asm__
(".idít\t\"" såög "\"")

	)

359 #i‚def 
__RCSID


360 
	#__RCSID
(
s
Ë
	`__IDSTRING
(
rcsid
,s)

	)

363 #i‚def 
__RCSID_SOURCE


364 
	#__RCSID_SOURCE
(
s
Ë
	`__IDSTRING
(
rcsid_sour˚
,s)

	)

367 #i‚def 
__COPYRIGHT


368 
	#__COPYRIGHT
(
s
Ë
	`__IDSTRING
(
c›yright
,s)

	)

371 #i‚def 
__DECONST


372 
	#__DECONST
(
ty≥
, 
v¨
Ë(—y≥)(
uöçå_t
)(c⁄° *)(v¨))

	)

375 #i‚def 
__DEVOLATILE


376 
	#__DEVOLATILE
(
ty≥
, 
v¨
Ë(—y≥)(
uöçå_t
)(vﬁ©ûê*)(v¨))

	)

379 #i‚def 
__DEQUALIFY


380 
	#__DEQUALIFY
(
ty≥
, 
v¨
Ë(—y≥)(
uöçå_t
)(c⁄° vﬁ©ûê*)(v¨))

	)

410 #i‡(!
deföed
(
_POSIX_C_SOURCE
Ë&& !deföed(
_XOPEN_SOURCE
) && \

411 !
deföed
(
_ANSI_SOURCE
Ë&& !deföed(
_C99_SOURCE
)) || \

412 
deföed
(
_DRAGONFLY_SOURCE
Ë|| 
	$deföed
(
_NETBSD_SOURCE
)

413 
	#__DF_VISIBLE
 1

	)

415 
	#__DF_VISIBLE
 0

	)

419 #i‡
	`deföed
(
_POSIX_C_SOURCE
) && (_POSIX_C_SOURCE - 0) == 1

420 #unde‡
_POSIX_C_SOURCE


421 
	#_POSIX_C_SOURCE
 199009

	)

425 #i‡
	`deföed
(
_POSIX_C_SOURCE
) && (_POSIX_C_SOURCE - 0) == 2

426 #unde‡
_POSIX_C_SOURCE


427 
	#_POSIX_C_SOURCE
 199209

	)

431 #ifde‡
_XOPEN_SOURCE


432 #i‡
_XOPEN_SOURCE
 - 0 >= 700

433 
	#__XSI_VISIBLE
 700

	)

434 #unde‡
_POSIX_C_SOURCE


435 
	#_POSIX_C_SOURCE
 200809

	)

436 #ñi‡
_XOPEN_SOURCE
 - 0 >= 600

437 
	#__XSI_VISIBLE
 600

	)

438 #unde‡
_POSIX_C_SOURCE


439 
	#_POSIX_C_SOURCE
 200112

	)

440 #ñi‡
_XOPEN_SOURCE
 - 0 >= 500

441 
	#__XSI_VISIBLE
 500

	)

442 #unde‡
_POSIX_C_SOURCE


443 
	#_POSIX_C_SOURCE
 199506

	)

451 #i‡
	`deföed
(
_POSIX_SOURCE
Ë&& !deföed(
_POSIX_C_SOURCE
)

452 
	#_POSIX_C_SOURCE
 198808

	)

454 #ifde‡
_POSIX_C_SOURCE


455 #i‡(
_POSIX_C_SOURCE
 - 0) >= 200809

456 
	#__POSIX_VISIBLE
 200809

	)

457 
	#__ISO_C_VISIBLE
 1999

	)

458 #ñi‡(
_POSIX_C_SOURCE
 - 0) >= 200112

459 
	#__POSIX_VISIBLE
 200112

	)

460 
	#__ISO_C_VISIBLE
 1999

	)

461 #ñi‡(
_POSIX_C_SOURCE
 - 0) >= 199506

462 
	#__POSIX_VISIBLE
 199506

	)

463 
	#__ISO_C_VISIBLE
 1990

	)

464 #ñi‡(
_POSIX_C_SOURCE
 - 0) >= 199309

465 
	#__POSIX_VISIBLE
 199309

	)

466 
	#__ISO_C_VISIBLE
 1990

	)

467 #ñi‡(
_POSIX_C_SOURCE
 - 0) >= 199209

468 
	#__POSIX_VISIBLE
 199209

	)

469 
	#__ISO_C_VISIBLE
 1990

	)

470 #ñi‡(
_POSIX_C_SOURCE
 - 0) >= 199009

471 
	#__POSIX_VISIBLE
 199009

	)

472 
	#__ISO_C_VISIBLE
 1990

	)

474 
	#__POSIX_VISIBLE
 198808

	)

475 
	#__ISO_C_VISIBLE
 0

	)

490 #ifde‡
_ANSI_SOURCE


491 
	#__POSIX_VISIBLE
 0

	)

492 
	#__XSI_VISIBLE
 0

	)

493 
	#__BSD_VISIBLE
 0

	)

494 
	#__ISO_C_VISIBLE
 1990

	)

495 #ñi‡
	`deföed
(
_C99_SOURCE
)

496 
	#__POSIX_VISIBLE
 0

	)

497 
	#__XSI_VISIBLE
 0

	)

498 
	#__BSD_VISIBLE
 0

	)

499 
	#__ISO_C_VISIBLE
 1999

	)

501 
	#__POSIX_VISIBLE
 200112

	)

502 
	#__XSI_VISIBLE
 600

	)

503 
	#__BSD_VISIBLE
 1

	)

504 
	#__ISO_C_VISIBLE
 1999

	)

	@inc/cell.h

1 #i‚de‡
__CELL_H__


2 
	#__CELL_H__


	)

3 
	~<öc/queue.h
>

4 
	~<GL/glut.h
>

5 
	~<öc/time_£q.h
>

6 
	~<öc/∑r£r.h
>

7 
	~<öc/curve.h
>

16 
	sBackground
{

18 
evít_t
 
	mevít_hódî
;

21 
	sAµrﬂch
{

23 
evít_t
 
	mevít_hódî
;

26 
	mpx
, 
	mpy
;

27 
	mcuºít_zoomøã
;

28 
GLuöt
 *
	mãx_gøph
;

31 
	sHôcú˛e
{

33 
evít_t
 
	mevít_hódî
;

35 
	mpx
, 
	mpy
;

36 
GLuöt
 *
	mãx_gøph
;

39 
	sCú˛íumbî
{

41 
evít_t
 
	mevít_hódî
;

43 
	mpx
, 
	mpy
;

44 
GLuöt
 *
	mãx_gøph
;

47 
	sSlidî
{

49 
evít_t
 
	mevít_hódî
;

51 
DŸ
 *
	mpoöts
;

52 
	mmax_Àn
;

53 
	mªvî£_time
;

54 
	mcﬁ‹_ödex
;

55 
	msound_ty≥
;

61 
	sHôsc‹e
{

63 
evít_t
 
	mevít_hódî
;

65 
	mpx
, 
	mpy
;

66 
GLuöt
 *
	mãx_gøph
;

67 
	mcuºít_zoomøã
;

73 
	sSlidîbÆl
{

75 
evít_t
 
	mevít_hódî
;

77 
	mpx
, 
	mpy
;

78 
GLuöt
 *
	mãx_gøph
;

79 
	mdx
, 
	mdy
;

80 
	msound_ty≥
;

81 
	mevî_∂ayed
;

91 
	#TIME_INTERVAL
 1

92 
	#CIRCLE_CLOSE_TIME
 800

93 
	#APPROACH_INIT_ZOOMRATE
 3

94 
	#HITSCORE_INIT_ZOOMRATE
 0.3

95 
	#HITSCORE_APPEAR_TIME
 100

	)

96 
	#HITCIRCLE_EXIST_TIME
 1000

97 
	#HITSCORE_EXIST_TIME
 500

98 

	)

103 
	mHIT_50
 = 0,

104 
	mHIT_100
,

105 
	mHIT_100k
,

106 
	mHIT_300
,

107 
	mHIT_300k
,

108 
	mHIT_300g
,

109 
	mHIT_miss
,

110 
	mHIT_30


117 
Aµrﬂch
 *
√w_≠¥ﬂch
(
x
, 
y
, 
GLuöt
 *
ãxt
);

118 
≠¥ﬂch_åiggî
(*
£lf
, 
time_£q_t
 *
time_£q
, 
size_t
 
time
);

119 
Hôcú˛e
 *
__©åibuã__
((
›timize
("O0"))Ë
√w_hôcú˛e
(
x
, 
y
, 
GLuöt
 *
ãxt
, 
wôh_ovîLay
);

120 
hôcú˛e_åiggî
(*
£lf
, 
time_£q_t
 *
time_£q
, 
size_t
 
time
);

121 
hôcú˛e_åiggî_no_ovîœy
(*
£lf
, 
time_£q_t
 *
time_£q
, 
size_t
 
time
);

122 
Cú˛íumbî
 *
__©åibuã__
((
›timize
("O0"))Ë
√w_cú˛íumbî
(
x
, 
y
, 
GLuöt
 *
ãxt
);

123 
cú˛íumbî_åiggî
(*
£lf
, 
time_£q_t
 *
time_£q
, 
size_t
 
time
);

124 
Hôsc‹e
 *
__©åibuã__
((
›timize
("O0"))Ë
√w_hôsc‹e
(
x
, 
y
, 
GLuöt
 *
ãxt
);

125 
hôsc‹e_åiggî
(*
£lf
, 
time_£q_t
 *
time_£q
, 
size_t
 
time
);

126 
SlidîbÆl
 *
√w_¶idîbÆl
(
x
, 
y
, 
GLuöt
 *
ãxt
, 
dx
, 
dy
, 
sound_ty≥
);

127 
¶idîbÆl_åiggî
(*
£lf
, 
time_£q_t
 *
time_£q
, 
size_t
 
time
);

128 
Slidî
 *
__©åibuã__
((
›timize
("O0"))Ë
√w_¶idî
(
DŸ
* 
poöts
, 
Àn
, 
cﬁ‹_ödex
, 
ªvî£_time
);

129 
¶idî_åiggî
(*
£lf
, 
time_£q_t
 *
time_£q
, 
size_t
 
time
);

130 
Background
* 
__©åibuã__
((
›timize
("O0"))Ë
√w_background
();

131 
background_åiggî
(*
£lf
, 
time_£q_t
 *
time_£q
, 
size_t
 
time
);

139 
¸óã_hôcú˛e_evít
(
x
, 
y
, 
cﬁ‹_ödex
, 
time_£q_t
 *
time_£q
, 
size_t
 
time
, size_à
œ°_time
, 
wôh_ovîœy
);

140 
¸óã_≠¥ﬂch_evít
(
x
, 
y
, 
cﬁ‹_ödex
, 
time_£q_t
 *
time_£q
, 
size_t
 
time
);

141 
¸óã_cú˛íumbî_evít
(
x
, 
y
, 
numbî
, 
time_£q_t
 *
time_£q
, 
size_t
 
time
, size_à
œ°_time
);

142 
¸óã_hôsc‹e_evít
(
x
, 
y
, 
sc‹e
, 
time_£q_t
 *
time_£q
, 
size_t
 
time
);

143 
¸óã_¶idîbÆl_evít
(
x
, 
y
, 
ödex
, 
time_£q_t
 *
time_£q
, 
size_t
 
time
, size_à
œ°_time
, 
dx
, 
dy
, 
sound_ty≥
);

144 
˚Œ_öô
();

146 
¸óã_¶idî
(
DŸ
 *
poöts
, 
Àn
, 
time_£q_t
 * 
time_£q
, 
cﬁ‹_ödex
, 
numbî
, 
ªvî£_time
, 
sound_ty≥
);

148 
¸óã_¶idî_bÆl
(
DŸ
 *
poöts
, 
Àn
, 
time_£q_t
 *
time_£q
, 
sˇn_time
, 
sound_ty≥
);

149 
¸óã_background
(*
background
, 
time_£q_t
 *
time_£q
, 
max_time
);

	@inc/curve.h

1 #i‚de‡
__CURVE_H__


2 
	#__CURVE_H__


	)

3 
	#CIRCLE_DENSITY
 10

	)

4 
	#DIV_POINT_NUM
 50

	)

5 
	~<öc/∑r£r.h
>

6 
	sDŸ
 {

7 
	mx
;

8 
	my
;

9 
	mtime
;

10 
	mdx
;

11 
	mdy
;

12 
	mis_tick
;

14 
curve_gë_¶idî_poöts
(
Slidî_r
 * 
¶idî
, 
¶idî_mu…ùlõr
, 
tick_øã
, 
bót_Àngth
, 
DŸ
 **);

	@inc/game.h

1 #i‚de‡
__GAME_H__


2 
	#__GAME_H__


	)

3 
	~<öc/ãxtuª.h
>

4 
	~<öc/audio.h
>

5 
	~<öc/mou£_judge.h
>

6 
	~<öc/∑r£r.h
>

7 
	~<öc/unföevít.h
>

9 
mou£_judge_t
 *
mou£_judge
;

10 
mou£_x
,
mou£_y
;

11 
GLuöt
 
ãx_curs‹
;

12 
UnföEvít
 *
u_evíts
;

13 
evít_num
;

14 
time_£q_t
 *
£q
;

15 
sound_t
 *
bgm
;

17 
di•œy
();

18 
ªsh≠e
(
w
, 
h
);

19 
døw_curs‹
(
x
, 
y
);

20 
mou£_døg
(
x
, 
y
);

21 
mou£_move
(
x
, 
y
);

22 
mou£_˛ick
(
buâ⁄
, 
°©e
, 
x
, 
y
);

23 
keybﬂrd
(
key
, 
x
, 
y
);

	@inc/game_status.h

1 #i‚de‡
__GAME_STATUS_H__


2 
	#__GAME_STATUS_H__


	)

3 
game_°©us
;

4 
cuºít_¶ide_°¨t
;

5 
cuºít_tick_id
;

7 
	#SET_GAME_STATUS
(
__bôs
Ë(
game_°©us
 |(__bôs))

	)

8 
	#RESET_GAME_STATUS
(
__bôs
Ë(
game_°©us
 &~(__bôs))

	)

10 
	#GAME_SF_ONSLIDER
 0x1

	)

11 
	#GAME_SF_STRAY
 0x2

	)

12 
	#GAME_SF_MOUSE_DOWN
 0x4

	)

	@inc/lodepng.h

26 #i‚de‡
LODEPNG_H


27 
	#LODEPNG_H


	)

29 
	~<°rög.h
>

31 #ifde‡
__˝lu•lus


32 
	~<ve˘‹
>

33 
	~<°rög
>

46 
	#LODEPNG_COMPILE_ZLIB


	)

47 
	#LODEPNG_COMPILE_PNG


	)

48 
	#LODEPNG_COMPILE_DECODER


	)

49 
	#LODEPNG_COMPILE_ENCODER


	)

50 
	#LODEPNG_COMPILE_DISK


	)

51 
	#LODEPNG_COMPILE_ANCILLARY_CHUNKS


	)

52 
	#LODEPNG_COMPILE_UNKNOWN_CHUNKS


	)

53 
	#LODEPNG_COMPILE_ERROR_TEXT


	)

67 #ifde‡
LODEPNG_COMPILE_PNG


68 #ifde‡
LODEPNG_COMPILE_DECODER


84 
LodePNG_decode
(** 
out
, * 
w
, * 
h
, c⁄° * 
ö
, 
size_t
 
ösize
, 
cﬁ‹Ty≥
, 
bôDïth
);

99 
LodePNG_decode32
(** 
out
, * 
w
, * 
h
, c⁄° * 
ö
, 
size_t
 
ösize
);

101 #ifde‡
LODEPNG_COMPILE_DISK


116 
LodePNG_decode_fûe
(** 
out
, * 
w
, * 
h
, c⁄° * 
fûíame
, 
cﬁ‹Ty≥
, 
bôDïth
);

131 
LodePNG_decode32_fûe
(** 
out
, * 
w
, * 
h
, c⁄° * 
fûíame
);

135 #ifde‡
LODEPNG_COMPILE_ENCODER


153 
LodePNG_ícode
(** 
out
, 
size_t
* 
outsize
, c⁄° * 
image
, 
w
, 
h
, 
cﬁ‹Ty≥
, 
bôDïth
);

167 
LodePNG_ícode32
(** 
out
, 
size_t
* 
outsize
, c⁄° * 
image
, 
w
, 
h
);

169 #ifde‡
LODEPNG_COMPILE_DISK


184 
LodePNG_ícode_fûe
(c⁄° * 
fûíame
, c⁄° * 
image
, 
w
, 
h
, 
cﬁ‹Ty≥
, 
bôDïth
);

196 
LodePNG_ícode32_fûe
(c⁄° * 
fûíame
, c⁄° * 
image
, 
w
, 
h
);

201 #ifde‡
__˝lu•lus


202 
«me•a˚
 
	gLodePNG


204 #ifde‡
LODEPNG_COMPILE_DECODER


220 
decode
(
°d
::
ve˘‹
<>& 
out
, & 
w
, & 
h
, c⁄° * 
ö
, 
size_t
 
ösize
, 
cﬁ‹Ty≥
 = 6, 
bôDïth
 = 8);

227 
decode
(
°d
::
ve˘‹
<>& 
out
, & 
w
, & 
h
, c⁄° std::ve˘‹<>& 
ö
, 
cﬁ‹Ty≥
 = 6, 
bôDïth
 = 8);

228 #ifde‡
LODEPNG_COMPILE_DISK


242 
decode
(
°d
::
ve˘‹
<>& 
out
, & 
w
, & 
h
, c⁄° std::
°rög
& 
fûíame
, 
cﬁ‹Ty≥
 = 6, 
bôDïth
 = 8);

246 #ifde‡
LODEPNG_COMPILE_ENCODER


261 
ícode
(
°d
::
ve˘‹
<>& 
out
, c⁄° * 
ö
, 
w
, 
h
, 
cﬁ‹Ty≥
 = 6, 
bôDïth
 = 8);

268 
ícode
(
°d
::
ve˘‹
<>& 
out
, c⁄° std::ve˘‹<>& 
ö
, 
w
, 
h
, 
cﬁ‹Ty≥
 = 6, 
bôDïth
 = 8);

269 #ifde‡
LODEPNG_COMPILE_DISK


283 
ícode
(c⁄° 
°d
::
°rög
& 
fûíame
, c⁄° * 
ö
, 
w
, 
h
, 
cﬁ‹Ty≥
 = 6, 
bôDïth
 = 8);

290 
ícode
(c⁄° 
°d
::
°rög
& 
fûíame
, c⁄° std::
ve˘‹
<>& 
ö
, 
w
, 
h
, 
cﬁ‹Ty≥
 = 6, 
bôDïth
 = 8);

297 #ifde‡
LODEPNG_COMPILE_ERROR_TEXT


303 c⁄° * 
LodePNG_îr‹_ãxt
(
code
);

316 #ifde‡
LODEPNG_COMPILE_DECODER


317 
	sLodeZlib_Decom¥essSëtögs


319 
	mign‹eAdÀr32
;

320 } 
	tLodeZlib_Decom¥essSëtögs
;

322 c⁄° 
LodeZlib_Decom¥essSëtögs
 
LodeZlib_deÁu…Decom¥essSëtögs
;

323 
LodeZlib_Decom¥essSëtögs_öô
(
LodeZlib_Decom¥essSëtögs
* 
£âögs
);

326 #ifde‡
LODEPNG_COMPILE_ENCODER


332 
	sLodeZlib_Com¥essSëtögs


335 
	mbty≥
;

336 
	mu£LZ77
;

337 
	mwödowSize
;

338 } 
	tLodeZlib_Com¥essSëtögs
;

340 c⁄° 
LodeZlib_Com¥essSëtögs
 
LodeZlib_deÁu…Com¥essSëtögs
;

341 
LodeZlib_Com¥essSëtögs_öô
(
LodeZlib_Com¥essSëtögs
* 
£âögs
);

344 #ifde‡
LODEPNG_COMPILE_PNG


356 
	sLodePNG_InfoCﬁ‹


359 
	mcﬁ‹Ty≥
;

360 
	mbôDïth
;

383 * 
	m∑Àâe
;

384 
size_t
 
	m∑Àâesize
;

394 
	mkey_deföed
;

395 
	mkey_r
;

396 
	mkey_g
;

397 
	mkey_b
;

398 } 
	tLodePNG_InfoCﬁ‹
;

401 
LodePNG_InfoCﬁ‹_öô
(
LodePNG_InfoCﬁ‹
* 
öfo
);

402 
LodePNG_InfoCﬁ‹_˛ónup
(
LodePNG_InfoCﬁ‹
* 
öfo
);

403 
LodePNG_InfoCﬁ‹_c›y
(
LodePNG_InfoCﬁ‹
* 
de°
, c⁄° LodePNG_InfoCﬁ‹* 
sour˚
);

406 
LodePNG_InfoCﬁ‹_˛órPÆëã
(
LodePNG_InfoCﬁ‹
* 
öfo
);

407 
LodePNG_InfoCﬁ‹_addPÆëã
(
LodePNG_InfoCﬁ‹
* 
öfo
, 
r
, 
g
, 
b
, 
a
);

410 
LodePNG_InfoCﬁ‹_gëBµ
(c⁄° 
LodePNG_InfoCﬁ‹
* 
öfo
);

411 
LodePNG_InfoCﬁ‹_gëCh™√ls
(c⁄° 
LodePNG_InfoCﬁ‹
* 
öfo
);

412 
LodePNG_InfoCﬁ‹_isGªysˇÀTy≥
(c⁄° 
LodePNG_InfoCﬁ‹
* 
öfo
);

413 
LodePNG_InfoCﬁ‹_isAÕhaTy≥
(c⁄° 
LodePNG_InfoCﬁ‹
* 
öfo
);

414 
LodePNG_InfoCﬁ‹_isPÆëãTy≥
(c⁄° 
LodePNG_InfoCﬁ‹
* 
öfo
);

415 
LodePNG_InfoCﬁ‹_hasPÆëãAÕha
(c⁄° 
LodePNG_InfoCﬁ‹
* 
öfo
);

424 
LodePNG_InfoCﬁ‹_ˇnHaveAÕha
(c⁄° 
LodePNG_InfoCﬁ‹
* 
öfo
);

426 #ifde‡
LODEPNG_COMPILE_ANCILLARY_CHUNKS


434 
	sLodePNG_Time


436 
	myór
;

437 
	mm⁄th
;

438 
	mday
;

439 
	mhour
;

440 
	mmöuã
;

441 
	m£c⁄d
;

442 } 
	tLodePNG_Time
;

458 
	sLodePNG_Text


462 
size_t
 
	mnum
;

463 ** 
	mkeys
;

464 ** 
	m°rögs
;

465 } 
	tLodePNG_Text
;

468 
LodePNG_Text_öô
(
LodePNG_Text
* 
ãxt
);

469 
LodePNG_Text_˛ónup
(
LodePNG_Text
* 
ãxt
);

470 
LodePNG_Text_c›y
(
LodePNG_Text
* 
de°
, c⁄° LodePNG_Text* 
sour˚
);

473 
LodePNG_Text_˛ór
(
LodePNG_Text
* 
ãxt
);

474 
LodePNG_Text_add
(
LodePNG_Text
* 
ãxt
, c⁄° * 
key
, c⁄° * 
°r
);

485 
	sLodePNG_IText


489 
size_t
 
	mnum
;

490 ** 
	mkeys
;

491 ** 
	mœngègs
;

492 ** 
	må™skeys
;

493 ** 
	m°rögs
;

494 } 
	tLodePNG_IText
;

497 
LodePNG_IText_öô
(
LodePNG_IText
* 
ãxt
);

498 
LodePNG_IText_˛ónup
(
LodePNG_IText
* 
ãxt
);

499 
LodePNG_IText_c›y
(
LodePNG_IText
* 
de°
, c⁄° LodePNG_IText* 
sour˚
);

502 
LodePNG_IText_˛ór
(
LodePNG_IText
* 
ãxt
);

503 
LodePNG_IText_add
(
LodePNG_IText
* 
ãxt
, c⁄° * 
key
, c⁄° * 
œngèg
, c⁄° * 
å™skey
, c⁄° * 
°r
);

506 #ifde‡
LODEPNG_COMPILE_UNKNOWN_CHUNKS


512 
	sLodePNG_UnknownChunks


522 * 
	md©a
[3];

523 
size_t
 
	md©asize
[3];

525 } 
	tLodePNG_UnknownChunks
;

528 
LodePNG_UnknownChunks_öô
(
LodePNG_UnknownChunks
* 
chunks
);

529 
LodePNG_UnknownChunks_˛ónup
(
LodePNG_UnknownChunks
* 
chunks
);

530 
LodePNG_UnknownChunks_c›y
(
LodePNG_UnknownChunks
* 
de°
, c⁄° LodePNG_UnknownChunks* 
§c
);

537 
	sLodePNG_InfoPng


546 
	mwidth
;

547 
	mheight
;

548 
	mcom¥essi⁄Mëhod
;

549 
	mfûãrMëhod
;

550 
	möãæa˚Mëhod
;

551 
LodePNG_InfoCﬁ‹
 
	mcﬁ‹
;

553 #ifde‡
LODEPNG_COMPILE_ANCILLARY_CHUNKS


566 
	mbackground_deföed
;

567 
	mbackground_r
;

568 
	mbackground_g
;

569 
	mbackground_b
;

572 
LodePNG_Text
 
	mãxt
;

575 
LodePNG_IText
 
	môext
;

578 
	mtime_deföed
;

579 
LodePNG_Time
 
	mtime
;

582 
	mphys_deföed
;

583 
	mphys_x
;

584 
	mphys_y
;

585 
	mphys_unô
;

589 #ifde‡
LODEPNG_COMPILE_UNKNOWN_CHUNKS


591 
LodePNG_UnknownChunks
 
	munknown_chunks
;

594 } 
	tLodePNG_InfoPng
;

597 
LodePNG_InfoPng_öô
(
LodePNG_InfoPng
* 
öfo
);

598 
LodePNG_InfoPng_˛ónup
(
LodePNG_InfoPng
* 
öfo
);

599 
LodePNG_InfoPng_c›y
(
LodePNG_InfoPng
* 
de°
, c⁄° LodePNG_InfoPng* 
sour˚
);

607 
	sLodePNG_InfoRaw


609 
LodePNG_InfoCﬁ‹
 
	mcﬁ‹
;

610 } 
	tLodePNG_InfoRaw
;

613 
LodePNG_InfoRaw_öô
(
LodePNG_InfoRaw
* 
öfo
);

614 
LodePNG_InfoRaw_˛ónup
(
LodePNG_InfoRaw
* 
öfo
);

615 
LodePNG_InfoRaw_c›y
(
LodePNG_InfoRaw
* 
de°
, c⁄° LodePNG_InfoRaw* 
sour˚
);

626 
LodePNG_c⁄vît
(* 
out
, c⁄° * 
ö
, 
LodePNG_InfoCﬁ‹
* 
öfoOut
, LodePNG_InfoCﬁ‹* 
öfoIn
, 
w
, 
h
);

628 #ifde‡
LODEPNG_COMPILE_DECODER


638 
	sLodePNG_DecodeSëtögs


640 
LodeZlib_Decom¥essSëtögs
 
	mzlib£âögs
;

642 
	mign‹eCrc
;

643 
	mcﬁ‹_c⁄vît
;

645 #ifde‡
LODEPNG_COMPILE_ANCILLARY_CHUNKS


646 
	mªadTextChunks
;

649 #ifde‡
LODEPNG_COMPILE_UNKNOWN_CHUNKS


650 
	mªmembîUnknownChunks
;

652 } 
	tLodePNG_DecodeSëtögs
;

654 
LodePNG_DecodeSëtögs_öô
(
LodePNG_DecodeSëtögs
* 
£âögs
);

661 
	sLodePNG_Decodî


663 
LodePNG_DecodeSëtögs
 
	m£âögs
;

664 
LodePNG_InfoRaw
 
	möfoRaw
;

665 
LodePNG_InfoPng
 
	möfoPng
;

666 
	mîr‹
;

667 } 
	tLodePNG_Decodî
;

670 
LodePNG_Decodî_öô
(
LodePNG_Decodî
* 
decodî
);

671 
LodePNG_Decodî_˛ónup
(
LodePNG_Decodî
* 
decodî
);

672 
LodePNG_Decodî_c›y
(
LodePNG_Decodî
* 
de°
, c⁄° LodePNG_Decodî* 
sour˚
);

682 
LodePNG_Decodî_decode
(
LodePNG_Decodî
* 
decodî
, ** 
out
, 
size_t
* 
outsize
, c⁄° * 
ö
, size_à
ösize
);

690 
LodePNG_Decodî_ö•e˘
(
LodePNG_Decodî
* 
decodî
, c⁄° * 
ö
, 
size_t
 
ösize
);

694 #ifde‡
LODEPNG_COMPILE_ENCODER


704 
	sLodePNG_EncodeSëtögs


706 
LodeZlib_Com¥essSëtögs
 
	mzlib£âögs
;

708 
	mautoLóveOutAÕhaCh™√l
;

709 
	mf‹˚_∑Àâe
;

710 #ifde‡
LODEPNG_COMPILE_ANCILLARY_CHUNKS


711 
	madd_id
;

712 
	mãxt_com¥essi⁄
;

714 } 
	tLodePNG_EncodeSëtögs
;

716 
LodePNG_EncodeSëtögs_öô
(
LodePNG_EncodeSëtögs
* 
£âögs
);

724 
	sLodePNG_Encodî


726 
LodePNG_EncodeSëtögs
 
	m£âögs
;

727 
LodePNG_InfoPng
 
	möfoPng
;

728 
LodePNG_InfoRaw
 
	möfoRaw
;

729 
	mîr‹
;

730 } 
	tLodePNG_Encodî
;

733 
LodePNG_Encodî_öô
(
LodePNG_Encodî
* 
ícodî
);

734 
LodePNG_Encodî_˛ónup
(
LodePNG_Encodî
* 
ícodî
);

735 
LodePNG_Encodî_c›y
(
LodePNG_Encodî
* 
de°
, c⁄° LodePNG_Encodî* 
sour˚
);

738 
LodePNG_Encodî_ícode
(
LodePNG_Encodî
* 
ícodî
, ** 
out
, 
size_t
* 
outsize
, c⁄° * 
image
, 
w
, 
h
);

754 
LodePNG_chunk_Àngth
(c⁄° * 
chunk
);

756 
LodePNG_chunk_ty≥
(
ty≥
[5], c⁄° * 
chunk
);

757 
LodePNG_chunk_ty≥_equÆs
(c⁄° * 
chunk
, c⁄° * 
ty≥
);

763 
LodePNG_chunk_¸ôiˇl
(c⁄° * 
chunk
);

764 
LodePNG_chunk_¥iv©e
(c⁄° * 
chunk
);

765 
LodePNG_chunk_ß„toc›y
(c⁄° * 
chunk
);

767 * 
LodePNG_chunk_d©a
(* 
chunk
);

768 c⁄° * 
LodePNG_chunk_d©a_c⁄°
(c⁄° * 
chunk
);

770 
LodePNG_chunk_check_¸c
(c⁄° * 
chunk
);

771 
LodePNG_chunk_gíî©e_¸c
(* 
chunk
);

774 * 
LodePNG_chunk_√xt
(* 
chunk
);

775 c⁄° * 
LodePNG_chunk_√xt_c⁄°
(c⁄° * 
chunk
);

783 
LodePNG_≠≥nd_chunk
(** 
out
, 
size_t
* 
ouéígth
, c⁄° * 
chunk
);

792 
LodePNG_¸óã_chunk
(** 
out
, 
size_t
* 
ouéígth
, 
Àngth
, c⁄° * 
ty≥
, c⁄° * 
d©a
);

796 #ifde‡
LODEPNG_COMPILE_ZLIB


809 #ifde‡
LODEPNG_COMPILE_DECODER


812 
LodeZlib_decom¥ess
(** 
out
, 
size_t
* 
outsize
, c⁄° * 
ö
, size_à
ösize
, c⁄° 
LodeZlib_Decom¥essSëtögs
* 
£âögs
);

815 #ifde‡
LODEPNG_COMPILE_ENCODER


818 
LodeZlib_com¥ess
(** 
out
, 
size_t
* 
outsize
, c⁄° * 
ö
, size_à
ösize
, c⁄° 
LodeZlib_Com¥essSëtögs
* 
£âögs
);

822 #ifde‡
LODEPNG_COMPILE_DISK


832 
LodePNG_lﬂdFûe
(** 
out
, 
size_t
* 
outsize
, c⁄° * 
fûíame
);

842 
LodePNG_ßveFûe
(c⁄° * 
buf„r
, 
size_t
 
buf„rsize
, c⁄° * 
fûíame
);

845 #ifde‡
__˝lu•lus


855 #ifde‡
LODEPNG_COMPILE_ZLIB


857 
«me•a˚
 
	gLodeZlib


859 #ifde‡
LODEPNG_COMPILE_DECODER


862 
decom¥ess
(
°d
::
ve˘‹
<>& 
out
, c⁄° * 
ö
, 
size_t
 
ösize
, c⁄° 
LodeZlib_Decom¥essSëtögs
& 
£âögs
 = 
LodeZlib_deÁu…Decom¥essSëtögs
);

865 
decom¥ess
(
°d
::
ve˘‹
<>& 
out
, c⁄° std::ve˘‹<>& 
ö
, c⁄° 
LodeZlib_Decom¥essSëtögs
& 
£âögs
 = 
LodeZlib_deÁu…Decom¥essSëtögs
);

868 #ifde‡
LODEPNG_COMPILE_ENCODER


871 
com¥ess
(
°d
::
ve˘‹
<>& 
out
, c⁄° * 
ö
, 
size_t
 
ösize
, c⁄° 
LodeZlib_Com¥essSëtögs
& 
£âögs
 = 
LodeZlib_deÁu…Com¥essSëtögs
);

874 
com¥ess
(
°d
::
ve˘‹
<>& 
out
, c⁄° std::ve˘‹<>& 
ö
, c⁄° 
LodeZlib_Com¥essSëtögs
& 
£âögs
 = 
LodeZlib_deÁu…Com¥essSëtögs
);

880 #ifde‡
LODEPNG_COMPILE_PNG


881 
«me•a˚
 
	gLodePNG


884 #ifde‡
LODEPNG_COMPILE_DECODER


892 ˛as†
	cDecodî
 : 
public
 
LodePNG_Decodî


894 
public
:

896 
Decodî
();

897 ~
Decodî
();

898 
	g›î©‹
=(c⁄° 
LodePNG_Decodî
& 
Ÿhî
);

901 
decode
(
°d
::
ve˘‹
<>& 
out
, c⁄° * 
ö
, 
size_t
 
ösize
);

904 
decode
(
°d
::
ve˘‹
<>& 
out
, c⁄° std::ve˘‹<>& 
ö
);

907 
ö•e˘
(c⁄° * 
ö
, 
size_t
 
ösize
);

910 
ö•e˘
(c⁄° 
°d
::
ve˘‹
<>& 
ö
);

913 
boﬁ
 
hasEº‹
() const;

914 
gëEº‹
() const;

917 
gëWidth
() const;

918 
gëHeight
() const;

919 
gëBµ
();

920 
gëCh™√ls
();

921 
isGªysˇÀTy≥
();

922 
isAÕhaTy≥
();

925 c⁄° 
	gLodePNG_DecodeSëtögs
& 
gëSëtögs
() const;

926 
	gLodePNG_DecodeSëtögs
& 
gëSëtögs
();

927 
£tSëtögs
(c⁄° 
LodePNG_DecodeSëtögs
& 
öfo
);

930 c⁄° 
	gLodePNG_InfoPng
& 
gëInfoPng
() const;

931 
	gLodePNG_InfoPng
& 
gëInfoPng
();

932 
£tInfoPng
(c⁄° 
LodePNG_InfoPng
& 
öfo
);

933 
sw≠InfoPng
(
LodePNG_InfoPng
& 
öfo
);

936 c⁄° 
	gLodePNG_InfoRaw
& 
gëInfoRaw
() const;

937 
	gLodePNG_InfoRaw
& 
gëInfoRaw
();

938 
£tInfoRaw
(c⁄° 
LodePNG_InfoRaw
& 
öfo
);

943 #ifde‡
LODEPNG_COMPILE_ENCODER


950 ˛as†
	cEncodî
 : 
public
 
LodePNG_Encodî


952 
public
:

954 
Encodî
();

955 ~
Encodî
();

956 
	g›î©‹
=(c⁄° 
LodePNG_Encodî
& 
Ÿhî
);

959 
ícode
(
°d
::
ve˘‹
<>& 
out
, c⁄° * 
image
, 
w
, 
h
);

962 
ícode
(
°d
::
ve˘‹
<>& 
out
, c⁄° std::ve˘‹<>& 
image
, 
w
, 
h
);

965 
boﬁ
 
hasEº‹
() const;

966 
gëEº‹
() const;

969 
˛órPÆëã
();

970 
addPÆëã
(
r
, 
g
, 
b
, 
a
);

971 #ifde‡
LODEPNG_COMPILE_ANCILLARY_CHUNKS


972 
˛órText
();

973 
addText
(c⁄° 
°d
::
°rög
& 
key
, c⁄° std::°rög& 
°r
);

974 
˛órIText
();

975 
addIText
(c⁄° 
°d
::
°rög
& 
key
, c⁄° std::°rög& 
œngèg
, c⁄° std::°rög& 
å™skey
, c⁄° std::°rög& 
°r
);

979 c⁄° 
	gLodePNG_EncodeSëtögs
& 
gëSëtögs
() const;

980 
	gLodePNG_EncodeSëtögs
& 
gëSëtögs
();

981 
£tSëtögs
(c⁄° 
LodePNG_EncodeSëtögs
& 
öfo
);

984 c⁄° 
	gLodePNG_InfoPng
& 
gëInfoPng
() const;

985 
	gLodePNG_InfoPng
& 
gëInfoPng
();

986 
£tInfoPng
(c⁄° 
LodePNG_InfoPng
& 
öfo
);

987 
sw≠InfoPng
(
LodePNG_InfoPng
& 
öfo
);

990 c⁄° 
	gLodePNG_InfoRaw
& 
gëInfoRaw
() const;

991 
	gLodePNG_InfoRaw
& 
gëInfoRaw
();

992 
£tInfoRaw
(c⁄° 
LodePNG_InfoRaw
& 
öfo
);

997 #ifde‡
LODEPNG_COMPILE_DISK


1003 
lﬂdFûe
(
°d
::
ve˘‹
<>& 
buf„r
, c⁄° std::
°rög
& 
fûíame
);

1010 
ßveFûe
(c⁄° 
°d
::
ve˘‹
<>& 
buf„r
, c⁄° std::
°rög
& 
fûíame
);

	@inc/mouse_judge.h

1 #i‚de‡
__MOUSE_JUDGE_H__


2 
	#__MOUSE_JUDGE_H__


	)

3 
	~<öc/queue.h
>

4 
	~<°ddef.h
>

5 
	~<öc/curve.h
>

11 
	#OBJECT_EQ
(
__po1
, 
__po2
)(((__po1)->
id
 == (__po2)->id) &&\

12 (
__po1
)->
ty≥
 =(
__po2
)->ty≥)

	)

13 
	eobje˘_ty≥
{

14 
	mobje˘_hô
 = 0,

15 
	mobje˘_¶ide_°¨t
,

16 
	mobje˘_¶ide_íd
,

17 
	mobje˘_¶ide_tick


20 
	eobje˘_sc‹e
{

21 
	msc‹e_300
 = 0,

22 
	msc‹e_100
,

23 
	msc‹e_50
,

24 
	msc‹e_miss
,

25 
	msc‹e_n⁄hô


28 
	gmou£_judge_t
;

29 
	sobje˘_t


31 
TAILQ_ENTRY
(
obje˘_t
Ë
	mqueue_íåy
;

32 
	mpos_x
, 
	mpos_y
;

33 
	mid
;

34 
obje˘_ty≥
 
	mty≥
;

35 
obje˘_sc‹e
 
	msc‹e
;

38 
TAILQ_HEAD
(
obje˘_queue_hód_t
, 
obje˘_t
);

40 
	smou£_judge_t
{

41 
obje˘_queue_hód_t
 *
	mobje˘_queue_¨øy
;

42 
size_t
 
	mÀngth
;

43 
	mªdius_hô
;

44 
	mªdius_¶ide
;

45 
	mthªshﬁd_300
;

46 
	mthªshﬁd_100
;

47 
	mthªshﬁd_50
;

48 
	mthªshﬁd_miss
;

49 
	mthªshﬁd_tŸÆ
;

50 
	mœ°_øã
;

53 
mou£_judge_t
 *
mou£_judge_öô
(
size_t
 
tŸÆ_m£c
, 
ªdius_hô
, 
ªdius_¶ide
, 
t300
, 
t100
, 
t50
, 
tm
);

54 
mou£_judge_ö£π_hôobje˘
(
mou£_judge_t
 *
mou£_judge
, 
pos_x
, 
pos_y
, 
size_t
 
time
, 
obje˘_ty≥
 
ty≥
, 
id
);

55 
mou£_judge_ö£π_¶idî
(
mou£_judge_t
 *
mou£_judge
, 
DŸ
 *
p
, 
dŸ_num
, 
ª≥©
, 
id
);

56 
obje˘_sc‹e
 
mou£_judge_˛ick
(
mou£_judge_t
 *
mou£_judge
, 
pos_x
, 
pos_y
, 
size_t
 
time
, *
id_°‹e
, 
obje˘_ty≥
* 
ty≥_°‹e
);

57 
obje˘_sc‹e
 
mou£_judge_up
(
mou£_judge_t
 *
mou£_judge
, 
pos_x
, 
pos_y
, 
size_t
 
time
, *
id_°‹e
, 
obje˘_ty≥
* 
ty≥_°‹e
);

58 
mou£_judge_døg
(
mou£_judge_t
 *
mou£_judge
, 
pos_x
, 
pos_y
, 
size_t
 
time
, *
id_°‹e
);

	@inc/parser.h

1 #i‚de‡
__PARSER_H__


2 
	#__PARSER_H__


	)

4 
	~<°dio.h
>

5 
	~<°dlib.h
>

6 
	~<°rög.h
>

8 
	~<öc/queue.h
>

9 
	~<°ddef.h
>

15 
	sGíîÆ


17 
	mAudioFûíame
[80];

18 
	mAudioLódIn
;

19 
	mPªvõwTime
;

20 
	mCou¡down
;

21 
	mSam∂eSë
;

22 
	mSèckLíõncy
;

23 
	mMode
;

24 
	mLëãrboxInBªaks
;

25 
	mEdô‹Bookm¨ks
[20];

26 }
	ggíîÆ
;

28 
	sMëad©a


30 
	mTôÀ
[80];

31 
	mAπi°
[80];

32 
	mCª©î
[80];

33 
	mVîsi⁄
[80];

34 
	mSour˚
[80];

35 
	mTags
[80];

36 }
	gmëad©a
;

38 
	sDifficu…y


40 
	mHPDøöR©e
;

41 
	mCú˛eSize
;

42 
	mOvîÆlDifficu…y
;

43 
	mSlidîMu…ùlõr
;

44 
	mSlidîTickR©e
;

45 }
	gdifficu…y
;

48 
	sTimögPoöts


50 
TAILQ_ENTRY
(
TimögPoöts
Ë
	mTíåy
;

51 
	moff£t
;

52 
	mbótLígth
;

53 
	mtimögSig«tuª
;

54 
	mßm∂eSëId
;

55 
	mu£Cu°omSam∂ós
;

56 
	mßm∂eVﬁume
;

57 
	mnŸInhîôed
;

58 
	misKüi
;

59 }
	gtimögPoöts
;

61 
	sHôCú˛e


63 
	mxPos
;

64 
	myPos
;

65 
	m°¨tTimeMs
;

66 
	mobje˘Ty≥
;

67 
	msoundTy≥
;

68 }
	ghôCú˛e
;

70 
	sSlidî_r


72 
	mxPos
;

73 
	myPos
;

74 
	m°¨tTimeMs
;

75 
	mobje˘Ty≥
;

76 
	msoundTy≥
;

77 
	mcurveTy≥
;

78 
	mposNum
;

79 
	mpos
[40][2];

80 
	mª≥©Cou¡
;

81 
	m¶idîLígthPixñs
;

82 }
	g¶idî
;

84 
	sHôObje˘s


86 
TAILQ_ENTRY
(
HôObje˘s
Ë
	mHíåy
;

87 
	mty≥
;

88 
HôCú˛e
 
	mhôCú˛e
;

89 
Slidî_r
 
	m¶idî
;

92 
	sCﬁ‹_r


94 
TAILQ_ENTRY
(
Cﬁ‹_r
Ë
	mCíåy
;

95 
	mr
;

96 
	mg
;

97 
	mb
;

98 }
	gcﬁ‹
;

99 
TAILQ_HEAD
(
Obje˘Li°
, 
HôObje˘s
);

100 
TAILQ_HEAD
(
Cﬁ‹Li°
, 
Cﬁ‹_r
);

101 
TAILQ_HEAD
(
TimögPoötsLi°
, 
TimögPoöts
);

102 
osu_ªad
(
FILE
* 
osu
);

103 
Obje˘Li°
 *
osu_gë_obje˘_li°
();

105 
Cﬁ‹Li°
 *
osu_gë_cﬁ‹_li°
();

107 
GíîÆ
 *
osu_gë_gíîÆ
();

108 
Difficu…y
 *
osu_gë_difficu…y
();

109 
TimögPoötsLi°
 *
osu_gë_timög_poöts
();

110 
is_HôCú˛e
(
HôObje˘s
 *
a
);

112 * 
osu_gë_backGround
();

113 * 
osu_gë_video
();

	@inc/queue.h

33 #i‚de‡
_SYS_QUEUE_H_


34 
	#_SYS_QUEUE_H_


	)

37 
	~<sys/cdefs.h
>

105 #ifde‡
QUEUE_MACRO_DEBUG


107 
	sqm_åa˚
 {

108 *
	mœ°fûe
;

109 
	mœ°löe
;

110 *
	m¥evfûe
;

111 
	m¥evlöe
;

114 
	#TRACEBUF
 
qm_åa˚
 
åa˚
;

	)

115 
	#TRASHIT
(
x
Ëdÿ{(xË(*)-1;} 0)

	)

116 
	#QMD_SAVELINK
(
«me
, 
lök
Ë**«mê(*)&÷ök)

	)

118 
	#QMD_TRACE_HEAD
(
hód
) do { \

119 (
hód
)->
åa˚
.
¥evlöe
 = (hód)->åa˚.
œ°löe
; \

120 (
hód
)->
åa˚
.
¥evfûe
 = (hód)->åa˚.
œ°fûe
; \

121 (
hód
)->
åa˚
.
œ°löe
 = 
__LINE__
; \

122 (
hód
)->
åa˚
.
œ°fûe
 = 
__FILE__
; \

123 } 0)

	)

125 
	#QMD_TRACE_ELEM
(
ñem
) do { \

126 (
ñem
)->
åa˚
.
¥evlöe
 = (ñem)->åa˚.
œ°löe
; \

127 (
ñem
)->
åa˚
.
¥evfûe
 = (ñem)->åa˚.
œ°fûe
; \

128 (
ñem
)->
åa˚
.
œ°löe
 = 
__LINE__
; \

129 (
ñem
)->
åa˚
.
œ°fûe
 = 
__FILE__
; \

130 } 0)

	)

133 
	#QMD_TRACE_ELEM
(
ñem
)

	)

134 
	#QMD_TRACE_HEAD
(
hód
)

	)

135 
	#QMD_SAVELINK
(
«me
, 
lök
)

	)

136 
	#TRACEBUF


	)

137 
	#TRASHIT
(
x
)

	)

143 
	#SLIST_HEAD
(
«me
, 
ty≥
) \

144 
	s«me
 { \

145 
ty≥
 *
¶h_fú°
; \

146 }

	)

148 
	#SLIST_HEAD_INITIALIZER
(
hód
) \

149 { 
NULL
 }

	)

151 
	#SLIST_ENTRY
(
ty≥
) \

153 
ty≥
 *
¶e_√xt
; \

154 }

	)

156 
	#SLIST_ENTRY_INITIALIZER
 { 
NULL
 }

	)

161 
	#SLIST_EMPTY
(
hód
Ë((hód)->
¶h_fú°
 =
NULL
)

	)

163 
	#SLIST_FIRST
(
hód
Ë((hód)->
¶h_fú°
)

	)

165 
	#SLIST_FOREACH
(
v¨
, 
hód
, 
fõld
) \

166 (
v¨
Ë
	`SLIST_FIRST
((
hód
)); \

167 (
v¨
); \

168 (
v¨
Ë
	`SLIST_NEXT
((v¨), 
fõld
))

	)

170 
	#SLIST_FOREACH_MUTABLE
(
v¨
, 
hód
, 
fõld
, 
tv¨
) \

171 (
v¨
Ë
	`SLIST_FIRST
((
hód
)); \

172 (
v¨
Ë&& ((
tv¨
Ë
	`SLIST_NEXT
((v¨), 
fõld
), 1); \

173 (
v¨
Ë(
tv¨
))

	)

175 
	#SLIST_FOREACH_PREVPTR
(
v¨
, 
v¨p
, 
hód
, 
fõld
) \

176 (
v¨p
Ë&
	`SLIST_FIRST
((
hód
)); \

177 ((
v¨
Ë*(
v¨p
)Ë!
NULL
; \

178 (
v¨p
Ë&
	`SLIST_NEXT
((
v¨
), 
fõld
))

	)

180 
	#SLIST_INIT
(
hód
) do { \

181 
	`SLIST_FIRST
((
hód
)Ë
NULL
; \

182 } 0)

	)

184 
	#SLIST_INSERT_AFTER
(
¶i°ñm
, 
ñm
, 
fõld
) do { \

185 
	`SLIST_NEXT
((
ñm
), 
fõld
ËSLIST_NEXT((
¶i°ñm
), field); \

186 
	`SLIST_NEXT
((
¶i°ñm
), 
fõld
Ë(
ñm
); \

187 } 0)

	)

189 
	#SLIST_INSERT_HEAD
(
hód
, 
ñm
, 
fõld
) do { \

190 
	`SLIST_NEXT
((
ñm
), 
fõld
Ë
	`SLIST_FIRST
((
hód
)); \

191 
	`SLIST_FIRST
((
hód
)Ë(
ñm
); \

192 } 0)

	)

194 
	#SLIST_NEXT
(
ñm
, 
fõld
Ë(”lm)->fõld.
¶e_√xt
)

	)

196 
	#SLIST_REMOVE
(
hód
, 
ñm
, 
ty≥
, 
fõld
) do { \

197 
	`QMD_SAVELINK
(
ﬁd√xt
, (
ñm
)->
fõld
.
¶e_√xt
); \

198 i‡(
	`SLIST_FIRST
((
hód
)Ë=(
ñm
)) { \

199 
	`SLIST_REMOVE_HEAD
((
hód
), 
fõld
); \

202 
ty≥
 *
cuªlm
 = 
	`SLIST_FIRST
((
hód
)); \

203 
	`SLIST_NEXT
(
cuªlm
, 
fõld
Ë!(
ñm
)) \

204 
cuªlm
 = 
	`SLIST_NEXT
(cuªlm, 
fõld
); \

205 
	`SLIST_REMOVE_AFTER
(
cuªlm
, 
fõld
); \

207 
	`TRASHIT
(*
ﬁd√xt
); \

208 } 0)

	)

210 
	#SLIST_REMOVE_AFTER
(
ñm
, 
fõld
) do { \

211 
	`SLIST_NEXT
(
ñm
, 
fõld
) = \

212 
	`SLIST_NEXT
(SLIST_NEXT(
ñm
, 
fõld
), field); \

213 } 0)

	)

215 
	#SLIST_REMOVE_HEAD
(
hód
, 
fõld
) do { \

216 
	`SLIST_FIRST
((
hód
)Ë
	`SLIST_NEXT
(SLIST_FIRST((hód)), 
fõld
); \

217 } 0)

	)

219 
	#SLIST_SWAP
(
hód1
, 
hód2
, 
ty≥
) do { \

220 
ty≥
 *
sw≠_fú°
 = 
	`SLIST_FIRST
(
hód1
); \

221 
	`SLIST_FIRST
(
hód1
ËSLIST_FIRST(
hód2
); \

222 
	`SLIST_FIRST
(
hód2
Ë
sw≠_fú°
; \

223 } 0)

	)

228 
	#STAILQ_HEAD
(
«me
, 
ty≥
) \

229 
	s«me
 { \

230 
ty≥
 *
°qh_fú°
; \

231 
ty≥
 **
°qh_œ°
; \

232 }

	)

234 
	#STAILQ_HEAD_INITIALIZER
(
hód
) \

235 { 
NULL
, &(
hód
).
°qh_fú°
 }

	)

237 
	#STAILQ_ENTRY
(
ty≥
) \

239 
ty≥
 *
°qe_√xt
; \

240 }

	)

245 
	#STAILQ_CONCAT
(
hód1
, 
hód2
) do { \

246 i‡(!
	`STAILQ_EMPTY
((
hód2
))) { \

247 *(
hód1
)->
°qh_œ°
 = (
hód2
)->
°qh_fú°
; \

248 (
hód1
)->
°qh_œ°
 = (
hód2
)->stqh_last; \

249 
	`STAILQ_INIT
((
hód2
)); \

251 } 0)

	)

253 
	#STAILQ_EMPTY
(
hód
Ë((hód)->
°qh_fú°
 =
NULL
)

	)

255 
	#STAILQ_FIRST
(
hód
Ë((hód)->
°qh_fú°
)

	)

257 
	#STAILQ_FOREACH
(
v¨
, 
hód
, 
fõld
) \

258 (
v¨
Ë
	`STAILQ_FIRST
((
hód
)); \

259 (
v¨
); \

260 (
v¨
Ë
	`STAILQ_NEXT
((v¨), 
fõld
))

	)

263 
	#STAILQ_FOREACH_MUTABLE
(
v¨
, 
hód
, 
fõld
, 
tv¨
) \

264 (
v¨
Ë
	`STAILQ_FIRST
((
hód
)); \

265 (
v¨
Ë&& ((
tv¨
Ë
	`STAILQ_NEXT
((v¨), 
fõld
), 1); \

266 (
v¨
Ë(
tv¨
))

	)

268 
	#STAILQ_INIT
(
hód
) do { \

269 
	`STAILQ_FIRST
((
hód
)Ë
NULL
; \

270 (
hód
)->
°qh_œ°
 = &
	`STAILQ_FIRST
((head)); \

271 } 0)

	)

273 
	#STAILQ_INSERT_AFTER
(
hód
, 
tqñm
, 
ñm
, 
fõld
) do { \

274 i‡((
	`STAILQ_NEXT
((
ñm
), 
fõld
ËSTAILQ_NEXT((
tqñm
), fõld)Ë=
NULL
)\

275 (
hód
)->
°qh_œ°
 = &
	`STAILQ_NEXT
((
ñm
), 
fõld
); \

276 
	`STAILQ_NEXT
((
tqñm
), 
fõld
Ë(
ñm
); \

277 } 0)

	)

279 
	#STAILQ_INSERT_HEAD
(
hód
, 
ñm
, 
fõld
) do { \

280 i‡((
	`STAILQ_NEXT
((
ñm
), 
fõld
Ë
	`STAILQ_FIRST
((
hód
))Ë=
NULL
) \

281 (
hód
)->
°qh_œ°
 = &
	`STAILQ_NEXT
((
ñm
), 
fõld
); \

282 
	`STAILQ_FIRST
((
hód
)Ë(
ñm
); \

283 } 0)

	)

285 
	#STAILQ_INSERT_TAIL
(
hód
, 
ñm
, 
fõld
) do { \

286 
	`STAILQ_NEXT
((
ñm
), 
fõld
Ë
NULL
; \

287 *(
hód
)->
°qh_œ°
 = (
ñm
); \

288 (
hód
)->
°qh_œ°
 = &
	`STAILQ_NEXT
((
ñm
), 
fõld
); \

289 } 0)

	)

291 
	#STAILQ_LAST
(
hód
, 
ty≥
, 
fõld
) \

292 (
	`STAILQ_EMPTY
((
hód
)) ? \

293 
NULL
 : \

294 ((
ty≥
 *)(*) \

295 ((*)((
hód
)->
°qh_œ°
Ë- 
	`__off£tof
(
ty≥
, 
fõld
))))

	)

297 
	#STAILQ_NEXT
(
ñm
, 
fõld
Ë(”lm)->fõld.
°qe_√xt
)

	)

299 
	#STAILQ_REMOVE
(
hód
, 
ñm
, 
ty≥
, 
fõld
) do { \

300 
	`QMD_SAVELINK
(
ﬁd√xt
, (
ñm
)->
fõld
.
°qe_√xt
); \

301 i‡(
	`STAILQ_FIRST
((
hód
)Ë=(
ñm
)) { \

302 
	`STAILQ_REMOVE_HEAD
((
hód
), 
fõld
); \

305 
ty≥
 *
cuªlm
 = 
	`STAILQ_FIRST
((
hód
)); \

306 
	`STAILQ_NEXT
(
cuªlm
, 
fõld
Ë!(
ñm
)) \

307 
cuªlm
 = 
	`STAILQ_NEXT
(cuªlm, 
fõld
); \

308 
	`STAILQ_REMOVE_AFTER
(
hód
, 
cuªlm
, 
fõld
); \

310 
	`TRASHIT
(*
ﬁd√xt
); \

311 } 0)

	)

313 
	#STAILQ_REMOVE_HEAD
(
hód
, 
fõld
) do { \

314 i‡((
	`STAILQ_FIRST
((
hód
)) = \

315 
	`STAILQ_NEXT
(
	`STAILQ_FIRST
((
hód
)), 
fõld
)Ë=
NULL
) \

316 (
hód
)->
°qh_œ°
 = &
	`STAILQ_FIRST
((head)); \

317 } 0)

	)

319 
	#STAILQ_REMOVE_AFTER
(
hód
, 
ñm
, 
fõld
) do { \

320 i‡((
	`STAILQ_NEXT
(
ñm
, 
fõld
) = \

321 
	`STAILQ_NEXT
(STAILQ_NEXT(
ñm
, 
fõld
), fõld)Ë=
NULL
) \

322 (
hód
)->
°qh_œ°
 = &
	`STAILQ_NEXT
((
ñm
), 
fõld
); \

323 } 0)

	)

325 
	#STAILQ_SWAP
(
hód1
, 
hód2
, 
ty≥
) do { \

326 
ty≥
 *
sw≠_fú°
 = 
	`STAILQ_FIRST
(
hód1
); \

327 
ty≥
 **
sw≠_œ°
 = (
hód1
)->
°qh_œ°
; \

328 
	`STAILQ_FIRST
(
hód1
ËSTAILQ_FIRST(
hód2
); \

329 (
hód1
)->
°qh_œ°
 = (
hód2
)->stqh_last; \

330 
	`STAILQ_FIRST
(
hód2
Ë
sw≠_fú°
; \

331 (
hód2
)->
°qh_œ°
 = 
sw≠_œ°
; \

332 i‡(
	`STAILQ_EMPTY
(
hód1
)) \

333 (
hód1
)->
°qh_œ°
 = &
	`STAILQ_FIRST
(head1); \

334 i‡(
	`STAILQ_EMPTY
(
hód2
)) \

335 (
hód2
)->
°qh_œ°
 = &
	`STAILQ_FIRST
(head2); \

336 } 0)

	)

342 
	#LIST_HEAD
(
«me
, 
ty≥
) \

343 
	s«me
 { \

344 
ty≥
 *
lh_fú°
; \

345 }

	)

347 
	#LIST_HEAD_INITIALIZER
(
hód
) \

348 { 
NULL
 }

	)

350 
	#LIST_ENTRY
(
ty≥
) \

352 
ty≥
 *
À_√xt
; \

353 
ty≥
 **
À_¥ev
; \

354 }

	)

360 #i‡(
deföed
(
_KERNEL
Ë&& deföed(
INVARIANTS
))

361 
	#QMD_LIST_CHECK_HEAD
(
hód
, 
fõld
) do { \

362 i‡(
	`LIST_FIRST
((
hód
)Ë!
NULL
 && \

363 
	`LIST_FIRST
((
hód
))->
fõld
.
À_¥ev
 != \

364 &
	`LIST_FIRST
((
hód
))) \

365 
	`∑nic
("BadÜi° hód %∞fú°->¥ev !hód", (
hód
)); \

366 } 0)

	)

368 
	#QMD_LIST_CHECK_NEXT
(
ñm
, 
fõld
) do { \

369 i‡(
	`LIST_NEXT
((
ñm
), 
fõld
Ë!
NULL
 && \

370 
	`LIST_NEXT
((
ñm
), 
fõld
)->fõld.
À_¥ev
 != \

371 &((
ñm
)->
fõld
.
À_√xt
)) \

372 
	`∑nic
("BadÜökÉlm %∞√xt->¥ev !ñm", (
ñm
)); \

373 } 0)

	)

375 
	#QMD_LIST_CHECK_PREV
(
ñm
, 
fõld
) do { \

376 i‡(*(
ñm
)->
fõld
.
À_¥ev
 != (elm)) \

377 
	`∑nic
("BadÜökÉlm %∞¥ev->√xà!ñm", (
ñm
)); \

378 } 0)

	)

380 
	#QMD_LIST_CHECK_HEAD
(
hód
, 
fõld
)

	)

381 
	#QMD_LIST_CHECK_NEXT
(
ñm
, 
fõld
)

	)

382 
	#QMD_LIST_CHECK_PREV
(
ñm
, 
fõld
)

	)

385 
	#LIST_EMPTY
(
hód
Ë((hód)->
lh_fú°
 =
NULL
)

	)

387 
	#LIST_FIRST
(
hód
Ë((hód)->
lh_fú°
)

	)

389 
	#LIST_FOREACH
(
v¨
, 
hód
, 
fõld
) \

390 (
v¨
Ë
	`LIST_FIRST
((
hód
)); \

391 (
v¨
); \

392 (
v¨
Ë
	`LIST_NEXT
((v¨), 
fõld
))

	)

394 
	#LIST_FOREACH_MUTABLE
(
v¨
, 
hód
, 
fõld
, 
tv¨
) \

395 (
v¨
Ë
	`LIST_FIRST
((
hód
)); \

396 (
v¨
Ë&& ((
tv¨
Ë
	`LIST_NEXT
((v¨), 
fõld
), 1); \

397 (
v¨
Ë(
tv¨
))

	)

399 
	#LIST_INIT
(
hód
) do { \

400 
	`LIST_FIRST
((
hód
)Ë
NULL
; \

401 } 0)

	)

403 
	#LIST_INSERT_AFTER
(
li°ñm
, 
ñm
, 
fõld
) do { \

404 
	`QMD_LIST_CHECK_NEXT
(
li°ñm
, 
fõld
); \

405 i‡((
	`LIST_NEXT
((
ñm
), 
fõld
ËLIST_NEXT((
li°ñm
), fõld)Ë!
NULL
)\

406 
	`LIST_NEXT
((
li°ñm
), 
fõld
)->fõld.
À_¥ev
 = \

407 &
	`LIST_NEXT
((
ñm
), 
fõld
); \

408 
	`LIST_NEXT
((
li°ñm
), 
fõld
Ë(
ñm
); \

409 (
ñm
)->
fõld
.
À_¥ev
 = &
	`LIST_NEXT
((
li°ñm
), field); \

410 } 0)

	)

412 
	#LIST_INSERT_BEFORE
(
li°ñm
, 
ñm
, 
fõld
) do { \

413 
	`QMD_LIST_CHECK_PREV
(
li°ñm
, 
fõld
); \

414 (
ñm
)->
fõld
.
À_¥ev
 = (
li°ñm
)->field.le_prev; \

415 
	`LIST_NEXT
((
ñm
), 
fõld
Ë(
li°ñm
); \

416 *(
li°ñm
)->
fõld
.
À_¥ev
 = (
ñm
); \

417 (
li°ñm
)->
fõld
.
À_¥ev
 = &
	`LIST_NEXT
((
ñm
), field); \

418 } 0)

	)

420 
	#LIST_INSERT_HEAD
(
hód
, 
ñm
, 
fõld
) do { \

421 
	`QMD_LIST_CHECK_HEAD
((
hód
), 
fõld
); \

422 i‡((
	`LIST_NEXT
((
ñm
), 
fõld
Ë
	`LIST_FIRST
((
hód
))Ë!
NULL
) \

423 
	`LIST_FIRST
((
hód
))->
fõld
.
À_¥ev
 = &
	`LIST_NEXT
((
ñm
), field);\

424 
	`LIST_FIRST
((
hód
)Ë(
ñm
); \

425 (
ñm
)->
fõld
.
À_¥ev
 = &
	`LIST_FIRST
((
hód
)); \

426 } 0)

	)

428 
	#LIST_NEXT
(
ñm
, 
fõld
Ë(”lm)->fõld.
À_√xt
)

	)

430 
	#LIST_REMOVE
(
ñm
, 
fõld
) do { \

431 
	`QMD_SAVELINK
(
ﬁd√xt
, (
ñm
)->
fõld
.
À_√xt
); \

432 
	`QMD_SAVELINK
(
ﬁd¥ev
, (
ñm
)->
fõld
.
À_¥ev
); \

433 
	`QMD_LIST_CHECK_NEXT
(
ñm
, 
fõld
); \

434 
	`QMD_LIST_CHECK_PREV
(
ñm
, 
fõld
); \

435 i‡(
	`LIST_NEXT
((
ñm
), 
fõld
Ë!
NULL
) \

436 
	`LIST_NEXT
((
ñm
), 
fõld
)->fõld.
À_¥ev
 = \

437 (
ñm
)->
fõld
.
À_¥ev
; \

438 *(
ñm
)->
fõld
.
À_¥ev
 = 
	`LIST_NEXT
((elm), field); \

439 
	`TRASHIT
(*
ﬁd√xt
); \

440 
	`TRASHIT
(*
ﬁd¥ev
); \

441 } 0)

	)

443 
	#LIST_SWAP
(
hód1
, 
hód2
, 
ty≥
, 
fõld
) do { \

444 
ty≥
 *
sw≠_tmp
 = 
	`LIST_FIRST
((
hód1
)); \

445 
	`LIST_FIRST
((
hód1
)ËLIST_FIRST((
hód2
)); \

446 
	`LIST_FIRST
((
hód2
)Ë
sw≠_tmp
; \

447 i‡((
sw≠_tmp
 = 
	`LIST_FIRST
((
hód1
))Ë!
NULL
) \

448 
sw≠_tmp
->
fõld
.
À_¥ev
 = &
	`LIST_FIRST
((
hód1
)); \

449 i‡((
sw≠_tmp
 = 
	`LIST_FIRST
((
hód2
))Ë!
NULL
) \

450 
sw≠_tmp
->
fõld
.
À_¥ev
 = &
	`LIST_FIRST
((
hód2
)); \

451 } 0)

	)

456 
	#TAILQ_HEAD
(
«me
, 
ty≥
) \

457 
	s«me
 { \

458 
ty≥
 *
tqh_fú°
; \

459 
ty≥
 **
tqh_œ°
; \

460 
TRACEBUF
 \

461 }

	)

463 
	#TAILQ_HEAD_INITIALIZER
(
hód
) \

464 { 
NULL
, &(
hód
).
tqh_fú°
 }

	)

466 
	#TAILQ_ENTRY
(
ty≥
) \

468 
ty≥
 *
tqe_√xt
; \

469 
ty≥
 **
tqe_¥ev
; \

470 
TRACEBUF
 \

471 }

	)

476 #i‡(
deföed
(
_KERNEL
Ë&& deföed(
INVARIANTS
))

477 
	#QMD_TAILQ_CHECK_HEAD
(
hód
, 
fõld
) do { \

478 i‡(!
	`TAILQ_EMPTY
(
hód
) && \

479 
	`TAILQ_FIRST
((
hód
))->
fõld
.
tqe_¥ev
 != \

480 &
	`TAILQ_FIRST
((
hód
))) \

481 
	`∑nic
("BadÅaûq hód %∞fú°->¥ev !hód", (
hód
)); \

482 } 0)

	)

484 
	#QMD_TAILQ_CHECK_TAIL
(
hód
, 
fõld
) do { \

485 i‡(*(
hód
)->
tqh_œ°
 !
NULL
) \

486 
	`∑nic
("BadÅaûq NEXT(%p->tqh_œ°Ë!NULL", (
hód
)); \

487 } 0)

	)

489 
	#QMD_TAILQ_CHECK_NEXT
(
ñm
, 
fõld
) do { \

490 i‡(
	`TAILQ_NEXT
((
ñm
), 
fõld
Ë!
NULL
 && \

491 
	`TAILQ_NEXT
((
ñm
), 
fõld
)->fõld.
tqe_¥ev
 != \

492 &((
ñm
)->
fõld
.
tqe_√xt
)) \

493 
	`∑nic
("BadÜökÉlm %∞√xt->¥ev !ñm", (
ñm
)); \

494 } 0)

	)

496 
	#QMD_TAILQ_CHECK_PREV
(
ñm
, 
fõld
) do { \

497 i‡(*(
ñm
)->
fõld
.
tqe_¥ev
 != (elm)) \

498 
	`∑nic
("BadÜökÉlm %∞¥ev->√xà!ñm", (
ñm
)); \

499 } 0)

	)

501 
	#QMD_TAILQ_CHECK_HEAD
(
hód
, 
fõld
)

	)

502 
	#QMD_TAILQ_CHECK_TAIL
(
hód
, 
hód«me
)

	)

503 
	#QMD_TAILQ_CHECK_NEXT
(
ñm
, 
fõld
)

	)

504 
	#QMD_TAILQ_CHECK_PREV
(
ñm
, 
fõld
)

	)

507 
	#TAILQ_CONCAT
(
hód1
, 
hód2
, 
fõld
) do { \

508 i‡(!
	`TAILQ_EMPTY
(
hód2
)) { \

509 *(
hód1
)->
tqh_œ°
 = (
hód2
)->
tqh_fú°
; \

510 (
hód2
)->
tqh_fú°
->
fõld
.
tqe_¥ev
 = (
hód1
)->
tqh_œ°
; \

511 (
hód1
)->
tqh_œ°
 = (
hód2
)->tqh_last; \

512 
	`TAILQ_INIT
((
hód2
)); \

513 
	`QMD_TRACE_HEAD
(
hód1
); \

514 
	`QMD_TRACE_HEAD
(
hód2
); \

516 } 0)

	)

518 
	#TAILQ_EMPTY
(
hód
Ë((hód)->
tqh_fú°
 =
NULL
)

	)

520 
	#TAILQ_FIRST
(
hód
Ë((hód)->
tqh_fú°
)

	)

522 
	#TAILQ_FOREACH
(
v¨
, 
hód
, 
fõld
) \

523 (
v¨
Ë
	`TAILQ_FIRST
((
hód
)); \

524 (
v¨
); \

525 (
v¨
Ë
	`TAILQ_NEXT
((v¨), 
fõld
))

	)

527 
	#TAILQ_FOREACH_MUTABLE
(
v¨
, 
hód
, 
fõld
, 
tv¨
) \

528 (
v¨
Ë
	`TAILQ_FIRST
((
hód
)); \

529 (
v¨
Ë&& ((
tv¨
Ë
	`TAILQ_NEXT
((v¨), 
fõld
), 1); \

530 (
v¨
Ë(
tv¨
))

	)

532 
	#TAILQ_FOREACH_REVERSE
(
v¨
, 
hód
, 
hód«me
, 
fõld
) \

533 (
v¨
Ë
	`TAILQ_LAST
((
hód
), 
hód«me
); \

534 (
v¨
); \

535 (
v¨
Ë
	`TAILQ_PREV
((v¨), 
hód«me
, 
fõld
))

	)

537 
	#TAILQ_FOREACH_REVERSE_MUTABLE
(
v¨
, 
hód
, 
hód«me
, 
fõld
, 
tv¨
) \

538 (
v¨
Ë
	`TAILQ_LAST
((
hód
), 
hód«me
); \

539 (
v¨
Ë&& ((
tv¨
Ë
	`TAILQ_PREV
((v¨), 
hód«me
, 
fõld
), 1); \

540 (
v¨
Ë(
tv¨
))

	)

542 
	#TAILQ_INIT
(
hód
) do { \

543 
	`TAILQ_FIRST
((
hód
)Ë
NULL
; \

544 (
hód
)->
tqh_œ°
 = &
	`TAILQ_FIRST
((head)); \

545 
	`QMD_TRACE_HEAD
(
hód
); \

546 } 0)

	)

548 
	#TAILQ_INSERT_AFTER
(
hód
, 
li°ñm
, 
ñm
, 
fõld
) do { \

549 
	`QMD_TAILQ_CHECK_NEXT
(
li°ñm
, 
fõld
); \

550 i‡((
	`TAILQ_NEXT
((
ñm
), 
fõld
ËTAILQ_NEXT((
li°ñm
), fõld)Ë!
NULL
)\

551 
	`TAILQ_NEXT
((
ñm
), 
fõld
)->fõld.
tqe_¥ev
 = \

552 &
	`TAILQ_NEXT
((
ñm
), 
fõld
); \

554 (
hód
)->
tqh_œ°
 = &
	`TAILQ_NEXT
((
ñm
), 
fõld
); \

555 
	`QMD_TRACE_HEAD
(
hód
); \

557 
	`TAILQ_NEXT
((
li°ñm
), 
fõld
Ë(
ñm
); \

558 (
ñm
)->
fõld
.
tqe_¥ev
 = &
	`TAILQ_NEXT
((
li°ñm
), field); \

559 
	`QMD_TRACE_ELEM
(&(
ñm
)->
fõld
); \

560 
	`QMD_TRACE_ELEM
(&
li°ñm
->
fõld
); \

561 } 0)

	)

563 
	#TAILQ_INSERT_BEFORE
(
li°ñm
, 
ñm
, 
fõld
) do { \

564 
	`QMD_TAILQ_CHECK_PREV
(
li°ñm
, 
fõld
); \

565 (
ñm
)->
fõld
.
tqe_¥ev
 = (
li°ñm
)->field.tqe_prev; \

566 
	`TAILQ_NEXT
((
ñm
), 
fõld
Ë(
li°ñm
); \

567 *(
li°ñm
)->
fõld
.
tqe_¥ev
 = (
ñm
); \

568 (
li°ñm
)->
fõld
.
tqe_¥ev
 = &
	`TAILQ_NEXT
((
ñm
), field); \

569 
	`QMD_TRACE_ELEM
(&(
ñm
)->
fõld
); \

570 
	`QMD_TRACE_ELEM
(&
li°ñm
->
fõld
); \

571 } 0)

	)

573 
	#TAILQ_INSERT_HEAD
(
hód
, 
ñm
, 
fõld
) do { \

574 
	`QMD_TAILQ_CHECK_HEAD
(
hód
, 
fõld
); \

575 i‡((
	`TAILQ_NEXT
((
ñm
), 
fõld
Ë
	`TAILQ_FIRST
((
hód
))Ë!
NULL
) \

576 
	`TAILQ_FIRST
((
hód
))->
fõld
.
tqe_¥ev
 = \

577 &
	`TAILQ_NEXT
((
ñm
), 
fõld
); \

579 (
hód
)->
tqh_œ°
 = &
	`TAILQ_NEXT
((
ñm
), 
fõld
); \

580 
	`TAILQ_FIRST
((
hód
)Ë(
ñm
); \

581 (
ñm
)->
fõld
.
tqe_¥ev
 = &
	`TAILQ_FIRST
((
hód
)); \

582 
	`QMD_TRACE_HEAD
(
hód
); \

583 
	`QMD_TRACE_ELEM
(&(
ñm
)->
fõld
); \

584 } 0)

	)

586 
	#TAILQ_INSERT_TAIL
(
hód
, 
ñm
, 
fõld
) do { \

587 
	`QMD_TAILQ_CHECK_TAIL
(
hód
, 
fõld
); \

588 
	`TAILQ_NEXT
((
ñm
), 
fõld
Ë
NULL
; \

589 (
ñm
)->
fõld
.
tqe_¥ev
 = (
hód
)->
tqh_œ°
; \

590 *(
hód
)->
tqh_œ°
 = (
ñm
); \

591 (
hód
)->
tqh_œ°
 = &
	`TAILQ_NEXT
((
ñm
), 
fõld
); \

592 
	`QMD_TRACE_HEAD
(
hód
); \

593 
	`QMD_TRACE_ELEM
(&(
ñm
)->
fõld
); \

594 } 0)

	)

596 
	#TAILQ_LAST
(
hód
, 
hód«me
) \

597 (*(((
hód«me
 *)((
hód
)->
tqh_œ°
))->tqh_œ°))

	)

599 
	#TAILQ_NEXT
(
ñm
, 
fõld
Ë(”lm)->fõld.
tqe_√xt
)

	)

601 
	#TAILQ_PREV
(
ñm
, 
hód«me
, 
fõld
) \

602 (*(((
hód«me
 *)((
ñm
)->
fõld
.
tqe_¥ev
))->
tqh_œ°
))

	)

604 
	#TAILQ_REMOVE
(
hód
, 
ñm
, 
fõld
) do { \

605 
	`QMD_SAVELINK
(
ﬁd√xt
, (
ñm
)->
fõld
.
tqe_√xt
); \

606 
	`QMD_SAVELINK
(
ﬁd¥ev
, (
ñm
)->
fõld
.
tqe_¥ev
); \

607 
	`QMD_TAILQ_CHECK_NEXT
(
ñm
, 
fõld
); \

608 
	`QMD_TAILQ_CHECK_PREV
(
ñm
, 
fõld
); \

609 i‡((
	`TAILQ_NEXT
((
ñm
), 
fõld
)Ë!
NULL
) \

610 
	`TAILQ_NEXT
((
ñm
), 
fõld
)->fõld.
tqe_¥ev
 = \

611 (
ñm
)->
fõld
.
tqe_¥ev
; \

613 (
hód
)->
tqh_œ°
 = (
ñm
)->
fõld
.
tqe_¥ev
; \

614 
	`QMD_TRACE_HEAD
(
hód
); \

616 *(
ñm
)->
fõld
.
tqe_¥ev
 = 
	`TAILQ_NEXT
((elm), field); \

617 
	`TRASHIT
(*
ﬁd√xt
); \

618 
	`TRASHIT
(*
ﬁd¥ev
); \

619 
	`QMD_TRACE_ELEM
(&(
ñm
)->
fõld
); \

620 } 0)

	)

622 
	#TAILQ_SWAP
(
hód1
, 
hód2
, 
ty≥
, 
fõld
) do { \

623 
ty≥
 *
sw≠_fú°
 = (
hód1
)->
tqh_fú°
; \

624 
ty≥
 **
sw≠_œ°
 = (
hód1
)->
tqh_œ°
; \

625 (
hód1
)->
tqh_fú°
 = (
hód2
)->tqh_first; \

626 (
hód1
)->
tqh_œ°
 = (
hód2
)->tqh_last; \

627 (
hód2
)->
tqh_fú°
 = 
sw≠_fú°
; \

628 (
hód2
)->
tqh_œ°
 = 
sw≠_œ°
; \

629 i‡((
sw≠_fú°
 = (
hód1
)->
tqh_fú°
Ë!
NULL
) \

630 
sw≠_fú°
->
fõld
.
tqe_¥ev
 = &(
hód1
)->
tqh_fú°
; \

632 (
hód1
)->
tqh_œ°
 = &(hód1)->
tqh_fú°
; \

633 i‡((
sw≠_fú°
 = (
hód2
)->
tqh_fú°
Ë!
NULL
) \

634 
sw≠_fú°
->
fõld
.
tqe_¥ev
 = &(
hód2
)->
tqh_fú°
; \

636 (
hód2
)->
tqh_œ°
 = &(hód2)->
tqh_fú°
; \

637 } 0)

	)

	@inc/res.h

1 #i‚de‡
__RES_H__


2 
	#__RES_H__


	)

3 
	#MATERIAL_DIR
 
m©îül


	)

4 
	#STR_EXPAND
(
__tok
)#__tok

	)

5 
	#STR
(
__tok
Ë
	`STR_EXPAND
(__tok)

	)

	@inc/sfx.h

1 #i‚de‡
__SFX_H__


2 
	#__SFX_H__


	)

3 
	~<SDL.h
>

4 
	~<SDL_mixî.h
>

6 
	ssfx_t
{

7 
Mix_Chunk
 *
	mmix_chunk
;

9 
sfx_öô
();

10 
sfx_∂ay_by_ty≥
();

11 
sfx_combo_miss
();

12 
sfx_tick
();

13 
sfx_de°roy
();

	@inc/texture.h

9 #i‚de‡
__TEXTURE_H__


10 
	#__TEXTURE_H__


	)

11 
	~<GL/glut.h
>

12 
	~<öc/lodïng.h
>

13 
	#TEXTURE_DRAW_BEGIN
(
__ãx
) \

14 
	`glBödTextuª
(
GL_TEXTURE_2D
, (
__ãx
)); \

15 
	`glBegö
(
GL_QUADS
);

	)

16 
	#TEXTURE_DRAW_END
() \

17 
	`glEnd
();

	)

18 
	#TEXTURE_PIN
(
__tx
, 
__ty
, 
__vx
, 
__vy
) \

19 
	`glTexCo‹d2f
((
__tx
), (
__ty
)); \

20 
	`glVîãx2f
((
__vx
), (
__vy
));

	)

22 
GLuöt
 
ãxtuª_lﬂd
(c⁄° *
fûíame
);

23 
GLuöt
 
ãxtuª_böd_image
(*
img
, 
size_t
 
width
, size_à
height
);

24 
GLuöt
 
ãxtuª_lﬂd_wôh_cﬁ‹
(c⁄° *
fûíame
, 
r
, 
g
, 
b
);

25 
GLuöt
 
ãxtuª_lﬂd_wôh_Æpha
(c⁄° *
fûíame
, 
Æpha
);

	@inc/time_seq.h

1 #i‚de‡
__TIME_SEQ_H__


2 
	#__TIME_SEQ_H__


	)

3 
	~<öc/queue.h
>

4 
	~<°ddef.h
>

5 
	gtime_£q_t
;

6 
	sevít_t
{

7 
TAILQ_ENTRY
(
evít_t
Ë
	mqueue_íåy
;

8 (* 
	måiggî
Ë(*
	m£lf
, 
time_£q_t
 *
	mtime_£q
, 
size_t
 
	mtime
);

11 
TAILQ_HEAD
(
evít_queue_hód_t
, 
evít_t
);

13 
	stime_£q_t
{

14 
evít_queue_hód_t
 *
	mqueue_¨øy_±r
;

15 
size_t
 
	mÀngth
;

18 
time_£q_de°‹y
(
time_£q_t
 *
time_£q
);

19 
time_£q_t
* 
time_£q_öô
(
size_t
 
tŸÆ_mûli£c⁄d
);

20 
ölöe
 
time_£q_ö£π_hód
(
time_£q_t
 *
time_£q
, 
size_t
 
time
, 
evít_t
 *
evít
);

21 
ölöe
 
time_£q_ö£π_èû
(
time_£q_t
 *
time_£q
, 
size_t
 
time
, 
evít_t
 *
evít
);

22 
time_£q_åiggî_©
(
time_£q_t
 *
time_£q
, 
size_t
 
time
);

23 
time_£q_de°‹y_©
(
time_£q_t
 *
time_£q
, 
size_t
 
time
);

	@inc/unfinevent.h

1 #i‚de‡
__UNFINEVENT_H__


2 
	#__UNFINEVENT_H__


	)

3 
	~<öc/queue.h
>

4 
	~<GL/glut.h
>

5 
	~<öc/time_£q.h
>

6 
	~<öc/˚Œ.h
>

7 
	~<öc/mou£_judge.h
>

15 
	sUnföEvít


17 
	mföish_time
;

18 
	mpx
;

19 
	mpy
;

20 
	mföished
;

21 
	msound_ty≥
;

22 
	mobje˘_ty≥
;

30 
add_unfö_evít
(
UnföEvít
 *
u_evít
, 
id
, 
x
, 
y
, 
time
, 
sound_ty≥
, 
obje˘_ty≥
);

31 
föish_evít
(
UnföEvít
 *
u_evít
, 
id
, 
sc‹e
, 
time
, 
suc˚ss
, 
time_£q_t
 *
time_£q
);

32 
kûl_unfö_evít_bef‹e
(
UnföEvít
 *
u_evít
, 
evít_num
, 
time
, 
time_£q_t
 *
time_£q
);

33 
£t_cuºít_tick_time
(
UnföEvít
 *
u_evít
, 
evít_num
, 
time
);

35 
	#EVENT_SUCCESS
 1

	)

36 
	#EVENT_FAIL
 0

	)

	@utils/audio.c

1 
	~<öc/audio.h
>

2 
	~<as£π.h
>

3 
	~<°dio.h
>

4 
	~<°rög.h
>

5 
	~<°dlib.h
>

6 
	#FILE_MP3
 0

	)

7 
	#FILE_OGG
 1

	)

8 
	#FILE_WAV
 2

	)

10 
	$⁄_∑d_added_ogg
 (
G°EÀmít
 *
ñemít
,

11 
G°Pad
 *
∑d
,

12 
gpoöãr
 
d©a
)

14 
G°Pad
 *
sök∑d
;

15 
G°EÀmít
 *
decodî
 = (G°EÀmíà*Ë
d©a
;

18 
	`g_¥öt
 ("DynamicÖad created,Üinking demuxer/decoder\n");

20 
sök∑d
 = 
	`g°_ñemít_gë_°©ic_∑d
 (
decodî
, "sink");

22 
	`g°_∑d_lök
 (
∑d
, 
sök∑d
);

24 
	`g°_obje˘_uƒef
 (
sök∑d
);

25 
	}
}

28 
	$⁄_∑d_added_wav
 (
G°EÀmít
 *
ñemít
 , 
G°Pad
 *
∑d
 , 
gpoöãr
 
d©a
){

30 
gch¨
 *
«me
;

31 
G°EÀmít
 *
sök
 = (G°EÀmít*)
d©a
;

33 
«me
 = 
	`g°_∑d_gë_«me
(
∑d
);

34 
	`g°_ñemít_lök_∑ds
(
ñemít
 , 
«me
 , 
sök
 , "sink");

35 
	`g_‰ì
(
«me
);

36 
	}
}

38 
	$fûe_dëe˘
(c⁄° *
f
)

40 
Àn
 = 
	`°æí
(
f
);

41 i‡(!
	`°rˇ£cmp
(
f
 + 
Àn
 - 3, "mp3"))

42  
FILE_MP3
;

43 i‡(!
	`°rˇ£cmp
(
f
 + 
Àn
 - 3, "ogg"))

44  
FILE_OGG
;

45 i‡(!
	`°rˇ£cmp
(
f
 + 
Àn
 - 3, "wav"))

46  
FILE_WAV
;

48 
	}
}

50 
	$lﬂd_mp3
 (
sound_t
 *
sound
, c⁄° *
fûe
)

52 
buf
[1024];

53 
unique
 = 0;

54 
sound
->
pùñöe
 = 
	`g°_pùñöe_√w
 (
fûe
);

55 
	`¢¥ötf
(
buf
, 1024, "%d%s",
unique
,
fûe
);

56 
sound
->
sour˚
 = 
	`g°_ñemít_Á˘‹y_make
 ("fûe§c", 
	`°rˇt
(
buf
,"file-source"));

57 
	`¢¥ötf
(
buf
, 1024, "%d%s",
unique
,
fûe
);

58 
sound
->
decodî
 = 
	`g°_ñemít_Á˘‹y_make
 ("mad", 
	`°rˇt
(
buf
, "mad-decoder"));

59 
	`¢¥ötf
(
buf
, 1024, "%d%s",
unique
,
fûe
);

60 
sound
->
sök
 = 
	`g°_ñemít_Á˘‹y_make
 ("autﬂudiosök", 
	`°rˇt
(
buf
, "audio-output"));

61 
unique
++;

62 i‡(!
sound
->
pùñöe


63 || !
sound
->
sour˚


64 || !
sound
->
decodî


65 || !
sound
->
sök
){

66 
	`g_¥öãº
 ("OneÉlement couldÇot be created. Exiting.\n");

69 
	`g_obje˘_£t
 (
	`G_OBJECT
 (
sound
->
sour˚
), "loˇti⁄", 
fûe
, 
NULL
);

70 
	`g°_bö_add_m™y
 (
	`GST_BIN
 (
sound
->
pùñöe
),

71 
sound
->
sour˚
, sound->
decodî
, sound->
sök
, 
NULL
);

72 
	`g°_ñemít_lök_m™y
 (
sound
->
sour˚
, sound->
decodî
, sound->
sök
, 
NULL
);

75 
	}
}

77 
	$lﬂd_ogg
(
sound_t
 *
sound
, c⁄° *
fûe
)

79 
buf
[1024];

80 
unique
 = 0;

81 
sound
->
pùñöe
 = 
	`g°_pùñöe_√w
 (
fûe
);

83 
	`¢¥ötf
(
buf
, 1024, "%d%s",
unique
,
fûe
);

84 
sound
->
sour˚
 = 
	`g°_ñemít_Á˘‹y_make
 ("fûe§c", 
	`°rˇt
(
buf
,"file-source"));

85 
	`¢¥ötf
(
buf
, 1024, "%d%s",
unique
,
fûe
);

86 
sound
->
demuxî
 = 
	`g°_ñemít_Á˘‹y_make
 ("oggdemux", 
	`°rˇt
(
buf
,"ogg-demuxer"));

87 
	`¢¥ötf
(
buf
, 1024, "%d%s",
unique
,
fûe
);

88 
sound
->
decodî
 = 
	`g°_ñemít_Á˘‹y_make
 ("v‹bisdec", 
	`°rˇt
(
buf
, "vorbis-decoder"));

89 
	`¢¥ötf
(
buf
, 1024, "%d%s",
unique
,
fûe
);

90 
sound
->
c⁄v
 = 
	`g°_ñemít_Á˘‹y_make
 ("audioc⁄vît", 
	`°rˇt
(
buf
, "converter"));

91 
	`¢¥ötf
(
buf
, 1024, "%d%s",
unique
,
fûe
);

92 
sound
->
sök
 = 
	`g°_ñemít_Á˘‹y_make
 ("autﬂudiosök", 
	`°rˇt
(
buf
, "audio-output"));

93 
unique
++;

94 i‡(!
sound
->
pùñöe
 || !sound->
sour˚
 || !sound->
demuxî
 || !sound->
decodî
 || !sound->
c⁄v
 || !sound->
sök
) {

95 
	`g_¥öãº
 ("OneÉlement couldÇot be created. Exiting.\n");

98 
	`g_obje˘_£t
 (
	`G_OBJECT
 (
sound
->
sour˚
), "loˇti⁄", 
fûe
, 
NULL
);

99 
	`g°_bö_add_m™y
 (
	`GST_BIN
 (
sound
->
pùñöe
),

100 
sound
->
sour˚
, sound->
demuxî
,

101 
sound
->
decodî
, sound->
c⁄v
,

102 
sound
->
sök
, 
NULL
);

103 
	`g°_ñemít_lök
 (
sound
->
sour˚
, sound->
demuxî
);

104 
	`g°_ñemít_lök_m™y
 (
sound
->
decodî
, sound->
c⁄v
, sound->
sök
, 
NULL
);

105 
	`g_sig«l_c⁄√˘
 (
sound
->
demuxî
, "∑d-added", 
	`G_CALLBACK
 (
⁄_∑d_added_ogg
), sound->
decodî
);

106 
	}
}

109 
	$lﬂd_wav
(
sound_t
 *
sound
, c⁄° *
fûe
)

111 
G°EÀmít
 *
pùñöe
, *
sour˚
, *
∑r£r
, *
sök
;

112 
buf
[1024];

113 
unique
 = 0;

114 
pùñöe
 = 
	`g°_pùñöe_√w
(
fûe
);

116 
	`¢¥ötf
(
buf
, 1024, "%d%s",
unique
,
fûe
);

117 
sour˚
 = 
	`g°_ñemít_Á˘‹y_make
("fûe§c" , 
	`°rˇt
(
buf
,"source"));

118 
	`¢¥ötf
(
buf
, 1024, "%d%s",
unique
,
fûe
);

119 
∑r£r
 = 
	`g°_ñemít_Á˘‹y_make
("wav∑r£" , 
	`°rˇt
(
buf
,"parser"));

120 
	`¢¥ötf
(
buf
, 1024, "%d%s",
unique
,
fûe
);

121 
sök
 = 
	`g°_ñemít_Á˘‹y_make
 ("autﬂudiosök", 
	`°rˇt
(
buf
,"audio-output"));

122 
unique
++;

124 i‡(!
sour˚
 || !
∑r£r
 || !
sök
)

126 
	`g_obje˘_£t
(
	`G_OBJECT
(
sour˚
Ë, "loˇti⁄", 
fûe
, 
NULL
);

128 
	`g°_bö_add_m™y
(
	`GST_BIN
(
pùñöe
)

129 , 
sour˚
 , 
∑r£r
 , 
sök
 , 
NULL
);

131 
	`g_sig«l_c⁄√˘
(
∑r£r


132 , "∑d-added" , 
	`G_CALLBACK
(
⁄_∑d_added_wav
Ë, 
sök
);

133 
	`g°_ñemít_lök
(
sour˚
 , 
∑r£r
);

134 
sound
->
pùñöe
 =Öipeline;

135 
sound
->
∑r£r
 =Öarser;

136 
sound
->
sour˚
 = source;

137 
sound
->
sök
 = sink;

139 
	}
}

141 
sound_t
 *

142 
	$sound_lﬂd
(c⁄° *
fûe
)

144 
sound_t
 *
sound
 = (sound_à*)
	`mÆloc
( (sound_t));

145 
	`as£π
(
sound
);

146 
	`mem£t
(
sound
, 0, (
sound_t
));

147 
	`fûe_dëe˘
(
fûe
)){

148 
FILE_MP3
:

149 i‡(
	`lﬂd_mp3
(
sound
, 
fûe
) < 0)

150  
NULL
;

151  
sound
;

152 
FILE_OGG
:

153 i‡(
	`lﬂd_ogg
(
sound
, 
fûe
) < 0)

154  
NULL
;

155  
sound
;

156 
FILE_WAV
:

157 i‡(
	`lﬂd_wav
(
sound
, 
fûe
) < 0)

158  
NULL
;

159  
sound
;

161  
NULL
;

163 
	}
}

164 
ölöe
 

165 
	$sound_∂ay
(
sound_t
 *
sound
)

167 
	`g°_ñemít_£ek
 (
sound
->
pùñöe
, 1.0,

168 
GST_FORMAT_TIME
, 
GST_SEEK_FLAG_FLUSH
,

169 
GST_SEEK_TYPE_SET
, 0,

170 
GST_SEEK_TYPE_NONE
, 
GST_CLOCK_TIME_NONE
);

171 
	`g°_ñemít_£t_°©e
 (
sound
->
pùñöe
, 
GST_STATE_PLAYING
);

173 
	}
}

175 
ölöe
 

176 
	$sound_°›
(
sound_t
 *
sound
)

178 
	`g°_ñemít_£t_°©e
 (
sound
->
pùñöe
, 
GST_STATE_NULL
);

179 
	}
}

180 
ölöe
 
göt64


181 
	$sound_quîy_posôi⁄
(
sound_t
 *
sound
)

183 
G°F‹m©
 
fmt
 = 
GST_FORMAT_TIME
;

184 
göt64
 
pos
;

185 
	`g°_ñemít_quîy_posôi⁄
 (
sound
->
pùñöe
, &
fmt
, &
pos
);

186  
pos
;

187 
	}
}

188 
ölöe
 
göt64


189 
	$sound_quîy_duøti⁄
(
sound_t
 *
sound
)

191 
G°F‹m©
 
fmt
 = 
GST_FORMAT_TIME
;

192 
göt64
 
Àn
;

193 
	`g°_ñemít_quîy_duøti⁄
 (
sound
->
pùñöe
, &
fmt
, &
Àn
);

194  
Àn
;

195 
	}
}

196 
ölöe
 

197 
	$sound_‰ì
(
sound_t
 *
sound
)

199 
	`g°_obje˘_uƒef
 (
	`GST_OBJECT
 (
sound
->
pùñöe
));

200 
	`‰ì
(
sound
);

201 
	}
}

	@utils/cell.c

2 
	~<GL/glut.h
>

3 
	~<°dio.h
>

4 
	~<mem‹y.h
>

5 
	~<°dlib.h
>

6 
	~<m©h.h
>

8 
	~<öc/˚Œ.h
>

9 
	~<öc/time_£q.h
>

10 
	~<öc/ãxtuª.h
>

11 
	~<öc/ªs.h
>

12 
	~<öc/game.h
>

13 
	~<öc/game_°©us.h
>

19 
	ghôcú˛e_cﬁ‹
[10][3]={{255,255,0}, {255,0,255}, {0,255,255}, {0,0,255}, {0,255,0},{255,0,0}};

20 
GLuöt
 
	ghôcú˛e_ãx
[10];

21 
GLuöt
 
	gnumbî_ãx
[10];

22 
GLuöt
 
	g≠¥ﬂch_ãx
[10];

23 
GLuöt
 
	ghôsc‹e_ãx
[8];

24 
GLuöt
 
	govîœy_ãx
;

25 
GLuöt
 
	g¶idîbÆl_ãx
[10];

26 
GLuöt
 
	gbackground_ãx
;

27 
GLuöt
 
	g¶idîfﬁlow_ãx
;

29 
GLuöt
 
	gªvî£_ãx
;

31 
	gcú˛e_size
 = 80;

32 
	gnumbî_size
 = 24;

33 
	gsc‹e_size
 = 160;

34 
	g¶idîbÆl_size
 = 80;

35 
	gªvî£_size
 = 50;

39 
Aµrﬂch
 *

40 
	$√w_≠¥ﬂch
(
x
, 
y
, 
GLuöt
 *
ãxt
)

42 
Aµrﬂch
 *
π
;

43 
π
 = (
Aµrﬂch
 *Ë
	`mÆloc
((Approach));

44 
π
->
px
 = 
x
;

45 
π
->
py
 = 
y
;

46 
π
->
cuºít_zoomøã
 = 
APPROACH_INIT_ZOOMRATE
;

47 
π
->
ãx_gøph
 = 
ãxt
;

48 
π
->
evít_hódî
.
åiggî
 = 
≠¥ﬂch_åiggî
;

49  
π
;

50 
	}
}

53 
Hôcú˛e
 *

54 
	$√w_hôcú˛e
(
x
, 
y
, 
GLuöt
 *
ãxt
, 
wôh_ovîœy
)

56 
Hôcú˛e
 *
π
;

57 
π
 = (
Hôcú˛e
 *Ë
	`mÆloc
((Hitcircle));

58 
π
->
px
 = 
x
;

59 
π
->
py
 = 
y
;

60 
π
->
ãx_gøph
 = 
ãxt
;

61 if(
wôh_ovîœy
)

62 
π
->
evít_hódî
.
åiggî
 = 
hôcú˛e_åiggî
;

64 
π
->
evít_hódî
.
åiggî
 = 
hôcú˛e_åiggî_no_ovîœy
;

65  
π
;

66 
	}
}

68 
Cú˛íumbî
 *

69 
	$√w_cú˛íumbî
(
x
, 
y
, 
GLuöt
 *
ãxt
)

71 
Cú˛íumbî
 *
π
;

72 
π
 = (
Cú˛íumbî
 *Ë
	`mÆloc
((Circlenumber));

73 
π
->
px
 = 
x
;

74 
π
->
py
 = 
y
;

75 
π
->
ãx_gøph
 = 
ãxt
;

76 
π
->
evít_hódî
.
åiggî
 = 
cú˛íumbî_åiggî
;

77  
π
;

78 
	}
}

80 
Hôsc‹e
 *

81 
	$√w_hôsc‹e
(
x
, 
y
, 
GLuöt
 *
ãxt
)

83 
Hôsc‹e
 *
π
;

84 
π
 = (
Hôsc‹e
 *)
	`mÆloc
((Hitscore));

85 
π
->
px
 = 
x
;

86 
π
->
py
 = 
y
;

87 
π
->
ãx_gøph
 = 
ãxt
;

88 
π
->
cuºít_zoomøã
 = 
HITSCORE_INIT_ZOOMRATE
;

89 
π
->
evít_hódî
.
åiggî
 = 
hôsc‹e_åiggî
;

90  
π
;

91 
	}
}

93 
SlidîbÆl
 *

94 
	$√w_¶idîbÆl
(
x
, 
y
, 
GLuöt
 *
ãxt
, 
dx
, 
dy
, 
sound_ty≥
)

96 
SlidîbÆl
 *
π
;

97 
π
 = (
SlidîbÆl
 *)
	`mÆloc
((Sliderball));

98 
π
->
px
 = 
x
;

99 
π
->
py
 = 
y
;

100 
π
->
dx
 = dx;

101 
π
->
dy
 = dy;

102 
π
->
ãx_gøph
 = 
ãxt
;

103 
π
->
sound_ty≥
 = sound_type;

104 
π
->
evî_∂ayed
 = 0;

105 
π
->
evít_hódî
.
åiggî
 = 
¶idîbÆl_åiggî
;

106  
π
;

107 
	}
}

109 
Slidî
 *

110 
	$√w_¶idî
(
DŸ
 *
poöts
, 
Àn
, 
cﬁ‹_ödex
, 
ªvî£_time
)

112 
Slidî
 *
π
;

113 
π
 = (
Slidî
 *)
	`mÆloc
((Slider));

114 
π
->
poöts
 =Öoints;

115 
π
->
max_Àn
 = 
Àn
;

116 
π
->
ªvî£_time
 =Ñeverse_time;

117 
π
->
cﬁ‹_ödex
 = color_index;

118 
π
->
evít_hódî
.
åiggî
 = 
¶idî_åiggî
;

119  
π
;

120 
	}
}

121 
Background
 *

122 
	$√w_background
()

124 
Background
 *
π
;

125 
π
 = (
Background
 *)
	`mÆloc
((Background));

126 
π
->
evít_hódî
.
åiggî
 = 
background_åiggî
;

127 
	}
}

131 
	$≠¥ﬂch_åiggî
(*
£lf
, 
time_£q_t
 *
time_£q
, 
size_t
 
time
)

133 
Aµrﬂch
 *
p
 = (Aµrﬂch *)
£lf
;

134 
åx
, 
åy
, 
blx
, 
bly
;

135 
åx
 = 
p
->
px
 + (
cú˛e_size
/2 *Ö->
cuºít_zoomøã
);

136 
åy
 = 
p
->
py
 + (
cú˛e_size
/2 *Ö->
cuºít_zoomøã
);

137 
blx
 = 
p
->
px
 - (
cú˛e_size
/2 *Ö->
cuºít_zoomøã
);

138 
bly
 = 
p
->
py
 - (
cú˛e_size
/2 *Ö->
cuºít_zoomøã
);

140 
	`TEXTURE_DRAW_BEGIN
(*
p
->
ãx_gøph
);

141 
	`TEXTURE_PIN
(0.0,0.0, 
blx
, 
bly
);

142 
	`TEXTURE_PIN
(0.0,1.0, 
blx
, 
åy
);

143 
	`TEXTURE_PIN
(1.0,1.0, 
åx
, 
åy
);

144 
	`TEXTURE_PIN
(1.0,0.0, 
åx
, 
bly
);

145 
	`TEXTURE_DRAW_END
();

146 
	}
}

149 
	$hôcú˛e_åiggî
(*
£lf
, 
time_£q_t
 *
time_£q
, 
size_t
 
time
)

151 
Hôcú˛e
 *
p
 = (Hôcú˛ê*)
£lf
;

152 
åx
, 
åy
, 
blx
, 
bly
;

153 
åx
 = 
p
->
px
 + 
cú˛e_size
/2.0;

154 
åy
 = 
p
->
py
 + 
cú˛e_size
/2.0;

155 
blx
 = 
p
->
px
 - 
cú˛e_size
/2.0;

156 
bly
 = 
p
->
py
 - 
cú˛e_size
/2.0;

158 
	`TEXTURE_DRAW_BEGIN
(*
p
->
ãx_gøph
);

159 
	`TEXTURE_PIN
(0.0,0.0, 
blx
, 
bly
);

160 
	`TEXTURE_PIN
(0.0,1.0, 
blx
, 
åy
);

161 
	`TEXTURE_PIN
(1.0,1.0, 
åx
, 
åy
);

162 
	`TEXTURE_PIN
(1.0,0.0, 
åx
, 
bly
);

163 
	`TEXTURE_DRAW_END
();

165 
	`TEXTURE_DRAW_BEGIN
(
ovîœy_ãx
);

166 
	`TEXTURE_PIN
(0.0,0.0, 
blx
, 
bly
);

167 
	`TEXTURE_PIN
(0.0,1.0, 
blx
, 
åy
);

168 
	`TEXTURE_PIN
(1.0,1.0, 
åx
, 
åy
);

169 
	`TEXTURE_PIN
(1.0,0.0, 
åx
, 
bly
);

170 
	`TEXTURE_DRAW_END
();

171 
	}
}

174 
	$hôcú˛e_åiggî_no_ovîœy
(*
£lf
, 
time_£q_t
 *
time_£q
, 
size_t
 
time
)

176 
Hôcú˛e
 *
p
 = (Hôcú˛ê*)
£lf
;

177 
åx
, 
åy
, 
blx
, 
bly
;

178 
åx
 = 
p
->
px
 + 
cú˛e_size
/2.0;

179 
åy
 = 
p
->
py
 + 
cú˛e_size
/2.0;

180 
blx
 = 
p
->
px
 - 
cú˛e_size
/2.0;

181 
bly
 = 
p
->
py
 - 
cú˛e_size
/2.0;

183 
	`TEXTURE_DRAW_BEGIN
(*
p
->
ãx_gøph
);

184 
	`TEXTURE_PIN
(0.0,0.0, 
blx
, 
bly
);

185 
	`TEXTURE_PIN
(0.0,1.0, 
blx
, 
åy
);

186 
	`TEXTURE_PIN
(1.0,1.0, 
åx
, 
åy
);

187 
	`TEXTURE_PIN
(1.0,0.0, 
åx
, 
bly
);

188 
	`TEXTURE_DRAW_END
();

189 
	}
}

192 
	$cú˛íumbî_åiggî
(*
£lf
, 
time_£q_t
 *
time_£q
, 
size_t
 
time
)

194 
Cú˛íumbî
 *
p
 = (Cú˛íumbî *)
£lf
;

195 
åx
, 
åy
, 
blx
, 
bly
;

196 if(
p
->
ãx_gøph
 !&
ªvî£_ãx
){

197 
åx
 = 
p
->
px
 + 
numbî_size
/2.0;

198 
åy
 = 
p
->
py
 + 
numbî_size
/2.0;

199 
blx
 = 
p
->
px
 - 
numbî_size
/2.0;

200 
bly
 = 
p
->
py
 - 
numbî_size
/2.0;

203 
åx
 = 
p
->
px
 + 
ªvî£_size
/2.0;

204 
åy
 = 
p
->
py
 + 
ªvî£_size
/2.0;

205 
blx
 = 
p
->
px
 - 
ªvî£_size
/2.0;

206 
bly
 = 
p
->
py
 - 
ªvî£_size
/2.0;

209 
	`TEXTURE_DRAW_BEGIN
(*
p
->
ãx_gøph
);

210 
	`TEXTURE_PIN
(0.0,0.0, 
blx
, 
bly
);

211 
	`TEXTURE_PIN
(0.0,1.0, 
blx
, 
åy
);

212 
	`TEXTURE_PIN
(1.0,1.0, 
åx
, 
åy
);

213 
	`TEXTURE_PIN
(1.0,0.0, 
åx
, 
bly
);

214 
	`TEXTURE_DRAW_END
();

215 
	}
}

218 
	$hôsc‹e_åiggî
(*
£lf
, 
time_£q_t
 *
time_£q
, 
size_t
 
time
)

220 
Hôsc‹e
 *
p
 = (Hôsc‹ê*)
£lf
;

221 
åx
, 
åy
, 
blx
, 
bly
;

222 if(
p
->
ãx_gøph
 =&
hôsc‹e_ãx
[
HIT_30
])

224 
åx
 = 
p
->
px
 + 40/2.0 *Ö->
cuºít_zoomøã
;

225 
åy
 = 
p
->
py
 + 25/2.0 *Ö->
cuºít_zoomøã
;

226 
blx
 = 
p
->
px
 - 40/2.0 *Ö->
cuºít_zoomøã
;

227 
bly
 = 
p
->
py
 - 25/2.0 *Ö->
cuºít_zoomøã
;

230 
åx
 = 
p
->
px
 + 
sc‹e_size
/2.0 *Ö->
cuºít_zoomøã
;

231 
åy
 = 
p
->
py
 + 
sc‹e_size
/2.0 *Ö->
cuºít_zoomøã
;

232 
blx
 = 
p
->
px
 - 
sc‹e_size
/2.0 *Ö->
cuºít_zoomøã
;

233 
bly
 = 
p
->
py
 - 
sc‹e_size
/2.0 *Ö->
cuºít_zoomøã
;

235 
	`TEXTURE_DRAW_BEGIN
(*
p
->
ãx_gøph
);

236 
	`TEXTURE_PIN
(0.0,0.0, 
blx
, 
bly
);

237 
	`TEXTURE_PIN
(0.0,1.0, 
blx
, 
åy
);

238 
	`TEXTURE_PIN
(1.0,1.0, 
åx
, 
åy
);

239 
	`TEXTURE_PIN
(1.0,0.0, 
åx
, 
bly
);

240 
	`TEXTURE_DRAW_END
();

241 
	}
}

242 
	gevî_∂ayed
 = 0;

243 
	gsound_x
, 
	gsound_y
;

245 
	$¶idîbÆl_åiggî
(*
£lf
, 
time_£q_t
 *
time_£q
, 
size_t
 
time
)

247 
SlidîbÆl
 *
p
 = (SlidîbÆ»*)
£lf
;

248 
…x
, 
…y
, 
πx
, 
πy
, 
rbx
, 
rby
, 
lbx
, 
lby
;

249 
åx
, 
åy
, 
blx
, 
bly
;

250 
ãmp_x
, 
ãmp_y
;

251 
coß
, 
söa
;

252 
coß
 = 
p
->
dx
;

253 
söa
 = 
p
->
dy
;

254 
ãmp_x
 = 
¶idîbÆl_size
/2;

255 
ãmp_y
 = 
¶idîbÆl_size
/2;

256 
πx
 = 
ãmp_x
*
coß
 - 
ãmp_y
*
söa
 + 
p
->
px
;

257 
πy
 = 
ãmp_x
*
söa
 + 
ãmp_y
*
coß
 + 
p
->
py
;

258 
ãmp_x
 = -
¶idîbÆl_size
/2;

259 
ãmp_y
 = 
¶idîbÆl_size
/2;

260 
…x
 = 
ãmp_x
*
coß
 - 
ãmp_y
*
söa
 + 
p
->
px
;

261 
…y
 = 
ãmp_x
*
söa
 + 
ãmp_y
*
coß
 + 
p
->
py
;

262 
ãmp_x
 = 
¶idîbÆl_size
/2;

263 
ãmp_y
 = -
¶idîbÆl_size
/2;

264 
rbx
 = 
ãmp_x
*
coß
 - 
ãmp_y
*
söa
 + 
p
->
px
;

265 
rby
 = 
ãmp_x
*
söa
 + 
ãmp_y
*
coß
 + 
p
->
py
;

266 
ãmp_x
 = -
¶idîbÆl_size
/2;

267 
ãmp_y
 = -
¶idîbÆl_size
/2;

268 
lbx
 = 
ãmp_x
*
coß
 - 
ãmp_y
*
söa
 + 
p
->
px
;

269 
lby
 = 
ãmp_x
*
söa
 + 
ãmp_y
*
coß
 + 
p
->
py
;

271 
	`TEXTURE_DRAW_BEGIN
(*
p
->
ãx_gøph
);

272 
	`TEXTURE_PIN
(0.0,0.0, 
lbx
, 
lby
);

273 
	`TEXTURE_PIN
(0.0,1.0, 
…x
, 
…y
);

274 
	`TEXTURE_PIN
(1.0,1.0, 
πx
, 
πy
);

275 
	`TEXTURE_PIN
(1.0,0.0, 
rbx
, 
rby
);

276 
	`TEXTURE_DRAW_END
();

277 if(
game_°©us
 & 
GAME_SF_MOUSE_DOWN
){

278 
åx
 = 
p
->
px
 + 
cú˛e_size
;

279 
åy
 = 
p
->
py
 + 
cú˛e_size
;

280 
blx
 = 
p
->
px
 - 
cú˛e_size
;

281 
bly
 = 
p
->
py
 - 
cú˛e_size
;

282 
	`TEXTURE_DRAW_BEGIN
(
¶idîfﬁlow_ãx
);

283 
	`TEXTURE_PIN
(0.0,0.0, 
blx
, 
bly
);

284 
	`TEXTURE_PIN
(0.0,1.0, 
blx
, 
åy
);

285 
	`TEXTURE_PIN
(1.0,1.0, 
åx
, 
åy
);

286 
	`TEXTURE_PIN
(1.0,0.0, 
åx
, 
bly
);

287 
	`TEXTURE_DRAW_END
();

288 if(
p
->
sound_ty≥
 !-1 && 
evî_∂ayed
 =0 && !(
	`Ábs
(
sound_x
 -Ö->
px
Ë< 0.01Ë&& !(Ábs(
sound_y
 -Ö->
py
)<0.01)){

289 
	`sfx_∂ay_by_ty≥
(
p
->
sound_ty≥
);

290 
evî_∂ayed
 = 1;

291 
sound_x
 = 
p
->
px
;

292 
sound_y
 = 
p
->
py
;

294 if(
p
->
sound_ty≥
 =-1 &&
evî_∂ayed
 == 1)

296 
evî_∂ayed
 = 0;

299 
	}
}

301 
	$¶idî_åiggî
(*
£lf
, 
time_£q_t
 *
time_£q
, 
size_t
 
time
)

303 
Slidî
 *
p
 = (Slidî *)
£lf
;

304 
Àn
 = 
p
->
max_Àn
;

305 
exi°_time
 = 
p
->
poöts
[
Àn
-1].
time
 -Ö->poöts[0].timê+ 
HITCIRCLE_EXIST_TIME
;

306 
öãrvÆ_time
 = 
p
->
poöts
[
Àn
-1].
time
 -Ö->points[0].time;

307 
sˇn_time
 = (
time
 - (
p
->
poöts
[
Àn
-1].timê-
exi°_time
))/
öãrvÆ_time
;

308 
i
, 
j
;

309 
åx
, 
åy
, 
blx
, 
bly
;

310 
evít_id
;

311 
Êag
 = 0;

312 
i
 = 0 ; i < 
Àn
 ; i++){

313 if(
	`Ábs
(
p
->
poöts
[
i
].
x
 - 
u_evíts
[
cuºít_tick_id
].
px
Ë< 0.01 && fabs’->poöts[i].
y
 - u_evíts[cuºít_tick_id].
py
) < 0.01){

314 
Êag
 = 1;

318 if(
Êag
){

319 if(
time
 < 
u_evíts
[
cuºít_tick_id
].
föish_time
 + 100 &&Åime > u_events[current_tick_id].finish_time - 500){

320 if(
game_°©us
 & 
GAME_SF_MOUSE_DOWN
){

321 if((
mou£_x
 - 
u_evíts
[
cuºít_tick_id
].
px
)*(mou£_x - u_evíts[cuºít_tick_id].pxË+ (
mou£_y
 - u_evíts[cuºít_tick_id].
py
)*(mouse_y - u_events[current_tick_id].py) < 4900)

324 
	`¸óã_hôsc‹e_evít
(
u_evíts
[
cuºít_tick_id
].
px
, u_evíts[cuºít_tick_id].
py
, 
HIT_30
, 
time_£q
, u_evíts[cuºít_tick_id].
föish_time
);

325 
	`föish_evít
(
u_evíts
, 
cuºít_tick_id
, 0, 
time
, 0, 
time_£q
);

326 
	`£t_cuºít_tick_time
(
u_evíts
, 
evít_num
, u_evíts[
cuºít_tick_id
].
föish_time
);

334 
i
 = 0 ; i < 
p
->
max_Àn
 ; i++)

337 
åx
 = 
p
->
poöts
[
i
].
x
 + 
cú˛e_size
/2.0;

338 
åy
 = 
p
->
poöts
[
i
].
y
 + 
cú˛e_size
/2.0;

339 
blx
 = 
p
->
poöts
[
i
].
x
 - 
cú˛e_size
/2.0;

340 
bly
 = 
p
->
poöts
[
i
].
y
 - 
cú˛e_size
/2.0;

341 
	`TEXTURE_DRAW_BEGIN
(
ovîœy_ãx
);

342 
	`TEXTURE_PIN
(0.0,0.0, 
blx
, 
bly
);

343 
	`TEXTURE_PIN
(0.0,1.0, 
blx
, 
åy
);

344 
	`TEXTURE_PIN
(1.0,1.0, 
åx
, 
åy
);

345 
	`TEXTURE_PIN
(1.0,0.0, 
åx
, 
bly
);

346 
	`TEXTURE_DRAW_END
();

348 
i
 = 0 ; i < 
p
->
max_Àn
 ; i++)

351 
åx
 = 
p
->
poöts
[
i
].
x
 + 
cú˛e_size
/2.0;

352 
åy
 = 
p
->
poöts
[
i
].
y
 + 
cú˛e_size
/2.0;

353 
blx
 = 
p
->
poöts
[
i
].
x
 - 
cú˛e_size
/2.0;

354 
bly
 = 
p
->
poöts
[
i
].
y
 - 
cú˛e_size
/2.0;

355 
	`TEXTURE_DRAW_BEGIN
(
hôcú˛e_ãx
[
p
->
cﬁ‹_ödex
]);

356 
	`TEXTURE_PIN
(0.0,0.0, 
blx
, 
bly
);

357 
	`TEXTURE_PIN
(0.0,1.0, 
blx
, 
åy
);

358 
	`TEXTURE_PIN
(1.0,1.0, 
åx
, 
åy
);

359 
	`TEXTURE_PIN
(1.0,0.0, 
åx
, 
bly
);

360 
	`TEXTURE_DRAW_END
();

362 
åx
 = 
p
->
poöts
[0].
x
 + 
cú˛e_size
/2.0;

363 
åy
 = 
p
->
poöts
[0].
y
 + 
cú˛e_size
/2.0;

364 
blx
 = 
p
->
poöts
[0].
x
 - 
cú˛e_size
/2.0;

365 
bly
 = 
p
->
poöts
[0].
y
 - 
cú˛e_size
/2.0;

366 
	`TEXTURE_DRAW_BEGIN
(
hôcú˛e_ãx
[
p
->
cﬁ‹_ödex
]);

367 
	`TEXTURE_PIN
(0.0,0.0, 
blx
, 
bly
);

368 
	`TEXTURE_PIN
(0.0,1.0, 
blx
, 
åy
);

369 
	`TEXTURE_PIN
(1.0,1.0, 
åx
, 
åy
);

370 
	`TEXTURE_PIN
(1.0,0.0, 
åx
, 
bly
);

371 
	`TEXTURE_DRAW_END
();

372 
	`TEXTURE_DRAW_BEGIN
(
ovîœy_ãx
);

373 
	`TEXTURE_PIN
(0.0,0.0, 
blx
, 
bly
);

374 
	`TEXTURE_PIN
(0.0,1.0, 
blx
, 
åy
);

375 
	`TEXTURE_PIN
(1.0,1.0, 
åx
, 
åy
);

376 
	`TEXTURE_PIN
(1.0,0.0, 
åx
, 
bly
);

377 
	`TEXTURE_DRAW_END
();

379 
åx
 = 
p
->
poöts
[
Àn
-1].
x
 + 
cú˛e_size
/2.0;

380 
åy
 = 
p
->
poöts
[
Àn
-1].
y
 + 
cú˛e_size
/2.0;

381 
blx
 = 
p
->
poöts
[
Àn
-1].
x
 - 
cú˛e_size
/2.0;

382 
bly
 = 
p
->
poöts
[
Àn
-1].
y
 - 
cú˛e_size
/2.0;

383 
	`TEXTURE_DRAW_BEGIN
(
hôcú˛e_ãx
[
p
->
cﬁ‹_ödex
]);

384 
	`TEXTURE_PIN
(0.0,0.0, 
blx
, 
bly
);

385 
	`TEXTURE_PIN
(0.0,1.0, 
blx
, 
åy
);

386 
	`TEXTURE_PIN
(1.0,1.0, 
åx
, 
åy
);

387 
	`TEXTURE_PIN
(1.0,0.0, 
åx
, 
bly
);

388 
	`TEXTURE_DRAW_END
();

389 
	`TEXTURE_DRAW_BEGIN
(
ovîœy_ãx
);

390 
	`TEXTURE_PIN
(0.0,0.0, 
blx
, 
bly
);

391 
	`TEXTURE_PIN
(0.0,1.0, 
blx
, 
åy
);

392 
	`TEXTURE_PIN
(1.0,1.0, 
åx
, 
åy
);

393 
	`TEXTURE_PIN
(1.0,0.0, 
åx
, 
bly
);

394 
	`TEXTURE_DRAW_END
();

395 
	}
}

397 
	$background_åiggî
(*
£lf
, 
time_£q_t
 *
time_£q
, 
size_t
 
time
)

399 
	`TEXTURE_DRAW_BEGIN
(
background_ãx
);

400 
	`TEXTURE_PIN
(0.0,0.0, 0, 0);

401 
	`TEXTURE_PIN
(0.0,1.0, 0, 480);

402 
	`TEXTURE_PIN
(1.0,1.0, 640, 480);

403 
	`TEXTURE_PIN
(1.0,0.0, 640, 0);

404 
	`TEXTURE_DRAW_END
();

405 
	}
}

412 
	$¸óã_hôcú˛e_evít
(
x
, 
y
, 
cﬁ‹_ödex
, 
time_£q_t
 *
time_£q
, 
size_t
 
time
, size_à
œ°_time
, 
wôh_ovîœy
)

414 
i
, 
j
;

415 
Hôcú˛e
* 
p
;

416 
i
 = 0 ; i < 
œ°_time
 ; i++){

417 
p
 = 
	`√w_hôcú˛e
(
x
, 
y
, &
hôcú˛e_ãx
[
cﬁ‹_ödex
], 
wôh_ovîœy
);

418 
	`time_£q_ö£π_hód
(
time_£q
, 
time
 + 
i
, (
evít_t
*)
p
);

420 
	}
}

428 
	$¸óã_≠¥ﬂch_evít
(
x
, 
y
, 
cﬁ‹_ödex
, 
time_£q_t
 *
time_£q
, 
size_t
 
time
)

430 
i
;

431 
Aµrﬂch
* 
p
;

432 
i
 = 0 ; i < 
CIRCLE_CLOSE_TIME
 ; i++){

433 
p
 = 
	`√w_≠¥ﬂch
(
x
, 
y
, &
≠¥ﬂch_ãx
[
cﬁ‹_ödex
]);

434 
p
->
cuºít_zoomøã
 = ()
APPROACH_INIT_ZOOMRATE
 - 
i
 * ()(APPROACH_INIT_ZOOMRATE - 1)/
CIRCLE_CLOSE_TIME
;

435 
	`time_£q_ö£π_èû
(
time_£q
, 
time
 + 
i
, (
evít_t
*)
p
);

437 
	}
}

448 
	$¸óã_cú˛íumbî_evít
(
x
, 
y
, 
numbî
, 
time_£q_t
 *
time_£q
, 
size_t
 
time
, size_à
œ°_time
)

450 
i
;

451 
x1
, 
x2
;

452 
numbî1
, 
numbî2
;

453 
Cú˛íumbî
* 
p
;

454 if(
numbî
 == -1)

456 
i
 = 0 ; i < 
œ°_time
; i++){

457 
p
 = 
	`√w_cú˛íumbî
(
x
, 
y
, &
ªvî£_ãx
);

458 
	`time_£q_ö£π_hód
(
time_£q
, 
time
+
i
, (
evít_t
*)
p
);

461 if(
numbî
 < 10){

462 
i
 = 0 ; i < 
œ°_time
 ; i++){

463 
p
 = 
	`√w_cú˛íumbî
(
x
, 
y
, &
numbî_ãx
[
numbî
]);

464 
	`time_£q_ö£π_hód
(
time_£q
, 
time
 + 
i
, (
evít_t
*)
p
);

469 
x1
 = 
x
 - 
numbî_size
/2;

470 
x2
 = 
x
 + 
numbî_size
/2;

471 
numbî1
 = 
numbî
/10;

472 
numbî2
 = 
numbî
%10;

473 
i
 = 0 ; i < 
œ°_time
; i++){

474 
p
 = 
	`√w_cú˛íumbî
(
x1
, 
y
, &
numbî_ãx
[
numbî1
]);

475 
	`time_£q_ö£π_hód
(
time_£q
, 
time
 + 
i
, (
evít_t
*)
p
);

476 
p
 = 
	`√w_cú˛íumbî
(
x2
, 
y
, &
numbî_ãx
[
numbî2
]);

477 
	`time_£q_ö£π_hód
(
time_£q
, 
time
 + 
i
, (
evít_t
*)
p
);

480 
	}
}

488 
	$¸óã_hôsc‹e_evít
(
x
, 
y
, 
sc‹e
, 
time_£q_t
 *
time_£q
, 
size_t
 
time
)

490 
i
;

491 
Hôsc‹e
 *
p
;

493 
i
 = 0 ; i < 
HITSCORE_APPEAR_TIME
 ; i++){

494 
p
 = 
	`√w_hôsc‹e
(
x
, 
y
, &
hôsc‹e_ãx
[
sc‹e
]);

495 
p
->
cuºít_zoomøã
 = ()
HITSCORE_INIT_ZOOMRATE
 + 
i
 * ()(1 - HITSCORE_INIT_ZOOMRATE)/()
HITSCORE_APPEAR_TIME
;

496 
	`time_£q_ö£π_èû
(
time_£q
, 
time
 + 
i
, (
evít_t
*)
p
);

499 ; 
i
 < 
HITSCORE_EXIST_TIME
 ; i++){

500 
p
 = 
	`√w_hôsc‹e
(
x
, 
y
, &
hôsc‹e_ãx
[
sc‹e
]);

501 
p
->
cuºít_zoomøã
 = 1;

502 
	`time_£q_ö£π_èû
(
time_£q
, 
time
 + 
i
, (
evít_t
*)
p
);

504 
	}
}

512 
	$¸óã_¶idîbÆl_evít
(
x
, 
y
, 
ödex
, 
time_£q_t
 *
time_£q
, 
size_t
 
time
, size_à
œ°_time
, 
dx
, 
dy
, 
sound_ty≥
)

514 
i
;

515 
SlidîbÆl
 *
p
;

516 
i
 = 0 ; i < 
œ°_time
; i++)

518 
p
 = 
	`√w_¶idîbÆl
(
x
, 
y
, &
¶idîbÆl_ãx
[
ödex
], 
dx
, 
dy
, 
sound_ty≥
);

519 
	`time_£q_ö£π_hód
(
time_£q
, 
time
+
i
, (
evít_t
*)
p
);

521 
	}
}

528 
	$¸óã_background
(*
background
, 
time_£q_t
 *
time_£q
, 
max_time
)

530 
Background
 *
p
;

531 
i
;

532 
	`¥ötf
("%s\n", 
background
);

533 
background_ãx
 = 
	`ãxtuª_lﬂd_wôh_Æpha
(
background
, 0.6);

534 
i
 = 0 ; i < 
max_time
 ;i++){

535 
p
 = 
	`√w_background
();

536 
	`time_£q_ö£π_hód
(
time_£q
, 
i
, (
evít_t
*)
p
);

539 
	}
}

546 
cﬁ‹_deföed
;

547 
cﬁ‹_num
;

549 
	$˚Œ_öô
()

551 
i
;

552 
ãmp
[50];

553 
Cﬁ‹Li°
 *
c
;

554 
Cﬁ‹_r
 *
pc
;

555 if(
cﬁ‹_deföed
){

557 
c
 = 
	`osu_gë_cﬁ‹_li°
();

558 
i
 = 0;

559 
	`TAILQ_FOREACH
(
pc
,
c
, 
Cíåy
)

561 
hôcú˛e_cﬁ‹
[
i
][0] = 
pc
->
r
;

562 
hôcú˛e_cﬁ‹
[
i
][1] = 
pc
->
g
;

563 
hôcú˛e_cﬁ‹
[
i
][2] = 
pc
->
b
;

564 
	`¥ötf
("a:%d, %d, %d\n", 
pc
->
r
,Öc->
g
,Öc->
b
);

565 
i
 ++;

567 
cﬁ‹_num
 = 
i
;

569 
i
 = 0 ; i < 
cﬁ‹_num
 ; i++){

570 
hôcú˛e_ãx
[
i
] = 
	`ãxtuª_lﬂd_wôh_cﬁ‹
(
	`STR
(
MATERIAL_DIR
/
hôcú˛e
.
≤g
), 
hôcú˛e_cﬁ‹
[i][0], hitcircle_color[i][1], hitcircle_color[i][2]);

571 
≠¥ﬂch_ãx
[
i
] = 
	`ãxtuª_lﬂd_wôh_cﬁ‹
(
	`STR
(
MATERIAL_DIR
/
≠¥ﬂchcú˛e
.
≤g
), 
hôcú˛e_cﬁ‹
[i][0], hitcircle_color[i][1], hitcircle_color[i][2]);

574 
hôcú˛e_ãx
[9] = 
	`ãxtuª_lﬂd
(
	`STR
(
MATERIAL_DIR
/
hôcú˛e
.
≤g
));

576 
i
 = 0 ; i < 10 ; i++){

577 
	`•rötf
(
ãmp
, 
	`STR
(
MATERIAL_DIR
/-%
d
.
≤g
), 
i
);

578 
numbî_ãx
[
i
] = 
	`ãxtuª_lﬂd
(
ãmp
);

581 
i
 = 0 ; i < 10 ; i++){

582 
	`•rötf
(
ãmp
, 
	`STR
(
MATERIAL_DIR
/
¶idîb
%
d
.
≤g
), 
i
);

583 
¶idîbÆl_ãx
[
i
] = 
	`ãxtuª_lﬂd
(
ãmp
);

587 
ªvî£_ãx
 = 
	`ãxtuª_lﬂd
(
	`STR
(
MATERIAL_DIR
/
ªvî£¨row
.
≤g
));

588 
ovîœy_ãx
 = 
	`ãxtuª_lﬂd
(
	`STR
(
MATERIAL_DIR
/
hôcú˛eovîœy
.
≤g
));

589 
¶idîfﬁlow_ãx
 = 
	`ãxtuª_lﬂd
(
	`STR
(
MATERIAL_DIR
/
¶idîfﬁlowcú˛e
.
≤g
));

590 
hôsc‹e_ãx
[
HIT_50
] = 
	`ãxtuª_lﬂd
(
	`STR
(
MATERIAL_DIR
/
hô50
.
≤g
));

591 
hôsc‹e_ãx
[
HIT_100
] = 
	`ãxtuª_lﬂd
(
	`STR
(
MATERIAL_DIR
/
hô100
.
≤g
));

592 
hôsc‹e_ãx
[
HIT_100k
] = 
	`ãxtuª_lﬂd
(
	`STR
(
MATERIAL_DIR
/
hô100k
.
≤g
));

593 
hôsc‹e_ãx
[
HIT_300
] = 
	`ãxtuª_lﬂd
(
	`STR
(
MATERIAL_DIR
/
hô300
.
≤g
));

594 
hôsc‹e_ãx
[
HIT_300k
] = 
	`ãxtuª_lﬂd
(
	`STR
(
MATERIAL_DIR
/
hô300k
.
≤g
));

595 
hôsc‹e_ãx
[
HIT_300g
] = 
	`ãxtuª_lﬂd
(
	`STR
(
MATERIAL_DIR
/
hô300g
.
≤g
));

596 
hôsc‹e_ãx
[
HIT_miss
] = 
	`ãxtuª_lﬂd
(
	`STR
(
MATERIAL_DIR
/
hô0
.
≤g
));

597 
hôsc‹e_ãx
[
HIT_30
] = 
	`ãxtuª_lﬂd
(
	`STR
(
MATERIAL_DIR
/
¶idîpoöt30
.
≤g
));

598 
	}
}

647 
	$¸óã_¶idî
(
DŸ
 *
poöts
, 
Àn
, 
time_£q_t
 *
time_£q
, 
cﬁ‹_ödex
, 
numbî
, 
ªvî£_time
, 
sound_ty≥
)

652 
tŸÆ_time
 = (
poöts
[
Àn
-1].
time
 -Öoöts[0].timeË* 
ªvî£_time
 + (’oöts[0].timê> 
HITCIRCLE_EXIST_TIME
)?HITCIRCLE_EXIST_TIME:points[0].time);

653 
exi°_time
 = 
poöts
[
Àn
-1].
time
 -Öoöts[0].timê+((
HITCIRCLE_EXIST_TIME
 >Öoints[0].time)?points[0].time:HITCIRCLE_EXIST_TIME);

654 
öãrvÆ_time
 = 
poöts
[
Àn
-1].
time
 -Öoints[0].time;

655 
i
;

656 
Slidî
 *
p
;

662 
i
 = 0 ; i < 
ªvî£_time
 ; i++){

663 
	`¸óã_¶idî_bÆl
(
poöts
, 
Àn
, 
time_£q
, 
i
, 
sound_ty≥
);

665 if(
i
 == 0){

666 
	`¸óã_≠¥ﬂch_evít
(
poöts
[0].
x
,Öoöts[0].
y
, 
cﬁ‹_ödex
, 
time_£q
, (poöts[
Àn
-1].
time
>
exi°_time
)?(points[len-1].time-exist_time):0);

667 if(
ªvî£_time
 != 2){

668 
	`¸óã_cú˛íumbî_evít
(
poöts
[0].
x
,Öoöts[0].
y
, 
numbî
, 
time_£q
,Öoöts[
Àn
-1].
time
-
exi°_time
,Éxist_time);

671 
	`¸óã_cú˛íumbî_evít
(
poöts
[0].
x
,Öoöts[0].
y
, 
numbî
, 
time_£q
,Öoöts[
Àn
-1].
time
-
exi°_time
,Éxi°_timê+ 
öãrvÆ_time
);

673 if(
ªvî£_time
 != 1){

674 
	`¸óã_cú˛íumbî_evít
(
poöts
[
Àn
-1].
x
,Öoöts[Àn-1].
y
, -1, 
time_£q
,Öoöts[Àn-1].
time
-
exi°_time
 + 
i
*
öãrvÆ_time
,Éxist_time);

677 if(
i
 =
ªvî£_time
 -1)

679 if(
i
 % 2 ==1)

681 
	`¸óã_cú˛íumbî_evít
(
poöts
[
Àn
-1].
x
,Öoöts[Àn-1].
y
, -1, 
time_£q
,Öoöts[Àn-1].
time
-
exi°_time
 + 
i
 * 
öãrvÆ_time
, interval_time);

684 
	`¸óã_cú˛íumbî_evít
(
poöts
[0].
x
,Öoöts[0].
y
, -1, 
time_£q
,Öoöts[
Àn
-1].
time
-
exi°_time
 + 
i
 * 
öãrvÆ_time
, interval_time);

687 
	`¸óã_cú˛íumbî_evít
(
poöts
[
Àn
-1].
x
,Öoöts[Àn-1].
y
, -1, 
time_£q
,Öoöts[Àn-1].
time
-
exi°_time
 + 
i
 * 
öãrvÆ_time
, interval_time);

688 
	`¸óã_cú˛íumbî_evít
(
poöts
[0].
x
,Öoöts[0].
y
, -1, 
time_£q
,Öoöts[
Àn
-1].
time
-
exi°_time
 + 
i
 * 
öãrvÆ_time
, interval_time);

692 
i
 = 0 ; i < 
tŸÆ_time
 ; i++ ){

693 
p
 = 
	`√w_¶idî
(
poöts
, 
Àn
, 
cﬁ‹_ödex
, 
ªvî£_time
);

694 
	`time_£q_ö£π_hód
(
time_£q
, 
poöts
[
Àn
-1].
time
 -
exi°_time
 + 
i
, (
evít_t
*)
p
);

696 
	}
}

704 
	$¸óã_¶idî_bÆl
(
DŸ
 *
poöts
, 
Àn
, 
time_£q_t
 *
time_£q
, 
sˇn_time
, 
sound_ty≥
)

706 
i
, 
j
;

707 
j
 = 0;

708 if(
sˇn_time
 % 2 == 0){

709 
i
 = 0 ; i < 
Àn
-1 ; i++)

711 
j
++;

712 if(
j
 == 10) j = 1;

713 
	`¸óã_¶idîbÆl_evít
(
poöts
[
i
].
x
,Öoöts[i].
y
, 
j
, 
time_£q
,Öoöts[i].
time
 + 
sˇn_time
*’oöts[
Àn
-1].time-poöts[0].time),Öoöts[i+1].timê-Öoöts[i].time,Öoöts[i].
dx
,Öoöts[i].
dy
, ((ò=Àn-2)?
sound_ty≥
:-1));

717 
i
 = 
Àn
-1 ; i >=1 ; i--)

719 
j
++;

720 if(
j
 == 10) j = 1;

721 
	`¸óã_¶idîbÆl_evít
(
poöts
[
i
].
x
,Öoöts[i].
y
, 
j
, 
time_£q
,Öoöts[
Àn
-i].
time
 + 
sˇn_time
*’oöts[Àn-1].time-poöts[0].time),Öoöts[Àn-i].timê-Öoöts[Àn-i-1].time, -poöts[i].
dx
, -poöts[i].
dy
, ((ò=Àn-2)?
sound_ty≥
:-1));

724 
	}
}

	@utils/curve.c

1 
	~<°dio.h
>

2 
	~<°dlib.h
>

3 
	~<m©h.h
>

5 
	~<öc/curve.h
>

7 
	$bezõr_¨c_Àn
(
t
, 
c⁄åﬁ_poöts
[][2], 
°¨t_idx
, 
degªe
)

9 
i
, 
j
;

10 
b
[100][2], 
db
[100][2];

11 
ªsu…
;

12 
i
 = 0; i < 
degªe
; i++)

14 
b
[
i
][0] = 
c⁄åﬁ_poöts
[i+
°¨t_idx
][0];

15 
b
[
i
][1] = 
c⁄åﬁ_poöts
[i+
°¨t_idx
][1];

17 
db
[
i
][0] = 0.0;

18 
db
[
i
][1] = 0.0;

20 
i
 = 1; i < 
degªe
; i++)

22 
j
 = 0; j < 
degªe
-
i
; j++)

24 
db
[
j
][0] +
t
 * (db[j+1][0] - db[j][0]Ë+ (
b
[j+1][0] - b[j][0]);

25 
db
[
j
][1] +
t
 * (db[j+1][1] - db[j][1]Ë+ (
b
[j+1][1] - b[j][1]);

26 
b
[
j
][0] +
t
 * (b[j+1][0] - b[j][0]);

27 
b
[
j
][1] +
t
 * (b[j+1][1] - b[j][1]);

30 
ªsu…
 = 
	`sqπ
(
db
[0][0]*db[0][0] + db[0][1]*db[0][1]);

31  
ªsu…
;

32 
	}
}

35 
simps⁄_mëhod
(
a
, 
b
, (*
f
)(,[][2],,), 
c⁄åﬁ_poöts
[][2], 
°¨t_idx
, 
degªe
)

37 
i
;

38 
h
 = (
b
 - 
a
Ë/ 
DIV_POINT_NUM
;

39 
ªsu…
 = 0.0;

40 
i
 = 0; i < 
DIV_POINT_NUM
; i++)

41 
ªsu…
 +(
	`f
(
a
+
i
*
h
, 
c⁄åﬁ_poöts
, 
°¨t_idx
, 
degªe
) + 4 * f(a+(i+0.5)*h, control_points, start_idx, degree) + f(a+(i+1)*h, control_points, start_idx, degree)) * h / 6;

42  
ªsu…
;

43 
	}
}

46 
	$bö¨y_£¨ch_t
(
èr_Àngth
, 
c⁄åﬁ_poöts
[][2], 
°¨t_idx
, 
degªe
)

48 
mö
 = 0.0, 
mid
 = 0.5, 
max
 = 1.0;

49 
cur_Àngth
;

51 
max
 - 
mö
 > 0.00001)

53 
cur_Àngth
 = 
	`simps⁄_mëhod
(0, 
mid
, 
bezõr_¨c_Àn
, 
c⁄åﬁ_poöts
, 
°¨t_idx
, 
degªe
);

56 i‡(
	`Ábs
(
cur_Àngth
-
èr_Àngth
) < 0.01)

58 i‡(
cur_Àngth
 - 
èr_Àngth
 >= 0.01)

59 
max
 = 
mid
;

61 
mö
 = 
mid
;

62 
mid
 = (
mö
 + 
max
) / 2;

64  
mid
;

65 
	}
}

68 
	$¸óã_bezõr
(
c⁄åﬁ_poöts
[][2], 
DŸ
 *
døw_poöts
, 
num
, 
°¨t_idx
, 
degªe
, 
°¨t_time
, 
¶idî_mu…ùlõr
, 
bót_Àngth
)

70 
i
, 
j
, 
k
;

71 
t
;

72 
b
[100][2], 
db
[100][2];

74 
k
 = 0; k < 
num
; k++)

76 
t
 = 
	`bö¨y_£¨ch_t
(
k
 * 
CIRCLE_DENSITY
, 
c⁄åﬁ_poöts
, 
°¨t_idx
, 
degªe
);

78 
j
 = 0; j < 
degªe
; j++)

80 
b
[
j
][0] = 
c⁄åﬁ_poöts
[j+
°¨t_idx
][0];

81 
b
[
j
][1] = 
c⁄åﬁ_poöts
[j+
°¨t_idx
][1];

82 
db
[
j
][0] = 0.0;

83 
db
[
j
][1] = 0.0;

85 
i
 = 1; i < 
degªe
; i++)

87 
j
 = 0; j < 
degªe
-
i
; j++)

89 
db
[
j
][0] +
t
 * (db[j+1][0] - db[j][0]Ë+ (
b
[j+1][0] - b[j][0]);

90 
db
[
j
][1] +
t
 * (db[j+1][1] - db[j][1]Ë+ (
b
[j+1][1] - b[j][1]);

91 
b
[
j
][0] +
t
 * (b[j+1][0] - b[j][0]);

92 
b
[
j
][1] +
t
 * (b[j+1][1] - b[j][1]);

96 
døw_poöts
[
k
].
x
 = 
b
[0][0];

97 
døw_poöts
[
k
].
y
 = 
b
[0][1];

98 
døw_poöts
[
k
].
time
 = ()(
°¨t_time
 + ()k * 
CIRCLE_DENSITY
 /(
¶idî_mu…ùlõr
*100Ë* 
bót_Àngth
);

99 
døw_poöts
[
k
].
dx
 = 
db
[0][0] / 
	`sqπ
(db[0][0]*db[0][0] + db[0][1]*db[0][1]);

100 
døw_poöts
[
k
].
dy
 = 
db
[0][1] / 
	`sqπ
(db[0][0]*db[0][0] + db[0][1]*db[0][1]);

102 
	}
}

105 
	$curve_gë_¶idî_poöts
(
Slidî_r
 * 
¶idî
, 
¶idî_mu…ùlõr
, 
tick_øã
, 
bót_Àngth
, 
DŸ
 ** 
dŸ_°‹e
)

107 
c⁄åﬁ_poöts_num
 = 
¶idî
->
posNum
+1;

108 (*
c⁄åﬁ_poöts
)[2];

109 
°¨t_time
 = 
¶idî
->
°¨tTimeMs
;

110 
¶idî_Àngth
 = 
¶idî
->
¶idîLígthPixñs
, 
Àn
, 
dis
 = (
¶idî_mu…ùlõr
*100Ë/ 
tick_øã
;

111 
i
, 
j
, 
œ°_ödex
, 
°¨t_idx
, 
degªe
;

112 
cú˛e_num
, 
tŸÆ_cú˛e_num
, 
tick_num
;

113 
DŸ
 *
døw_poöts
;

116 
c⁄åﬁ_poöts
 = (*)
	`mÆloc
((
¶idî
->
posNum
 + 1)*()*2);

117 
c⁄åﬁ_poöts
[0][0] = 
¶idî
->
xPos
;

118 
c⁄åﬁ_poöts
[0][1] = 
¶idî
->
yPos
;

119 
i
 = 0; i < 
¶idî
->
posNum
; i++)

120 
c⁄åﬁ_poöts
[
i
+1][0] = 
¶idî
->
pos
[i][0],

121 
c⁄åﬁ_poöts
[
i
+1][1] = 
¶idî
->
pos
[i][1];

125 
døw_poöts
 = 
NULL
;

126 
tŸÆ_cú˛e_num
 = 0;

127 
œ°_ödex
 = 0;

128 
i
 = 0; i < 
c⁄åﬁ_poöts_num
; i++)

130 i‡(
i
=
c⁄åﬁ_poöts_num
-1 || (
c⁄åﬁ_poöts
[i][0] == control_points[i+1][0] && control_points[i][1] == control_points[i+1][1]))

132 
°¨t_idx
 = 
œ°_ödex
;

133 
degªe
 = 
i
 - 
°¨t_idx
 + 1;

134 
Àn
 = 
	`simps⁄_mëhod
(0, 1, 
bezõr_¨c_Àn
, 
c⁄åﬁ_poöts
, 
°¨t_idx
, 
degªe
);

136 
cú˛e_num
 = ()
Àn
 / 
CIRCLE_DENSITY
;

137 i‡(
i
 =
c⁄åﬁ_poöts_num
-1)

138 
cú˛e_num
++;

140 
tŸÆ_cú˛e_num
 +
cú˛e_num
;

141 
døw_poöts
 = (
DŸ
*)
	`ªÆloc
(døw_poöts, 
tŸÆ_cú˛e_num
*(Dot));

143 
	`¸óã_bezõr
(
c⁄åﬁ_poöts
, 
døw_poöts
+
tŸÆ_cú˛e_num
-
cú˛e_num
, cú˛e_num, 
°¨t_idx
, 
degªe
, 
°¨t_time
, 
¶idî_mu…ùlõr
, 
bót_Àngth
);

144 
°¨t_time
 +
Àn
 / (
¶idî_mu…ùlõr
*100Ë* 
bót_Àngth
;

145 
œ°_ödex
 = 
i
+1;

146 
tick_num
 = ()(
Àn
 / 
dis
);

148 
j
 = 0; j < 
cú˛e_num
; j++)

149 
døw_poöts
[
tŸÆ_cú˛e_num
-
cú˛e_num
+
j
].
is_tick
 = 0;

150 
j
 = 1; j <
tick_num
; j++)

151 
døw_poöts
[
tŸÆ_cú˛e_num
-
cú˛e_num
+()(
j
*
dis
/
CIRCLE_DENSITY
)].
is_tick
 = 1;

158 *
dŸ_°‹e
 = 
døw_poöts
;

159  
tŸÆ_cú˛e_num
;

160 
	}
}

	@utils/lodepng.c

31 
	~<öc/lodïng.h
>

33 
	~<°dio.h
>

34 
	~<°dlib.h
>

36 #ifde‡
__˝lu•lus


37 
	~<f°ªam
>

40 
	#VERSION_STRING
 "20110221"

	)

53 #ifde‡
LODEPNG_COMPILE_ZLIB


54 #ifde‡
LODEPNG_COMPILE_ENCODER


56 
	sve˘‹


58 * 
	md©a
;

59 
size_t
 
	msize
;

60 
size_t
 
	mÆlocsize
;

61 
	mty≥size
;

62 } 
	tve˘‹
;

64 
	$ve˘‹_ªsize
(
ve˘‹
* 
p
, 
size_t
 
size
)

66 if(
size
 * 
p
->
ty≥size
 >Ö->
Ælocsize
)

68 
size_t
 
√wsize
 = 
size
 * 
p
->
ty≥size
 * 2;

69 * 
d©a
 = 
	`ªÆloc
(
p
->d©a, 
√wsize
);

70 if(
d©a
)

72 
p
->
Ælocsize
 = 
√wsize
;

73 
p
->
d©a
 = data;

74 
p
->
size
 = size;

78 
p
->
size
 = size;

80 
	}
}

82 
ve˘‹_ªsized
(
ve˘‹
* 
p
, 
size_t
 
size
, 
	$dt‹
(*))

84 
size_t
 
i
;

85 if(
size
 < 
p
->size)

87 
i
 = 
size
; i < 
p
->size; i++)

89 
	`dt‹
(&((*)(
p
->
d©a
))[
i
 *Ö->
ty≥size
]);

92  
	`ve˘‹_ªsize
(
p
, 
size
);

93 
	}
}

95 
	$ve˘‹_˛ónup
(* 
p
)

97 ((
ve˘‹
*)
p
)->
size
 = ((ve˘‹*Ì)->
Ælocsize
 = 0;

98 
	`‰ì
(((
ve˘‹
*)
p
)->
d©a
);

99 ((
ve˘‹
*)
p
)->
d©a
 = 
NULL
;

100 
	}
}

102 
ve˘‹_˛ónupd
(
ve˘‹
* 
p
, 
	$dt‹
(*))

104 
	`ve˘‹_ªsized
(
p
, 0, 
dt‹
);

105 
	`ve˘‹_˛ónup
(
p
);

106 
	}
}

108 
	$ve˘‹_öô
(
ve˘‹
* 
p
, 
ty≥size
)

110 
p
->
d©a
 = 
NULL
;

111 
p
->
size
 =Ö->
Ælocsize
 = 0;

112 
p
->
ty≥size
 =Åypesize;

113 
	}
}

115 
	$ve˘‹_sw≠
(
ve˘‹
* 
p
, ve˘‹* 
q
)

117 
size_t
 
tmp
;

118 * 
tmµ
;

119 
tmp
 = 
p
->
size
;Ö->sizê
q
->size; q->size =Åmp;

120 
tmp
 = 
p
->
Ælocsize
;Ö->Ælocsizê
q
->allocsize; q->allocsize =Åmp;

121 
tmµ
 = 
p
->
d©a
;Ö->d©®
q
->data; q->data =Åmpp;

122 
	}
}

124 * 
	$ve˘‹_gë
(
ve˘‹
* 
p
, 
size_t
 
ödex
)

126  &((*)
p
->
d©a
)[
ödex
 *Ö->
ty≥size
];

127 
	}
}

134 #ifde‡
LODEPNG_COMPILE_ZLIB


135 
	suive˘‹


137 * 
	md©a
;

138 
size_t
 
	msize
;

139 
size_t
 
	mÆlocsize
;

140 } 
	tuive˘‹
;

142 
	$uive˘‹_˛ónup
(* 
p
)

144 ((
uive˘‹
*)
p
)->
size
 = ((uive˘‹*Ì)->
Ælocsize
 = 0;

145 
	`‰ì
(((
uive˘‹
*)
p
)->
d©a
);

146 ((
uive˘‹
*)
p
)->
d©a
 = 
NULL
;

147 
	}
}

149 
	$uive˘‹_ªsize
(
uive˘‹
* 
p
, 
size_t
 
size
)

151 if(
size
 * (Ë> 
p
->
Ælocsize
)

153 
size_t
 
√wsize
 = 
size
 * () * 2;

154 * 
d©a
 = 
	`ªÆloc
(
p
->d©a, 
√wsize
);

155 if(
d©a
)

157 
p
->
Ælocsize
 = 
√wsize
;

158 
p
->
d©a
 = (*)data;

159 
p
->
size
 = size;

163 
p
->
size
 = size;

165 
	}
}

167 
	$uive˘‹_ªsizev
(
uive˘‹
* 
p
, 
size_t
 
size
, 
vÆue
)

169 
size_t
 
ﬁdsize
 = 
p
->
size
, 
i
;

170 if(!
	`uive˘‹_ªsize
(
p
, 
size
))  0;

171 
i
 = 
ﬁdsize
; i < 
size
; i++Ë
p
->
d©a
[i] = 
vÆue
;

173 
	}
}

175 
	$uive˘‹_öô
(
uive˘‹
* 
p
)

177 
p
->
d©a
 = 
NULL
;

178 
p
->
size
 =Ö->
Ælocsize
 = 0;

179 
	}
}

181 #ifde‡
LODEPNG_COMPILE_ENCODER


182 
	$uive˘‹_push_back
(
uive˘‹
* 
p
, 
c
)

184 if(!
	`uive˘‹_ªsize
(
p
,Ö->
size
 + 1))  0;

185 
p
->
d©a
[p->
size
 - 1] = 
c
;

187 
	}
}

189 
	$uive˘‹_c›y
(
uive˘‹
* 
p
, c⁄° uive˘‹* 
q
)

191 
size_t
 
i
;

192 if(!
	`uive˘‹_ªsize
(
p
, 
q
->
size
))  0;

193 
i
 = 0; i < 
q
->
size
; i++Ë
p
->
d©a
[i] = q->data[i];

195 
	}
}

197 
	$uive˘‹_sw≠
(
uive˘‹
* 
p
, uive˘‹* 
q
)

199 
size_t
 
tmp
;

200 * 
tmµ
;

201 
tmp
 = 
p
->
size
;Ö->sizê
q
->size; q->size =Åmp;

202 
tmp
 = 
p
->
Ælocsize
;Ö->Ælocsizê
q
->allocsize; q->allocsize =Åmp;

203 
tmµ
 = 
p
->
d©a
;Ö->d©®
q
->data; q->data =Åmpp;

204 
	}
}

210 
	sucve˘‹


212 * 
	md©a
;

213 
size_t
 
	msize
;

214 
size_t
 
	mÆlocsize
;

215 } 
	tucve˘‹
;

217 
	$ucve˘‹_˛ónup
(* 
p
)

219 ((
ucve˘‹
*)
p
)->
size
 = ((ucve˘‹*Ì)->
Ælocsize
 = 0;

220 
	`‰ì
(((
ucve˘‹
*)
p
)->
d©a
);

221 ((
ucve˘‹
*)
p
)->
d©a
 = 
NULL
;

222 
	}
}

224 
	$ucve˘‹_ªsize
(
ucve˘‹
* 
p
, 
size_t
 
size
)

226 if(
size
 * (Ë> 
p
->
Ælocsize
)

228 
size_t
 
√wsize
 = 
size
 * () * 2;

229 * 
d©a
 = 
	`ªÆloc
(
p
->d©a, 
√wsize
);

230 if(
d©a
)

232 
p
->
Ælocsize
 = 
√wsize
;

233 
p
->
d©a
 = (*)data;

234 
p
->
size
 = size;

238 
p
->
size
 = size;

240 
	}
}

242 #ifde‡
LODEPNG_COMPILE_DECODER


243 #ifde‡
LODEPNG_COMPILE_PNG


244 
	$ucve˘‹_ªsizev
(
ucve˘‹
* 
p
, 
size_t
 
size
, 
vÆue
)

246 
size_t
 
ﬁdsize
 = 
p
->
size
, 
i
;

247 if(!
	`ucve˘‹_ªsize
(
p
, 
size
))  0;

248 
i
 = 
ﬁdsize
; i < 
size
; i++Ë
p
->
d©a
[i] = 
vÆue
;

250 
	}
}

254 
	$ucve˘‹_öô
(
ucve˘‹
* 
p
)

256 
p
->
d©a
 = 
NULL
;

257 
p
->
size
 =Ö->
Ælocsize
 = 0;

258 
	}
}

260 #ifde‡
LODEPNG_COMPILE_ZLIB


262 
	$ucve˘‹_öô_buf„r
(
ucve˘‹
* 
p
, * 
buf„r
, 
size_t
 
size
)

264 
p
->
d©a
 = 
buf„r
;

265 
p
->
Ælocsize
 =Ö->
size
 = size;

266 
	}
}

269 
	$ucve˘‹_push_back
(
ucve˘‹
* 
p
, 
c
)

271 if(!
	`ucve˘‹_ªsize
(
p
,Ö->
size
 + 1))  0;

272 
p
->
d©a
[p->
size
 - 1] = 
c
;

274 
	}
}

278 #ifde‡
LODEPNG_COMPILE_PNG


279 #ifde‡
LODEPNG_COMPILE_ANCILLARY_CHUNKS


280 
	$°rög_ªsize
(** 
out
, 
size_t
 
size
)

282 * 
d©a
 = (*)
	`ªÆloc
(*
out
, 
size
 + 1);

283 if(
d©a
)

285 
d©a
[
size
] = 0;

286 *
out
 = 
d©a
;

288  
d©a
 != 0;

289 
	}
}

291 
	$°rög_öô
(** 
out
)

293 *
out
 = 
NULL
;

294 
	`°rög_ªsize
(
out
, 0);

295 
	}
}

297 
	$°rög_˛ónup
(** 
out
)

299 
	`‰ì
(*
out
);

300 *
out
 = 
NULL
;

301 
	}
}

303 
	$°rög_£t
(** 
out
, c⁄° * 
ö
)

305 
size_t
 
ösize
 = 
	`°æí
(
ö
), 
i
 = 0;

306 if(
	`°rög_ªsize
(
out
, 
ösize
))

308 
i
 = 0; i < 
ösize
; i++)

310 (*
out
)[
i
] = 
ö
[i];

313 
	}
}

317 #ifde‡
LODEPNG_COMPILE_ZLIB


323 #ifde‡
LODEPNG_COMPILE_ENCODER


324 
	$addBôToSåóm
(
size_t
* 
bôpoöãr
, 
ucve˘‹
* 
bô°ªam
, 
bô
)

326 if((*
bôpoöãr
Ë% 8 =0Ë
	`ucve˘‹_push_back
(
bô°ªam
, ()0);

327 (
bô°ªam
->
d©a
[bô°ªam->
size
 - 1]Ë|(
bô
 << ((*
bôpoöãr
) & 0x7));

328 (*
bôpoöãr
)++;

329 
	}
}

331 
	$addBôsToSåóm
(
size_t
* 
bôpoöãr
, 
ucve˘‹
* 
bô°ªam
, 
vÆue
, size_à
nbôs
)

333 
size_t
 
i
;

334 
i
 = 0; i < 
nbôs
; i++Ë
	`addBôToSåóm
(
bôpoöãr
, 
bô°ªam
, ()((
vÆue
 >> i) & 1));

335 
	}
}

337 
	$addBôsToSåómRevî£d
(
size_t
* 
bôpoöãr
, 
ucve˘‹
* 
bô°ªam
, 
vÆue
, size_à
nbôs
)

339 
size_t
 
i
;

340 
i
 = 0; i < 
nbôs
; i++Ë
	`addBôToSåóm
(
bôpoöãr
, 
bô°ªam
, ()((
vÆue
 >> (nbits - 1 - i)) & 1));

341 
	}
}

344 #ifde‡
LODEPNG_COMPILE_DECODER


346 
	#READBIT
(
bôpoöãr
, 
bô°ªam
Ë((bô°ªam[bôpoöã∏>> 3] >> (bôpoöã∏& 0x7)Ë& ()1)

	)

348 
	$ªadBôFromSåóm
(
size_t
* 
bôpoöãr
, c⁄° * 
bô°ªam
)

350 
ªsu…
 = ()(
	`READBIT
(*
bôpoöãr
, 
bô°ªam
));

351 (*
bôpoöãr
)++;

352  
ªsu…
;

353 
	}
}

355 
	$ªadBôsFromSåóm
(
size_t
* 
bôpoöãr
, c⁄° * 
bô°ªam
, size_à
nbôs
)

357 
ªsu…
 = 0, 
i
;

358 
i
 = 0; i < 
nbôs
; i++)

360 
ªsu…
 +(()
	`READBIT
(*
bôpoöãr
, 
bô°ªam
)Ë<< 
i
;

361 (*
bôpoöãr
)++;

363  
ªsu…
;

364 
	}
}

371 
	#FIRST_LENGTH_CODE_INDEX
 257

	)

372 
	#LAST_LENGTH_CODE_INDEX
 285

	)

373 
	#NUM_DEFLATE_CODE_SYMBOLS
 288

	)

374 
	#NUM_DISTANCE_SYMBOLS
 32

	)

375 
	#NUM_CODE_LENGTH_CODES
 19

	)

377 c⁄° 
	gLENGTHBASE
[29]

379 c⁄° 
	gLENGTHEXTRA
[29]

381 c⁄° 
	gDISTANCEBASE
[30]

383 c⁄° 
	gDISTANCEEXTRA
[30]

385 c⁄° 
	gCLCL
[
NUM_CODE_LENGTH_CODES
]

390 #ifde‡
LODEPNG_COMPILE_ENCODER


396 
	sCoö


398 
uive˘‹
 
	msymbﬁs
;

399 
	mweight
;

400 } 
	tCoö
;

402 
	$Coö_öô
(
Coö
* 
c
)

404 
	`uive˘‹_öô
(&
c
->
symbﬁs
);

405 
	}
}

407 
	$Coö_˛ónup
(* 
c
)

409 
	`uive˘‹_˛ónup
(&((
Coö
*)
c
)->
symbﬁs
);

410 
	}
}

412 
	$Coö_c›y
(
Coö
* 
c1
, c⁄° Coö* 
c2
)

414 
c1
->
weight
 = 
c2
->weight;

415 
	`uive˘‹_c›y
(&
c1
->
symbﬁs
, &
c2
->symbols);

416 
	}
}

418 
	$addCoös
(
Coö
* 
c1
, c⁄° Coö* 
c2
)

420 
size_t
 
i
;

421 
i
 = 0; i < 
c2
->
symbﬁs
.
size
; i++Ë
	`uive˘‹_push_back
(&
c1
->symbﬁs, c2->symbﬁs.
d©a
[i]);

422 
c1
->
weight
 +
c2
->weight;

423 
	}
}

429 
	$Coö_s‹t
(
Coö
* 
d©a
, 
size_t
 
amou¡
)

431 
size_t
 
g≠
 = 
amou¡
;

432 
sw≠≥d
 = 0;

433 (
g≠
 > 1Ë|| 
sw≠≥d
)

435 
size_t
 
i
;

436 
g≠
 = (gap * 10) / 13;

437 if(
g≠
 == 9 || gap == 10) gap = 11;

438 if(
g≠
 < 1) gap = 1;

439 
sw≠≥d
 = 0;

440 
i
 = 0; i < 
amou¡
 - 
g≠
; i++)

442 
size_t
 
j
 = 
i
 + 
g≠
;

443 if(
d©a
[
j
].
weight
 < d©a[
i
].weight)

445 
ãmp
 = 
d©a
[
j
].
weight
; d©a[j].weighàd©a[
i
].weight; data[i].weight =Åemp;

446 
	`uive˘‹_sw≠
(&
d©a
[
i
].
symbﬁs
, &d©a[
j
].symbols);

447 
sw≠≥d
 = 1;

451 
	}
}

457 
	sHuffm™Tªe


459 
uive˘‹
 
	måì2d
;

460 
uive˘‹
 
	måì1d
;

461 
uive˘‹
 
	mÀngths
;

462 
	mmaxbôÀn
;

463 
	mnumcodes
;

464 } 
	tHuffm™Tªe
;

479 
	$Huffm™Tªe_öô
(
Huffm™Tªe
* 
åì
)

481 
	`uive˘‹_öô
(&
åì
->
åì2d
);

482 
	`uive˘‹_öô
(&
åì
->
åì1d
);

483 
	`uive˘‹_öô
(&
åì
->
Àngths
);

484 
	}
}

486 
	$Huffm™Tªe_˛ónup
(
Huffm™Tªe
* 
åì
)

488 
	`uive˘‹_˛ónup
(&
åì
->
åì2d
);

489 
	`uive˘‹_˛ónup
(&
åì
->
åì1d
);

490 
	`uive˘‹_˛ónup
(&
åì
->
Àngths
);

491 
	}
}

494 
	$Huffm™Tªe_make2DTªe
(
Huffm™Tªe
* 
åì
)

496 
nodefûÀd
 = 0;

497 
åìpos
 = 0;

498 
n
, 
i
;

500 if(!
	`uive˘‹_ªsize
(&
åì
->
åì2d
,Åªe->
numcodes
 * 2))  9901;

503 
n
 = 0;Ç < 
åì
->
numcodes
 * 2;Ç++Ëåì->
åì2d
.
d©a
[n] = 32767;

505 
n
 = 0;Ç < 
åì
->
numcodes
;Ç++)

507 
i
 = 0; i < 
åì
->
Àngths
.
d©a
[
n
]; i++)

509 
bô
 = ()((
åì
->
åì1d
.
d©a
[
n
] >> (åì->
Àngths
.d©a[n] - 
i
 - 1)) & 1);

510 if(
åìpos
 > 
åì
->
numcodes
 - 2)  55;

511 if(
åì
->
åì2d
.
d©a
[2 * 
åìpos
 + 
bô
] == 32767)

513 if(
i
 + 1 =
åì
->
Àngths
.
d©a
[
n
])

515 
åì
->
åì2d
.
d©a
[2 * 
åìpos
 + 
bô
] = 
n
;

516 
åìpos
 = 0;

520 
nodefûÀd
++;

521 
åì
->
åì2d
.
d©a
[2 * 
åìpos
 + 
bô
] = 
nodefûÀd
 +Åªe->
numcodes
;

522 
åìpos
 = 
nodefûÀd
;

525 
åìpos
 = 
åì
->
åì2d
.
d©a
[2 *Åªïo†+ 
bô
] -Åªe->
numcodes
;

529 
n
 = 0;Ç < 
åì
->
numcodes
 * 2;Ç++)

531 if(
åì
->
åì2d
.
d©a
[
n
] == 32767)Åree->tree2d.data[n] = 0;

535 
	}
}

542 
	$Huffm™Tªe_makeFromLígths2
(
Huffm™Tªe
* 
åì
)

544 
uive˘‹
 
blcou¡
;

545 
uive˘‹
 
√xtcode
;

546 
bôs
, 
n
, 
îr‹
 = 0;

548 
	`uive˘‹_öô
(&
blcou¡
);

549 
	`uive˘‹_öô
(&
√xtcode
);

550 if(!
	`uive˘‹_ªsize
(&
åì
->
åì1d
,Åªe->
numcodes
)

551 || !
	`uive˘‹_ªsizev
(&
blcou¡
, 
åì
->
maxbôÀn
 + 1, 0)

552 || !
	`uive˘‹_ªsizev
(&
√xtcode
, 
åì
->
maxbôÀn
 + 1, 0))

553 
îr‹
 = 9902;

555 if(!
îr‹
)

558 
bôs
 = 0; bô†< 
åì
->
numcodes
; bôs++Ë
blcou¡
.
d©a
[åì->
Àngths
.data[bits]]++;

560 
bôs
 = 1; bô†<
åì
->
maxbôÀn
; bôs++Ë
√xtcode
.
d©a
[bôs] = (√xtcode.d©a[bô†- 1] + 
blcou¡
.data[bits - 1]) << 1;

562 
n
 = 0;Ç < 
åì
->
numcodes
;Ç++Ëif—ªe->
Àngths
.
d©a
[n] !0Ëåì->
åì1d
.d©a[n] = 
√xtcode
.data[tree->lengths.data[n]]++;

565 
	`uive˘‹_˛ónup
(&
blcou¡
);

566 
	`uive˘‹_˛ónup
(&
√xtcode
);

568 if(!
îr‹
Ë 
	`Huffm™Tªe_make2DTªe
(
åì
);

569  
îr‹
;

570 
	}
}

578 
	$Huffm™Tªe_makeFromLígths
(
Huffm™Tªe
* 
åì
, c⁄° * 
bôÀn
, 
size_t
 
numcodes
, 
maxbôÀn
)

580 
i
;

581 if(!
	`uive˘‹_ªsize
(&
åì
->
Àngths
, 
numcodes
))  9903;

582 
i
 = 0; i < 
numcodes
; i++Ë
åì
->
Àngths
.
d©a
[i] = 
bôÀn
[i];

583 
åì
->
numcodes
 = ()numcodes;

584 
åì
->
maxbôÀn
 = maxbitlen;

585  
	`Huffm™Tªe_makeFromLígths2
(
åì
);

586 
	}
}

588 #ifde‡
LODEPNG_COMPILE_ENCODER


589 
	$Huffm™Tªe_fûlInCoös
(
ve˘‹
* 
coös
, c⁄° * 
‰equícõs
, 
numcodes
, 
size_t
 
sum
)

591 
i
;

592 
i
 = 0; i < 
numcodes
; i++)

594 
Coö
* 
coö
;

595 if(
‰equícõs
[
i
] == 0) ;

596 if(!
	`ve˘‹_ªsize
(
coös
, coös->
size
 + 1))

598 
	`ve˘‹_˛ónup
(
coös
);

601 
coö
 = (
Coö
*)(
	`ve˘‹_gë
(
coös
, coös->
size
 - 1));

602 
	`Coö_öô
(
coö
);

603 
coö
->
weight
 = 
‰equícõs
[
i
] / ()
sum
;

604 
	`uive˘‹_push_back
(&
coö
->
symbﬁs
, 
i
);

606 if(
coös
->
size
Ë
	`Coö_s‹t
((
Coö
*)coös->
d©a
, coins->size);

608 
	}
}

614 
	$Huffm™Tªe_makeFromFªquícõs
(
Huffm™Tªe
* 
åì
, c⁄° * 
‰equícõs
, 
size_t
 
numcodes
, 
maxbôÀn
)

616 
i
, 
j
;

617 
size_t
 
sum
 = 0, 
num¥e£¡
 = 0;

618 
îr‹
 = 0;

620 
ve˘‹
 
¥ev_row
;

621 
ve˘‹
 
coös
;

623 
åì
->
maxbôÀn
 = maxbitlen;

625 
i
 = 0; i < 
numcodes
; i++)

627 if(
‰equícõs
[
i
] > 0)

629 
num¥e£¡
++;

630 
sum
 +
‰equícõs
[
i
];

634 if(
numcodes
 == 0)  80;

635 
åì
->
numcodes
 = ()numcodes;

636 
	`uive˘‹_ªsize
(&
åì
->
Àngths
, 0);

637 if(!
	`uive˘‹_ªsizev
(&
åì
->
Àngths
,Åªe->
numcodes
, 0))  9905;

639 if(
num¥e£¡
 == 0)

641 
åì
->
Àngths
.
d©a
[0] = 1;

642  
	`Huffm™Tªe_makeFromLígths2
(
åì
);

644 if(
num¥e£¡
 == 1)

646 
i
 = 0; i < 
numcodes
; i++Ëif(
‰equícõs
[i]Ë
åì
->
Àngths
.
d©a
[i] = 1;

647  
	`Huffm™Tªe_makeFromLígths2
(
åì
);

650 
	`ve˘‹_öô
(&
coös
, (
Coö
));

651 
	`ve˘‹_öô
(&
¥ev_row
, (
Coö
));

657 
îr‹
 = 
	`Huffm™Tªe_fûlInCoös
(&
coös
, 
‰equícõs
, 
åì
->
numcodes
, 
sum
);

658 if(!
îr‹
)

660 
j
 = 1; j <
maxbôÀn
 && !
îr‹
; j++)

662 
	`ve˘‹_sw≠
(&
coös
, &
¥ev_row
);

663 if(!
	`ve˘‹_ªsized
(&
coös
, 0, 
Coö_˛ónup
))

665 
îr‹
 = 9906;

669 
i
 = 0; i + 1 < 
¥ev_row
.
size
; i += 2)

671 if(!
	`ve˘‹_ªsize
(&
coös
, coös.
size
 + 1))

673 
îr‹
 = 9907;

676 
	`Coö_öô
((
Coö
*)
	`ve˘‹_gë
(&
coös
, coös.
size
 - 1));

677 
	`Coö_c›y
((
Coö
*)
	`ve˘‹_gë
(&
coös
, coös.
size
 - 1), (Coö*)ve˘‹_gë(&
¥ev_row
, 
i
));

678 
	`addCoös
((
Coö
*)
	`ve˘‹_gë
(&
coös
, coös.
size
 - 1), (Coö*)ve˘‹_gë(&
¥ev_row
, 
i
 + 1));

680 if(
j
 < 
maxbôÀn
)

682 
îr‹
 = 
	`Huffm™Tªe_fûlInCoös
(&
coös
, 
‰equícõs
, 
åì
->
numcodes
, 
sum
);

687 if(!
îr‹
)

690 
	`ve˘‹_ªsized
(&
coös
, 
num¥e£¡
 - 1, 
Coö_˛ónup
);

693 
i
 = 0; i < 
coös
.
size
; i++)

695 
Coö
* 
coö
 = (Coö*)
	`ve˘‹_gë
(&
coös
, 
i
);

696 
j
 = 0; j < 
coö
->
symbﬁs
.
size
; j++Ë
åì
->
Àngths
.
d©a
[coin->symbols.data[j]]++;

699 
îr‹
 = 
	`Huffm™Tªe_makeFromLígths2
(
åì
);

702 
	`ve˘‹_˛ónupd
(&
coös
, 
Coö_˛ónup
);

703 
	`ve˘‹_˛ónupd
(&
¥ev_row
, 
Coö_˛ónup
);

705  
îr‹
;

706 
	}
}

708 
	$Huffm™Tªe_gëCode
(c⁄° 
Huffm™Tªe
* 
åì
, 
ödex
)

710  
åì
->
åì1d
.
d©a
[
ödex
];

711 
	}
}

713 
	$Huffm™Tªe_gëLígth
(c⁄° 
Huffm™Tªe
* 
åì
, 
ödex
)

715  
åì
->
Àngths
.
d©a
[
ödex
];

716 
	}
}

720 
	$gíî©eFixedTªe
(
Huffm™Tªe
* 
åì
)

722 
i
, 
îr‹
 = 0;

723 
uive˘‹
 
bôÀn
;

724 
	`uive˘‹_öô
(&
bôÀn
);

725 if(!
	`uive˘‹_ªsize
(&
bôÀn
, 
NUM_DEFLATE_CODE_SYMBOLS
)Ë
îr‹
 = 9909;

727 if(!
îr‹
)

730 
i
 = 0; i <143; i++Ë
bôÀn
.
d©a
[i] = 8;

731 
i
 = 144; i <255; i++Ë
bôÀn
.
d©a
[i] = 9;

732 
i
 = 256; i <279; i++Ë
bôÀn
.
d©a
[i] = 7;

733 
i
 = 280; i <287; i++Ë
bôÀn
.
d©a
[i] = 8;

735 
îr‹
 = 
	`Huffm™Tªe_makeFromLígths
(
åì
, 
bôÀn
.
d©a
, 
NUM_DEFLATE_CODE_SYMBOLS
, 15);

738 
	`uive˘‹_˛ónup
(&
bôÀn
);

739  
îr‹
;

740 
	}
}

742 
	$gíî©eDi°™˚Tªe
(
Huffm™Tªe
* 
åì
)

744 
i
, 
îr‹
 = 0;

745 
uive˘‹
 
bôÀn
;

746 
	`uive˘‹_öô
(&
bôÀn
);

747 if(!
	`uive˘‹_ªsize
(&
bôÀn
, 
NUM_DISTANCE_SYMBOLS
)Ë
îr‹
 = 9910;

750 if(!
îr‹
)

752 
i
 = 0; i < 
NUM_DISTANCE_SYMBOLS
; i++Ë
bôÀn
.
d©a
[i] = 5;

753 
îr‹
 = 
	`Huffm™Tªe_makeFromLígths
(
åì
, 
bôÀn
.
d©a
, 
NUM_DISTANCE_SYMBOLS
, 15);

755 
	`uive˘‹_˛ónup
(&
bôÀn
);

756  
îr‹
;

757 
	}
}

759 #ifde‡
LODEPNG_COMPILE_DECODER


765 
	$huffm™DecodeSymbﬁ
(c⁄° * 
ö
, 
size_t
* 
bp
,

766 c⁄° 
Huffm™Tªe
* 
codëªe
, 
size_t
 
öbôÀngth
)

768 
åìpos
 = 0, 
˘
;

771 if(*
bp
 > 
öbôÀngth
)  ()(-1);

777 
˘
 = 
codëªe
->
åì2d
.
d©a
[(
åìpos
 << 1Ë+ 
	`READBIT
(*
bp
, 
ö
)];

778 (*
bp
)++;

779 if(
˘
 < 
codëªe
->
numcodes
)  ct;

780 
åìpos
 = 
˘
 - 
codëªe
->
numcodes
;

782 if(
åìpos
 >
codëªe
->
numcodes
)  ()(-1);

784 
	}
}

787 #ifde‡
LODEPNG_COMPILE_DECODER


794 
	$gëTªeInÊ©eFixed
(
Huffm™Tªe
* 
åì
, Huffm™Tªe* 
åìD
)

797 
	`gíî©eFixedTªe
(
åì
);

798 
	`gíî©eDi°™˚Tªe
(
åìD
);

799 
	}
}

802 
	$gëTªeInÊ©eDy«mic
(
Huffm™Tªe
* 
codëªe
, Huffm™Tªe* 
codëªeD
, Huffm™Tªe* 
codñígthcodëªe
,

803 c⁄° * 
ö
, 
size_t
* 
bp
, size_à
öÀngth
)

807 
îr‹
 = 0;

808 
n
, 
HLIT
, 
HDIST
, 
HCLEN
, 
i
;

809 
uive˘‹
 
bôÀn
;

810 
uive˘‹
 
bôÀnD
;

811 
uive˘‹
 
codñígthcode
;

812 
size_t
 
öbôÀngth
 = 
öÀngth
 * 8;

814 if((*
bp
Ë>> 3 >
öÀngth
 - 2)  49;

816 
HLIT
 = 
	`ªadBôsFromSåóm
(
bp
, 
ö
, 5) + 257;

817 
HDIST
 = 
	`ªadBôsFromSåóm
(
bp
, 
ö
, 5) + 1;

818 
HCLEN
 = 
	`ªadBôsFromSåóm
(
bp
, 
ö
, 4) + 4;

821 
	`uive˘‹_öô
(&
codñígthcode
);

822 if(!
	`uive˘‹_ªsize
(&
codñígthcode
, 
NUM_CODE_LENGTH_CODES
)Ë
îr‹
 = 9911;

824 if(!
îr‹
)

826 
i
 = 0; i < 
NUM_CODE_LENGTH_CODES
; i++)

828 if(
i
 < 
HCLEN
Ë
codñígthcode
.
d©a
[
CLCL
[i]] = 
	`ªadBôsFromSåóm
(
bp
, 
ö
, 3);

829 
codñígthcode
.
d©a
[
CLCL
[
i
]] = 0;

832 
îr‹
 = 
	`Huffm™Tªe_makeFromLígths
(
codñígthcodëªe
, 
codñígthcode
.
d©a
, codñígthcode.
size
, 7);

835 
	`uive˘‹_˛ónup
(&
codñígthcode
);

836 if(
îr‹
) Érror;

839 
	`uive˘‹_öô
(&
bôÀn
);

840 
	`uive˘‹_ªsizev
(&
bôÀn
, 
NUM_DEFLATE_CODE_SYMBOLS
, 0);

841 
	`uive˘‹_öô
(&
bôÀnD
);

842 
	`uive˘‹_ªsizev
(&
bôÀnD
, 
NUM_DISTANCE_SYMBOLS
, 0);

843 
i
 = 0;

844 if(!
bôÀn
.
d©a
 || !
bôÀnD
.data)

846 
îr‹
 = 9912;

848 
i
 < 
HLIT
 + 
HDIST
)

850 
code
 = 
	`huffm™DecodeSymbﬁ
(
ö
, 
bp
, 
codñígthcodëªe
, 
öbôÀngth
);

851 if(
code
 <= 15)

853 if(
i
 < 
HLIT
Ë
bôÀn
.
d©a
[i] = 
code
;

854 
bôÀnD
.
d©a
[
i
 - 
HLIT
] = 
code
;

855 
i
++;

857 if(
code
 == 16)

859 
ª∂ígth
 = 3;

860 
vÆue
;

862 if((*
bp
Ë>> 3 >
öÀngth
)

864 
îr‹
 = 50;

868 
ª∂ígth
 +
	`ªadBôsFromSåóm
(
bp
, 
ö
, 2);

870 if((
i
 - 1Ë< 
HLIT
Ë
vÆue
 = 
bôÀn
.
d©a
[i - 1];

871 
vÆue
 = 
bôÀnD
.
d©a
[
i
 - 
HLIT
 - 1];

873 
n
 = 0;Ç < 
ª∂ígth
;Ç++)

875 if(
i
 >
HLIT
 + 
HDIST
)

877 
îr‹
 = 13;

880 if(
i
 < 
HLIT
Ë
bôÀn
.
d©a
[i] = 
vÆue
;

881 
bôÀnD
.
d©a
[
i
 - 
HLIT
] = 
vÆue
;

882 
i
++;

885 if(
code
 == 17)

887 
ª∂ígth
 = 3;

888 if((*
bp
Ë>> 3 >
öÀngth
)

890 
îr‹
 = 50;

894 
ª∂ígth
 +
	`ªadBôsFromSåóm
(
bp
, 
ö
, 3);

897 
n
 = 0;Ç < 
ª∂ígth
;Ç++)

899 if(
i
 >
HLIT
 + 
HDIST
)

901 
îr‹
 = 14;

904 if(
i
 < 
HLIT
Ë
bôÀn
.
d©a
[i] = 0;

905 
bôÀnD
.
d©a
[
i
 - 
HLIT
] = 0;

906 
i
++;

909 if(
code
 == 18)

911 
ª∂ígth
 = 11;

912 if((*
bp
Ë>> 3 >
öÀngth
)

914 
îr‹
 = 50;

917 
ª∂ígth
 +
	`ªadBôsFromSåóm
(
bp
, 
ö
, 7);

920 
n
 = 0;Ç < 
ª∂ígth
;Ç++)

922 if(
i
 >
HLIT
 + 
HDIST
)

924 
îr‹
 = 15;

927 if(
i
 < 
HLIT
Ë
bôÀn
.
d©a
[i] = 0;

928 
bôÀnD
.
d©a
[
i
 - 
HLIT
] = 0;

929 
i
++;

934 if(
code
 == ()(-1))

936 
îr‹
 = (*
bp
Ë> 
öÀngth
 * 8 ? 10 : 11;

938 
îr‹
 = 16;

943 if(!
îr‹
 && 
bôÀn
.
d©a
[256] == 0)Érror = 64;

946 if(!
îr‹
Ëîr‹ = 
	`Huffm™Tªe_makeFromLígths
(
codëªe
, &
bôÀn
.
d©a
[0], bôÀn.
size
, 15);

947 if(!
îr‹
Ëîr‹ = 
	`Huffm™Tªe_makeFromLígths
(
codëªeD
, &
bôÀnD
.
d©a
[0], bôÀnD.
size
, 15);

949 
	`uive˘‹_˛ónup
(&
bôÀn
);

950 
	`uive˘‹_˛ónup
(&
bôÀnD
);

952  
îr‹
;

953 
	}
}

956 
	$öÊ©eHuffm™Block
(
ucve˘‹
* 
out
, c⁄° * 
ö
, 
size_t
* 
bp
, size_t* 
pos
, size_à
öÀngth
, 
bty≥
)

958 
îr‹
 = 0;

959 
Huffm™Tªe
 
codëªe
;

960 
Huffm™Tªe
 
codëªeD
;

961 
size_t
 
öbôÀngth
 = 
öÀngth
 * 8;

963 
	`Huffm™Tªe_öô
(&
codëªe
);

964 
	`Huffm™Tªe_öô
(&
codëªeD
);

966 if(
bty≥
 =1Ë
	`gëTªeInÊ©eFixed
(&
codëªe
, &
codëªeD
);

967 if(
bty≥
 == 2)

969 
Huffm™Tªe
 
codñígthcodëªe
;

970 
	`Huffm™Tªe_öô
(&
codñígthcodëªe
);

971 
îr‹
 = 
	`gëTªeInÊ©eDy«mic
(&
codëªe
, &
codëªeD
, &
codñígthcodëªe
, 
ö
, 
bp
, 
öÀngth
);

972 
	`Huffm™Tªe_˛ónup
(&
codñígthcodëªe
);

977 
code
 = 
	`huffm™DecodeSymbﬁ
(
ö
, 
bp
, &
codëªe
, 
öbôÀngth
);

978 if(
code
 <= 255)

980 if((*
pos
Ë>
out
->
size
)

982 if(!
	`ucve˘‹_ªsize
(
out
, ((*
pos
) + 1) * 2))

984 
îr‹
 = 9913;

988 
out
->
d©a
[(*
pos
)] = ()(
code
);

989 (*
pos
)++;

991 if(
code
 >
FIRST_LENGTH_CODE_INDEX
 && codê<
LAST_LENGTH_CODE_INDEX
)

994 
size_t
 
Àngth
 = 
LENGTHBASE
[
code
 - 
FIRST_LENGTH_CODE_INDEX
];

995 
codeD
, 
di°™˚
, 
numexåabôsD
;

996 
size_t
 
°¨t
, 
f‹w¨d
, 
backw¨d
, 
numexåabôs
;

999 
numexåabôs
 = 
LENGTHEXTRA
[
code
 - 
FIRST_LENGTH_CODE_INDEX
];

1000 if(((*
bp
Ë>> 3Ë>
öÀngth
)

1002 
îr‹
 = 51;

1005 
Àngth
 +
	`ªadBôsFromSåóm
(
bp
, 
ö
, 
numexåabôs
);

1008 
codeD
 = 
	`huffm™DecodeSymbﬁ
(
ö
, 
bp
, &
codëªeD
, 
öbôÀngth
);

1009 if(
codeD
 > 29)

1011 if(
code
 == ()(-1))

1013 
îr‹
 = (*
bp
Ë> 
öÀngth
 * 8 ? 10 : 11;

1015 
îr‹
 = 18;

1018 
di°™˚
 = 
DISTANCEBASE
[
codeD
];

1021 
numexåabôsD
 = 
DISTANCEEXTRA
[
codeD
];

1022 if(((*
bp
Ë>> 3Ë>
öÀngth
)

1024 
îr‹
 = 51;

1027 
di°™˚
 +
	`ªadBôsFromSåóm
(
bp
, 
ö
, 
numexåabôsD
);

1030 
°¨t
 = (*
pos
);

1031 
backw¨d
 = 
°¨t
 - 
di°™˚
;

1032 if((*
pos
Ë+ 
Àngth
 >
out
->
size
)

1034 if(!
	`ucve˘‹_ªsize
(
out
, ((*
pos
Ë+ 
Àngth
) * 2))

1036 
îr‹
 = 9914;

1041 
f‹w¨d
 = 0; f‹w¨d < 
Àngth
; forward++)

1043 
out
->
d©a
[(*
pos
)] = out->d©a[
backw¨d
];

1044 (*
pos
)++;

1045 
backw¨d
++;

1046 if(
backw¨d
 >
°¨t
Ëbackw¨d = sèπ - 
di°™˚
;

1049 if(
code
 == 256) ;

1052 
îr‹
 = (*
bp
Ë> 
öÀngth
 * 8 ? 10 : 11;

1057 
	`Huffm™Tªe_˛ónup
(&
codëªe
);

1058 
	`Huffm™Tªe_˛ónup
(&
codëªeD
);

1060  
îr‹
;

1061 
	}
}

1063 
	$öÊ©eNoCom¥essi⁄
(
ucve˘‹
* 
out
, c⁄° * 
ö
, 
size_t
* 
bp
, size_t* 
pos
, size_à
öÀngth
)

1066 
size_t
 
p
;

1067 
LEN
, 
NLEN
, 
n
, 
îr‹
 = 0;

1068 ((*
bp
) & 0x7) != 0) (*bp)++;

1069 
p
 = (*
bp
) / 8;

1072 if(
p
 >
öÀngth
 - 4)  52;

1073 
LEN
 = 
ö
[
p
] + 256 * in[p + 1];Ö += 2;

1074 
NLEN
 = 
ö
[
p
] + 256 * in[p + 1];Ö += 2;

1077 if(
LEN
 + 
NLEN
 != 65535)  21;

1079 if((*
pos
Ë+ 
LEN
 >
out
->
size
)

1081 if(!
	`ucve˘‹_ªsize
(
out
, (*
pos
Ë+ 
LEN
))  9915;

1085 if(
p
 + 
LEN
 > 
öÀngth
)  23;

1086 
n
 = 0;Ç < 
LEN
;Ç++Ë
out
->
d©a
[(*
pos
)++] = 
ö
[
p
++];

1088 (*
bp
Ë
p
 * 8;

1090  
îr‹
;

1091 
	}
}

1094 
	$LodeFœã_öÊ©e
(
ucve˘‹
* 
out
, c⁄° * 
ö
, 
size_t
 
ösize
, size_à
öpos
)

1096 
size_t
 
bp
 = 0;

1097 
BFINAL
 = 0;

1098 
size_t
 
pos
 = 0;

1100 
îr‹
 = 0;

1102 !
BFINAL
)

1104 
BTYPE
;

1105 if(
bp
 + 2 >
ösize
 * 8)  52;

1106 
BFINAL
 = 
	`ªadBôFromSåóm
(&
bp
, &
ö
[
öpos
]);

1107 
BTYPE
 = 1 * 
	`ªadBôFromSåóm
(&
bp
, &
ö
[
öpos
]);

1108 
BTYPE
 +2 * 
	`ªadBôFromSåóm
(&
bp
, &
ö
[
öpos
]);

1110 if(
BTYPE
 == 3)  20;

1111 if(
BTYPE
 =0Ë
îr‹
 = 
	`öÊ©eNoCom¥essi⁄
(
out
, &
ö
[
öpos
], &
bp
, &
pos
, 
ösize
);

1112 
îr‹
 = 
	`öÊ©eHuffm™Block
(
out
, &
ö
[
öpos
], &
bp
, &
pos
, 
ösize
, 
BTYPE
);

1114 if(
îr‹
) Érror;

1117 if(!
	`ucve˘‹_ªsize
(
out
, 
pos
)Ë
îr‹
 = 9916;

1119  
îr‹
;

1120 
	}
}

1124 #ifde‡
LODEPNG_COMPILE_ENCODER


1130 c⁄° 
size_t
 
	gMAX_SUPPORTED_DEFLATE_LENGTH
 = 258;

1133 
	$addHuffm™Symbﬁ
(
size_t
* 
bp
, 
ucve˘‹
* 
com¥es£d
, 
code
, 
bôÀn
)

1135 
	`addBôsToSåómRevî£d
(
bp
, 
com¥es£d
, 
code
, 
bôÀn
);

1136 
	}
}

1139 
size_t
 
	$£¨chCodeIndex
(c⁄° * 
¨øy
, 
size_t
 
¨øy_size
, size_à
vÆue
)

1146 
size_t
 
À·
 = 1;

1147 
size_t
 
right
 = 
¨øy_size
 - 1;

1148 
À·
 <
right
)

1150 
size_t
 
mid
 = (
À·
 + 
right
) / 2;

1151 if(
¨øy
[
mid
] <
vÆue
Ë
À·
 = mid + 1;

1152 if(
¨øy
[
mid
 - 1] > 
vÆue
Ë
right
 = mid - 1;

1153  
mid
 - 1;

1155  
¨øy_size
 - 1;

1156 
	}
}

1158 
	$addLígthDi°™˚
(
uive˘‹
* 
vÆues
, 
size_t
 
Àngth
, size_à
di°™˚
)

1166 
Àngth_code
 = ()
	`£¨chCodeIndex
(
LENGTHBASE
, 29, 
Àngth
);

1167 
exåa_Àngth
 = ()(
Àngth
 - 
LENGTHBASE
[
Àngth_code
]);

1168 
di°_code
 = ()
	`£¨chCodeIndex
(
DISTANCEBASE
, 30, 
di°™˚
);

1169 
exåa_di°™˚
 = ()(
di°™˚
 - 
DISTANCEBASE
[
di°_code
]);

1171 
	`uive˘‹_push_back
(
vÆues
, 
Àngth_code
 + 
FIRST_LENGTH_CODE_INDEX
);

1172 
	`uive˘‹_push_back
(
vÆues
, 
exåa_Àngth
);

1173 
	`uive˘‹_push_back
(
vÆues
, 
di°_code
);

1174 
	`uive˘‹_push_back
(
vÆues
, 
exåa_di°™˚
);

1175 
	}
}

1179 
	$ícodeLZ77_bruã
(
uive˘‹
* 
out
, c⁄° * 
ö
, 
size_t
 
ösize
, 
wödowSize
)

1181 
size_t
 
pos
;

1183 
pos
 = 0;Öo†< 
ösize
;Öos++)

1185 
size_t
 
Àngth
 = 0, 
off£t
 = 0;

1186 
size_t
 
max_off£t
 = 
pos
 < 
wödowSize
 ?Öos : windowSize;

1187 
size_t
 
cuºít_off£t
;

1190 
cuºít_off£t
 = 1; cuºít_off£à< 
max_off£t
; current_offset++)

1192 
size_t
 
backpos
 = 
pos
 - 
cuºít_off£t
;

1193 if(
ö
[
backpos
] =ö[
pos
])

1196 
size_t
 
cuºít_Àngth
 = 1;

1197 
size_t
 
backã°
 = 
backpos
 + 1;

1198 
size_t
 
f‹ëe°
 = 
pos
 + 1;

1199 
f‹ëe°
 < 
ösize
 && 
ö
[
backã°
] =ö[f‹ëe°] && 
cuºít_Àngth
 < 
MAX_SUPPORTED_DEFLATE_LENGTH
)

1201 if(
backpos
 >
pos
Ëbackpo†-
cuºít_off£t
;

1202 
cuºít_Àngth
++;

1203 
backã°
++;

1204 
f‹ëe°
++;

1206 if(
cuºít_Àngth
 > 
Àngth
)

1208 
Àngth
 = 
cuºít_Àngth
;

1209 
off£t
 = 
cuºít_off£t
;

1210 if(
cuºít_Àngth
 =
MAX_SUPPORTED_DEFLATE_LENGTH
) ;

1216 if(
Àngth
 < 3)

1218 
	`uive˘‹_push_back
(
out
, 
ö
[
pos
]);

1222 
	`addLígthDi°™˚
(
out
, 
Àngth
, 
off£t
);

1223 
pos
 +(
Àngth
 - 1);

1226 
	}
}

1229 c⁄° 
	gHASH_NUM_VALUES
 = 65536;

1230 c⁄° 
	gHASH_NUM_CHARACTERS
 = 6;

1231 c⁄° 
	gHASH_SHIFT
 = 2;

1238 
	$gëHash
(c⁄° * 
d©a
, 
size_t
 
size
, size_à
pos
)

1240 
ªsu…
 = 0;

1241 
size_t
 
amou¡
, 
i
;

1242 if(
pos
 >
size
)  0;

1243 
amou¡
 = 
HASH_NUM_CHARACTERS
;

1244 if(
pos
 + 
amou¡
 >
size
)ámount = size -Öos;

1245 
i
 = 0; i < 
amou¡
; i++Ë
ªsu…
 ^(
d©a
[
pos
 + i] << (ò* 
HASH_SHIFT
));

1246  
ªsu…
 % 
HASH_NUM_VALUES
;

1247 
	}
}

1249 
	$cou¡InôülZîos
(c⁄° * 
d©a
, 
size_t
 
size
, size_à
pos
)

1251 
size_t
 
max_cou¡
 = 
MAX_SUPPORTED_DEFLATE_LENGTH
;

1252 
size_t
 
i
;

1253 if(
max_cou¡
 > 
size
 - 
pos
) max_count = size -Öos;

1254 
i
 = 0; i < 
max_cou¡
; i++)

1256 if(
d©a
[
pos
 + 
i
] != 0)

1257  
i
;

1259  
max_cou¡
;

1260 
	}
}

1263 
	$ícodeLZ77
(
uive˘‹
* 
out
, c⁄° * 
ö
, 
size_t
 
ösize
, 
wödowSize
)

1266 
ve˘‹
 
èbÀ
;

1267 
uive˘‹
 
èbÀpos1
, 
èbÀpos2
;

1268 
uive˘‹
 
öôülZîosTabÀ
;

1269 
pos
, 
i
, 
îr‹
 = 0;

1271 
	`ve˘‹_öô
(&
èbÀ
, (
uive˘‹
));

1272 if(!
	`ve˘‹_ªsize
(&
èbÀ
, 
HASH_NUM_VALUES
))  9917;

1273 
i
 = 0; i < 
HASH_NUM_VALUES
; i++)

1275 
uive˘‹
* 
v
 = (uive˘‹*)
	`ve˘‹_gë
(&
èbÀ
, 
i
);

1276 
	`uive˘‹_öô
(
v
);

1280 
	`uive˘‹_öô
(&
èbÀpos1
);

1281 
	`uive˘‹_öô
(&
èbÀpos2
);

1282 
	`uive˘‹_öô
(&
öôülZîosTabÀ
);

1284 if(!
	`uive˘‹_ªsizev
(&
èbÀpos1
, 
HASH_NUM_VALUES
, 0)Ë
îr‹
 = 9918;

1285 if(!
	`uive˘‹_ªsizev
(&
èbÀpos2
, 
HASH_NUM_VALUES
, 0)Ë
îr‹
 = 9919;

1287 if(!
îr‹
)

1289 
Àngth
, 
off£t
, 
èbÀpos
, 
max_off£t
;

1290 
hash
, 
öôülZîos
;

1291 
backpos
, 
cuºít_off£t
, 
t1
, 
t2
, 
skù
, 
cuºít_Àngth
;

1292 c⁄° *
œ°±r
, *
f‹ïå
, *
back±r
;

1294 
pos
 = 0;Öo†< 
ösize
;Öos++)

1296 
Àngth
 = 0, 
off£t
 = 0;

1297 
max_off£t
 = 
pos
 < 
wödowSize
 ?Öos : windowSize;

1301 
hash
 = 
	`gëHash
(
ö
, 
ösize
, 
pos
);

1302 
öôülZîos
 = 
	`cou¡InôülZîos
(
ö
, 
ösize
, 
pos
);

1303 if(!
	`uive˘‹_push_back
((
uive˘‹
*)
	`ve˘‹_gë
(&
èbÀ
, 
hash
), 
pos
))

1305 
îr‹
 = 9920;

1308 if(
hash
 =0 && !
	`uive˘‹_push_back
(&
öôülZîosTabÀ
, 
öôülZîos
))

1310 
îr‹
 = 9920;

1314 ((
uive˘‹
*)
	`ve˘‹_gë
(&
èbÀ
, 
hash
))->
d©a
[
èbÀpos1
.d©a[hash]] < 
pos
 - 
max_off£t
)

1316 
èbÀpos1
.
d©a
[
hash
]++;

1318 ((
uive˘‹
*)
	`ve˘‹_gë
(&
èbÀ
, 
hash
))->
d©a
[
èbÀpos2
.d©a[hash]] < 
pos
)

1320 
èbÀpos2
.
d©a
[
hash
]++;

1323 
t1
 = 
èbÀpos1
.
d©a
[
hash
];

1324 
t2
 = 
èbÀpos2
.
d©a
[
hash
];

1326 
œ°±r
 = &
ö
[
ösize
 < 
pos
 + 
MAX_SUPPORTED_DEFLATE_LENGTH
 ? insize :Öos + MAX_SUPPORTED_DEFLATE_LENGTH];

1328 
èbÀpos
 = 
èbÀpos2
.
d©a
[
hash
] - 1;ÅabÀpo†>
t1
 &&ÅabÀpo†< 
t2
;Åablepos--)

1330 
backpos
 = ((
uive˘‹
*)
	`ve˘‹_gë
(&
èbÀ
, 
hash
))->
d©a
[
èbÀpos
];

1331 
cuºít_off£t
 = 
pos
 - 
backpos
;

1334 
f‹ïå
 = &
ö
[
pos
];

1335 
back±r
 = &
ö
[
backpos
];

1337 if(
hash
 == 0)

1339 
skù
 = 
öôülZîosTabÀ
.
d©a
[
èbÀpos
];

1340 if(
skù
 > 
öôülZîos
) skip = initialZeros;

1341 if(
skù
 > 
ösize
 - 
pos
) skip = insize -Öos;

1342 
back±r
 +
skù
;

1343 
f‹ïå
 +
skù
;

1345 
f‹ïå
 !
œ°±r
 && *
back±r
 == *foreptr)

1347 ++
back±r
;

1348 ++
f‹ïå
;

1350 
cuºít_Àngth
 = ()(
f‹ïå
 - &
ö
[
pos
]);

1351 if(
cuºít_Àngth
 > 
Àngth
)

1353 
Àngth
 = 
cuºít_Àngth
;

1354 
off£t
 = 
cuºít_off£t
;

1355 if(
cuºít_Àngth
 =
MAX_SUPPORTED_DEFLATE_LENGTH
) ;

1360 if(
Àngth
 < 3)

1362 if(!
	`uive˘‹_push_back
(
out
, 
ö
[
pos
]))

1364 
îr‹
 = 9921;

1370 
j
, 
loˇl_hash
;

1371 
	`addLígthDi°™˚
(
out
, 
Àngth
, 
off£t
);

1372 
j
 = 0; j < 
Àngth
 - 1; j++)

1374 
pos
++;

1375 
loˇl_hash
 = 
	`gëHash
(
ö
, 
ösize
, 
pos
);

1376 if(!
	`uive˘‹_push_back
((
uive˘‹
*)
	`ve˘‹_gë
(&
èbÀ
, 
loˇl_hash
), 
pos
))

1378 
îr‹
 = 9922;

1381 if(
loˇl_hash
 =0 && !
	`uive˘‹_push_back
(&
öôülZîosTabÀ
, 
	`cou¡InôülZîos
(
ö
, 
ösize
, 
pos
)))

1383 
îr‹
 = 9922;

1392 
i
 = 0; i < 
èbÀ
.
size
; i++)

1394 
uive˘‹
* 
v
 = (uive˘‹*)
	`ve˘‹_gë
(&
èbÀ
, 
i
);

1395 
	`uive˘‹_˛ónup
(
v
);

1397 
	`ve˘‹_˛ónup
(&
èbÀ
);

1398 
	`uive˘‹_˛ónup
(&
èbÀpos1
);

1399 
	`uive˘‹_˛ónup
(&
èbÀpos2
);

1400 
	`uive˘‹_˛ónup
(&
öôülZîosTabÀ
);

1401  
îr‹
;

1402 
	}
}

1406 
	$deÊ©eNoCom¥essi⁄
(
ucve˘‹
* 
out
, c⁄° * 
d©a
, 
size_t
 
d©asize
)

1410 
size_t
 
i
, 
j
, 
numdeÊ©eblocks
 = 
d©asize
 / 65536 + 1;

1411 
d©≠os
 = 0;

1412 
i
 = 0; i < 
numdeÊ©eblocks
; i++)

1414 
BFINAL
, 
BTYPE
, 
LEN
, 
NLEN
;

1415 
fú°byã
;

1417 
BFINAL
 = (
i
 =
numdeÊ©eblocks
 - 1);

1418 
BTYPE
 = 0;

1420 
fú°byã
 = ()(
BFINAL
 + ((
BTYPE
 & 1) << 1) + ((BTYPE & 2) << 1));

1421 
	`ucve˘‹_push_back
(
out
, 
fú°byã
);

1423 
LEN
 = 65535;

1424 if(
d©asize
 - 
d©≠os
 < 65535Ë
LEN
 = ()datasize - datapos;

1425 
NLEN
 = 65535 - 
LEN
;

1427 
	`ucve˘‹_push_back
(
out
, ()(
LEN
 % 256));

1428 
	`ucve˘‹_push_back
(
out
, ()(
LEN
 / 256));

1429 
	`ucve˘‹_push_back
(
out
, ()(
NLEN
 % 256));

1430 
	`ucve˘‹_push_back
(
out
, ()(
NLEN
 / 256));

1433 
j
 = 0; j < 65535 && 
d©≠os
 < 
d©asize
; j++)

1435 
	`ucve˘‹_push_back
(
out
, 
d©a
[
d©≠os
++]);

1440 
	}
}

1443 
	$wrôeLZ77d©a
(
size_t
* 
bp
, 
ucve˘‹
* 
out
, c⁄° 
uive˘‹
* 
lz77_ícoded
, c⁄° 
Huffm™Tªe
* 
codes
, c⁄° Huffm™Tªe* 
codesD
)

1445 
size_t
 
i
 = 0;

1446 
i
 = 0; i < 
lz77_ícoded
->
size
; i++)

1448 
vÆ
 = 
lz77_ícoded
->
d©a
[
i
];

1449 
	`addHuffm™Symbﬁ
(
bp
, 
out
, 
	`Huffm™Tªe_gëCode
(
codes
, 
vÆ
), 
	`Huffm™Tªe_gëLígth
(codes, val));

1450 if(
vÆ
 > 256)

1452 
Àngth_ödex
 = 
vÆ
 - 
FIRST_LENGTH_CODE_INDEX
;

1453 
n_Àngth_exåa_bôs
 = 
LENGTHEXTRA
[
Àngth_ödex
];

1454 
Àngth_exåa_bôs
 = 
lz77_ícoded
->
d©a
[++
i
];

1456 
di°™˚_code
 = 
lz77_ícoded
->
d©a
[++
i
];

1458 
di°™˚_ödex
 = 
di°™˚_code
;

1459 
n_di°™˚_exåa_bôs
 = 
DISTANCEEXTRA
[
di°™˚_ödex
];

1460 
di°™˚_exåa_bôs
 = 
lz77_ícoded
->
d©a
[++
i
];

1462 
	`addBôsToSåóm
(
bp
, 
out
, 
Àngth_exåa_bôs
, 
n_Àngth_exåa_bôs
);

1463 
	`addHuffm™Symbﬁ
(
bp
, 
out
, 
	`Huffm™Tªe_gëCode
(
codesD
, 
di°™˚_code
), 
	`Huffm™Tªe_gëLígth
(codesD, distance_code));

1464 
	`addBôsToSåóm
(
bp
, 
out
, 
di°™˚_exåa_bôs
, 
n_di°™˚_exåa_bôs
);

1467 
	}
}

1469 
	$deÊ©eDy«mic
(
ucve˘‹
* 
out
, c⁄° * 
d©a
, 
size_t
 
d©asize
, c⁄° 
LodeZlib_Com¥essSëtögs
* 
£âögs
)

1481 
îr‹
 = 0;

1483 
uive˘‹
 
lz77_ícoded
;

1484 
Huffm™Tªe
 
codes
;

1485 
Huffm™Tªe
 
codesD
;

1486 
Huffm™Tªe
 
codñígthcodes
;

1487 
uive˘‹
 
‰equícõs
;

1488 
uive˘‹
 
‰equícõsD
;

1489 
uive˘‹
 
amou¡s
;

1490 
uive˘‹
 
Œdl
;

1491 
uive˘‹
 
ŒdŒ
;

1492 
uive˘‹
 
˛˛s
;

1494 
BFINAL
 = 1;

1495 
size_t
 
numcodes
, 
numcodesD
, 
i
;

1496 
size_t
 
bp
 = 0;

1497 
HLIT
, 
HDIST
, 
HCLEN
;

1499 
	`uive˘‹_öô
(&
lz77_ícoded
);

1500 
	`Huffm™Tªe_öô
(&
codes
);

1501 
	`Huffm™Tªe_öô
(&
codesD
);

1502 
	`Huffm™Tªe_öô
(&
codñígthcodes
);

1503 
	`uive˘‹_öô
(&
‰equícõs
);

1504 
	`uive˘‹_öô
(&
‰equícõsD
);

1505 
	`uive˘‹_öô
(&
amou¡s
);

1506 
	`uive˘‹_öô
(&
Œdl
);

1507 
	`uive˘‹_öô
(&
ŒdŒ
);

1508 
	`uive˘‹_öô
(&
˛˛s
);

1510 !
îr‹
)

1512 if(
£âögs
->
u£LZ77
)

1514 
îr‹
 = 
	`ícodeLZ77
(&
lz77_ícoded
, 
d©a
, 
d©asize
, 
£âögs
->
wödowSize
);

1515 if(
îr‹
) ;

1519 if(!
	`uive˘‹_ªsize
(&
lz77_ícoded
, 
d©asize
))

1521 
îr‹
 = 9923;

1524 
i
 = 0; i < 
d©asize
; i++Ë
lz77_ícoded
.
d©a
[i] = data[i];

1527 if(!
	`uive˘‹_ªsizev
(&
‰equícõs
, 286, 0))

1529 
îr‹
 = 9924;

1532 if(!
	`uive˘‹_ªsizev
(&
‰equícõsD
, 30, 0))

1534 
îr‹
 = 9925;

1537 
i
 = 0; i < 
lz77_ícoded
.
size
; i++)

1539 
symbﬁ
 = 
lz77_ícoded
.
d©a
[
i
];

1540 
‰equícõs
.
d©a
[
symbﬁ
]++;

1541 if(
symbﬁ
 > 256)

1543 
di°
 = 
lz77_ícoded
.
d©a
[
i
 + 2];

1544 
‰equícõsD
.
d©a
[
di°
]++;

1545 
i
 += 3;

1548 
‰equícõs
.
d©a
[256] = 1;

1550 
îr‹
 = 
	`Huffm™Tªe_makeFromFªquícõs
(&
codes
, 
‰equícõs
.
d©a
, fªquícõs.
size
, 15);

1551 if(
îr‹
) ;

1552 
îr‹
 = 
	`Huffm™Tªe_makeFromFªquícõs
(&
codesD
, 
‰equícõsD
.
d©a
, fªquícõsD.
size
, 15);

1553 if(
îr‹
) ;

1555 
	`addBôToSåóm
(&
bp
, 
out
, 
BFINAL
);

1556 
	`addBôToSåóm
(&
bp
, 
out
, 0);

1557 
	`addBôToSåóm
(&
bp
, 
out
, 1);

1559 
numcodes
 = 
codes
.numcodes; if(numcodes > 286)Çumcodes = 286;

1560 
numcodesD
 = 
codesD
.
numcodes
; if(numcodesD > 30)ÇumcodesD = 30;

1561 
i
 = 0; i < 
numcodes
; i++Ë
	`uive˘‹_push_back
(&
ŒdŒ
, 
	`Huffm™Tªe_gëLígth
(&
codes
, ()i));

1562 
i
 = 0; i < 
numcodesD
; i++Ë
	`uive˘‹_push_back
(&
ŒdŒ
, 
	`Huffm™Tªe_gëLígth
(&
codesD
, ()i));

1565 
i
 = 0; i < ()
ŒdŒ
.
size
; i++)

1567 
j
 = 0;

1568 
i
 + 
j
 + 1 < ()
ŒdŒ
.
size
 &&ÜldŒ.
d©a
[i + j + 1] ==Üldll.data[i]) j++;

1570 if(
ŒdŒ
.
d©a
[
i
] =0 && 
j
 >= 2)

1572 
j
++;

1573 if(
j
 <= 10)

1575 
	`uive˘‹_push_back
(&
Œdl
, 17);

1576 
	`uive˘‹_push_back
(&
Œdl
, 
j
 - 3);

1580 if(
j
 > 138) j = 138;

1581 
	`uive˘‹_push_back
(&
Œdl
, 18);

1582 
	`uive˘‹_push_back
(&
Œdl
, 
j
 - 11);

1584 
i
 +(
j
 - 1);

1586 if(
j
 >= 3)

1588 
size_t
 
k
;

1589 
num
 = 
j
 / 6, 
ª°
 = j % 6;

1590 
	`uive˘‹_push_back
(&
Œdl
, 
ŒdŒ
.
d©a
[
i
]);

1591 
k
 = 0; k < 
num
; k++)

1593 
	`uive˘‹_push_back
(&
Œdl
, 16);

1594 
	`uive˘‹_push_back
(&
Œdl
, 6 - 3);

1596 if(
ª°
 >= 3)

1598 
	`uive˘‹_push_back
(&
Œdl
, 16);

1599 
	`uive˘‹_push_back
(&
Œdl
, 
ª°
 - 3);

1601 
j
 -
ª°
;

1602 
i
 +
j
;

1604 
	`uive˘‹_push_back
(&
Œdl
, 
ŒdŒ
.
d©a
[
i
]);

1608 if(!
	`uive˘‹_ªsizev
(&
amou¡s
, 19, 0))

1610 
îr‹
 = 9926;

1613 
i
 = 0; i < 
Œdl
.
size
; i++)

1615 
amou¡s
.
d©a
[
Œdl
.d©a[
i
]]++;

1616 if(
Œdl
.
d©a
[
i
] >= 16) i++;

1619 
îr‹
 = 
	`Huffm™Tªe_makeFromFªquícõs
(&
codñígthcodes
, 
amou¡s
.
d©a
,ámou¡s.
size
, 7);

1620 if(
îr‹
) ;

1622 if(!
	`uive˘‹_ªsize
(&
˛˛s
, 19))

1624 
îr‹
 = 9927;

1627 
i
 = 0; i < 19; i++Ë
˛˛s
.
d©a
[i] = 
	`Huffm™Tªe_gëLígth
(&
codñígthcodes
, 
CLCL
[i]);

1628 
˛˛s
.
d©a
[˛˛s.
size
 - 1] == 0 && clcls.size > 4)

1630 if(!
	`uive˘‹_ªsize
(&
˛˛s
, cl˛s.
size
 - 1))

1632 
îr‹
 = 9928;

1636 if(
îr‹
) ;

1639 
HLIT
 = ()(
numcodes
 - 257);

1640 
HDIST
 = ()(
numcodesD
 - 1);

1641 
HCLEN
 = ()
˛˛s
.
size
 - 4;

1642 
	`addBôsToSåóm
(&
bp
, 
out
, 
HLIT
, 5);

1643 
	`addBôsToSåóm
(&
bp
, 
out
, 
HDIST
, 5);

1644 
	`addBôsToSåóm
(&
bp
, 
out
, 
HCLEN
, 4);

1647 
i
 = 0; i < 
HCLEN
 + 4; i++Ë
	`addBôsToSåóm
(&
bp
, 
out
, 
˛˛s
.
d©a
[i], 3);

1650 
i
 = 0; i < 
Œdl
.
size
; i++)

1652 
	`addHuffm™Symbﬁ
(&
bp
, 
out
, 
	`Huffm™Tªe_gëCode
(&
codñígthcodes
, 
Œdl
.
d©a
[
i
]), 
	`Huffm™Tªe_gëLígth
(&codelengthcodes,Üldl.data[i]));

1654 if(
Œdl
.
d©a
[
i
] =16Ë
	`addBôsToSåóm
(&
bp
, 
out
,Üldl.data[++i], 2);

1655 if(
Œdl
.
d©a
[
i
] =17Ë
	`addBôsToSåóm
(&
bp
, 
out
,Üldl.data[++i], 3);

1656 if(
Œdl
.
d©a
[
i
] =18Ë
	`addBôsToSåóm
(&
bp
, 
out
,Üldl.data[++i], 7);

1660 
	`wrôeLZ77d©a
(&
bp
, 
out
, &
lz77_ícoded
, &
codes
, &
codesD
);

1661 if(
	`Huffm™Tªe_gëLígth
(&
codes
, 256) == 0)

1663 
îr‹
 = 64;

1666 
	`addHuffm™Symbﬁ
(&
bp
, 
out
, 
	`Huffm™Tªe_gëCode
(&
codes
, 256), 
	`Huffm™Tªe_gëLígth
(&codes, 256));

1672 
	`uive˘‹_˛ónup
(&
lz77_ícoded
);

1673 
	`Huffm™Tªe_˛ónup
(&
codes
);

1674 
	`Huffm™Tªe_˛ónup
(&
codesD
);

1675 
	`Huffm™Tªe_˛ónup
(&
codñígthcodes
);

1676 
	`uive˘‹_˛ónup
(&
‰equícõs
);

1677 
	`uive˘‹_˛ónup
(&
‰equícõsD
);

1678 
	`uive˘‹_˛ónup
(&
amou¡s
);

1679 
	`uive˘‹_˛ónup
(&
Œdl
);

1680 
	`uive˘‹_˛ónup
(&
ŒdŒ
);

1681 
	`uive˘‹_˛ónup
(&
˛˛s
);

1683  
îr‹
;

1684 
	}
}

1686 
	$deÊ©eFixed
(
ucve˘‹
* 
out
, c⁄° * 
d©a
, 
size_t
 
d©asize
, c⁄° 
LodeZlib_Com¥essSëtögs
* 
£âögs
)

1688 
Huffm™Tªe
 
codes
;

1689 
Huffm™Tªe
 
codesD
;

1691 
BFINAL
 = 1;

1692 
îr‹
 = 0;

1693 
size_t
 
i
, 
bp
 = 0;

1695 
	`Huffm™Tªe_öô
(&
codes
);

1696 
	`Huffm™Tªe_öô
(&
codesD
);

1698 
	`gíî©eFixedTªe
(&
codes
);

1699 
	`gíî©eDi°™˚Tªe
(&
codesD
);

1701 
	`addBôToSåóm
(&
bp
, 
out
, 
BFINAL
);

1702 
	`addBôToSåóm
(&
bp
, 
out
, 1);

1703 
	`addBôToSåóm
(&
bp
, 
out
, 0);

1705 if(
£âögs
->
u£LZ77
)

1707 
uive˘‹
 
lz77_ícoded
;

1708 
	`uive˘‹_öô
(&
lz77_ícoded
);

1709 
îr‹
 = 
	`ícodeLZ77
(&
lz77_ícoded
, 
d©a
, 
d©asize
, 
£âögs
->
wödowSize
);

1710 if(!
îr‹
Ë
	`wrôeLZ77d©a
(&
bp
, 
out
, &
lz77_ícoded
, &
codes
, &
codesD
);

1711 
	`uive˘‹_˛ónup
(&
lz77_ícoded
);

1715 
i
 = 0; i < 
d©asize
; i++)

1717 
	`addHuffm™Symbﬁ
(&
bp
, 
out
, 
	`Huffm™Tªe_gëCode
(&
codes
, 
d©a
[
i
]), 
	`Huffm™Tªe_gëLígth
(&codes, data[i]));

1720 if(!
îr‹
Ë
	`addHuffm™Symbﬁ
(&
bp
, 
out
, 
	`Huffm™Tªe_gëCode
(&
codes
, 256), 
	`Huffm™Tªe_gëLígth
(&codes, 256));

1723 
	`Huffm™Tªe_˛ónup
(&
codes
);

1724 
	`Huffm™Tªe_˛ónup
(&
codesD
);

1726  
îr‹
;

1727 
	}
}

1729 
	$LodeFœã_deÊ©e
(
ucve˘‹
* 
out
, c⁄° * 
d©a
, 
size_t
 
d©asize
, c⁄° 
LodeZlib_Com¥essSëtögs
* 
£âögs
)

1731 
îr‹
 = 0;

1732 if(
£âögs
->
bty≥
 =0Ë
îr‹
 = 
	`deÊ©eNoCom¥essi⁄
(
out
, 
d©a
, 
d©asize
);

1733 if(
£âögs
->
bty≥
 =1Ë
îr‹
 = 
	`deÊ©eFixed
(
out
, 
d©a
, 
d©asize
, settings);

1734 if(
£âögs
->
bty≥
 =2Ë
îr‹
 = 
	`deÊ©eDy«mic
(
out
, 
d©a
, 
d©asize
, settings);

1735 
îr‹
 = 61;

1736  
îr‹
;

1737 
	}
}

1745 
	$upd©e_adÀr32
(
adÀr
, c⁄° * 
d©a
, 
Àn
)

1747 
s1
 = 
adÀr
 & 0xffff;

1748 
s2
 = (
adÀr
 >> 16) & 0xffff;

1750 
Àn
 > 0)

1753 
amou¡
 = 
Àn
 > 5550 ? 5550 :Üen;

1754 
Àn
 -
amou¡
;

1755 
amou¡
 > 0)

1757 
s1
 = (s1 + *
d©a
++);

1758 
s2
 = (s2 + 
s1
);

1759 
amou¡
--;

1761 
s1
 %= 65521;

1762 
s2
 %= 65521;

1765  (
s2
 << 16Ë| 
s1
;

1766 
	}
}

1769 
	$adÀr32
(c⁄° * 
d©a
, 
Àn
)

1771  
	`upd©e_adÀr32
(1L, 
d©a
, 
Àn
);

1772 
	}
}

1778 #ifde‡
LODEPNG_COMPILE_ENCODER


1779 
	$LodeZlib_add32bôI¡
(
ucve˘‹
* 
buf„r
, 
vÆue
)

1781 
	`ucve˘‹_push_back
(
buf„r
, ()((
vÆue
 >> 24) & 0xff));

1782 
	`ucve˘‹_push_back
(
buf„r
, ()((
vÆue
 >> 16) & 0xff));

1783 
	`ucve˘‹_push_back
(
buf„r
, ()((
vÆue
 >> 8) & 0xff));

1784 
	`ucve˘‹_push_back
(
buf„r
, ()((
vÆue
 ) & 0xff));

1785 
	}
}

1788 
	$LodeZlib_ªad32bôI¡
(c⁄° * 
buf„r
)

1790  (
buf„r
[0] << 24) | (buffer[1] << 16) | (buffer[2] << 8) | buffer[3];

1791 
	}
}

1797 #ifde‡
LODEPNG_COMPILE_DECODER


1799 
	$LodeZlib_decom¥ess
(** 
out
, 
size_t
* 
outsize
, c⁄° * 
ö
, size_à
ösize
, c⁄° 
LodeZlib_Decom¥essSëtögs
* 
£âögs
)

1801 
îr‹
 = 0;

1802 
CM
, 
CINFO
, 
FDICT
;

1803 
ucve˘‹
 
outv
;

1805 if(
ösize
 < 2)  53;

1807 if((
ö
[0] * 256 + in[1]) % 31 != 0)  24;

1809 
CM
 = 
ö
[0] & 15;

1810 
CINFO
 = (
ö
[0] >> 4) & 15;

1812 
FDICT
 = (
ö
[1] >> 5) & 1;

1815 if(
CM
 !8 || 
CINFO
 > 7)  25;

1816 if(
FDICT
 != 0)  26;

1818 
	`ucve˘‹_öô_buf„r
(&
outv
, *
out
, *
outsize
);

1819 
îr‹
 = 
	`LodeFœã_öÊ©e
(&
outv
, 
ö
, 
ösize
, 2);

1820 *
out
 = 
outv
.
d©a
;

1821 *
outsize
 = 
outv
.
size
;

1822 if(
îr‹
) Érror;

1824 if(!
£âögs
->
ign‹eAdÀr32
)

1826 
ADLER32
 = 
	`LodeZlib_ªad32bôI¡
(&
ö
[
ösize
 - 4]);

1827 
checksum
 = 
	`adÀr32
(
outv
.
d©a
, ()outv.
size
);

1828 if(
checksum
 !
ADLER32
)  58;

1832 
	}
}

1836 #ifde‡
LODEPNG_COMPILE_ENCODER


1838 
	$LodeZlib_com¥ess
(** 
out
, 
size_t
* 
outsize
, c⁄° * 
ö
, size_à
ösize
, c⁄° 
LodeZlib_Com¥essSëtögs
* 
£âögs
)

1841 
ucve˘‹
 
deÊ©ed©a
, 
outv
;

1842 
size_t
 
i
;

1843 
îr‹
;

1845 
ADLER32
;

1847 
CMF
 = 120;

1848 
FLEVEL
 = 0;

1849 
FDICT
 = 0;

1850 
CMFFLG
 = 256 * 
CMF
 + 
FDICT
 * 32 + 
FLEVEL
 * 64;

1851 
FCHECK
 = 31 - 
CMFFLG
 % 31;

1852 
CMFFLG
 +
FCHECK
;

1854 
	`ucve˘‹_öô_buf„r
(&
outv
, *
out
, *
outsize
);

1856 
	`ucve˘‹_push_back
(&
outv
, ()(
CMFFLG
 / 256));

1857 
	`ucve˘‹_push_back
(&
outv
, ()(
CMFFLG
 % 256));

1859 
	`ucve˘‹_öô
(&
deÊ©ed©a
);

1860 
îr‹
 = 
	`LodeFœã_deÊ©e
(&
deÊ©ed©a
, 
ö
, 
ösize
, 
£âögs
);

1862 if(!
îr‹
)

1864 
ADLER32
 = 
	`adÀr32
(
ö
, ()
ösize
);

1865 
i
 = 0; i < 
deÊ©ed©a
.
size
; i++Ë
	`ucve˘‹_push_back
(&
outv
, deÊ©ed©a.
d©a
[i]);

1866 
	`ucve˘‹_˛ónup
(&
deÊ©ed©a
);

1867 
	`LodeZlib_add32bôI¡
(&
outv
, 
ADLER32
);

1870 *
out
 = 
outv
.
d©a
;

1871 *
outsize
 = 
outv
.
size
;

1873  
îr‹
;

1874 
	}
}

1882 #ifde‡
LODEPNG_COMPILE_ENCODER


1884 
	$LodeZlib_Com¥essSëtögs_öô
(
LodeZlib_Com¥essSëtögs
* 
£âögs
)

1886 
£âögs
->
bty≥
 = 2;

1887 
£âögs
->
u£LZ77
 = 1;

1888 
£âögs
->
wödowSize
 = 2048;

1889 
	}
}

1891 c⁄° 
LodeZlib_Com¥essSëtögs
 
	gLodeZlib_deÁu…Com¥essSëtögs
 = {2, 1, 2048};

1895 #ifde‡
LODEPNG_COMPILE_DECODER


1897 
	$LodeZlib_Decom¥essSëtögs_öô
(
LodeZlib_Decom¥essSëtögs
* 
£âögs
)

1899 
£âögs
->
ign‹eAdÀr32
 = 0;

1900 
	}
}

1902 c⁄° 
LodeZlib_Decom¥essSëtögs
 
	gLodeZlib_deÁu…Decom¥essSëtögs
 = {0};

1918 #ifde‡
LODEPNG_COMPILE_PNG


1932 #ifde‡
LODEPNG_COMPILE_DECODER


1933 
	$LodePNG_decom¥ess
(** 
out
, 
size_t
* 
outsize
, c⁄° * 
ö
, size_à
ösize
, c⁄° 
LodeZlib_Decom¥essSëtögs
* 
£âögs
)

1936  
	`LodeZlib_decom¥ess
(
out
, 
outsize
, 
ö
, 
ösize
, 
£âögs
);

1937 
	}
}

1939 #ifde‡
LODEPNG_COMPILE_ENCODER


1940 
	$LodePNG_com¥ess
(** 
out
, 
size_t
* 
outsize
, c⁄° * 
ö
, size_à
ösize
, c⁄° 
LodeZlib_Com¥essSëtögs
* 
£âögs
)

1943  
	`LodeZlib_com¥ess
(
out
, 
outsize
, 
ö
, 
ösize
, 
£âögs
);

1944 
	}
}

1951 
	gCrc32_¸c_èbÀ_compuãd
 = 0;

1952 
	gCrc32_¸c_èbÀ
[256];

1955 
	$Crc32_make_¸c_èbÀ
()

1957 
c
, 
k
, 
n
;

1958 
n
 = 0;Ç < 256;Ç++)

1960 
c
 = 
n
;

1961 
k
 = 0; k < 8; k++)

1963 if(
c
 & 1) c = 0xedb88320L ^ (c >> 1);

1964 
c
 = c >> 1;

1966 
Crc32_¸c_èbÀ
[
n
] = 
c
;

1968 
Crc32_¸c_èbÀ_compuãd
 = 1;

1969 
	}
}

1974 
	$Crc32_upd©e_¸c
(c⁄° * 
buf
, 
¸c
, 
size_t
 
Àn
)

1976 
c
 = 
¸c
;

1977 
size_t
 
n
;

1979 if(!
Crc32_¸c_èbÀ_compuãd
Ë
	`Crc32_make_¸c_èbÀ
();

1980 
n
 = 0;Ç < 
Àn
;Ç++)

1982 
c
 = 
Crc32_¸c_èbÀ
[(¯^ 
buf
[
n
]) & 0xff] ^ (c >> 8);

1984  
c
;

1985 
	}
}

1988 
	$Crc32_¸c
(c⁄° * 
buf
, 
size_t
 
Àn
)

1990  
	`Crc32_upd©e_¸c
(
buf
, 0xffffffffL, 
Àn
) ^ 0xffffffffL;

1991 
	}
}

1997 
	$ªadBôFromRevî£dSåóm
(
size_t
* 
bôpoöãr
, c⁄° * 
bô°ªam
)

1999 
ªsu…
 = ()((
bô°ªam
[(*
bôpoöãr
) >> 3] >> (7 - ((*bitpointer) & 0x7))) & 1);

2000 (*
bôpoöãr
)++;

2001  
ªsu…
;

2002 
	}
}

2004 
	$ªadBôsFromRevî£dSåóm
(
size_t
* 
bôpoöãr
, c⁄° * 
bô°ªam
, size_à
nbôs
)

2006 
ªsu…
 = 0;

2007 
size_t
 
i
;

2008 
i
 = 
nbôs
 - 1; i <Çbits; i--)

2010 
ªsu…
 +()
	`ªadBôFromRevî£dSåóm
(
bôpoöãr
, 
bô°ªam
Ë<< 
i
;

2012  
ªsu…
;

2013 
	}
}

2015 #ifde‡
LODEPNG_COMPILE_DECODER


2016 
	$£tBôOfRevî£dSåóm0
(
size_t
* 
bôpoöãr
, * 
bô°ªam
, 
bô
)

2019 if(
bô
Ë
bô°ªam
[(*
bôpoöãr
) >> 3] |= (bit << (7 - ((*bitpointer) & 0x7)));

2020 (*
bôpoöãr
)++;

2021 
	}
}

2024 
	$£tBôOfRevî£dSåóm
(
size_t
* 
bôpoöãr
, * 
bô°ªam
, 
bô
)

2027 if(
bô
 =0Ë
bô°ªam
[(*
bôpoöãr
) >> 3] &= ()(~(1 << (7 - ((*bitpointer) & 0x7))));

2028 
bô°ªam
[(*
bôpoöãr
) >> 3] |= (1 << (7 - ((*bitpointer) & 0x7)));

2029 (*
bôpoöãr
)++;

2030 
	}
}

2032 
	$LodePNG_ªad32bôI¡
(c⁄° * 
buf„r
)

2034  (
buf„r
[0] << 24) | (buffer[1] << 16) | (buffer[2] << 8) | buffer[3];

2035 
	}
}

2037 
	$LodePNG_£t32bôI¡
(* 
buf„r
, 
vÆue
)

2039 
buf„r
[0] = ()((
vÆue
 >> 24) & 0xff);

2040 
buf„r
[1] = ()((
vÆue
 >> 16) & 0xff);

2041 
buf„r
[2] = ()((
vÆue
 >> 8) & 0xff);

2042 
buf„r
[3] = ()((
vÆue
 ) & 0xff);

2043 
	}
}

2045 #ifde‡
LODEPNG_COMPILE_ENCODER


2046 
	$LodePNG_add32bôI¡
(
ucve˘‹
* 
buf„r
, 
vÆue
)

2048 
	`ucve˘‹_ªsize
(
buf„r
, buf„r->
size
 + 4);

2049 
	`LodePNG_£t32bôI¡
(&
buf„r
->
d©a
[buf„r->
size
 - 4], 
vÆue
);

2050 
	}
}

2057 
	$LodePNG_chunk_Àngth
(c⁄° * 
chunk
)

2059  
	`LodePNG_ªad32bôI¡
(&
chunk
[0]);

2060 
	}
}

2062 
	$LodePNG_chunk_ty≥
(
ty≥
[5], c⁄° * 
chunk
)

2064 
i
;

2065 
i
 = 0; i < 4; i++Ë
ty≥
[i] = 
chunk
[4 + i];

2066 
ty≥
[4] = 0;

2067 
	}
}

2069 
	$LodePNG_chunk_ty≥_equÆs
(c⁄° * 
chunk
, c⁄° * 
ty≥
)

2071 if(
	`°æí
(
ty≥
) != 4)  0;

2072  (
chunk
[4] =
ty≥
[0] && chunk[5] ==Åype[1] && chunk[6] ==Åype[2] && chunk[7] ==Åype[3]);

2073 
	}
}

2076 
	$LodePNG_chunk_¸ôiˇl
(c⁄° * 
chunk
)

2078 ((
chunk
[4] & 32) == 0);

2079 
	}
}

2081 
	$LodePNG_chunk_¥iv©e
(c⁄° * 
chunk
)

2083 ((
chunk
[6] & 32) != 0);

2084 
	}
}

2086 
	$LodePNG_chunk_ß„toc›y
(c⁄° * 
chunk
)

2088 ((
chunk
[7] & 32) != 0);

2089 
	}
}

2091 * 
	$LodePNG_chunk_d©a
(* 
chunk
)

2093  &
chunk
[8];

2094 
	}
}

2096 c⁄° * 
	$LodePNG_chunk_d©a_c⁄°
(c⁄° * 
chunk
)

2098  &
chunk
[8];

2099 
	}
}

2101 
	$LodePNG_chunk_check_¸c
(c⁄° * 
chunk
)

2103 
Àngth
 = 
	`LodePNG_chunk_Àngth
(
chunk
);

2104 
CRC
 = 
	`LodePNG_ªad32bôI¡
(&
chunk
[
Àngth
 + 8]);

2105 
checksum
 = 
	`Crc32_¸c
(&
chunk
[4], 
Àngth
 + 4);

2106 if(
CRC
 !
checksum
)  1;

2108 
	}
}

2110 
	$LodePNG_chunk_gíî©e_¸c
(* 
chunk
)

2112 
Àngth
 = 
	`LodePNG_chunk_Àngth
(
chunk
);

2113 
CRC
 = 
	`Crc32_¸c
(&
chunk
[4], 
Àngth
 + 4);

2114 
	`LodePNG_£t32bôI¡
(
chunk
 + 8 + 
Àngth
, 
CRC
);

2115 
	}
}

2117 * 
	$LodePNG_chunk_√xt
(* 
chunk
)

2119 
tŸÆ_chunk_Àngth
 = 
	`LodePNG_chunk_Àngth
(
chunk
) + 12;

2120  &
chunk
[
tŸÆ_chunk_Àngth
];

2121 
	}
}

2123 c⁄° * 
	$LodePNG_chunk_√xt_c⁄°
(c⁄° * 
chunk
)

2125 
tŸÆ_chunk_Àngth
 = 
	`LodePNG_chunk_Àngth
(
chunk
) + 12;

2126  &
chunk
[
tŸÆ_chunk_Àngth
];

2127 
	}
}

2129 
	$LodePNG_≠≥nd_chunk
(** 
out
, 
size_t
* 
ouéígth
, c⁄° * 
chunk
)

2131 
i
;

2132 
tŸÆ_chunk_Àngth
 = 
	`LodePNG_chunk_Àngth
(
chunk
) + 12;

2133 *
chunk_°¨t
, *
√w_buf„r
;

2134 
size_t
 
√w_Àngth
 = (*
ouéígth
Ë+ 
tŸÆ_chunk_Àngth
;

2135 if(
√w_Àngth
 < 
tŸÆ_chunk_Àngth
 ||Çew_Àngth < (*
ouéígth
))  77;

2137 
√w_buf„r
 = (*)
	`ªÆloc
(*
out
, 
√w_Àngth
);

2138 if(!
√w_buf„r
)  9929;

2139 (*
out
Ë
√w_buf„r
;

2140 (*
ouéígth
Ë
√w_Àngth
;

2141 
chunk_°¨t
 = &(*
out
)[
√w_Àngth
 - 
tŸÆ_chunk_Àngth
];

2143 
i
 = 0; i < 
tŸÆ_chunk_Àngth
; i++Ë
chunk_°¨t
[i] = 
chunk
[i];

2146 
	}
}

2148 
	$LodePNG_¸óã_chunk
(** 
out
, 
size_t
* 
ouéígth
, 
Àngth
, c⁄° * 
ty≥
, c⁄° * 
d©a
)

2150 
i
;

2151 *
chunk
, *
√w_buf„r
;

2152 
size_t
 
√w_Àngth
 = (*
ouéígth
Ë+ 
Àngth
 + 12;

2153 if(
√w_Àngth
 < 
Àngth
 + 12 ||Çew_Àngth < (*
ouéígth
))  77;

2154 
√w_buf„r
 = (*)
	`ªÆloc
(*
out
, 
√w_Àngth
);

2155 if(!
√w_buf„r
)  9930;

2156 (*
out
Ë
√w_buf„r
;

2157 (*
ouéígth
Ë
√w_Àngth
;

2158 
chunk
 = &(*
out
)[(*
ouéígth
Ë- 
Àngth
 - 12];

2161 
	`LodePNG_£t32bôI¡
(
chunk
, ()
Àngth
);

2164 
chunk
[4] = 
ty≥
[0];

2165 
chunk
[5] = 
ty≥
[1];

2166 
chunk
[6] = 
ty≥
[2];

2167 
chunk
[7] = 
ty≥
[3];

2170 
i
 = 0; i < 
Àngth
; i++Ë
chunk
[8 + i] = 
d©a
[i];

2173 
	`LodePNG_chunk_gíî©e_¸c
(
chunk
);

2176 
	}
}

2183 
	$checkCﬁ‹VÆidôy
(
cﬁ‹Ty≥
, 
bd
)

2185 
cﬁ‹Ty≥
)

2187 0: if(!(
bd
 == 1 || bd == 2 || bd == 4 || bd == 8 || bd == 16))  37; ;

2188 2: if(!–
bd
 == 8 || bd == 16))  37; ;

2189 3: if(!(
bd
 == 1 || bd == 2 || bd == 4 || bd == 8 ))  37; ;

2190 4: if(!–
bd
 == 8 || bd == 16))  37; ;

2191 6: if(!–
bd
 == 8 || bd == 16))  37; ;

2195 
	}
}

2197 
	$gëNumCﬁ‹Ch™√ls
(
cﬁ‹Ty≥
)

2199 
cﬁ‹Ty≥
)

2208 
	}
}

2210 
	$gëBµ
(
cﬁ‹Ty≥
, 
bôDïth
)

2212  
	`gëNumCﬁ‹Ch™√ls
(
cﬁ‹Ty≥
Ë* 
bôDïth
;

2213 
	}
}

2217 
	$LodePNG_InfoCﬁ‹_öô
(
LodePNG_InfoCﬁ‹
* 
öfo
)

2219 
öfo
->
key_deföed
 = 0;

2220 
öfo
->
key_r
 = info->
key_g
 = info->
key_b
 = 0;

2221 
öfo
->
cﬁ‹Ty≥
 = 6;

2222 
öfo
->
bôDïth
 = 8;

2223 
öfo
->
∑Àâe
 = 0;

2224 
öfo
->
∑Àâesize
 = 0;

2225 
	}
}

2227 
	$LodePNG_InfoCﬁ‹_˛ónup
(
LodePNG_InfoCﬁ‹
* 
öfo
)

2229 
	`LodePNG_InfoCﬁ‹_˛órPÆëã
(
öfo
);

2230 
	}
}

2232 
	$LodePNG_InfoCﬁ‹_˛órPÆëã
(
LodePNG_InfoCﬁ‹
* 
öfo
)

2234 if(
öfo
->
∑Àâe
Ë
	`‰ì
(info->palette);

2235 
öfo
->
∑Àâesize
 = 0;

2236 
	}
}

2238 
	$LodePNG_InfoCﬁ‹_addPÆëã
(
LodePNG_InfoCﬁ‹
* 
öfo
, 
r
, 
g
, 
b
, 
a
)

2240 * 
d©a
;

2242 if(!(
öfo
->
∑Àâesize
 & (info->palettesize - 1)))

2245 
size_t
 
Æloc_size
 = 
öfo
->
∑Àâesize
 == 0 ? 4 : info->palettesize * 4 * 2;

2246 
d©a
 = (*)
	`ªÆloc
(
öfo
->
∑Àâe
, 
Æloc_size
);

2247 if(!
d©a
)  9931;

2248 
öfo
->
∑Àâe
 = 
d©a
;

2250 
öfo
->
∑Àâe
[4 * info->
∑Àâesize
 + 0] = 
r
;

2251 
öfo
->
∑Àâe
[4 * info->
∑Àâesize
 + 1] = 
g
;

2252 
öfo
->
∑Àâe
[4 * info->
∑Àâesize
 + 2] = 
b
;

2253 
öfo
->
∑Àâe
[4 * info->
∑Àâesize
 + 3] = 
a
;

2254 
öfo
->
∑Àâesize
++;

2256 
	}
}

2258 
	$LodePNG_InfoCﬁ‹_gëBµ
(c⁄° 
LodePNG_InfoCﬁ‹
* 
öfo
)

2260  
	`gëBµ
(
öfo
->
cﬁ‹Ty≥
, info->
bôDïth
);

2261 
	}
}

2263 
	$LodePNG_InfoCﬁ‹_gëCh™√ls
(c⁄° 
LodePNG_InfoCﬁ‹
* 
öfo
)

2265  
	`gëNumCﬁ‹Ch™√ls
(
öfo
->
cﬁ‹Ty≥
);

2266 
	}
}

2268 
	$LodePNG_InfoCﬁ‹_isGªysˇÀTy≥
(c⁄° 
LodePNG_InfoCﬁ‹
* 
öfo
)

2270  
öfo
->
cﬁ‹Ty≥
 == 0 || info->colorType == 4;

2271 
	}
}

2273 
	$LodePNG_InfoCﬁ‹_isAÕhaTy≥
(c⁄° 
LodePNG_InfoCﬁ‹
* 
öfo
)

2275  (
öfo
->
cﬁ‹Ty≥
 & 4) != 0;

2276 
	}
}

2278 
	$LodePNG_InfoCﬁ‹_isPÆëãTy≥
(c⁄° 
LodePNG_InfoCﬁ‹
* 
öfo
)

2280  
öfo
->
cﬁ‹Ty≥
 == 3;

2281 
	}
}

2283 
	$LodePNG_InfoCﬁ‹_hasPÆëãAÕha
(c⁄° 
LodePNG_InfoCﬁ‹
* 
öfo
)

2285 
size_t
 
i
;

2286 
i
 = 0; i < 
öfo
->
∑Àâesize
; i++)

2288 if(
öfo
->
∑Àâe
[
i
 * 4 + 3] < 255)  1;

2291 
	}
}

2293 
	$LodePNG_InfoCﬁ‹_ˇnHaveAÕha
(c⁄° 
LodePNG_InfoCﬁ‹
* 
öfo
)

2295  
öfo
->
key_deföed


2296 || 
	`LodePNG_InfoCﬁ‹_isAÕhaTy≥
(
öfo
)

2297 || 
	`LodePNG_InfoCﬁ‹_hasPÆëãAÕha
(
öfo
);

2298 
	}
}

2300 
	$LodePNG_InfoCﬁ‹_equÆ
(c⁄° 
LodePNG_InfoCﬁ‹
* 
öfo1
, c⁄° LodePNG_InfoCﬁ‹* 
öfo2
)

2302  
öfo1
->
cﬁ‹Ty≥
 =
öfo2
->colorType

2303 && 
öfo1
->
bôDïth
 =
öfo2
->bitDepth;

2304 
	}
}

2306 #ifde‡
LODEPNG_COMPILE_UNKNOWN_CHUNKS


2308 
	$LodePNG_UnknownChunks_öô
(
LodePNG_UnknownChunks
* 
chunks
)

2310 
i
;

2311 
i
 = 0; i < 3; i++Ë
chunks
->
d©a
[i] = 0;

2312 
i
 = 0; i < 3; i++Ë
chunks
->
d©asize
[i] = 0;

2313 
	}
}

2315 
	$LodePNG_UnknownChunks_˛ónup
(
LodePNG_UnknownChunks
* 
chunks
)

2317 
i
;

2318 
i
 = 0; i < 3; i++Ë
	`‰ì
(
chunks
->
d©a
[i]);

2319 
	}
}

2321 
	$LodePNG_UnknownChunks_c›y
(
LodePNG_UnknownChunks
* 
de°
, c⁄° LodePNG_UnknownChunks* 
§c
)

2323 
i
;

2325 
	`LodePNG_UnknownChunks_˛ónup
(
de°
);

2327 
i
 = 0; i < 3; i++)

2329 
size_t
 
j
;

2330 
de°
->
d©asize
[
i
] = 
§c
->datasize[i];

2331 
de°
->
d©a
[
i
] = (*)
	`mÆloc
(
§c
->
d©asize
[i]);

2332 if(!
de°
->
d©a
[
i
] && de°->
d©asize
[i])  9932;

2333 
j
 = 0; j < 
§c
->
d©asize
[
i
]; j++Ë
de°
->
d©a
[i][j] = src->data[i][j];

2337 
	}
}

2341 #ifde‡
LODEPNG_COMPILE_ANCILLARY_CHUNKS


2343 
	$LodePNG_Text_öô
(
LodePNG_Text
* 
ãxt
)

2345 
ãxt
->
num
 = 0;

2346 
ãxt
->
keys
 = 
NULL
;

2347 
ãxt
->
°rögs
 = 
NULL
;

2348 
	}
}

2350 
	$LodePNG_Text_˛ónup
(
LodePNG_Text
* 
ãxt
)

2352 
	`LodePNG_Text_˛ór
(
ãxt
);

2353 
	}
}

2355 
	$LodePNG_Text_c›y
(
LodePNG_Text
* 
de°
, c⁄° LodePNG_Text* 
sour˚
)

2357 
size_t
 
i
 = 0;

2358 
de°
->
keys
 = 0;

2359 
de°
->
°rögs
 = 0;

2360 
de°
->
num
 = 0;

2361 
i
 = 0; i < 
sour˚
->
num
; i++)

2363 
îr‹
 = 
	`LodePNG_Text_add
(
de°
, 
sour˚
->
keys
[
i
], sour˚->
°rögs
[i]);

2364 if(
îr‹
) Érror;

2367 
	}
}

2369 
	$LodePNG_Text_˛ór
(
LodePNG_Text
* 
ãxt
)

2371 
size_t
 
i
;

2372 
i
 = 0; i < 
ãxt
->
num
; i++)

2374 
	`°rög_˛ónup
(&
ãxt
->
keys
[
i
]);

2375 
	`°rög_˛ónup
(&
ãxt
->
°rögs
[
i
]);

2377 
	`‰ì
(
ãxt
->
keys
);

2378 
	`‰ì
(
ãxt
->
°rögs
);

2379 
	}
}

2381 
	$LodePNG_Text_add
(
LodePNG_Text
* 
ãxt
, c⁄° * 
key
, c⁄° * 
°r
)

2383 ** 
√w_keys
 = (**)(
	`ªÆloc
(
ãxt
->
keys
, (*Ë* (ãxt->
num
 + 1)));

2384 ** 
√w_°rögs
 = (**)(
	`ªÆloc
(
ãxt
->
°rögs
, (*Ë* (ãxt->
num
 + 1)));

2385 if(!
√w_keys
 || !
√w_°rögs
)

2387 
	`‰ì
(
√w_keys
);

2388 
	`‰ì
(
√w_°rögs
);

2392 
ãxt
->
num
++;

2393 
ãxt
->
keys
 = 
√w_keys
;

2394 
ãxt
->
°rögs
 = 
√w_°rögs
;

2396 
	`°rög_öô
(&
ãxt
->
keys
[ãxt->
num
 - 1]);

2397 
	`°rög_£t
(&
ãxt
->
keys
[ãxt->
num
 - 1], 
key
);

2399 
	`°rög_öô
(&
ãxt
->
°rögs
[ãxt->
num
 - 1]);

2400 
	`°rög_£t
(&
ãxt
->
°rögs
[ãxt->
num
 - 1], 
°r
);

2403 
	}
}

2407 
	$LodePNG_IText_öô
(
LodePNG_IText
* 
ãxt
)

2409 
ãxt
->
num
 = 0;

2410 
ãxt
->
keys
 = 
NULL
;

2411 
ãxt
->
œngègs
 = 
NULL
;

2412 
ãxt
->
å™skeys
 = 
NULL
;

2413 
ãxt
->
°rögs
 = 
NULL
;

2414 
	}
}

2416 
	$LodePNG_IText_˛ónup
(
LodePNG_IText
* 
ãxt
)

2418 
	`LodePNG_IText_˛ór
(
ãxt
);

2419 
	}
}

2421 
	$LodePNG_IText_c›y
(
LodePNG_IText
* 
de°
, c⁄° LodePNG_IText* 
sour˚
)

2423 
size_t
 
i
 = 0;

2424 
de°
->
keys
 = 0;

2425 
de°
->
œngègs
 = 0;

2426 
de°
->
å™skeys
 = 0;

2427 
de°
->
°rögs
 = 0;

2428 
de°
->
num
 = 0;

2429 
i
 = 0; i < 
sour˚
->
num
; i++)

2431 
îr‹
 = 
	`LodePNG_IText_add
(
de°
, 
sour˚
->
keys
[
i
], sour˚->
œngègs
[i], sour˚->
å™skeys
[i], sour˚->
°rögs
[i]);

2432 if(
îr‹
) Érror;

2435 
	}
}

2437 
	$LodePNG_IText_˛ór
(
LodePNG_IText
* 
ãxt
)

2439 
size_t
 
i
;

2440 
i
 = 0; i < 
ãxt
->
num
; i++)

2442 
	`°rög_˛ónup
(&
ãxt
->
keys
[
i
]);

2443 
	`°rög_˛ónup
(&
ãxt
->
œngègs
[
i
]);

2444 
	`°rög_˛ónup
(&
ãxt
->
å™skeys
[
i
]);

2445 
	`°rög_˛ónup
(&
ãxt
->
°rögs
[
i
]);

2447 
	`‰ì
(
ãxt
->
keys
);

2448 
	`‰ì
(
ãxt
->
œngègs
);

2449 
	`‰ì
(
ãxt
->
å™skeys
);

2450 
	`‰ì
(
ãxt
->
°rögs
);

2451 
	}
}

2453 
	$LodePNG_IText_add
(
LodePNG_IText
* 
ãxt
, c⁄° * 
key
, c⁄° * 
œngèg
, c⁄° * 
å™skey
, c⁄° * 
°r
)

2455 ** 
√w_keys
 = (**)(
	`ªÆloc
(
ãxt
->
keys
, (*Ë* (ãxt->
num
 + 1)));

2456 ** 
√w_œngègs
 = (**)(
	`ªÆloc
(
ãxt
->
œngègs
, (*Ë* (ãxt->
num
 + 1)));

2457 ** 
√w_å™skeys
 = (**)(
	`ªÆloc
(
ãxt
->
å™skeys
, (*Ë* (ãxt->
num
 + 1)));

2458 ** 
√w_°rögs
 = (**)(
	`ªÆloc
(
ãxt
->
°rögs
, (*Ë* (ãxt->
num
 + 1)));

2459 if(!
√w_keys
 || !
√w_œngègs
 || !
√w_å™skeys
 || !
√w_°rögs
)

2461 
	`‰ì
(
√w_keys
);

2462 
	`‰ì
(
√w_œngègs
);

2463 
	`‰ì
(
√w_å™skeys
);

2464 
	`‰ì
(
√w_°rögs
);

2468 
ãxt
->
num
++;

2469 
ãxt
->
keys
 = 
√w_keys
;

2470 
ãxt
->
œngègs
 = 
√w_œngègs
;

2471 
ãxt
->
å™skeys
 = 
√w_å™skeys
;

2472 
ãxt
->
°rögs
 = 
√w_°rögs
;

2474 
	`°rög_öô
(&
ãxt
->
keys
[ãxt->
num
 - 1]);

2475 
	`°rög_£t
(&
ãxt
->
keys
[ãxt->
num
 - 1], 
key
);

2477 
	`°rög_öô
(&
ãxt
->
œngègs
[ãxt->
num
 - 1]);

2478 
	`°rög_£t
(&
ãxt
->
œngègs
[ãxt->
num
 - 1], 
œngèg
);

2480 
	`°rög_öô
(&
ãxt
->
å™skeys
[ãxt->
num
 - 1]);

2481 
	`°rög_£t
(&
ãxt
->
å™skeys
[ãxt->
num
 - 1], 
å™skey
);

2483 
	`°rög_öô
(&
ãxt
->
°rögs
[ãxt->
num
 - 1]);

2484 
	`°rög_£t
(&
ãxt
->
°rögs
[ãxt->
num
 - 1], 
°r
);

2487 
	}
}

2491 
	$LodePNG_InfoPng_öô
(
LodePNG_InfoPng
* 
öfo
)

2493 
öfo
->
width
 = info->
height
 = 0;

2494 
	`LodePNG_InfoCﬁ‹_öô
(&
öfo
->
cﬁ‹
);

2495 
öfo
->
öãæa˚Mëhod
 = 0;

2496 
öfo
->
com¥essi⁄Mëhod
 = 0;

2497 
öfo
->
fûãrMëhod
 = 0;

2498 #ifde‡
LODEPNG_COMPILE_ANCILLARY_CHUNKS


2499 
öfo
->
background_deföed
 = 0;

2500 
öfo
->
background_r
 = info->
background_g
 = info->
background_b
 = 0;

2502 
	`LodePNG_Text_öô
(&
öfo
->
ãxt
);

2503 
	`LodePNG_IText_öô
(&
öfo
->
ôext
);

2505 
öfo
->
time_deföed
 = 0;

2506 
öfo
->
phys_deföed
 = 0;

2508 #ifde‡
LODEPNG_COMPILE_UNKNOWN_CHUNKS


2509 
	`LodePNG_UnknownChunks_öô
(&
öfo
->
unknown_chunks
);

2511 
	}
}

2513 
	$LodePNG_InfoPng_˛ónup
(
LodePNG_InfoPng
* 
öfo
)

2515 
	`LodePNG_InfoCﬁ‹_˛ónup
(&
öfo
->
cﬁ‹
);

2516 #ifde‡
LODEPNG_COMPILE_ANCILLARY_CHUNKS


2517 
	`LodePNG_Text_˛ónup
(&
öfo
->
ãxt
);

2518 
	`LodePNG_IText_˛ónup
(&
öfo
->
ôext
);

2520 #ifde‡
LODEPNG_COMPILE_UNKNOWN_CHUNKS


2521 
	`LodePNG_UnknownChunks_˛ónup
(&
öfo
->
unknown_chunks
);

2523 
	}
}

2525 
	$LodePNG_InfoPng_c›y
(
LodePNG_InfoPng
* 
de°
, c⁄° LodePNG_InfoPng* 
sour˚
)

2527 
îr‹
 = 0;

2528 
	`LodePNG_InfoPng_˛ónup
(
de°
);

2529 *
de°
 = *
sour˚
;

2530 
	`LodePNG_InfoCﬁ‹_öô
(&
de°
->
cﬁ‹
);

2531 
îr‹
 = 
	`LodePNG_InfoCﬁ‹_c›y
(&
de°
->
cﬁ‹
, &
sour˚
->color); if(error) Érror;

2533 #ifde‡
LODEPNG_COMPILE_ANCILLARY_CHUNKS


2534 
îr‹
 = 
	`LodePNG_Text_c›y
(&
de°
->
ãxt
, &
sour˚
->text); if(error) Érror;

2535 
îr‹
 = 
	`LodePNG_IText_c›y
(&
de°
->
ôext
, &
sour˚
->itext); if(error) Érror;

2538 #ifde‡
LODEPNG_COMPILE_UNKNOWN_CHUNKS


2539 
	`LodePNG_UnknownChunks_öô
(&
de°
->
unknown_chunks
);

2540 
îr‹
 = 
	`LodePNG_UnknownChunks_c›y
(&
de°
->
unknown_chunks
, &
sour˚
->unknown_chunks); if(error) Érror;

2542  
îr‹
;

2543 
	}
}

2545 
	$LodePNG_InfoPng_sw≠
(
LodePNG_InfoPng
* 
a
, LodePNG_InfoPng* 
b
)

2547 
LodePNG_InfoPng
 
ãmp
 = *
a
;

2548 *
a
 = *
b
;

2549 *
b
 = 
ãmp
;

2550 
	}
}

2552 
	$LodePNG_InfoCﬁ‹_c›y
(
LodePNG_InfoCﬁ‹
* 
de°
, c⁄° LodePNG_InfoCﬁ‹* 
sour˚
)

2554 
size_t
 
i
;

2555 
	`LodePNG_InfoCﬁ‹_˛ónup
(
de°
);

2556 *
de°
 = *
sour˚
;

2557 
de°
->
∑Àâe
 = (*)
	`mÆloc
(
sour˚
->
∑Àâesize
 * 4);

2558 if(!
de°
->
∑Àâe
 && 
sour˚
->
∑Àâesize
)  9935;

2559 
i
 = 0; i < 
sour˚
->
∑Àâesize
 * 4; i++Ë
de°
->
∑Àâe
[i] = source->palette[i];

2561 
	}
}

2563 
	$LodePNG_InfoRaw_öô
(
LodePNG_InfoRaw
* 
öfo
)

2565 
	`LodePNG_InfoCﬁ‹_öô
(&
öfo
->
cﬁ‹
);

2566 
	}
}

2568 
	$LodePNG_InfoRaw_˛ónup
(
LodePNG_InfoRaw
* 
öfo
)

2570 
	`LodePNG_InfoCﬁ‹_˛ónup
(&
öfo
->
cﬁ‹
);

2571 
	}
}

2573 
	$LodePNG_InfoRaw_c›y
(
LodePNG_InfoRaw
* 
de°
, c⁄° LodePNG_InfoRaw* 
sour˚
)

2575 
îr‹
 = 0;

2576 
	`LodePNG_InfoRaw_˛ónup
(
de°
);

2577 *
de°
 = *
sour˚
;

2578 
	`LodePNG_InfoCﬁ‹_öô
(&
de°
->
cﬁ‹
);

2579 
îr‹
 = 
	`LodePNG_InfoCﬁ‹_c›y
(&
de°
->
cﬁ‹
, &
sour˚
->color);

2580  
îr‹
;

2581 
	}
}

2590 
	$LodePNG_c⁄vît
(* 
out
, c⁄° * 
ö
, 
LodePNG_InfoCﬁ‹
* 
öfoOut
, LodePNG_InfoCﬁ‹* 
öfoIn
, 
w
, 
h
)

2592 c⁄° 
size_t
 
numpixñs
 = 
w
 * 
h
;

2593 c⁄° 
OUT_BYTES
 = 
	`LodePNG_InfoCﬁ‹_gëBµ
(
öfoOut
) / 8;

2594 c⁄° 
OUT_ALPHA
 = 
	`LodePNG_InfoCﬁ‹_isAÕhaTy≥
(
öfoOut
);

2595 
size_t
 
i
, 
c
, 
bp
 = 0;

2598 if(
	`LodePNG_InfoCﬁ‹_equÆ
(
öfoIn
, 
öfoOut
))

2600 
size_t
 
i
;

2601 
size_t
 
size
 = (
w
 * 
h
 * 
	`LodePNG_InfoCﬁ‹_gëBµ
(
öfoIn
) + 7) / 8;

2602 
i
 = 0; i < 
size
; i++Ë
out
[i] = 
ö
[i];

2606 if((
öfoOut
->
cﬁ‹Ty≥
 =2 || infoOut->cﬁ‹Ty≥ =6Ë&& infoOut->
bôDïth
 == 8)

2608 if(
öfoIn
->
bôDïth
 == 8)

2610 
öfoIn
->
cﬁ‹Ty≥
)

2613 
i
 = 0; i < 
numpixñs
; i++)

2615 if(
OUT_ALPHA
Ë
out
[
OUT_BYTES
 * 
i
 + 3] = 255;

2616 
out
[
OUT_BYTES
 * 
i
 + 0] = 
ö
[i];

2617 
out
[
OUT_BYTES
 * 
i
 + 1] = 
ö
[i];

2618 
out
[
OUT_BYTES
 * 
i
 + 2] = 
ö
[i];

2619 if(
OUT_ALPHA
 && 
öfoIn
->
key_deföed
 && 
ö
[
i
] =öfoIn->
key_r
Ë
out
[
OUT_BYTES
 * i + 3] = 0;

2623 
i
 = 0; i < 
numpixñs
; i++)

2625 if(
OUT_ALPHA
Ë
out
[
OUT_BYTES
 * 
i
 + 3] = 255;

2626 
c
 = 0; c < 3; c++Ë
out
[
OUT_BYTES
 * 
i
 + c] = 
ö
[3 * i + c];

2627 if(
OUT_ALPHA
 && 
öfoIn
->
key_deföed
 =1 && 
ö
[3 * 
i
 + 0] =öfoIn->
key_r


2628 && 
ö
[3 * 
i
 + 1] =
öfoIn
->
key_g
 && in[3 * i + 2] =öfoIn->
key_b
)

2630 
out
[
OUT_BYTES
 * 
i
 + 3] = 0;

2635 
i
 = 0; i < 
numpixñs
; i++)

2637 if(
OUT_ALPHA
Ë
out
[
OUT_BYTES
 * 
i
 + 3] = 255;

2638 if(
ö
[
i
] >
öfoIn
->
∑Àâesize
)  46;

2639 
c
 = 0; c < 
OUT_BYTES
; c++)

2641 
out
[
OUT_BYTES
 * 
i
 + 
c
] = 
öfoIn
->
∑Àâe
[4 * 
ö
[i] + c];

2646 
i
 = 0; i < 
numpixñs
; i++)

2648 
out
[
OUT_BYTES
 * 
i
 + 0] = 
ö
[2 * i + 0];

2649 
out
[
OUT_BYTES
 * 
i
 + 1] = 
ö
[2 * i + 0];

2650 
out
[
OUT_BYTES
 * 
i
 + 2] = 
ö
[2 * i + 0];

2651 if(
OUT_ALPHA
Ë
out
[
OUT_BYTES
 * 
i
 + 3] = 
ö
[2 * i + 1];

2655 
i
 = 0; i < 
numpixñs
; i++)

2657 
c
 = 0; c < 
OUT_BYTES
; c++Ë
out
[OUT_BYTES * 
i
 + c] = 
ö
[4 * i + c];

2663 if(
öfoIn
->
bôDïth
 == 16)

2665 
öfoIn
->
cﬁ‹Ty≥
)

2668 
i
 = 0; i < 
numpixñs
; i++)

2670 if(
OUT_ALPHA
Ë
out
[
OUT_BYTES
 * 
i
 + 3] = 255;

2671 
out
[
OUT_BYTES
 * 
i
 + 0] = 
ö
[2 * i];

2672 
out
[
OUT_BYTES
 * 
i
 + 1] = 
ö
[2 * i];

2673 
out
[
OUT_BYTES
 * 
i
 + 2] = 
ö
[2 * i];

2674 if(
OUT_ALPHA
 && 
öfoIn
->
key_deföed
 && 256U * 
ö
[
i
] + in[ò+ 1] =öfoIn->
key_r
)

2676 
out
[
OUT_BYTES
 * 
i
 + 3] = 0;

2681 
i
 = 0; i < 
numpixñs
; i++)

2683 if(
OUT_ALPHA
Ë
out
[
OUT_BYTES
 * 
i
 + 3] = 255;

2684 
c
 = 0; c < 3; c++Ë
out
[
OUT_BYTES
 * 
i
 + c] = 
ö
[6 * i + 2 * c];

2685 if(
OUT_ALPHA
 && 
öfoIn
->
key_deföed
 && 256U * 
ö
[6 * 
i
 + 0] + in[6 * i + 1] =öfoIn->
key_r


2686 && 256U * 
ö
[6 * 
i
 + 2] + in[6 * i + 3] =
öfoIn
->
key_g
 && 256U * in[6 * i + 4] + in[6 * i + 5] =öfoIn->
key_b
)

2688 
out
[
OUT_BYTES
 * 
i
 + 3] = 0;

2693 
i
 = 0; i < 
numpixñs
; i++)

2695 
out
[
OUT_BYTES
 * 
i
 + 0] = 
ö
[4 * i];

2696 
out
[
OUT_BYTES
 * 
i
 + 1] = 
ö
[4 * i];

2697 
out
[
OUT_BYTES
 * 
i
 + 2] = 
ö
[4 * i];

2698 if(
OUT_ALPHA
Ë
out
[
OUT_BYTES
 * 
i
 + 3] = 
ö
[4 * i + 2];

2702 
i
 = 0; i < 
numpixñs
; i++)

2704 
c
 = 0; c < 
OUT_BYTES
; c++Ë
out
[OUT_BYTES * 
i
 + c] = 
ö
[8 * i + 2 * c];

2712 
öfoIn
->
cﬁ‹Ty≥
)

2715 
i
 = 0; i < 
numpixñs
; i++)

2717 
vÆue
 = 
	`ªadBôsFromRevî£dSåóm
(&
bp
, 
ö
, 
öfoIn
->
bôDïth
);

2718 if(
OUT_ALPHA
Ë
out
[
OUT_BYTES
 * 
i
 + 3] = 255;

2719 if(
OUT_ALPHA
 && 
öfoIn
->
key_deföed
 && 
vÆue


2720 && ((1U << 
öfoIn
->
bôDïth
Ë- 1UË=öfoIn->
key_r


2721 && ((1U << 
öfoIn
->
bôDïth
) - 1U))

2723 
out
[
OUT_BYTES
 * 
i
 + 3] = 0;

2725 
vÆue
 = (vÆuê* 255Ë/ ((1 << 
öfoIn
->
bôDïth
) - 1);

2726 
out
[
OUT_BYTES
 * 
i
 + 0] = ()(
vÆue
);

2727 
out
[
OUT_BYTES
 * 
i
 + 1] = ()(
vÆue
);

2728 
out
[
OUT_BYTES
 * 
i
 + 2] = ()(
vÆue
);

2732 
i
 = 0; i < 
numpixñs
; i++)

2734 
vÆue
 = 
	`ªadBôsFromRevî£dSåóm
(&
bp
, 
ö
, 
öfoIn
->
bôDïth
);

2735 if(
OUT_ALPHA
Ë
out
[
OUT_BYTES
 * 
i
 + 3] = 255;

2736 if(
vÆue
 >
öfoIn
->
∑Àâesize
)  47;

2737 
c
 = 0; c < 
OUT_BYTES
; c++)

2739 
out
[
OUT_BYTES
 * 
i
 + 
c
] = 
öfoIn
->
∑Àâe
[4 * 
vÆue
 + c];

2747 if(
	`LodePNG_InfoCﬁ‹_isGªysˇÀTy≥
(
öfoOut
Ë&& infoOut->
bôDïth
 == 8)

2749 if(!
	`LodePNG_InfoCﬁ‹_isGªysˇÀTy≥
(
öfoIn
))  62;

2750 if(
öfoIn
->
bôDïth
 == 8)

2752 
öfoIn
->
cﬁ‹Ty≥
)

2755 
i
 = 0; i < 
numpixñs
; i++)

2757 if(
OUT_ALPHA
Ë
out
[
OUT_BYTES
 * 
i
 + 1] = 255;

2758 
out
[
OUT_BYTES
 * 
i
] = 
ö
[i];

2759 if(
OUT_ALPHA
 && 
öfoIn
->
key_deföed
 && 
ö
[
i
] =öfoIn->
key_r
Ë
out
[
OUT_BYTES
 * i + 1] = 0;

2763 
i
 = 0; i < 
numpixñs
; i++)

2765 
out
[
OUT_BYTES
 * 
i
 + 0] = 
ö
[2 * i + 0];

2766 if(
OUT_ALPHA
Ë
out
[
OUT_BYTES
 * 
i
 + 1] = 
ö
[2 * i + 1];

2772 if(
öfoIn
->
bôDïth
 == 16)

2774 
öfoIn
->
cﬁ‹Ty≥
)

2777 
i
 = 0; i < 
numpixñs
; i++)

2779 if(
OUT_ALPHA
Ë
out
[
OUT_BYTES
 * 
i
 + 1] = 255;

2780 
out
[
OUT_BYTES
 * 
i
] = 
ö
[2 * i];

2781 if(
OUT_ALPHA
 && 
öfoIn
->
key_deföed
 && 256U * 
ö
[
i
] + in[ò+ 1] =öfoIn->
key_r
)

2783 
out
[
OUT_BYTES
 * 
i
 + 1] = 0;

2788 
i
 = 0; i < 
numpixñs
; i++)

2790 
out
[
OUT_BYTES
 * 
i
] = 
ö
[4 * i];

2791 if(
OUT_ALPHA
Ë
out
[
OUT_BYTES
 * 
i
 + 1] = 
ö
[4 * i + 2];

2799 if(
öfoIn
->
cﬁ‹Ty≥
 != 0)  31;

2800 
i
 = 0; i < 
numpixñs
; i++)

2802 
vÆue
 = 
	`ªadBôsFromRevî£dSåóm
(&
bp
, 
ö
, 
öfoIn
->
bôDïth
);

2803 if(
OUT_ALPHA
Ë
out
[
OUT_BYTES
 * 
i
 + 1] = 255;

2804 if(
OUT_ALPHA
 && 
öfoIn
->
key_deföed
 && 
vÆue


2805 && ((1U << 
öfoIn
->
bôDïth
Ë- 1UË=öfoIn->
key_r


2806 && ((1U << 
öfoIn
->
bôDïth
) - 1U))

2808 
out
[
OUT_BYTES
 * 
i
 + 1] = 0;

2810 
vÆue
 = (vÆuê* 255Ë/ ((1 << 
öfoIn
->
bôDïth
) - 1);

2811 
out
[
OUT_BYTES
 * 
i
] = ()(
vÆue
);

2818 
	}
}

2825 
	$∑ëhPªdi˘‹
(
a
, 
b
, 
c
)

2827 
∑
 = 
	`abs
(
b
 - 
c
);

2828 
pb
 = 
	`abs
(
a
 - 
c
);

2829 
pc
 = 
	`abs
(
a
 + 
b
 - 
c
 - c);

2836 if(
∑
 <
pb
 &&Ö®<
pc
Ë ()
a
;

2837 if(
pb
 <
pc
Ë ()
b
;

2838  ()
c
;

2839 
	}
}

2843 c⁄° 
	gADAM7_IX
[7] = { 0, 4, 0, 2, 0, 1, 0 };

2844 c⁄° 
	gADAM7_IY
[7] = { 0, 0, 4, 0, 2, 0, 1 };

2845 c⁄° 
	gADAM7_DX
[7] = { 8, 8, 4, 4, 2, 2, 1 };

2846 c⁄° 
	gADAM7_DY
[7] = { 8, 8, 8, 4, 4, 2, 2 };

2848 
	$Adam7_gë∑ssvÆues
(
∑ssw
[7], 
∑ssh
[7], 
size_t
 
fûãr_∑ss°¨t
[8], size_à
∑dded_∑ss°¨t
[8], size_à
∑ss°¨t
[8], 
w
, 
h
, 
bµ
)

2851 
i
;

2854 
i
 = 0; i < 7; i++)

2856 
∑ssw
[
i
] = (
w
 + 
ADAM7_DX
[i] - 
ADAM7_IX
[i] - 1) / ADAM7_DX[i];

2857 
∑ssh
[
i
] = (
h
 + 
ADAM7_DY
[i] - 
ADAM7_IY
[i] - 1) / ADAM7_DY[i];

2858 if(
∑ssw
[
i
] =0Ë
∑ssh
[i] = 0;

2859 if(
∑ssh
[
i
] =0Ë
∑ssw
[i] = 0;

2862 
fûãr_∑ss°¨t
[0] = 
∑dded_∑ss°¨t
[0] = 
∑ss°¨t
[0] = 0;

2863 
i
 = 0; i < 7; i++)

2865 
fûãr_∑ss°¨t
[
i
 + 1] = fûãr_∑ss°¨t[i] + ((
∑ssw
[i] && 
∑ssh
[i]Ë?Öassh[i] * (1 + (∑ssw[i] * 
bµ
 + 7) / 8) : 0);

2866 
∑dded_∑ss°¨t
[
i
 + 1] =Öadded_∑ss°¨t[i] + 
∑ssh
[i] * ((
∑ssw
[i] * 
bµ
 + 7) / 8);

2867 
∑ss°¨t
[
i
 + 1] =Öass°¨t[i] + (
∑ssh
[i] * 
∑ssw
[i] * 
bµ
 + 7) / 8;

2869 
	}
}

2871 #ifde‡
LODEPNG_COMPILE_DECODER


2878 
	$LodePNG_Decodî_ö•e˘
(
LodePNG_Decodî
* 
decodî
, c⁄° * 
ö
, 
size_t
 
öÀngth
)

2880 if(
öÀngth
 =0 || 
ö
 == 0)

2882 
decodî
->
îr‹
 = 48;

2885 if(
öÀngth
 < 29)

2887 
decodî
->
îr‹
 = 27;

2892 
	`LodePNG_InfoPng_˛ónup
(&
decodî
->
öfoPng
);

2893 
	`LodePNG_InfoPng_öô
(&
decodî
->
öfoPng
);

2894 
decodî
->
îr‹
 = 0;

2896 if(
ö
[0] != 137 || in[1] != 80 || in[2] != 78 || in[3] != 71 || in[4] != 13 || in[5] != 10 || in[6] != 26 || in[7] != 10)

2898 
decodî
->
îr‹
 = 28;

2901 if(
ö
[12] != 'I' || in[13] != 'H' || in[14] != 'D' || in[15] != 'R')

2903 
decodî
->
îr‹
 = 29;

2908 
decodî
->
öfoPng
.
width
 = 
	`LodePNG_ªad32bôI¡
(&
ö
[16]);

2909 
decodî
->
öfoPng
.
height
 = 
	`LodePNG_ªad32bôI¡
(&
ö
[20]);

2910 
decodî
->
öfoPng
.
cﬁ‹
.
bôDïth
 = 
ö
[24];

2911 
decodî
->
öfoPng
.
cﬁ‹
.
cﬁ‹Ty≥
 = 
ö
[25];

2912 
decodî
->
öfoPng
.
com¥essi⁄Mëhod
 = 
ö
[26];

2913 
decodî
->
öfoPng
.
fûãrMëhod
 = 
ö
[27];

2914 
decodî
->
öfoPng
.
öãæa˚Mëhod
 = 
ö
[28];

2916 if(!
decodî
->
£âögs
.
ign‹eCrc
)

2918 
CRC
 = 
	`LodePNG_ªad32bôI¡
(&
ö
[29]);

2919 
checksum
 = 
	`Crc32_¸c
(&
ö
[12], 17);

2920 if(
CRC
 !
checksum
)

2922 
decodî
->
îr‹
 = 57;

2927 if(
decodî
->
öfoPng
.
com¥essi⁄Mëhod
 !0Ë{ decodî->
îr‹
 = 32; ; }

2928 if(
decodî
->
öfoPng
.
fûãrMëhod
 !0Ë{ decodî->
îr‹
 = 33; ; }

2929 if(
decodî
->
öfoPng
.
öãæa˚Mëhod
 > 1Ë{ decodî->
îr‹
 = 34; ; }

2931 
decodî
->
îr‹
 = 
	`checkCﬁ‹VÆidôy
(decodî->
öfoPng
.
cﬁ‹
.
cﬁ‹Ty≥
, decodî->öfoPng.cﬁ‹.
bôDïth
);

2932 
	}
}

2934 
	$unfûãrSˇ∆öe
(* 
ªc⁄
, c⁄° * 
sˇ∆öe
, c⁄° * 
¥ec⁄
, 
size_t
 
byãwidth
, 
fûãrTy≥
, size_à
Àngth
)

2944 
size_t
 
i
;

2945 
fûãrTy≥
)

2948 
i
 = 0; i < 
Àngth
; i++Ë
ªc⁄
[i] = 
sˇ∆öe
[i];

2951 
i
 = 0; i < 
byãwidth
; i++Ë
ªc⁄
[i] = 
sˇ∆öe
[i];

2952 
i
 = 
byãwidth
; i < 
Àngth
; i++Ë
ªc⁄
[i] = 
sˇ∆öe
[i] +Ñecon[i - bytewidth];

2955 if(
¥ec⁄
)

2957 
i
 = 0; i < 
Àngth
; i++Ë
ªc⁄
[i] = 
sˇ∆öe
[i] + 
¥ec⁄
[i];

2961 
i
 = 0; i < 
Àngth
; i++Ë
ªc⁄
[i] = 
sˇ∆öe
[i];

2965 if(
¥ec⁄
)

2967 
i
 = 0; i < 
byãwidth
; i++Ë
ªc⁄
[i] = 
sˇ∆öe
[i] + 
¥ec⁄
[i] / 2;

2968 
i
 = 
byãwidth
; i < 
Àngth
; i++Ë
ªc⁄
[i] = 
sˇ∆öe
[i] + (‘ec⁄[ò- byãwidth] + 
¥ec⁄
[i]) / 2);

2972 
i
 = 0; i < 
byãwidth
; i++Ë
ªc⁄
[i] = 
sˇ∆öe
[i];

2973 
i
 = 
byãwidth
; i < 
Àngth
; i++Ë
ªc⁄
[i] = 
sˇ∆öe
[i] +Ñecon[i - bytewidth] / 2;

2977 if(
¥ec⁄
)

2979 
i
 = 0; i < 
byãwidth
; i++)

2981 
ªc⁄
[
i
] = (
sˇ∆öe
[i] + 
¥ec⁄
[i]);

2983 
i
 = 
byãwidth
; i < 
Àngth
; i++)

2985 
ªc⁄
[
i
] = (
sˇ∆öe
[i] + 
	`∑ëhPªdi˘‹
‘ec⁄[ò- 
byãwidth
], 
¥ec⁄
[i],Örecon[i - bytewidth]));

2990 
i
 = 0; i < 
byãwidth
; i++)

2992 
ªc⁄
[
i
] = 
sˇ∆öe
[i];

2994 
i
 = 
byãwidth
; i < 
Àngth
; i++)

2996 
ªc⁄
[
i
] = (
sˇ∆öe
[i] +Ñec⁄[ò- 
byãwidth
]);

3003 
	}
}

3005 
	$unfûãr
(* 
out
, c⁄° * 
ö
, 
w
, 
h
, 
bµ
)

3015 
y
;

3016 * 
¥evlöe
 = 0;

3018 
size_t
 
byãwidth
 = (
bµ
 + 7) / 8;

3019 
size_t
 
löebyãs
 = (
w
 * 
bµ
 + 7) / 8;

3021 
y
 = 0; y < 
h
; y++)

3023 
size_t
 
outödex
 = 
löebyãs
 * 
y
;

3024 
size_t
 
öödex
 = (1 + 
löebyãs
Ë* 
y
;

3025 
fûãrTy≥
 = 
ö
[
öödex
];

3027 
îr‹
 = 
	`unfûãrSˇ∆öe
(&
out
[
outödex
], &
ö
[
öödex
 + 1], 
¥evlöe
, 
byãwidth
, 
fûãrTy≥
, 
löebyãs
);

3028 if(
îr‹
) Érror;

3030 
¥evlöe
 = &
out
[
outödex
];

3034 
	}
}

3036 
	$Adam7_deöãæa˚
(* 
out
, c⁄° * 
ö
, 
w
, 
h
, 
bµ
)

3040 
∑ssw
[7], 
∑ssh
[7];

3041 
size_t
 
fûãr_∑ss°¨t
[8], 
∑dded_∑ss°¨t
[8], 
∑ss°¨t
[8];

3042 
i
;

3044 
	`Adam7_gë∑ssvÆues
(
∑ssw
, 
∑ssh
, 
fûãr_∑ss°¨t
, 
∑dded_∑ss°¨t
, 
∑ss°¨t
, 
w
, 
h
, 
bµ
);

3046 if(
bµ
 >= 8)

3048 
i
 = 0; i < 7; i++)

3050 
x
, 
y
, 
b
;

3051 
size_t
 
byãwidth
 = 
bµ
 / 8;

3052 
y
 = 0; y < 
∑ssh
[
i
]; y++)

3053 
x
 = 0; x < 
∑ssw
[
i
]; x++)

3055 
size_t
 
pixñö°¨t
 = 
∑ss°¨t
[
i
] + (
y
 * 
∑ssw
[i] + 
x
Ë* 
byãwidth
;

3056 
size_t
 
pixñout°¨t
 = ((
ADAM7_IY
[
i
] + 
y
 * 
ADAM7_DY
[i]Ë* 
w
 + 
ADAM7_IX
[i] + 
x
 * 
ADAM7_DX
[i]Ë* 
byãwidth
;

3057 
b
 = 0; b < 
byãwidth
; b++)

3059 
out
[
pixñout°¨t
 + 
b
] = 
ö
[
pixñö°¨t
 + b];

3066 
i
 = 0; i < 7; i++)

3068 
x
, 
y
, 
b
;

3069 
ûöebôs
 = 
bµ
 * 
∑ssw
[
i
];

3070 
ﬁöebôs
 = 
bµ
 * 
w
;

3071 
size_t
 
obp
, 
ibp
;

3072 
y
 = 0; y < 
∑ssh
[
i
]; y++)

3073 
x
 = 0; x < 
∑ssw
[
i
]; x++)

3075 
ibp
 = (8 * 
∑ss°¨t
[
i
]Ë+ (
y
 * 
ûöebôs
 + 
x
 * 
bµ
);

3076 
obp
 = (
ADAM7_IY
[
i
] + 
y
 * 
ADAM7_DY
[i]Ë* 
ﬁöebôs
 + (
ADAM7_IX
[i] + 
x
 * 
ADAM7_DX
[i]Ë* 
bµ
;

3077 
b
 = 0; b < 
bµ
; b++)

3079 
bô
 = 
	`ªadBôFromRevî£dSåóm
(&
ibp
, 
ö
);

3080 
	`£tBôOfRevî£dSåóm0
(&
obp
, 
out
, 
bô
);

3085 
	}
}

3087 
	$ªmovePaddögBôs
(* 
out
, c⁄° * 
ö
, 
size_t
 
ﬁöebôs
, size_à
ûöebôs
, 
h
)

3095 
y
;

3096 
size_t
 
diff
 = 
ûöebôs
 - 
ﬁöebôs
;

3097 
size_t
 
ibp
 = 0, 
obp
 = 0;

3098 
y
 = 0; y < 
h
; y++)

3100 
size_t
 
x
;

3101 
x
 = 0; x < 
ﬁöebôs
; x++)

3103 
bô
 = 
	`ªadBôFromRevî£dSåóm
(&
ibp
, 
ö
);

3104 
	`£tBôOfRevî£dSåóm
(&
obp
, 
out
, 
bô
);

3106 
ibp
 +
diff
;

3108 
	}
}

3111 
	$po°Pro˚ssSˇ∆öes
(* 
out
, * 
ö
, c⁄° 
LodePNG_InfoPng
* 
öfoPng
)

3119 
bµ
 = 
	`LodePNG_InfoCﬁ‹_gëBµ
(&
öfoPng
->
cﬁ‹
);

3120 
w
 = 
öfoPng
->
width
;

3121 
h
 = 
öfoPng
->
height
;

3122 
îr‹
 = 0;

3123 if(
bµ
 == 0)  31;

3125 if(
öfoPng
->
öãæa˚Mëhod
 == 0)

3127 if(
bµ
 < 8 && 
w
 * bpp != ((w * bpp + 7) / 8) * 8)

3129 
îr‹
 = 
	`unfûãr
(
ö
, in, 
w
, 
h
, 
bµ
);

3130 if(
îr‹
) Érror;

3131 
	`ªmovePaddögBôs
(
out
, 
ö
, 
w
 * 
bµ
, ((w * bµ + 7Ë/ 8Ë* 8, 
h
);

3133 
îr‹
 = 
	`unfûãr
(
out
, 
ö
, 
w
, 
h
, 
bµ
);

3137 
∑ssw
[7], 
∑ssh
[7]; 
size_t
 
fûãr_∑ss°¨t
[8], 
∑dded_∑ss°¨t
[8], 
∑ss°¨t
[8];

3138 
i
;

3140 
	`Adam7_gë∑ssvÆues
(
∑ssw
, 
∑ssh
, 
fûãr_∑ss°¨t
, 
∑dded_∑ss°¨t
, 
∑ss°¨t
, 
w
, 
h
, 
bµ
);

3142 
i
 = 0; i < 7; i++)

3144 
îr‹
 = 
	`unfûãr
(&
ö
[
∑dded_∑ss°¨t
[
i
]], &ö[
fûãr_∑ss°¨t
[i]], 
∑ssw
[i], 
∑ssh
[i], 
bµ
);

3145 if(
îr‹
) Érror;

3146 if(
bµ
 < 8)

3149 
	`ªmovePaddögBôs
(&
ö
[
∑ss°¨t
[
i
]], &ö[
∑dded_∑ss°¨t
[i]], 
∑ssw
[i] * 
bµ
, (’assw[i] * bµ + 7Ë/ 8Ë* 8, 
∑ssh
[i]);

3153 
	`Adam7_deöãæa˚
(
out
, 
ö
, 
w
, 
h
, 
bµ
);

3156  
îr‹
;

3157 
	}
}

3160 
	$decodeGíîic
(
LodePNG_Decodî
* 
decodî
, ** 
out
, 
size_t
* 
outsize
, c⁄° * 
ö
, size_à
ösize
)

3162 
IEND
 = 0;

3163 c⁄° * 
chunk
;

3164 
size_t
 
i
;

3165 
ucve˘‹
 
id©
;

3168 
unknown
 = 0;

3169 
¸ôiˇl_pos
 = 1;

3172 *
out
 = 0;

3173 *
outsize
 = 0;

3175 
	`LodePNG_Decodî_ö•e˘
(
decodî
, 
ö
, 
ösize
);

3176 if(
decodî
->
îr‹
) ;

3178 
	`ucve˘‹_öô
(&
id©
);

3180 
chunk
 = &
ö
[33];

3182 !
IEND
)

3184 
chunkLígth
;

3185 c⁄° * 
d©a
;

3187 if((
size_t
)((
chunk
 - 
ö
Ë+ 12Ë> 
ösize
 || chunk < in)

3189 
decodî
->
îr‹
 = 30;

3192 
chunkLígth
 = 
	`LodePNG_chunk_Àngth
(
chunk
);

3193 if(
chunkLígth
 > 2147483647)

3195 
decodî
->
îr‹
 = 63;

3198 if((
size_t
)((
chunk
 - 
ö
Ë+ 
chunkLígth
 + 12Ë> 
ösize
 || (chunk + chunkLength + 12) < in)

3200 
decodî
->
îr‹
 = 35;

3203 
d©a
 = 
	`LodePNG_chunk_d©a_c⁄°
(
chunk
);

3206 if(
	`LodePNG_chunk_ty≥_equÆs
(
chunk
, "IDAT"))

3208 
size_t
 
ﬁdsize
 = 
id©
.
size
;

3209 if(!
	`ucve˘‹_ªsize
(&
id©
, 
ﬁdsize
 + 
chunkLígth
))

3211 
decodî
->
îr‹
 = 9936;

3214 
i
 = 0; i < 
chunkLígth
; i++Ë
id©
.
d©a
[
ﬁdsize
 + i] = data[i];

3215 
¸ôiˇl_pos
 = 3;

3218 if(
	`LodePNG_chunk_ty≥_equÆs
(
chunk
, "IEND"))

3220 
IEND
 = 1;

3223 if(
	`LodePNG_chunk_ty≥_equÆs
(
chunk
, "PLTE"))

3225 
pos
 = 0;

3226 if(
decodî
->
öfoPng
.
cﬁ‹
.
∑Àâe
Ë
	`‰ì
(decoder->infoPng.color.palette);

3227 
decodî
->
öfoPng
.
cﬁ‹
.
∑Àâesize
 = 
chunkLígth
 / 3;

3228 
decodî
->
öfoPng
.
cﬁ‹
.
∑Àâe
 = (*)
	`mÆloc
(4 * decodî->öfoPng.cﬁ‹.
∑Àâesize
);

3229 if(!
decodî
->
öfoPng
.
cﬁ‹
.
∑Àâe
 && decodî->öfoPng.cﬁ‹.
∑Àâesize
)

3231 
decodî
->
öfoPng
.
cﬁ‹
.
∑Àâesize
 = 0;

3232 
decodî
->
îr‹
 = 9937;

3235 if(
decodî
->
öfoPng
.
cﬁ‹
.
∑Àâesize
 > 256)

3237 
decodî
->
îr‹
 = 38;

3240 
i
 = 0; i < 
decodî
->
öfoPng
.
cﬁ‹
.
∑Àâesize
; i++)

3242 
decodî
->
öfoPng
.
cﬁ‹
.
∑Àâe
[4 * 
i
 + 0] = 
d©a
[
pos
++];

3243 
decodî
->
öfoPng
.
cﬁ‹
.
∑Àâe
[4 * 
i
 + 1] = 
d©a
[
pos
++];

3244 
decodî
->
öfoPng
.
cﬁ‹
.
∑Àâe
[4 * 
i
 + 2] = 
d©a
[
pos
++];

3245 
decodî
->
öfoPng
.
cﬁ‹
.
∑Àâe
[4 * 
i
 + 3] = 255;

3247 
¸ôiˇl_pos
 = 2;

3250 if(
	`LodePNG_chunk_ty≥_equÆs
(
chunk
, "tRNS"))

3252 if(
decodî
->
öfoPng
.
cﬁ‹
.
cﬁ‹Ty≥
 == 3)

3254 if(
chunkLígth
 > 
decodî
->
öfoPng
.
cﬁ‹
.
∑Àâesize
)

3256 
decodî
->
îr‹
 = 39;

3259 
i
 = 0; i < 
chunkLígth
; i++Ë
decodî
->
öfoPng
.
cﬁ‹
.
∑Àâe
[4 * i + 3] = 
d©a
[i];

3261 if(
decodî
->
öfoPng
.
cﬁ‹
.
cﬁ‹Ty≥
 == 0)

3263 if(
chunkLígth
 != 2)

3265 
decodî
->
îr‹
 = 40;

3268 
decodî
->
öfoPng
.
cﬁ‹
.
key_deföed
 = 1;

3269 
decodî
->
öfoPng
.
cﬁ‹
.
key_r
 = decodî->öfoPng.cﬁ‹.
key_g
 = decodî->öfoPng.cﬁ‹.
key_b
 = 256 * 
d©a
[0] + data[1];

3271 if(
decodî
->
öfoPng
.
cﬁ‹
.
cﬁ‹Ty≥
 == 2)

3273 if(
chunkLígth
 != 6)

3275 
decodî
->
îr‹
 = 41;

3278 
decodî
->
öfoPng
.
cﬁ‹
.
key_deföed
 = 1;

3279 
decodî
->
öfoPng
.
cﬁ‹
.
key_r
 = 256 * 
d©a
[0] + data[1];

3280 
decodî
->
öfoPng
.
cﬁ‹
.
key_g
 = 256 * 
d©a
[2] + data[3];

3281 
decodî
->
öfoPng
.
cﬁ‹
.
key_b
 = 256 * 
d©a
[4] + data[5];

3285 
decodî
->
îr‹
 = 42;

3289 #ifde‡
LODEPNG_COMPILE_ANCILLARY_CHUNKS


3291 if(
	`LodePNG_chunk_ty≥_equÆs
(
chunk
, "bKGD"))

3293 if(
decodî
->
öfoPng
.
cﬁ‹
.
cﬁ‹Ty≥
 == 3)

3295 if(
chunkLígth
 != 1)

3297 
decodî
->
îr‹
 = 43;

3300 
decodî
->
öfoPng
.
background_deföed
 = 1;

3301 
decodî
->
öfoPng
.
background_r
 = decodî->öfoPng.
background_g
 = decodî->öfoPng.
background_b
 = 
d©a
[0];

3303 if(
decodî
->
öfoPng
.
cﬁ‹
.
cﬁ‹Ty≥
 == 0 || decoder->infoPng.color.colorType == 4)

3305 if(
chunkLígth
 != 2)

3307 
decodî
->
îr‹
 = 44;

3310 
decodî
->
öfoPng
.
background_deföed
 = 1;

3311 
decodî
->
öfoPng
.
background_r
 = decodî->öfoPng.
background_g
 = decodî->öfoPng.
background_b
 = 256 * 
d©a
[0] + data[1];

3313 if(
decodî
->
öfoPng
.
cﬁ‹
.
cﬁ‹Ty≥
 == 2 || decoder->infoPng.color.colorType == 6)

3315 if(
chunkLígth
 != 6)

3317 
decodî
->
îr‹
 = 45;

3320 
decodî
->
öfoPng
.
background_deföed
 = 1;

3321 
decodî
->
öfoPng
.
background_r
 = 256 * 
d©a
[0] + data[1];

3322 
decodî
->
öfoPng
.
background_g
 = 256 * 
d©a
[2] + data[3];

3323 
decodî
->
öfoPng
.
background_b
 = 256 * 
d©a
[4] + data[5];

3327 if(
	`LodePNG_chunk_ty≥_equÆs
(
chunk
, "tEXt"))

3329 if(
decodî
->
£âögs
.
ªadTextChunks
)

3331 *
key
 = 0, *
°r
 = 0;

3333 !
decodî
->
îr‹
)

3335 
Àngth
, 
°rög2_begö
;

3337 
Àngth
 = 0;

3338 
Àngth
 < 
chunkLígth
 && 
d©a
[length] != 0)Üength++;

3339 if(
Àngth
 + 1 >
chunkLígth
)

3341 
decodî
->
îr‹
 = 75;

3344 
key
 = (*)
	`mÆloc
(
Àngth
 + 1);

3345 if(!
key
)

3347 
decodî
->
îr‹
 = 9938;

3350 
key
[
Àngth
] = 0;

3351 
i
 = 0; i < 
Àngth
; i++Ë
key
[i] = 
d©a
[i];

3353 
°rög2_begö
 = 
Àngth
 + 1;

3354 if(
°rög2_begö
 > 
chunkLígth
)

3356 
decodî
->
îr‹
 = 75;

3359 
Àngth
 = 
chunkLígth
 - 
°rög2_begö
;

3360 
°r
 = (*)
	`mÆloc
(
Àngth
 + 1);

3361 if(!
°r
)

3363 
decodî
->
îr‹
 = 9939;

3366 
°r
[
Àngth
] = 0;

3367 
i
 = 0; i < 
Àngth
; i++Ë
°r
[i] = 
d©a
[
°rög2_begö
 + i];

3369 
decodî
->
îr‹
 = 
	`LodePNG_Text_add
(&decodî->
öfoPng
.
ãxt
, 
key
, 
°r
);

3374 
	`‰ì
(
key
);

3375 
	`‰ì
(
°r
);

3379 if(
	`LodePNG_chunk_ty≥_equÆs
(
chunk
, "zTXt"))

3381 if(
decodî
->
£âögs
.
ªadTextChunks
)

3383 
Àngth
, 
°rög2_begö
;

3384 *
key
 = 0;

3385 
ucve˘‹
 
decoded
;

3387 
	`ucve˘‹_öô
(&
decoded
);

3389 !
decodî
->
îr‹
)

3391 
Àngth
 = 0;Üígth < 
chunkLígth
 && 
d©a
[length] != 0;Üength++) ;

3392 if(
Àngth
 + 2 >
chunkLígth
)

3394 
decodî
->
îr‹
 = 75;

3397 
key
 = (*)
	`mÆloc
(
Àngth
 + 1);

3398 if(!
key
)

3400 
decodî
->
îr‹
 = 9940;

3403 
key
[
Àngth
] = 0;

3404 
i
 = 0; i < 
Àngth
; i++Ë
key
[i] = 
d©a
[i];

3406 if(
d©a
[
Àngth
 + 1] != 0)

3408 
decodî
->
îr‹
 = 72;

3412 
°rög2_begö
 = 
Àngth
 + 2;

3413 if(
°rög2_begö
 > 
chunkLígth
)

3415 
decodî
->
îr‹
 = 75;

3418 
Àngth
 = 
chunkLígth
 - 
°rög2_begö
;

3419 
decodî
->
îr‹
 = 
	`LodePNG_decom¥ess
(&
decoded
.
d©a
, &decoded.
size
, (*)(&d©a[
°rög2_begö
]), 
Àngth
, &decodî->
£âögs
.
zlib£âögs
);

3420 if(
decodî
->
îr‹
) ;

3421 
	`ucve˘‹_push_back
(&
decoded
, 0);

3423 
decodî
->
îr‹
 = 
	`LodePNG_Text_add
(&decodî->
öfoPng
.
ãxt
, 
key
, (*)
decoded
.
d©a
);

3428 
	`‰ì
(
key
);

3429 
	`ucve˘‹_˛ónup
(&
decoded
);

3430 if(
decodî
->
îr‹
) ;

3434 if(
	`LodePNG_chunk_ty≥_equÆs
(
chunk
, "iTXt"))

3436 if(
decodî
->
£âögs
.
ªadTextChunks
)

3438 
Àngth
, 
begö
, 
com¥es£d
;

3439 *
key
 = 0, *
œngèg
 = 0, *
å™skey
 = 0;

3440 
ucve˘‹
 
decoded
;

3441 
	`ucve˘‹_öô
(&
decoded
);

3443 !
decodî
->
îr‹
)

3446 if(
chunkLígth
 < 5)

3448 
decodî
->
îr‹
 = 76;

3453 
Àngth
 = 0;Üígth < 
chunkLígth
 && 
d©a
[length] != 0;Üength++) ;

3454 if(
Àngth
 + 2 >
chunkLígth
)

3456 
decodî
->
îr‹
 = 75;

3459 
key
 = (*)
	`mÆloc
(
Àngth
 + 1);

3460 if(!
key
)

3462 
decodî
->
îr‹
 = 9941;

3465 
key
[
Àngth
] = 0;

3466 
i
 = 0; i < 
Àngth
; i++Ë
key
[i] = 
d©a
[i];

3469 
com¥es£d
 = 
d©a
[
Àngth
 + 1];

3470 if(
d©a
[
Àngth
 + 2] != 0)

3472 
decodî
->
îr‹
 = 72;

3477 
begö
 = 
Àngth
 + 3;

3478 
Àngth
 = 0;

3479 
i
 = 
begö
; i < 
chunkLígth
 && 
d©a
[i] !0; i++Ë
Àngth
++;

3480 if(
begö
 + 
Àngth
 + 1 >
chunkLígth
)

3482 
decodî
->
îr‹
 = 75;

3485 
œngèg
 = (*)
	`mÆloc
(
Àngth
 + 1);

3486 if(!
œngèg
)

3488 
decodî
->
îr‹
 = 9942;

3491 
œngèg
[
Àngth
] = 0;

3492 
i
 = 0; i < 
Àngth
; i++Ë
œngèg
[i] = 
d©a
[
begö
 + i];

3495 
begö
 +
Àngth
 + 1;

3496 
Àngth
 = 0;

3497 
i
 = 
begö
; i < 
chunkLígth
 && 
d©a
[i] !0; i++Ë
Àngth
++;

3498 if(
begö
 + 
Àngth
 + 1 >
chunkLígth
)

3500 
decodî
->
îr‹
 = 75;

3503 
å™skey
 = (*)
	`mÆloc
(
Àngth
 + 1);

3504 if(!
å™skey
)

3506 
decodî
->
îr‹
 = 9943;

3509 
å™skey
[
Àngth
] = 0;

3510 
i
 = 0; i < 
Àngth
; i++Ë
å™skey
[i] = 
d©a
[
begö
 + i];

3513 
begö
 +
Àngth
 + 1;

3514 if(
begö
 > 
chunkLígth
)

3516 
decodî
->
îr‹
 = 75;

3519 
Àngth
 = 
chunkLígth
 - 
begö
;

3521 if(
com¥es£d
)

3523 
decodî
->
îr‹
 = 
	`LodePNG_decom¥ess
(&
decoded
.
d©a
, &decoded.
size
, (*)(&d©a[
begö
]), 
Àngth
, &decodî->
£âögs
.
zlib£âögs
);

3524 if(
decodî
->
îr‹
) ;

3525 
	`ucve˘‹_push_back
(&
decoded
, 0);

3529 if(!
	`ucve˘‹_ªsize
(&
decoded
, 
Àngth
 + 1))

3531 
decodî
->
îr‹
 = 9944;

3534 
decoded
.
d©a
[
Àngth
] = 0;

3535 
i
 = 0; i < 
Àngth
; i++Ë
decoded
.
d©a
[i] = d©a[
begö
 + i];

3538 
decodî
->
îr‹
 = 
	`LodePNG_IText_add
(&decodî->
öfoPng
.
ôext
, 
key
, 
œngèg
, 
å™skey
, (*)
decoded
.
d©a
);

3543 
	`‰ì
(
key
);

3544 
	`‰ì
(
œngèg
);

3545 
	`‰ì
(
å™skey
);

3546 
	`ucve˘‹_˛ónup
(&
decoded
);

3547 if(
decodî
->
îr‹
) ;

3550 if(
	`LodePNG_chunk_ty≥_equÆs
(
chunk
, "tIME"))

3552 if(
chunkLígth
 != 7)

3554 
decodî
->
îr‹
 = 73;

3557 
decodî
->
öfoPng
.
time_deföed
 = 1;

3558 
decodî
->
öfoPng
.
time
.
yór
 = 256 * 
d©a
[0] + data[+ 1];

3559 
decodî
->
öfoPng
.
time
.
m⁄th
 = 
d©a
[2];

3560 
decodî
->
öfoPng
.
time
.
day
 = 
d©a
[3];

3561 
decodî
->
öfoPng
.
time
.
hour
 = 
d©a
[4];

3562 
decodî
->
öfoPng
.
time
.
möuã
 = 
d©a
[5];

3563 
decodî
->
öfoPng
.
time
.
£c⁄d
 = 
d©a
[6];

3565 if(
	`LodePNG_chunk_ty≥_equÆs
(
chunk
, "pHYs"))

3567 if(
chunkLígth
 != 9)

3569 
decodî
->
îr‹
 = 74;

3572 
decodî
->
öfoPng
.
phys_deföed
 = 1;

3573 
decodî
->
öfoPng
.
phys_x
 = 16777216 * 
d©a
[0] + 65536 * data[1] + 256 * data[2] + data[3];

3574 
decodî
->
öfoPng
.
phys_y
 = 16777216 * 
d©a
[4] + 65536 * data[5] + 256 * data[6] + data[7];

3575 
decodî
->
öfoPng
.
phys_unô
 = 
d©a
[8];

3580 if(
	`LodePNG_chunk_¸ôiˇl
(
chunk
))

3582 
decodî
->
îr‹
 = 69;

3585 
unknown
 = 1;

3586 #ifde‡
LODEPNG_COMPILE_UNKNOWN_CHUNKS


3587 if(
decodî
->
£âögs
.
ªmembîUnknownChunks
)

3589 
LodePNG_UnknownChunks
* 
unknown
 = &
decodî
->
öfoPng
.
unknown_chunks
;

3590 
decodî
->
îr‹
 = 
	`LodePNG_≠≥nd_chunk
(&
unknown
->
d©a
[
¸ôiˇl_pos
 - 1], &unknown->
d©asize
[¸ôiˇl_po†- 1], 
chunk
);

3591 if(
decodî
->
îr‹
) ;

3596 if(!
decodî
->
£âögs
.
ign‹eCrc
 && !
unknown
)

3598 if(
	`LodePNG_chunk_check_¸c
(
chunk
))

3600 
decodî
->
îr‹
 = 57;

3605 if(!
IEND
Ë
chunk
 = 
	`LodePNG_chunk_√xt_c⁄°
(chunk);

3608 if(!
decodî
->
îr‹
)

3610 
ucve˘‹
 
sˇ∆öes
;

3611 
	`ucve˘‹_öô
(&
sˇ∆öes
);

3612 if(!
	`ucve˘‹_ªsize
(&
sˇ∆öes
, ((
decodî
->
öfoPng
.
width
 * (decodî->öfoPng.
height
 * 
	`LodePNG_InfoCﬁ‹_gëBµ
(&decodî->öfoPng.
cﬁ‹
Ë+ 7)Ë/ 8Ë+ decodî->öfoPng.height)Ëdecodî->
îr‹
 = 9945;

3613 if(!
decodî
->
îr‹
)

3615 
decodî
->
îr‹
 = 
	`LodePNG_decom¥ess
(&
sˇ∆öes
.
d©a
, &sˇ∆öes.
size
, 
id©
.d©a, id©.size, &decodî->
£âögs
.
zlib£âögs
);

3618 if(!
decodî
->
îr‹
)

3620 
ucve˘‹
 
outv
;

3621 
	`ucve˘‹_öô
(&
outv
);

3622 if(!
	`ucve˘‹_ªsizev
(&
outv
, (
decodî
->
öfoPng
.
height
 * decodî->öfoPng.
width
 * 
	`LodePNG_InfoCﬁ‹_gëBµ
(&decodî->öfoPng.
cﬁ‹
Ë+ 7Ë/ 8, 0)Ëdecodî->
îr‹
 = 9946;

3623 if(!
decodî
->
îr‹
Ëdecodî->îr‹ = 
	`po°Pro˚ssSˇ∆öes
(
outv
.
d©a
, 
sˇ∆öes
.d©a, &decodî->
öfoPng
);

3624 *
out
 = 
outv
.
d©a
;

3625 *
outsize
 = 
outv
.
size
;

3627 
	`ucve˘‹_˛ónup
(&
sˇ∆öes
);

3630 
	`ucve˘‹_˛ónup
(&
id©
);

3631 
	}
}

3633 
	$LodePNG_Decodî_decode
(
LodePNG_Decodî
* 
decodî
, ** 
out
, 
size_t
* 
outsize
, c⁄° * 
ö
, size_à
ösize
)

3635 *
out
 = 0;

3636 *
outsize
 = 0;

3637 
	`decodeGíîic
(
decodî
, 
out
, 
outsize
, 
ö
, 
ösize
);

3638 if(
decodî
->
îr‹
) ;

3639 if(!
decodî
->
£âögs
.
cﬁ‹_c⁄vît
 || 
	`LodePNG_InfoCﬁ‹_equÆ
(&decodî->
öfoRaw
.
cﬁ‹
, &decodî->
öfoPng
.color))

3644 if(!
decodî
->
£âögs
.
cﬁ‹_c⁄vît
)

3646 
decodî
->
îr‹
 = 
	`LodePNG_InfoCﬁ‹_c›y
(&decodî->
öfoRaw
.
cﬁ‹
, &decodî->
öfoPng
.color);

3647 if(
decodî
->
îr‹
) ;

3653 * 
d©a
 = *
out
;

3656 if(!(
decodî
->
öfoRaw
.
cﬁ‹
.
cﬁ‹Ty≥
 =2 || decodî->öfoRaw.cﬁ‹.cﬁ‹Ty≥ =6Ë&& !(decodî->öfoRaw.cﬁ‹.
bôDïth
 == 8))

3658 
decodî
->
îr‹
 = 56;

3662 *
outsize
 = (
decodî
->
öfoPng
.
width
 * decodî->öfoPng.
height
 * 
	`LodePNG_InfoCﬁ‹_gëBµ
(&decodî->
öfoRaw
.
cﬁ‹
) + 7) / 8;

3663 *
out
 = (*)
	`mÆloc
(*
outsize
);

3664 if(!(*
out
))

3666 
decodî
->
îr‹
 = 9947;

3667 *
outsize
 = 0;

3669 
decodî
->
îr‹
 = 
	`LodePNG_c⁄vît
(*
out
, 
d©a
, &decodî->
öfoRaw
.
cﬁ‹
, &decodî->
öfoPng
.cﬁ‹, decodî->öfoPng.
width
, decodî->öfoPng.
height
);

3670 
	`‰ì
(
d©a
);

3672 
	}
}

3674 
	$LodePNG_decode
(** 
out
, * 
w
, * 
h
, c⁄° * 
ö
, 
size_t
 
ösize
, 
cﬁ‹Ty≥
, 
bôDïth
)

3676 
îr‹
;

3677 
size_t
 
dummy_size
;

3678 
LodePNG_Decodî
 
decodî
;

3679 
	`LodePNG_Decodî_öô
(&
decodî
);

3680 
decodî
.
öfoRaw
.
cﬁ‹
.
cﬁ‹Ty≥
 = colorType;

3681 
decodî
.
öfoRaw
.
cﬁ‹
.
bôDïth
 = bitDepth;

3682 
	`LodePNG_Decodî_decode
(&
decodî
, 
out
, &
dummy_size
, 
ö
, 
ösize
);

3683 
îr‹
 = 
decodî
.error;

3684 *
w
 = 
decodî
.
öfoPng
.
width
;

3685 *
h
 = 
decodî
.
öfoPng
.
height
;

3686 
	`LodePNG_Decodî_˛ónup
(&
decodî
);

3687  
îr‹
;

3688 
	}
}

3690 
	$LodePNG_decode32
(** 
out
, * 
w
, * 
h
, c⁄° * 
ö
, 
size_t
 
ösize
)

3692  
	`LodePNG_decode
(
out
, 
w
, 
h
, 
ö
, 
ösize
, 6, 8);

3693 
	}
}

3695 #ifde‡
LODEPNG_COMPILE_DISK


3696 
	$LodePNG_decode_fûe
(** 
out
, * 
w
, * 
h
, c⁄° * 
fûíame
, 
cﬁ‹Ty≥
, 
bôDïth
)

3698 * 
buf„r
;

3699 
size_t
 
buf„rsize
;

3700 
îr‹
;

3701 
îr‹
 = 
	`LodePNG_lﬂdFûe
(&
buf„r
, &
buf„rsize
, 
fûíame
);

3702 if(!
îr‹
Ëîr‹ = 
	`LodePNG_decode
(
out
, 
w
, 
h
, 
buf„r
, 
buf„rsize
, 
cﬁ‹Ty≥
, 
bôDïth
);

3703 
	`‰ì
(
buf„r
);

3704  
îr‹
;

3705 
	}
}

3707 
	$LodePNG_decode32_fûe
(** 
out
, * 
w
, * 
h
, c⁄° * 
fûíame
)

3709  
	`LodePNG_decode_fûe
(
out
, 
w
, 
h
, 
fûíame
, 6, 8);

3710 
	}
}

3713 
	$LodePNG_DecodeSëtögs_öô
(
LodePNG_DecodeSëtögs
* 
£âögs
)

3715 
£âögs
->
cﬁ‹_c⁄vît
 = 1;

3716 #ifde‡
LODEPNG_COMPILE_ANCILLARY_CHUNKS


3717 
£âögs
->
ªadTextChunks
 = 1;

3719 
£âögs
->
ign‹eCrc
 = 0;

3720 #ifde‡
LODEPNG_COMPILE_UNKNOWN_CHUNKS


3721 
£âögs
->
ªmembîUnknownChunks
 = 0;

3723 
	`LodeZlib_Decom¥essSëtögs_öô
(&
£âögs
->
zlib£âögs
);

3724 
	}
}

3726 
	$LodePNG_Decodî_öô
(
LodePNG_Decodî
* 
decodî
)

3728 
	`LodePNG_DecodeSëtögs_öô
(&
decodî
->
£âögs
);

3729 
	`LodePNG_InfoRaw_öô
(&
decodî
->
öfoRaw
);

3730 
	`LodePNG_InfoPng_öô
(&
decodî
->
öfoPng
);

3731 
decodî
->
îr‹
 = 1;

3732 
	}
}

3734 
	$LodePNG_Decodî_˛ónup
(
LodePNG_Decodî
* 
decodî
)

3736 
	`LodePNG_InfoRaw_˛ónup
(&
decodî
->
öfoRaw
);

3737 
	`LodePNG_InfoPng_˛ónup
(&
decodî
->
öfoPng
);

3738 
	}
}

3740 
	$LodePNG_Decodî_c›y
(
LodePNG_Decodî
* 
de°
, c⁄° LodePNG_Decodî* 
sour˚
)

3742 
	`LodePNG_Decodî_˛ónup
(
de°
);

3743 *
de°
 = *
sour˚
;

3744 
	`LodePNG_InfoRaw_öô
(&
de°
->
öfoRaw
);

3745 
	`LodePNG_InfoPng_öô
(&
de°
->
öfoPng
);

3746 
de°
->
îr‹
 = 
	`LodePNG_InfoRaw_c›y
(&de°->
öfoRaw
, &
sour˚
->infoRaw); if(dest->error) ;

3747 
de°
->
îr‹
 = 
	`LodePNG_InfoPng_c›y
(&de°->
öfoPng
, &
sour˚
->infoPng); if(dest->error) ;

3748 
	}
}

3752 #ifde‡
LODEPNG_COMPILE_ENCODER


3759 
	$addChunk
(
ucve˘‹
* 
out
, c⁄° * 
chunkName
, c⁄° * 
d©a
, 
size_t
 
Àngth
)

3761 
îr‹
 = 
	`LodePNG_¸óã_chunk
(&
out
->
d©a
, &out->
size
, ()
Àngth
, 
chunkName
, data);

3762 if(
îr‹
) Érror;

3763 
out
->
Ælocsize
 = out->
size
;

3765 
	}
}

3767 
	$wrôeSig«tuª
(
ucve˘‹
* 
out
)

3770 
	`ucve˘‹_push_back
(
out
, 137);

3771 
	`ucve˘‹_push_back
(
out
, 80);

3772 
	`ucve˘‹_push_back
(
out
, 78);

3773 
	`ucve˘‹_push_back
(
out
, 71);

3774 
	`ucve˘‹_push_back
(
out
, 13);

3775 
	`ucve˘‹_push_back
(
out
, 10);

3776 
	`ucve˘‹_push_back
(
out
, 26);

3777 
	`ucve˘‹_push_back
(
out
, 10);

3778 
	}
}

3780 
	$addChunk_IHDR
(
ucve˘‹
* 
out
, 
w
, 
h
, 
bôDïth
, 
cﬁ‹Ty≥
, 
öãæa˚Mëhod
)

3782 
îr‹
 = 0;

3783 
ucve˘‹
 
hódî
;

3784 
	`ucve˘‹_öô
(&
hódî
);

3786 
	`LodePNG_add32bôI¡
(&
hódî
, 
w
);

3787 
	`LodePNG_add32bôI¡
(&
hódî
, 
h
);

3788 
	`ucve˘‹_push_back
(&
hódî
, ()
bôDïth
);

3789 
	`ucve˘‹_push_back
(&
hódî
, ()
cﬁ‹Ty≥
);

3790 
	`ucve˘‹_push_back
(&
hódî
, 0);

3791 
	`ucve˘‹_push_back
(&
hódî
, 0);

3792 
	`ucve˘‹_push_back
(&
hódî
, 
öãæa˚Mëhod
);

3794 
îr‹
 = 
	`addChunk
(
out
, "IHDR", 
hódî
.
d©a
, hódî.
size
);

3795 
	`ucve˘‹_˛ónup
(&
hódî
);

3797  
îr‹
;

3798 
	}
}

3800 
	$addChunk_PLTE
(
ucve˘‹
* 
out
, c⁄° 
LodePNG_InfoCﬁ‹
* 
öfo
)

3802 
îr‹
 = 0;

3803 
size_t
 
i
;

3804 
ucve˘‹
 
PLTE
;

3805 
	`ucve˘‹_öô
(&
PLTE
);

3806 
i
 = 0; i < 
öfo
->
∑Àâesize
 * 4; i++)

3808 if(
i
 % 4 !3Ë
	`ucve˘‹_push_back
(&
PLTE
, 
öfo
->
∑Àâe
[i]);

3810 
îr‹
 = 
	`addChunk
(
out
, "PLTE", 
PLTE
.
d©a
, PLTE.
size
);

3811 
	`ucve˘‹_˛ónup
(&
PLTE
);

3813  
îr‹
;

3814 
	}
}

3816 
	$addChunk_tRNS
(
ucve˘‹
* 
out
, c⁄° 
LodePNG_InfoCﬁ‹
* 
öfo
)

3818 
îr‹
 = 0;

3819 
size_t
 
i
;

3820 
ucve˘‹
 
tRNS
;

3821 
	`ucve˘‹_öô
(&
tRNS
);

3822 if(
öfo
->
cﬁ‹Ty≥
 == 3)

3824 
i
 = 0; i < 
öfo
->
∑Àâesize
; i++Ë
	`ucve˘‹_push_back
(&
tRNS
, info->
∑Àâe
[4 * i + 3]);

3826 if(
öfo
->
cﬁ‹Ty≥
 == 0)

3828 if(
öfo
->
key_deföed
)

3830 
	`ucve˘‹_push_back
(&
tRNS
, ()(
öfo
->
key_r
 / 256));

3831 
	`ucve˘‹_push_back
(&
tRNS
, ()(
öfo
->
key_r
 % 256));

3834 if(
öfo
->
cﬁ‹Ty≥
 == 2)

3836 if(
öfo
->
key_deföed
)

3838 
	`ucve˘‹_push_back
(&
tRNS
, ()(
öfo
->
key_r
 / 256));

3839 
	`ucve˘‹_push_back
(&
tRNS
, ()(
öfo
->
key_r
 % 256));

3840 
	`ucve˘‹_push_back
(&
tRNS
, ()(
öfo
->
key_g
 / 256));

3841 
	`ucve˘‹_push_back
(&
tRNS
, ()(
öfo
->
key_g
 % 256));

3842 
	`ucve˘‹_push_back
(&
tRNS
, ()(
öfo
->
key_b
 / 256));

3843 
	`ucve˘‹_push_back
(&
tRNS
, ()(
öfo
->
key_b
 % 256));

3847 
îr‹
 = 
	`addChunk
(
out
, "tRNS", 
tRNS
.
d©a
,ÅRNS.
size
);

3848 
	`ucve˘‹_˛ónup
(&
tRNS
);

3850  
îr‹
;

3851 
	}
}

3853 
	$addChunk_IDAT
(
ucve˘‹
* 
out
, c⁄° * 
d©a
, 
size_t
 
d©asize
, 
LodeZlib_Com¥essSëtögs
* 
zlib£âögs
)

3855 
ucve˘‹
 
zlibd©a
;

3856 
îr‹
 = 0;

3859 
	`ucve˘‹_öô
(&
zlibd©a
);

3860 
îr‹
 = 
	`LodePNG_com¥ess
(&
zlibd©a
.
d©a
, &zlibd©a.
size
, d©a, 
d©asize
, 
zlib£âögs
);

3861 if(!
îr‹
Ëîr‹ = 
	`addChunk
(
out
, "IDAT", 
zlibd©a
.
d©a
, zlibd©a.
size
);

3862 
	`ucve˘‹_˛ónup
(&
zlibd©a
);

3864  
îr‹
;

3865 
	}
}

3867 
	$addChunk_IEND
(
ucve˘‹
* 
out
)

3869 
îr‹
 = 0;

3870 
îr‹
 = 
	`addChunk
(
out
, "IEND", 0, 0);

3871  
îr‹
;

3872 
	}
}

3874 #ifde‡
LODEPNG_COMPILE_ANCILLARY_CHUNKS


3876 
	$addChunk_tEXt
(
ucve˘‹
* 
out
, c⁄° * 
keyw‹d
, c⁄° * 
ãxt°rög
)

3878 
îr‹
 = 0;

3879 
size_t
 
i
;

3880 
ucve˘‹
 
ãxt
;

3881 
	`ucve˘‹_öô
(&
ãxt
);

3882 
i
 = 0; 
keyw‹d
[i] !0; i++Ë
	`ucve˘‹_push_back
(&
ãxt
, ()keyword[i]);

3883 
	`ucve˘‹_push_back
(&
ãxt
, 0);

3884 
i
 = 0; 
ãxt°rög
[i] !0; i++Ë
	`ucve˘‹_push_back
(&
ãxt
, ()textstring[i]);

3885 
îr‹
 = 
	`addChunk
(
out
, "tEXt", 
ãxt
.
d©a
,Åext.
size
);

3886 
	`ucve˘‹_˛ónup
(&
ãxt
);

3888  
îr‹
;

3889 
	}
}

3891 
	$addChunk_zTXt
(
ucve˘‹
* 
out
, c⁄° * 
keyw‹d
, c⁄° * 
ãxt°rög
, 
LodeZlib_Com¥essSëtögs
* 
zlib£âögs
)

3893 
îr‹
 = 0;

3894 
ucve˘‹
 
d©a
, 
com¥es£d
;

3895 
size_t
 
i
, 
ãxtsize
 = 
	`°æí
(
ãxt°rög
);

3897 
	`ucve˘‹_öô
(&
d©a
);

3898 
	`ucve˘‹_öô
(&
com¥es£d
);

3899 
i
 = 0; 
keyw‹d
[i] !0; i++Ë
	`ucve˘‹_push_back
(&
d©a
, ()keyword[i]);

3900 
	`ucve˘‹_push_back
(&
d©a
, 0);

3901 
	`ucve˘‹_push_back
(&
d©a
, 0);

3903 
îr‹
 = 
	`LodePNG_com¥ess
(&
com¥es£d
.
d©a
, &com¥es£d.
size
, (*)
ãxt°rög
, 
ãxtsize
, 
zlib£âögs
);

3904 if(!
îr‹
)

3906 
i
 = 0; i < 
com¥es£d
.
size
; i++Ë
	`ucve˘‹_push_back
(&
d©a
, compressed.data[i]);

3907 
îr‹
 = 
	`addChunk
(
out
, "zTXt", 
d©a
.d©a, d©a.
size
);

3910 
	`ucve˘‹_˛ónup
(&
com¥es£d
);

3911 
	`ucve˘‹_˛ónup
(&
d©a
);

3912  
îr‹
;

3913 
	}
}

3915 
	$addChunk_iTXt
(
ucve˘‹
* 
out
, 
com¥es£d
, c⁄° * 
keyw‹d
, c⁄° * 
œngèg
, c⁄° * 
å™skey
, c⁄° * 
ãxt°rög
, 
LodeZlib_Com¥essSëtögs
* 
zlib£âögs
)

3917 
îr‹
 = 0;

3918 
ucve˘‹
 
d©a
, 
com¥es£d_d©a
;

3919 
size_t
 
i
, 
ãxtsize
 = 
	`°æí
(
ãxt°rög
);

3921 
	`ucve˘‹_öô
(&
d©a
);

3923 
i
 = 0; 
keyw‹d
[i] !0; i++Ë
	`ucve˘‹_push_back
(&
d©a
, ()keyword[i]);

3924 
	`ucve˘‹_push_back
(&
d©a
, 0);

3925 
	`ucve˘‹_push_back
(&
d©a
, 
com¥es£d
 ? 1 : 0);

3926 
	`ucve˘‹_push_back
(&
d©a
, 0);

3927 
i
 = 0; 
œngèg
[i] !0; i++Ë
	`ucve˘‹_push_back
(&
d©a
, ()langtag[i]);

3928 
	`ucve˘‹_push_back
(&
d©a
, 0);

3929 
i
 = 0; 
å™skey
[i] !0; i++Ë
	`ucve˘‹_push_back
(&
d©a
, ()transkey[i]);

3930 
	`ucve˘‹_push_back
(&
d©a
, 0);

3932 if(
com¥es£d
)

3934 
	`ucve˘‹_öô
(&
com¥es£d_d©a
);

3935 
îr‹
 = 
	`LodePNG_com¥ess
(&
com¥es£d_d©a
.
d©a
, &com¥es£d_d©a.
size
, (*)
ãxt°rög
, 
ãxtsize
, 
zlib£âögs
);

3936 if(!
îr‹
)

3938 
i
 = 0; i < 
com¥es£d_d©a
.
size
; i++Ë
	`ucve˘‹_push_back
(&
d©a
, compressed_data.data[i]);

3939 
i
 = 0; 
ãxt°rög
[i] !0; i++Ë
	`ucve˘‹_push_back
(&
d©a
, ()textstring[i]);

3944 
i
 = 0; 
ãxt°rög
[i] !0; i++Ë
	`ucve˘‹_push_back
(&
d©a
, ()textstring[i]);

3947 if(!
îr‹
Ëîr‹ = 
	`addChunk
(
out
, "iTXt", 
d©a
.d©a, d©a.
size
);

3948 
	`ucve˘‹_˛ónup
(&
d©a
);

3949  
îr‹
;

3950 
	}
}

3952 
	$addChunk_bKGD
(
ucve˘‹
* 
out
, c⁄° 
LodePNG_InfoPng
* 
öfo
)

3954 
îr‹
 = 0;

3955 
ucve˘‹
 
bKGD
;

3956 
	`ucve˘‹_öô
(&
bKGD
);

3957 if(
öfo
->
cﬁ‹
.
cﬁ‹Ty≥
 == 0 || info->color.colorType == 4)

3959 
	`ucve˘‹_push_back
(&
bKGD
, ()(
öfo
->
background_r
 / 256));

3960 
	`ucve˘‹_push_back
(&
bKGD
, ()(
öfo
->
background_r
 % 256));

3962 if(
öfo
->
cﬁ‹
.
cﬁ‹Ty≥
 == 2 || info->color.colorType == 6)

3964 
	`ucve˘‹_push_back
(&
bKGD
, ()(
öfo
->
background_r
 / 256));

3965 
	`ucve˘‹_push_back
(&
bKGD
, ()(
öfo
->
background_r
 % 256));

3966 
	`ucve˘‹_push_back
(&
bKGD
, ()(
öfo
->
background_g
 / 256));

3967 
	`ucve˘‹_push_back
(&
bKGD
, ()(
öfo
->
background_g
 % 256));

3968 
	`ucve˘‹_push_back
(&
bKGD
, ()(
öfo
->
background_b
 / 256));

3969 
	`ucve˘‹_push_back
(&
bKGD
, ()(
öfo
->
background_b
 % 256));

3971 if(
öfo
->
cﬁ‹
.
cﬁ‹Ty≥
 == 3)

3973 
	`ucve˘‹_push_back
(&
bKGD
, ()(
öfo
->
background_r
 % 256));

3976 
îr‹
 = 
	`addChunk
(
out
, "bKGD", 
bKGD
.
d©a
, bKGD.
size
);

3977 
	`ucve˘‹_˛ónup
(&
bKGD
);

3979  
îr‹
;

3980 
	}
}

3982 
	$addChunk_tIME
(
ucve˘‹
* 
out
, c⁄° 
LodePNG_Time
* 
time
)

3984 
îr‹
 = 0;

3985 * 
d©a
 = (*)
	`mÆloc
(7);

3986 if(!
d©a
)  9948;

3987 
d©a
[0] = ()(
time
->
yór
 / 256);

3988 
d©a
[1] = ()(
time
->
yór
 % 256);

3989 
d©a
[2] = 
time
->
m⁄th
;

3990 
d©a
[3] = 
time
->
day
;

3991 
d©a
[4] = 
time
->
hour
;

3992 
d©a
[5] = 
time
->
möuã
;

3993 
d©a
[6] = 
time
->
£c⁄d
;

3994 
îr‹
 = 
	`addChunk
(
out
, "tIME", 
d©a
, 7);

3995 
	`‰ì
(
d©a
);

3996  
îr‹
;

3997 
	}
}

3999 
	$addChunk_pHYs
(
ucve˘‹
* 
out
, c⁄° 
LodePNG_InfoPng
* 
öfo
)

4001 
îr‹
 = 0;

4002 
ucve˘‹
 
d©a
;

4003 
	`ucve˘‹_öô
(&
d©a
);

4005 
	`LodePNG_add32bôI¡
(&
d©a
, 
öfo
->
phys_x
);

4006 
	`LodePNG_add32bôI¡
(&
d©a
, 
öfo
->
phys_y
);

4007 
	`ucve˘‹_push_back
(&
d©a
, 
öfo
->
phys_unô
);

4009 
îr‹
 = 
	`addChunk
(
out
, "pHYs", 
d©a
.d©a, d©a.
size
);

4010 
	`ucve˘‹_˛ónup
(&
d©a
);

4012  
îr‹
;

4013 
	}
}

4017 
	$fûãrSˇ∆öe
(* 
out
, c⁄° * 
sˇ∆öe
, c⁄° * 
¥evlöe
, 
size_t
 
Àngth
, size_à
byãwidth
, 
fûãrTy≥
)

4019 
size_t
 
i
;

4020 
fûãrTy≥
)

4023 
i
 = 0; i < 
Àngth
; i++Ë
out
[i] = 
sˇ∆öe
[i];

4026 if(
¥evlöe
)

4028 
i
 = 0; i < 
byãwidth
; i++Ë
out
[i] = 
sˇ∆öe
[i];

4029 
i
 = 
byãwidth
; i < 
Àngth
 ; i++Ë
out
[i] = 
sˇ∆öe
[i] - scanline[i - bytewidth];

4033 
i
 = 0; i < 
byãwidth
; i++Ë
out
[i] = 
sˇ∆öe
[i];

4034 
i
 = 
byãwidth
; i < 
Àngth
; i++Ë
out
[i] = 
sˇ∆öe
[i] - scanline[i - bytewidth];

4038 if(
¥evlöe
)

4040 
i
 = 0; i < 
Àngth
; i++Ë
out
[i] = 
sˇ∆öe
[i] - 
¥evlöe
[i];

4044 
i
 = 0; i < 
Àngth
; i++Ë
out
[i] = 
sˇ∆öe
[i];

4048 if(
¥evlöe
)

4050 
i
 = 0; i < 
byãwidth
; i++Ë
out
[i] = 
sˇ∆öe
[i] - 
¥evlöe
[i] / 2;

4051 
i
 = 
byãwidth
; i < 
Àngth
; i++Ë
out
[i] = 
sˇ∆öe
[i] - ((sˇ∆öe[ò- byãwidth] + 
¥evlöe
[i]) / 2);

4055 
i
 = 0; i < 
byãwidth
; i++Ë
out
[i] = 
sˇ∆öe
[i];

4056 
i
 = 
byãwidth
; i < 
Àngth
; i++Ë
out
[i] = 
sˇ∆öe
[i] - scanline[i - bytewidth] / 2;

4060 if(
¥evlöe
)

4062 
i
 = 0; i < 
byãwidth
; i++Ë
out
[i] = (
sˇ∆öe
[i] - 
¥evlöe
[i]);

4063 
i
 = 
byãwidth
; i < 
Àngth
; i++Ë
out
[i] = (
sˇ∆öe
[i] - 
	`∑ëhPªdi˘‹
(sˇ∆öe[ò- byãwidth], 
¥evlöe
[i],Örevline[i - bytewidth]));

4067 
i
 = 0; i < 
byãwidth
; i++Ë
out
[i] = 
sˇ∆öe
[i];

4068 
i
 = 
byãwidth
; i < 
Àngth
; i++Ë
out
[i] = (
sˇ∆öe
[i] - scanline[i - bytewidth]);

4073 
	}
}

4075 
	$fûãr
(* 
out
, c⁄° * 
ö
, 
w
, 
h
, c⁄° 
LodePNG_InfoCﬁ‹
* 
öfo
)

4088 
bµ
 = 
	`LodePNG_InfoCﬁ‹_gëBµ
(
öfo
);

4089 
size_t
 
löebyãs
 = (
w
 * 
bµ
 + 7) / 8;

4090 
size_t
 
byãwidth
 = (
bµ
 + 7) / 8;

4091 c⁄° * 
¥evlöe
 = 0;

4092 
x
, 
y
;

4093 
heuri°ic
;

4094 
îr‹
 = 0;

4096 if(
bµ
 == 0)  31;

4099 if(
öfo
->
cﬁ‹Ty≥
 =3 || info->
bôDïth
 < 8Ë
heuri°ic
 = 0;

4100 
heuri°ic
 = 1;

4102 if(
heuri°ic
 == 0)

4104 
y
 = 0; y < 
h
; y++)

4106 
size_t
 
outödex
 = (1 + 
löebyãs
Ë* 
y
;

4107 
size_t
 
öödex
 = 
löebyãs
 * 
y
;

4108 c⁄° 
TYPE
 = 0;

4109 
out
[
outödex
] = 
TYPE
;

4110 
	`fûãrSˇ∆öe
(&
out
[
outödex
 + 1], &
ö
[
öödex
], 
¥evlöe
, 
löebyãs
, 
byãwidth
, 
TYPE
);

4111 
¥evlöe
 = &
ö
[
öödex
];

4114 if(
heuri°ic
 == 1)

4116 
size_t
 
sum
[5];

4117 
ucve˘‹
 
©ãm±
[5];

4118 
size_t
 
smÆÀ°
 = 0;

4119 
ty≥
, 
be°Ty≥
 = 0;

4121 
ty≥
 = 0;Åy≥ < 5;Åy≥++Ë
	`ucve˘‹_öô
(&
©ãm±
[type]);

4122 
ty≥
 = 0;Åype < 5;Åype++)

4124 if(!
	`ucve˘‹_ªsize
(&
©ãm±
[
ty≥
], 
löebyãs
))

4126 
îr‹
 = 9949;

4131 if(!
îr‹
)

4133 
y
 = 0; y < 
h
; y++)

4136 
ty≥
 = 0;Åype < 5;Åype++)

4138 
	`fûãrSˇ∆öe
(
©ãm±
[
ty≥
].
d©a
, &
ö
[
y
 * 
löebyãs
], 
¥evlöe
,Üöebyãs, 
byãwidth
,Åype);

4141 
sum
[
ty≥
] = 0;

4142 
x
 = 0; x < 
©ãm±
[
ty≥
].
size
; x+=3Ë
sum
[ty≥] +©ãm±[ty≥].
d©a
[x];

4145 if(
ty≥
 =0 || 
sum
[ty≥] < 
smÆÀ°
)

4147 
be°Ty≥
 = 
ty≥
;

4148 
smÆÀ°
 = 
sum
[
ty≥
];

4152 
¥evlöe
 = &
ö
[
y
 * 
löebyãs
];

4155 
out
[
y
 * (
löebyãs
 + 1)] = 
be°Ty≥
;

4156 
x
 = 0; x < 
löebyãs
; x++Ë
out
[
y
 * (löebyã†+ 1Ë+ 1 + x] = 
©ãm±
[
be°Ty≥
].
d©a
[x];

4160 
ty≥
 = 0;Åy≥ < 5;Åy≥++Ë
	`ucve˘‹_˛ónup
(&
©ãm±
[type]);

4163 if(
heuri°ic
 == 2)

4165 
size_t
 
size
[5];

4166 
ucve˘‹
 
©ãm±
[5];

4167 
size_t
 
smÆÀ°
;

4168 
ty≥
 = 0, 
be°Ty≥
 = 0;

4169 * 
dummy
;

4170 
LodeZlib_Com¥essSëtögs
 
deÊ©e£âögs
 = 
LodeZlib_deÁu…Com¥essSëtögs
;

4171 
deÊ©e£âögs
.
bty≥
 = 1;

4172 
ty≥
 = 0;Åype < 5;Åype++)

4174 
	`ucve˘‹_öô
(&
©ãm±
[
ty≥
]);

4175 
	`ucve˘‹_ªsize
(&
©ãm±
[
ty≥
], 
löebyãs
);

4177 
y
 = 0; y < 
h
; y++)

4179 
ty≥
 = 0;Åype < 5;Åype++)

4181 
	`fûãrSˇ∆öe
(
©ãm±
[
ty≥
].
d©a
, &
ö
[
y
 * 
löebyãs
], 
¥evlöe
,Üöebyãs, 
byãwidth
,Åype);

4182 
size
[
ty≥
] = 0;

4183 
dummy
 = 0;

4184 
	`LodePNG_com¥ess
(&
dummy
, &
size
[
ty≥
], 
©ãm±
[ty≥].
d©a
,áâem±[ty≥].size, &
deÊ©e£âögs
);

4185 
	`‰ì
(
dummy
);

4187 if(
ty≥
 =0 || 
size
[ty≥] < 
smÆÀ°
)

4189 
be°Ty≥
 = 
ty≥
;

4190 
smÆÀ°
 = 
size
[
ty≥
];

4193 
¥evlöe
 = &
ö
[
y
 * 
löebyãs
];

4194 
out
[
y
 * (
löebyãs
 + 1)] = 
be°Ty≥
;

4195 
x
 = 0; x < 
löebyãs
; x++Ë
out
[
y
 * (löebyã†+ 1Ë+ 1 + x] = 
©ãm±
[
be°Ty≥
].
d©a
[x];

4197 
ty≥
 = 0;Åy≥ < 5;Åy≥++Ë
	`ucve˘‹_˛ónup
(&
©ãm±
[type]);

4201  
îr‹
;

4202 
	}
}

4204 
	$addPaddögBôs
(* 
out
, c⁄° * 
ö
, 
size_t
 
ﬁöebôs
, size_à
ûöebôs
, 
h
)

4208 
y
;

4209 
size_t
 
diff
 = 
ﬁöebôs
 - 
ûöebôs
;

4210 
size_t
 
obp
 = 0, 
ibp
 = 0;

4211 
y
 = 0; y < 
h
; y++)

4213 
size_t
 
x
;

4214 
x
 = 0; x < 
ûöebôs
; x++)

4216 
bô
 = 
	`ªadBôFromRevî£dSåóm
(&
ibp
, 
ö
);

4217 
	`£tBôOfRevî£dSåóm
(&
obp
, 
out
, 
bô
);

4220 
x
 = 0; x < 
diff
; x++Ë
	`£tBôOfRevî£dSåóm
(&
obp
, 
out
, 0);

4222 
	}
}

4224 
	$Adam7_öãæa˚
(* 
out
, c⁄° * 
ö
, 
w
, 
h
, 
bµ
)

4227 
∑ssw
[7], 
∑ssh
[7];

4228 
size_t
 
fûãr_∑ss°¨t
[8], 
∑dded_∑ss°¨t
[8], 
∑ss°¨t
[8];

4229 
i
;

4231 
	`Adam7_gë∑ssvÆues
(
∑ssw
, 
∑ssh
, 
fûãr_∑ss°¨t
, 
∑dded_∑ss°¨t
, 
∑ss°¨t
, 
w
, 
h
, 
bµ
);

4233 if(
bµ
 >= 8)

4235 
i
 = 0; i < 7; i++)

4237 
x
, 
y
, 
b
;

4238 
size_t
 
byãwidth
 = 
bµ
 / 8;

4239 
y
 = 0; y < 
∑ssh
[
i
]; y++)

4240 
x
 = 0; x < 
∑ssw
[
i
]; x++)

4242 
size_t
 
pixñö°¨t
 = ((
ADAM7_IY
[
i
] + 
y
 * 
ADAM7_DY
[i]Ë* 
w
 + 
ADAM7_IX
[i] + 
x
 * 
ADAM7_DX
[i]Ë* 
byãwidth
;

4243 
size_t
 
pixñout°¨t
 = 
∑ss°¨t
[
i
] + (
y
 * 
∑ssw
[i] + 
x
Ë* 
byãwidth
;

4244 
b
 = 0; b < 
byãwidth
; b++)

4246 
out
[
pixñout°¨t
 + 
b
] = 
ö
[
pixñö°¨t
 + b];

4253 
i
 = 0; i < 7; i++)

4255 
x
, 
y
, 
b
;

4256 
ûöebôs
 = 
bµ
 * 
∑ssw
[
i
];

4257 
ﬁöebôs
 = 
bµ
 * 
w
;

4258 
size_t
 
obp
, 
ibp
;

4259 
y
 = 0; y < 
∑ssh
[
i
]; y++)

4260 
x
 = 0; x < 
∑ssw
[
i
]; x++)

4262 
ibp
 = (
ADAM7_IY
[
i
] + 
y
 * 
ADAM7_DY
[i]Ë* 
ﬁöebôs
 + (
ADAM7_IX
[i] + 
x
 * 
ADAM7_DX
[i]Ë* 
bµ
;

4263 
obp
 = (8 * 
∑ss°¨t
[
i
]Ë+ (
y
 * 
ûöebôs
 + 
x
 * 
bµ
);

4264 
b
 = 0; b < 
bµ
; b++)

4266 
bô
 = 
	`ªadBôFromRevî£dSåóm
(&
ibp
, 
ö
);

4267 
	`£tBôOfRevî£dSåóm
(&
obp
, 
out
, 
bô
);

4272 
	}
}

4275 
	$¥ePro˚ssSˇ∆öes
(** 
out
, 
size_t
* 
outsize
, c⁄° * 
ö
, c⁄° 
LodePNG_InfoPng
* 
öfoPng
)

4282 
bµ
 = 
	`LodePNG_InfoCﬁ‹_gëBµ
(&
öfoPng
->
cﬁ‹
);

4283 
w
 = 
öfoPng
->
width
;

4284 
h
 = 
öfoPng
->
height
;

4285 
îr‹
 = 0;

4287 if(
öfoPng
->
öãæa˚Mëhod
 == 0)

4289 *
outsize
 = 
h
 + (h * ((
w
 * 
bµ
 + 7) / 8));

4290 *
out
 = (*)
	`mÆloc
(*
outsize
);

4291 if(!(*
out
Ë&& (*
outsize
)Ë
îr‹
 = 9950;

4293 if(!
îr‹
)

4295 if(
bµ
 < 8 && 
w
 * bpp != ((w * bpp + 7) / 8) * 8)

4297 
ucve˘‹
 
∑dded
;

4298 
	`ucve˘‹_öô
(&
∑dded
);

4299 if(!
	`ucve˘‹_ªsize
(&
∑dded
, 
h
 * ((
w
 * 
bµ
 + 7Ë/ 8))Ë
îr‹
 = 9951;

4300 if(!
îr‹
)

4302 
	`addPaddögBôs
(
∑dded
.
d©a
, 
ö
, ((
w
 * 
bµ
 + 7Ë/ 8Ë* 8, w * bµ, 
h
);

4303 
îr‹
 = 
	`fûãr
(*
out
, 
∑dded
.
d©a
, 
w
, 
h
, &
öfoPng
->
cﬁ‹
);

4305 
	`ucve˘‹_˛ónup
(&
∑dded
);

4307 
îr‹
 = 
	`fûãr
(*
out
, 
ö
, 
w
, 
h
, &
öfoPng
->
cﬁ‹
);

4312 * 
adam7
 = (*)
	`mÆloc
((
h
 * 
w
 * 
bµ
 + 7) / 8);

4313 if(!
adam7
 && ((
h
 * 
w
 * 
bµ
 + 7Ë/ 8)Ë
îr‹
 = 9952;

4315 !
îr‹
)

4317 
∑ssw
[7], 
∑ssh
[7];

4318 
size_t
 
fûãr_∑ss°¨t
[8], 
∑dded_∑ss°¨t
[8], 
∑ss°¨t
[8];

4319 
i
;

4321 
	`Adam7_gë∑ssvÆues
(
∑ssw
, 
∑ssh
, 
fûãr_∑ss°¨t
, 
∑dded_∑ss°¨t
, 
∑ss°¨t
, 
w
, 
h
, 
bµ
);

4323 *
outsize
 = 
fûãr_∑ss°¨t
[7];

4324 *
out
 = (*)
	`mÆloc
(*
outsize
);

4325 if(!(*
out
Ë&& (*
outsize
))

4327 
îr‹
 = 9953;

4331 
	`Adam7_öãæa˚
(
adam7
, 
ö
, 
w
, 
h
, 
bµ
);

4333 
i
 = 0; i < 7; i++)

4335 if(
bµ
 < 8)

4337 
ucve˘‹
 
∑dded
;

4338 
	`ucve˘‹_öô
(&
∑dded
);

4339 if(!
	`ucve˘‹_ªsize
(&
∑dded
, 
h
 * ((
w
 * 
bµ
 + 7Ë/ 8))Ë
îr‹
 = 9954;

4340 if(!
îr‹
)

4342 
	`addPaddögBôs
(&
∑dded
.
d©a
[
∑dded_∑ss°¨t
[
i
]], &
adam7
[
∑ss°¨t
[i]], ((
∑ssw
[i] * 
bµ
 + 7Ë/ 8Ë* 8,Öassw[i] * bµ, 
∑ssh
[i]);

4343 
îr‹
 = 
	`fûãr
(&(*
out
)[
fûãr_∑ss°¨t
[
i
]], &
∑dded
.
d©a
[
∑dded_∑ss°¨t
[i]], 
∑ssw
[i], 
∑ssh
[i], &
öfoPng
->
cﬁ‹
);

4346 
	`ucve˘‹_˛ónup
(&
∑dded
);

4350 
îr‹
 = 
	`fûãr
(&(*
out
)[
fûãr_∑ss°¨t
[
i
]], &
adam7
[
∑dded_∑ss°¨t
[i]], 
∑ssw
[i], 
∑ssh
[i], &
öfoPng
->
cﬁ‹
);

4357 
	`‰ì
(
adam7
);

4360  
îr‹
;

4361 
	}
}

4364 
	$isPÆëãFuŒyO∑que
(c⁄° * 
∑Àâe
, 
size_t
 
∑Àâesize
)

4366 
size_t
 
i
;

4367 
i
 = 0; i < 
∑Àâesize
; i++)

4369 if(
∑Àâe
[4 * 
i
 + 3] != 255)  0;

4372 
	}
}

4375 
	$isFuŒyO∑que
(c⁄° * 
image
, 
w
, 
h
, c⁄° 
LodePNG_InfoCﬁ‹
* 
öfo
)

4379 
i
, 
numpixñs
 = 
w
 * 
h
;

4380 if(
öfo
->
cﬁ‹Ty≥
 == 6)

4382 if(
öfo
->
bôDïth
 == 8)

4384 
i
 = 0; i < 
numpixñs
; i++)

4386 if(
image
[
i
 * 4 + 3] != 255)  0;

4391 
i
 = 0; i < 
numpixñs
; i++)

4393 if(
image
[
i
 * 8 + 6] != 255 || image[i * 8 + 7] != 255)  0;

4398 if(
öfo
->
cﬁ‹Ty≥
 == 4)

4400 if(
öfo
->
bôDïth
 == 8)

4402 
i
 = 0; i < 
numpixñs
; i++)

4404 if(
image
[
i
 * 2 + 1] != 255)  0;

4409 
i
 = 0; i < 
numpixñs
; i++)

4411 if(
image
[
i
 * 4 + 2] != 255 || image[i * 4 + 3] != 255)  0;

4416 if(
öfo
->
cﬁ‹Ty≥
 == 3)

4419 (
	`isPÆëãFuŒyO∑que
(
öfo
->
∑Àâe
, info->
∑Àâesize
));

4423 
	}
}

4425 #ifde‡
LODEPNG_COMPILE_UNKNOWN_CHUNKS


4426 
	$addUnknownChunks
(
ucve˘‹
* 
out
, * 
d©a
, 
size_t
 
d©asize
)

4428 * 
öchunk
 = 
d©a
;

4429 (
size_t
)(
öchunk
 - 
d©a
Ë< 
d©asize
)

4431 
îr‹
 = 
	`LodePNG_≠≥nd_chunk
(&
out
->
d©a
, &out->
size
, 
öchunk
);

4432 if(
îr‹
) Érror;

4433 
out
->
Ælocsize
 = out->
size
;

4434 
öchunk
 = 
	`LodePNG_chunk_√xt
(inchunk);

4437 
	}
}

4440 
	$LodePNG_Encodî_ícode
(
LodePNG_Encodî
* 
ícodî
, ** 
out
, 
size_t
* 
outsize
, c⁄° * 
image
, 
w
, 
h
)

4442 
LodePNG_InfoPng
 
öfo
;

4443 
ucve˘‹
 
outv
;

4444 * 
d©a
 = 0;

4445 
size_t
 
d©asize
 = 0;

4448 *
out
 = 0;

4449 *
outsize
 = 0;

4450 
ícodî
->
îr‹
 = 0;

4452 
öfo
 = 
ícodî
->
öfoPng
;

4453 
öfo
.
width
 = 
w
;

4454 
öfo
.
height
 = 
h
;

4456 if(
ícodî
->
£âögs
.
autoLóveOutAÕhaCh™√l
 && 
	`isFuŒyO∑que
(
image
, 
w
, 
h
, &ícodî->
öfoRaw
.
cﬁ‹
))

4459 if(
öfo
.
cﬁ‹
.
cﬁ‹Ty≥
 == 6) info.color.colorType = 2;

4460 if(
öfo
.
cﬁ‹
.
cﬁ‹Ty≥
 == 4) info.color.colorType = 0;

4463 if(
ícodî
->
£âögs
.
zlib£âögs
.
wödowSize
 > 32768)

4465 
ícodî
->
îr‹
 = 60;

4468 if(
ícodî
->
£âögs
.
zlib£âögs
.
bty≥
 > 2)

4470 
ícodî
->
îr‹
 = 61;

4473 if(
ícodî
->
öfoPng
.
öãæa˚Mëhod
 > 1)

4475 
ícodî
->
îr‹
 = 71;

4478 if((
ícodî
->
îr‹
 = 
	`checkCﬁ‹VÆidôy
(
öfo
.
cﬁ‹
.
cﬁ‹Ty≥
, info.cﬁ‹.
bôDïth
))) ;

4479 if((
ícodî
->
îr‹
 = 
	`checkCﬁ‹VÆidôy
”ncodî->
öfoRaw
.
cﬁ‹
.
cﬁ‹Ty≥
,Éncodî->öfoRaw.cﬁ‹.
bôDïth
))) ;

4481 if(!
	`LodePNG_InfoCﬁ‹_equÆ
(&
ícodî
->
öfoRaw
.
cﬁ‹
, &
öfo
.color))

4483 * 
c⁄vîãd
;

4484 
size_t
 
size
 = (
w
 * 
h
 * 
	`LodePNG_InfoCﬁ‹_gëBµ
(&
öfo
.
cﬁ‹
) + 7) / 8;

4486 if((
öfo
.
cﬁ‹
.
cﬁ‹Ty≥
 !6 && info.cﬁ‹.cﬁ‹Ty≥ !2Ë|| (öfo.cﬁ‹.
bôDïth
 != 8))

4488 
ícodî
->
îr‹
 = 59;

4491 
c⁄vîãd
 = (*)
	`mÆloc
(
size
);

4492 if(!
c⁄vîãd
 && 
size
Ë
ícodî
->
îr‹
 = 9955;

4493 if(!
ícodî
->
îr‹
Ëícodî->îr‹ = 
	`LodePNG_c⁄vît
(
c⁄vîãd
, 
image
, &
öfo
.
cﬁ‹
, &ícodî->
öfoRaw
.cﬁ‹, 
w
, 
h
);

4494 if(!
ícodî
->
îr‹
Ë
	`¥ePro˚ssSˇ∆öes
(&
d©a
, &
d©asize
, 
c⁄vîãd
, &
öfo
);

4495 
	`‰ì
(
c⁄vîãd
);

4497 
	`¥ePro˚ssSˇ∆öes
(&
d©a
, &
d©asize
, 
image
, &
öfo
);

4499 
	`ucve˘‹_öô
(&
outv
);

4500 !
ícodî
->
îr‹
)

4502 #ifde‡
LODEPNG_COMPILE_ANCILLARY_CHUNKS


4503 
size_t
 
i
;

4506 
	`wrôeSig«tuª
(&
outv
);

4508 
	`addChunk_IHDR
(&
outv
, 
w
, 
h
, 
öfo
.
cﬁ‹
.
bôDïth
, info.cﬁ‹.
cﬁ‹Ty≥
, info.
öãæa˚Mëhod
);

4509 #ifde‡
LODEPNG_COMPILE_UNKNOWN_CHUNKS


4511 if(
öfo
.
unknown_chunks
.
d©a
[0])

4513 
ícodî
->
îr‹
 = 
	`addUnknownChunks
(&
outv
, 
öfo
.
unknown_chunks
.
d©a
[0], info.unknown_chunks.
d©asize
[0]);

4514 if(
ícodî
->
îr‹
) ;

4518 if(
öfo
.
cﬁ‹
.
cﬁ‹Ty≥
 == 3)

4520 if(
öfo
.
cﬁ‹
.
∑Àâesize
 == 0 || info.color.palettesize > 256)

4522 
ícodî
->
îr‹
 = 68;

4525 
	`addChunk_PLTE
(&
outv
, &
öfo
.
cﬁ‹
);

4527 if(
ícodî
->
£âögs
.
f‹˚_∑Àâe
 && (
öfo
.
cﬁ‹
.
cﬁ‹Ty≥
 == 2 || info.color.colorType == 6))

4529 if(
öfo
.
cﬁ‹
.
∑Àâesize
 == 0 || info.color.palettesize > 256)

4531 
ícodî
->
îr‹
 = 68;

4534 
	`addChunk_PLTE
(&
outv
, &
öfo
.
cﬁ‹
);

4537 if(
öfo
.
cﬁ‹
.
cﬁ‹Ty≥
 =3 && !
	`isPÆëãFuŒyO∑que
(öfo.cﬁ‹.
∑Àâe
, info.cﬁ‹.
∑Àâesize
))

4539 
	`addChunk_tRNS
(&
outv
, &
öfo
.
cﬁ‹
);

4541 if((
öfo
.
cﬁ‹
.
cﬁ‹Ty≥
 =0 || info.cﬁ‹.cﬁ‹Ty≥ =2Ë&& info.cﬁ‹.
key_deföed
)

4543 
	`addChunk_tRNS
(&
outv
, &
öfo
.
cﬁ‹
);

4545 #ifde‡
LODEPNG_COMPILE_ANCILLARY_CHUNKS


4547 if(
öfo
.
background_deföed
Ë
	`addChunk_bKGD
(&
outv
, &info);

4549 if(
öfo
.
phys_deföed
Ë
	`addChunk_pHYs
(&
outv
, &info);

4551 #ifde‡
LODEPNG_COMPILE_UNKNOWN_CHUNKS


4553 if(
öfo
.
unknown_chunks
.
d©a
[1])

4555 
ícodî
->
îr‹
 = 
	`addUnknownChunks
(&
outv
, 
öfo
.
unknown_chunks
.
d©a
[1], info.unknown_chunks.
d©asize
[1]);

4556 if(
ícodî
->
îr‹
) ;

4560 
ícodî
->
îr‹
 = 
	`addChunk_IDAT
(&
outv
, 
d©a
, 
d©asize
, &ícodî->
£âögs
.
zlib£âögs
);

4561 if(
ícodî
->
îr‹
) ;

4562 #ifde‡
LODEPNG_COMPILE_ANCILLARY_CHUNKS


4564 if(
öfo
.
time_deföed
Ë
	`addChunk_tIME
(&
outv
, &öfo.
time
);

4566 
i
 = 0; i < 
öfo
.
ãxt
.
num
; i++)

4568 if(
	`°æí
(
öfo
.
ãxt
.
keys
[
i
]) > 79)

4570 
ícodî
->
îr‹
 = 66;

4573 if(
	`°æí
(
öfo
.
ãxt
.
keys
[
i
]) < 1)

4575 
ícodî
->
îr‹
 = 67;

4578 if(
ícodî
->
£âögs
.
ãxt_com¥essi⁄
)

4579 
	`addChunk_zTXt
(&
outv
, 
öfo
.
ãxt
.
keys
[
i
], info.ãxt.
°rögs
[i], &
ícodî
->
£âögs
.
zlib£âögs
);

4581 
	`addChunk_tEXt
(&
outv
, 
öfo
.
ãxt
.
keys
[
i
], info.ãxt.
°rögs
[i]);

4584 if(
ícodî
->
£âögs
.
add_id
)

4586 
Æªad_added_id_ãxt
 = 0;

4587 
i
 = 0; i < 
öfo
.
ãxt
.
num
; i++)

4589 if(!
	`°rcmp
(
öfo
.
ãxt
.
keys
[
i
], "LodePNG"))

4591 
Æªad_added_id_ãxt
 = 1;

4595 if(
Æªad_added_id_ãxt
 == 0)

4596 
	`addChunk_tEXt
(&
outv
, "LodePNG", 
VERSION_STRING
);

4599 
i
 = 0; i < 
öfo
.
ôext
.
num
; i++)

4601 if(
	`°æí
(
öfo
.
ôext
.
keys
[
i
]) > 79)

4603 
ícodî
->
îr‹
 = 66;

4606 if(
	`°æí
(
öfo
.
ôext
.
keys
[
i
]) < 1)

4608 
ícodî
->
îr‹
 = 67;

4611 
	`addChunk_iTXt
(&
outv
, 
ícodî
->
£âögs
.
ãxt_com¥essi⁄
,

4612 
öfo
.
ôext
.
keys
[
i
], info.ôext.
œngègs
[i], info.ôext.
å™skeys
[i], info.ôext.
°rögs
[i],

4613 &
ícodî
->
£âögs
.
zlib£âögs
);

4616 #ifde‡
LODEPNG_COMPILE_UNKNOWN_CHUNKS


4618 if(
öfo
.
unknown_chunks
.
d©a
[2])

4620 
ícodî
->
îr‹
 = 
	`addUnknownChunks
(&
outv
, 
öfo
.
unknown_chunks
.
d©a
[2], info.unknown_chunks.
d©asize
[2]);

4621 if(
ícodî
->
îr‹
) ;

4625 
	`addChunk_IEND
(&
outv
);

4630 
	`‰ì
(
d©a
);

4632 *
out
 = 
outv
.
d©a
;

4633 *
outsize
 = 
outv
.
size
;

4634 
	}
}

4636 
	$LodePNG_ícode
(** 
out
, 
size_t
* 
outsize
, c⁄° * 
image
, 
w
, 
h
, 
cﬁ‹Ty≥
, 
bôDïth
)

4638 
îr‹
;

4639 
LodePNG_Encodî
 
ícodî
;

4640 
	`LodePNG_Encodî_öô
(&
ícodî
);

4641 
ícodî
.
öfoRaw
.
cﬁ‹
.
cﬁ‹Ty≥
 = colorType;

4642 
ícodî
.
öfoRaw
.
cﬁ‹
.
bôDïth
 = bitDepth;

4643 
	`LodePNG_Encodî_ícode
(&
ícodî
, 
out
, 
outsize
, 
image
, 
w
, 
h
);

4644 
îr‹
 = 
ícodî
.error;

4645 
	`LodePNG_Encodî_˛ónup
(&
ícodî
);

4646  
îr‹
;

4647 
	}
}

4649 
	$LodePNG_ícode32
(** 
out
, 
size_t
* 
outsize
, c⁄° * 
image
, 
w
, 
h
)

4651  
	`LodePNG_ícode
(
out
, 
outsize
, 
image
, 
w
, 
h
, 6, 8);;

4652 
	}
}

4654 #ifde‡
LODEPNG_COMPILE_DISK


4655 
	$LodePNG_ícode_fûe
(c⁄° * 
fûíame
, c⁄° * 
image
, 
w
, 
h
, 
cﬁ‹Ty≥
, 
bôDïth
)

4657 * 
buf„r
;

4658 
size_t
 
buf„rsize
;

4659 
îr‹
 = 
	`LodePNG_ícode
(&
buf„r
, &
buf„rsize
, 
image
, 
w
, 
h
, 
cﬁ‹Ty≥
, 
bôDïth
);

4660 
	`LodePNG_ßveFûe
(
buf„r
, 
buf„rsize
, 
fûíame
);

4661 
	`‰ì
(
buf„r
);

4662  
îr‹
;

4663 
	}
}

4665 
	$LodePNG_ícode32_fûe
(c⁄° * 
fûíame
, c⁄° * 
image
, 
w
, 
h
)

4667  
	`LodePNG_ícode_fûe
(
fûíame
, 
image
, 
w
, 
h
, 6, 8);;

4668 
	}
}

4671 
	$LodePNG_EncodeSëtögs_öô
(
LodePNG_EncodeSëtögs
* 
£âögs
)

4673 
	`LodeZlib_Com¥essSëtögs_öô
(&
£âögs
->
zlib£âögs
);

4674 
£âögs
->
autoLóveOutAÕhaCh™√l
 = 1;

4675 
£âögs
->
f‹˚_∑Àâe
 = 0;

4676 #ifde‡
LODEPNG_COMPILE_ANCILLARY_CHUNKS


4677 
£âögs
->
add_id
 = 1;

4678 
£âögs
->
ãxt_com¥essi⁄
 = 0;

4680 
	}
}

4682 
	$LodePNG_Encodî_öô
(
LodePNG_Encodî
* 
ícodî
)

4684 
	`LodePNG_EncodeSëtögs_öô
(&
ícodî
->
£âögs
);

4685 
	`LodePNG_InfoPng_öô
(&
ícodî
->
öfoPng
);

4686 
	`LodePNG_InfoRaw_öô
(&
ícodî
->
öfoRaw
);

4687 
ícodî
->
îr‹
 = 1;

4688 
	}
}

4690 
	$LodePNG_Encodî_˛ónup
(
LodePNG_Encodî
* 
ícodî
)

4692 
	`LodePNG_InfoPng_˛ónup
(&
ícodî
->
öfoPng
);

4693 
	`LodePNG_InfoRaw_˛ónup
(&
ícodî
->
öfoRaw
);

4694 
	}
}

4696 
	$LodePNG_Encodî_c›y
(
LodePNG_Encodî
* 
de°
, c⁄° LodePNG_Encodî* 
sour˚
)

4698 
	`LodePNG_Encodî_˛ónup
(
de°
);

4699 *
de°
 = *
sour˚
;

4700 
	`LodePNG_InfoPng_öô
(&
de°
->
öfoPng
);

4701 
	`LodePNG_InfoRaw_öô
(&
de°
->
öfoRaw
);

4702 
de°
->
îr‹
 = 
	`LodePNG_InfoPng_c›y
(&de°->
öfoPng
, &
sour˚
->infoPng);

4703 if(
de°
->
îr‹
) ;

4704 
de°
->
îr‹
 = 
	`LodePNG_InfoRaw_c›y
(&de°->
öfoRaw
, &
sour˚
->infoRaw);

4705 if(
de°
->
îr‹
) ;

4706 
	}
}

4716 #ifde‡
LODEPNG_COMPILE_DISK


4718 
	$LodePNG_lﬂdFûe
(** 
out
, 
size_t
* 
outsize
, c⁄° * 
fûíame
)

4720 
FILE
* 
fûe
;

4721 
size
;

4724 *
out
 = 0;

4725 *
outsize
 = 0;

4727 
fûe
 = 
	`f›í
(
fûíame
, "rb");

4728 if(!
fûe
)  78;

4731 
	`f£ek
(
fûe
 , 0 , 
SEEK_END
);

4732 
size
 = 
	`·ñl
(
fûe
);

4733 
	`ªwöd
(
fûe
);

4736 *
outsize
 = 0;

4737 *
out
 = (*)
	`mÆloc
((
size_t
)
size
);

4738 if(
size
 && (*
out
)Ë(*
outsize
Ë
	`‰ód
(*out, 1, (
size_t
)size, 
fûe
);

4740 
	`f˛o£
(
fûe
);

4741 if(!(*
out
Ë&& 
size
)  80;

4743 
	}
}

4746 
	$LodePNG_ßveFûe
(c⁄° * 
buf„r
, 
size_t
 
buf„rsize
, c⁄° * 
fûíame
)

4748 
FILE
* 
fûe
;

4749 
fûe
 = 
	`f›í
(
fûíame
, "wb" );

4750 if(!
fûe
)  79;

4751 
	`fwrôe
((*)
buf„r
 , 1 , 
buf„rsize
, 
fûe
);

4752 
	`f˛o£
(
fûe
);

4754 
	}
}

4758 #ifde‡
LODEPNG_COMPILE_ERROR_TEXT


4764 c⁄° * 
	$LodePNG_îr‹_ãxt
(
code
)

4766 
code
)

4849 if(
code
 >= 9900 && code <= 9999)  "memoryállocation failed";

4852 
	}
}

4856 #ifde‡
__˝lu•lus


4860 #ifde‡
LODEPNG_COMPILE_ZLIB


4861 
«me•a˚
 
	gLodeZlib


4863 #ifde‡
LODEPNG_COMPILE_DECODER


4864 
decom¥ess
(
°d
::
ve˘‹
<>& 
out
, c⁄° * 
ö
, 
size_t
 
ösize
, c⁄° 
LodeZlib_Decom¥essSëtögs
& 
£âögs
)

4866 * 
	gbuf„r
 = 0;

4867 
size_t
 
	gbuf„rsize
 = 0;

4868 
	gîr‹
 = 
LodeZlib_decom¥ess
(&
buf„r
, &
buf„rsize
, 
ö
, 
ösize
, &
£âögs
);

4869 if(
	gbuf„r
)

4871 
	gout
.
ö£π
(
out
.
íd
(), &
buf„r
[0], &buf„r[
buf„rsize
]);

4872 
‰ì
(
buf„r
);

4874  
	gîr‹
;

4877 
decom¥ess
(
°d
::
ve˘‹
<>& 
out
, c⁄° std::ve˘‹<>& 
ö
, c⁄° 
LodeZlib_Decom¥essSëtögs
& 
£âögs
)

4879  
decom¥ess
(
out
, 
ö
.
em±y
(Ë? 0 : &ö[0], in.
size
(), 
£âögs
);

4882 #ifde‡
LODEPNG_COMPILE_ENCODER


4883 
com¥ess
(
°d
::
ve˘‹
<>& 
out
, c⁄° * 
ö
, 
size_t
 
ösize
, c⁄° 
LodeZlib_Com¥essSëtögs
& 
£âögs
)

4885 * 
	gbuf„r
 = 0;

4886 
size_t
 
	gbuf„rsize
 = 0;

4887 
	gîr‹
 = 
LodeZlib_com¥ess
(&
buf„r
, &
buf„rsize
, 
ö
, 
ösize
, &
£âögs
);

4888 if(
	gbuf„r
)

4890 
	gout
.
ö£π
(
out
.
íd
(), &
buf„r
[0], &buf„r[
buf„rsize
]);

4891 
‰ì
(
buf„r
);

4893  
	gîr‹
;

4896 
com¥ess
(
°d
::
ve˘‹
<>& 
out
, c⁄° std::ve˘‹<>& 
ö
, c⁄° 
LodeZlib_Com¥essSëtögs
& 
£âögs
)

4898  
com¥ess
(
out
, 
ö
.
em±y
(Ë? 0 : &ö[0], in.
size
(), 
£âögs
);

4904 #ifde‡
LODEPNG_COMPILE_PNG


4905 
«me•a˚
 
	gLodePNG


4907 #ifde‡
LODEPNG_COMPILE_DECODER


4908 
	gDecodî
::
Decodî
()

4910 
LodePNG_Decodî_öô
(
this
);

4913 
	gDecodî
::~
Decodî
()

4915 
LodePNG_Decodî_˛ónup
(
this
);

4918 
	gDecodî
::
›î©‹
=(c⁄° 
LodePNG_Decodî
& 
Ÿhî
)

4920 
LodePNG_Decodî_c›y
(
this
, &
Ÿhî
);

4923 
boﬁ
 
	gDecodî
::
hasEº‹
() const

4925  
îr‹
 != 0;

4927 
	gDecodî
::
gëEº‹
() const

4929  
îr‹
;

4932 
	gDecodî
::
gëWidth
() const

4934  
öfoPng
.
width
;

4937 
	gDecodî
::
gëHeight
() const

4939  
öfoPng
.
height
;

4942 
	gDecodî
::
gëBµ
()

4944  
LodePNG_InfoCﬁ‹_gëBµ
(&
öfoPng
.
cﬁ‹
);

4947 
	gDecodî
::
gëCh™√ls
()

4949  
LodePNG_InfoCﬁ‹_gëCh™√ls
(&
öfoPng
.
cﬁ‹
);

4952 
	gDecodî
::
isGªysˇÀTy≥
()

4954  
LodePNG_InfoCﬁ‹_isGªysˇÀTy≥
(&
öfoPng
.
cﬁ‹
);

4957 
	gDecodî
::
isAÕhaTy≥
()

4959  
LodePNG_InfoCﬁ‹_isAÕhaTy≥
(&
öfoPng
.
cﬁ‹
);

4962 
	gDecodî
::
decode
(
°d
::
ve˘‹
<>& 
out
, c⁄° * 
ö
, 
size_t
 
ösize
)

4964 * 
	gbuf„r
;

4965 
size_t
 
	gbuf„rsize
;

4966 
LodePNG_Decodî_decode
(
this
, &
buf„r
, &
buf„rsize
, 
ö
, 
ösize
);

4967 if(
	gbuf„r
)

4969 
	gout
.
ö£π
(
out
.
íd
(), &
buf„r
[0], &buf„r[
buf„rsize
]);

4970 
‰ì
(
buf„r
);

4974 
	gDecodî
::
decode
(
°d
::
ve˘‹
<>& 
out
, c⁄° std::ve˘‹<>& 
ö
)

4976 
decode
(
out
, 
ö
.
em±y
(Ë? 0 : &ö[0], in.
size
());

4979 
	gDecodî
::
ö•e˘
(c⁄° * 
ö
, 
size_t
 
ösize
)

4981 
LodePNG_Decodî_ö•e˘
(
this
, 
ö
, 
ösize
);

4984 
	gDecodî
::
ö•e˘
(c⁄° 
°d
::
ve˘‹
<>& 
ö
)

4986 
ö•e˘
(
ö
.
em±y
(Ë? 0 : &ö[0], in.
size
());

4989 c⁄° 
	gLodePNG_DecodeSëtögs
& 
	gDecodî
::
gëSëtögs
() const

4991  
£âögs
;

4994 
	gLodePNG_DecodeSëtögs
& 
	gDecodî
::
gëSëtögs
()

4996  
£âögs
;

4999 
	gDecodî
::
£tSëtögs
(c⁄° 
LodePNG_DecodeSëtögs
& 
£âögs
)

5001 
this
->
£âögs
 = settings;

5004 c⁄° 
	gLodePNG_InfoPng
& 
	gDecodî
::
gëInfoPng
() const

5006  
öfoPng
;

5009 
	gLodePNG_InfoPng
& 
	gDecodî
::
gëInfoPng
()

5011  
öfoPng
;

5014 
	gDecodî
::
£tInfoPng
(c⁄° 
LodePNG_InfoPng
& 
öfo
)

5016 
îr‹
 = 
LodePNG_InfoPng_c›y
(&
this
->
öfoPng
, &
öfo
);

5019 
	gDecodî
::
sw≠InfoPng
(
LodePNG_InfoPng
& 
öfo
)

5021 
LodePNG_InfoPng_sw≠
(&
this
->
öfoPng
, &
öfo
);

5024 c⁄° 
	gLodePNG_InfoRaw
& 
	gDecodî
::
gëInfoRaw
() const

5026  
öfoRaw
;

5029 
	gLodePNG_InfoRaw
& 
	gDecodî
::
gëInfoRaw
()

5031  
öfoRaw
;

5034 
	gDecodî
::
£tInfoRaw
(c⁄° 
LodePNG_InfoRaw
& 
öfo
)

5036 
îr‹
 = 
LodePNG_InfoRaw_c›y
(&
this
->
öfoRaw
, &
öfo
);

5043 #ifde‡
LODEPNG_COMPILE_ENCODER


5045 
	gEncodî
::
Encodî
()

5047 
LodePNG_Encodî_öô
(
this
);

5050 
	gEncodî
::~
Encodî
()

5052 
LodePNG_Encodî_˛ónup
(
this
);

5055 
	gEncodî
::
›î©‹
=(c⁄° 
LodePNG_Encodî
& 
Ÿhî
)

5057 
LodePNG_Encodî_c›y
(
this
, &
Ÿhî
);

5060 
boﬁ
 
	gEncodî
::
hasEº‹
() const

5062  
îr‹
 != 0;

5065 
	gEncodî
::
gëEº‹
() const

5067  
îr‹
;

5070 
	gEncodî
::
ícode
(
°d
::
ve˘‹
<>& 
out
, c⁄° * 
image
, 
w
, 
h
)

5072 * 
	gbuf„r
;

5073 
size_t
 
	gbuf„rsize
;

5074 
LodePNG_Encodî_ícode
(
this
, &
buf„r
, &
buf„rsize
, 
image
, 
w
, 
h
);

5075 if(
	gbuf„r
)

5077 
	gout
.
ö£π
(
out
.
íd
(), &
buf„r
[0], &buf„r[
buf„rsize
]);

5078 
‰ì
(
buf„r
);

5082 
	gEncodî
::
ícode
(
°d
::
ve˘‹
<>& 
out
, c⁄° std::ve˘‹<>& 
image
, 
w
, 
h
)

5084 
ícode
(
out
, 
image
.
em±y
(Ë? 0 : &image[0], 
w
, 
h
);

5087 
	gEncodî
::
˛órPÆëã
()

5089 
LodePNG_InfoCﬁ‹_˛órPÆëã
(&
öfoPng
.
cﬁ‹
);

5092 
	gEncodî
::
addPÆëã
(
r
, 
g
, 
b
, 
a
)

5094 
	gîr‹
 = 
LodePNG_InfoCﬁ‹_addPÆëã
(&
öfoPng
.
cﬁ‹
, 
r
, 
g
, 
b
, 
a
);

5097 #ifde‡
LODEPNG_COMPILE_ANCILLARY_CHUNKS


5098 
	gEncodî
::
˛órText
()

5100 
LodePNG_Text_˛ór
(&
öfoPng
.
ãxt
);

5103 
	gEncodî
::
addText
(c⁄° 
°d
::
°rög
& 
key
, c⁄° std::°rög& 
°r
)

5105 
îr‹
 = 
LodePNG_Text_add
(&
öfoPng
.
ãxt
, 
key
.
c_°r
(), 
°r
.c_str());

5108 
	gEncodî
::
˛órIText
()

5110 
LodePNG_IText_˛ór
(&
öfoPng
.
ôext
);

5113 
	gEncodî
::
addIText
(c⁄° 
°d
::
°rög
& 
key
, c⁄° std::°rög& 
œngèg
, c⁄° std::°rög& 
å™skey
, c⁄° std::°rög& 
°r
)

5115 
îr‹
 = 
LodePNG_IText_add
(&
öfoPng
.
ôext
, 
key
.
c_°r
(), 
œngèg
.c_°r(), 
å™skey
.c_°r(), 
°r
.c_str());

5120 c⁄° 
	gLodePNG_EncodeSëtögs
& 
	gEncodî
::
gëSëtögs
() const

5122  
£âögs
;

5125 
	gLodePNG_EncodeSëtögs
& 
	gEncodî
::
gëSëtögs
()

5127  
£âögs
;

5130 
	gEncodî
::
£tSëtögs
(c⁄° 
LodePNG_EncodeSëtögs
& 
£âögs
)

5132 
this
->
£âögs
 = settings;

5135 c⁄° 
	gLodePNG_InfoPng
& 
	gEncodî
::
gëInfoPng
() const

5137  
öfoPng
;

5140 
	gLodePNG_InfoPng
& 
	gEncodî
::
gëInfoPng
()

5142  
öfoPng
;

5145 
	gEncodî
::
£tInfoPng
(c⁄° 
LodePNG_InfoPng
& 
öfo
)

5147 
îr‹
 = 
LodePNG_InfoPng_c›y
(&
this
->
öfoPng
, &
öfo
);

5150 
	gEncodî
::
sw≠InfoPng
(
LodePNG_InfoPng
& 
öfo
)

5152 
LodePNG_InfoPng_sw≠
(&
this
->
öfoPng
, &
öfo
);

5155 c⁄° 
	gLodePNG_InfoRaw
& 
	gEncodî
::
gëInfoRaw
() const

5157  
öfoRaw
;

5160 
	gLodePNG_InfoRaw
& 
	gEncodî
::
gëInfoRaw
()

5162  
öfoRaw
;

5165 
	gEncodî
::
£tInfoRaw
(c⁄° 
LodePNG_InfoRaw
& 
öfo
)

5167 
îr‹
 = 
LodePNG_InfoRaw_c›y
(&
this
->
öfoRaw
, &
öfo
);

5174 #ifde‡
LODEPNG_COMPILE_DISK


5176 
lﬂdFûe
(
°d
::
ve˘‹
<>& 
buf„r
, c⁄° std::
°rög
& 
fûíame
)

5178 
°d
::
if°ªam
 
fûe
(
fûíame
.
c_°r
(), std::
ios
::
ö
|°d::ios::
bö¨y
|°d::ios::
©e
);

5181 
	g°d
::
°ªamsize
 
size
 = 0;

5182 if(
	gfûe
.
£ekg
(0, 
°d
::
ios
::
íd
).
good
()Ë
size
 = 
fûe
.
ãŒg
();

5183 if(
	gfûe
.
£ekg
(0, 
°d
::
ios
::
beg
).
good
()Ë
size
 -
fûe
.
ãŒg
();

5186 
	gbuf„r
.
ªsize
(
size_t
(
size
));

5187 if(
	gsize
 > 0Ë
	gfûe
.
ªad
((*)(&
buf„r
[0]), 
size
);

5191 
ßveFûe
(c⁄° 
°d
::
ve˘‹
<>& 
buf„r
, c⁄° std::
°rög
& 
fûíame
)

5193 
°d
::
of°ªam
 
fûe
(
fûíame
.
c_°r
(), std::
ios
::
out
|°d::ios::
bö¨y
);

5194 
	gfûe
.
wrôe
(
buf„r
.
em±y
(Ë? 0 : (*)&buf„r[0], 
°d
::
°ªamsize
(buf„r.
size
()));

5201 #ifde‡
LODEPNG_COMPILE_DECODER


5203 
decode
(
°d
::
ve˘‹
<>& 
out
, & 
w
, & 
h
, c⁄° * 
ö
, 
size_t
 
ösize
, 
cﬁ‹Ty≥
, 
bôDïth
)

5205 
Decodî
 
	gdecodî
;

5206 
	gdecodî
.
gëInfoRaw
().
	gcﬁ‹
.
	gcﬁ‹Ty≥
 = 
cﬁ‹Ty≥
;

5207 
	gdecodî
.
gëInfoRaw
().
	gcﬁ‹
.
	gbôDïth
 = 
bôDïth
;

5208 
	gdecodî
.
decode
(
out
, 
ö
, 
ösize
);

5209 
	gw
 = 
decodî
.
gëWidth
();

5210 
	gh
 = 
decodî
.
gëHeight
();

5211  
	gdecodî
.
gëEº‹
();

5214 
decode
(
°d
::
ve˘‹
<>& 
out
, & 
w
, & 
h
, c⁄° std::ve˘‹<>& 
ö
, 
cﬁ‹Ty≥
, 
bôDïth
)

5216  
decode
(
out
, 
w
, 
h
, 
ö
.
em±y
(Ë? 0 : &ö[0], ()ö.
size
(), 
cﬁ‹Ty≥
, 
bôDïth
);

5219 #ifde‡
LODEPNG_COMPILE_DISK


5220 
decode
(
°d
::
ve˘‹
<>& 
out
, & 
w
, & 
h
, c⁄° std::
°rög
& 
fûíame
, 
cﬁ‹Ty≥
, 
bôDïth
)

5222 
	g°d
::
ve˘‹
<> 
buf„r
;

5223 
lﬂdFûe
(
buf„r
, 
fûíame
);

5224  
decode
(
out
, 
w
, 
h
, 
buf„r
, 
cﬁ‹Ty≥
, 
bôDïth
);

5231 #ifde‡
LODEPNG_COMPILE_ENCODER


5233 
ícode
(
°d
::
ve˘‹
<>& 
out
, c⁄° * 
ö
, 
w
, 
h
, 
cﬁ‹Ty≥
, 
bôDïth
)

5235 
Encodî
 
	gícodî
;

5236 
	gícodî
.
gëInfoRaw
().
	gcﬁ‹
.
	gcﬁ‹Ty≥
 = 
cﬁ‹Ty≥
;

5237 
	gícodî
.
gëInfoRaw
().
	gcﬁ‹
.
	gbôDïth
 = 
bôDïth
;

5238 
	gícodî
.
ícode
(
out
, 
ö
, 
w
, 
h
);

5239  
	gícodî
.
gëEº‹
();

5242 
ícode
(
°d
::
ve˘‹
<>& 
out
, c⁄° std::ve˘‹<>& 
ö
, 
w
, 
h
, 
cﬁ‹Ty≥
, 
bôDïth
)

5244  
ícode
(
out
, 
ö
.
em±y
(Ë? 0 : &ö[0], 
w
, 
h
, 
cﬁ‹Ty≥
, 
bôDïth
);

5247 #ifde‡
LODEPNG_COMPILE_DISK


5248 
ícode
(c⁄° 
°d
::
°rög
& 
fûíame
, c⁄° * 
ö
, 
w
, 
h
, 
cﬁ‹Ty≥
, 
bôDïth
)

5250 
	g°d
::
ve˘‹
<> 
buf„r
;

5251 
Encodî
 
	gícodî
;

5252 
	gícodî
.
gëInfoRaw
().
	gcﬁ‹
.
	gcﬁ‹Ty≥
 = 
cﬁ‹Ty≥
;

5253 
	gícodî
.
gëInfoRaw
().
	gcﬁ‹
.
	gbôDïth
 = 
bôDïth
;

5254 
	gícodî
.
ícode
(
buf„r
, 
ö
, 
w
, 
h
);

5255 if(!
	gícodî
.
hasEº‹
()Ë
ßveFûe
(
buf„r
, 
fûíame
);

5256  
	gícodî
.
gëEº‹
();

5259 
ícode
(c⁄° 
°d
::
°rög
& 
fûíame
, c⁄° std::
ve˘‹
<>& 
ö
, 
w
, 
h
, 
cﬁ‹Ty≥
, 
bôDïth
)

5261  
ícode
(
fûíame
, 
ö
.
em±y
(Ë? 0 : &ö[0], 
w
, 
h
, 
cﬁ‹Ty≥
, 
bôDïth
);

	@utils/mouse_judge.c

1 
	~<öc/mou£_judge.h
>

3 
	~<as£π.h
>

4 
	~<°dlib.h
>

5 
	~<°dio.h
>

6 
	~<mem‹y.h
>

9 
mou£_judge_m≠
(
mou£_judge_t
 *
mou£_judge
, (* 
func
Ë(
obje˘_queue_hód_t
 *))

11 
i
;

12 
i
 = 0; i < 
mou£_judge
->
Àngth
; i++)

13 
	`func
(&(
mou£_judge
->
obje˘_queue_¨øy
[
i
]));

14 
	}
}

17 
	$mou£_judge_öô_m≠≥r
(
obje˘_queue_hód_t
 *
queue
)

19 
queue
->
tqh_fú°
 = 
NULL
;

20 
queue
->
tqh_œ°
 = &(queue->
tqh_fú°
);

21 
	`TAILQ_INIT
(
queue
);

22 
	}
}

24 
mou£_judge_t
 *

25 
	$mou£_judge_öô
(
size_t
 
tŸÆ_m£c
, 
ªdius_hô
, 
ªdius_¶ide
, 
t300
, 
t100
, 
t50
, 
tm
)

27 
obje˘_queue_hód_t
 *
±r
;

28 
mou£_judge_t
 *
πn
;

29 
πn
 = (
mou£_judge_t
 *)
	`mÆloc
((mouse_judge_t));

30 
±r
 = (
obje˘_queue_hód_t
 *)
	`mÆloc
((obje˘_queue_hód_tË* 
tŸÆ_m£c
);

31 
πn
 -> 
obje˘_queue_¨øy
 = 
±r
;

32 
πn
 -> 
Àngth
 = 
tŸÆ_m£c
;

34 
πn
 -> 
ªdius_hô
 =Ñedius_hit;

35 
πn
 -> 
ªdius_¶ide
 =Ñedius_slide;

37 
πn
 -> 
thªshﬁd_300
 = 
t300
;

38 
πn
 -> 
thªshﬁd_100
 = 
t100
;

39 
πn
 -> 
thªshﬁd_50
 = 
t50
;

40 
πn
 -> 
thªshﬁd_miss
 = 
tm
;

42 
πn
 -> 
thªshﬁd_tŸÆ
 = (π¿-> 
thªshﬁd_300


43 + 
πn
->
thªshﬁd_100


44 + 
πn
->
thªshﬁd_50


45 + 
πn
->
thªshﬁd_miss


46 + ()(
πn
->
thªshﬁd_300
 * (πn->
œ°_øã
))

47 + ()(
πn
->
thªshﬁd_100
 * (πn->
œ°_øã
))

48 + ()(
πn
->
thªshﬁd_50
 * (πn->
œ°_øã
))

49 + ()(
πn
->
thªshﬁd_miss
* (πn->
œ°_øã
))

52 
πn
 -> 
œ°_øã
 = 0.3;

53 
	`mou£_judge_m≠
(
πn
, 
mou£_judge_öô_m≠≥r
);

54  
πn
;

55 
	}
}

56 
ölöe
 
obje˘_t
 *

57 
	$obje˘_öô
(
pos_x
, 
pos_y
, 
obje˘_ty≥
 
ty≥
, 
obje˘_sc‹e
 
sc‹e
, 
id
)

59 
obje˘_t
 *
o
;

60 
o
 = (
obje˘_t
 *)
	`mÆloc
((object_t));

61 
	`as£π
(
o
);

62 
o
->
pos_x
 =Öos_x;

63 
o
->
pos_y
 =Öos_y;

64 
o
->
ty≥
 =Åype;

65 
o
-> 
sc‹e
 = score;

66 
o
-> 
id
 = id;

67  
o
;

68 
	}
}

71 
	$mou£_judge_ö£π_hôobje˘
(
mou£_judge_t
 *
mou£_judge
, 
pos_x
, 
pos_y
, 
size_t
 
time
, 
obje˘_ty≥
 
ty≥
, 
id
)

73 
¥ev
 = 
time
 - 1, 
fwd
 =Åimê+ 1, 
i
;

75 
obje˘_t
 *
po
;

76 
thªshﬁd_300
 = 
mou£_judge
->threshold_300,

77 
thªshﬁd_100
 = 
mou£_judge
->threshold_100,

78 
thªshﬁd_50
 = 
mou£_judge
->threshold_50,

79 
thªshﬁd_miss

mou£_judge
->threshold_miss,

80 
œ°_øã
 = 
mou£_judge
->last_rate,

81 
Àngth
 = 
mou£_judge
->length;

82 
po
 = 
	`obje˘_öô
(
pos_x
, 
pos_y
, 
ty≥
, 
sc‹e_300
, 
id
);

83 
	`TAILQ_INSERT_TAIL
(
mou£_judge
->
obje˘_queue_¨øy
 + 
time
, 
po
, 
queue_íåy
);

85 
i
 = 0; i < 
thªshﬁd_300
; i++)

87 i‡(
¥ev
 > 0){

88 
po
 = 
	`obje˘_öô
(
pos_x
, 
pos_y
, 
ty≥
, 
sc‹e_300
, 
id
);

89 
	`TAILQ_INSERT_TAIL
(
mou£_judge
->
obje˘_queue_¨øy
 + 
¥ev
, 
po
, 
queue_íåy
);

91 i‡(
fwd
 < 
Àngth
 && fwd < ()(
thªshﬁd_300
 * 
œ°_øã
)){

92 
po
 = 
	`obje˘_öô
(
pos_x
, 
pos_y
, 
ty≥
, 
sc‹e_300
, 
id
);

93 
	`TAILQ_INSERT_TAIL
(
mou£_judge
->
obje˘_queue_¨øy
 + 
fwd
, 
po
, 
queue_íåy
);

95 
¥ev
--, 
fwd
++;

98 
i
 = 0; i < 
thªshﬁd_100
; i++)

100 i‡(
¥ev
 > 0){

101 
po
 = 
	`obje˘_öô
(
pos_x
, 
pos_y
, 
ty≥
, 
sc‹e_100
, 
id
);

102 
	`TAILQ_INSERT_TAIL
(
mou£_judge
->
obje˘_queue_¨øy
 + 
¥ev
, 
po
, 
queue_íåy
);

104 i‡(
fwd
 < 
Àngth
 && fwd < ()(
thªshﬁd_100
 * 
œ°_øã
)){

105 
po
 = 
	`obje˘_öô
(
pos_x
, 
pos_y
, 
ty≥
, 
sc‹e_100
, 
id
);

106 
	`TAILQ_INSERT_TAIL
(
mou£_judge
->
obje˘_queue_¨øy
 + 
fwd
, 
po
, 
queue_íåy
);

108 
¥ev
--, 
fwd
++;

111 
i
 = 0; i < 
thªshﬁd_50
; i++)

113 i‡(
¥ev
 > 0){

114 
po
 = 
	`obje˘_öô
(
pos_x
, 
pos_y
, 
ty≥
, 
sc‹e_50
, 
id
);

115 
	`TAILQ_INSERT_TAIL
(
mou£_judge
->
obje˘_queue_¨øy
 + 
¥ev
, 
po
, 
queue_íåy
);

117 i‡(
fwd
 < 
Àngth
 && fwd < ()(
thªshﬁd_50
 * 
œ°_øã
)){

118 
po
 = 
	`obje˘_öô
(
pos_x
, 
pos_y
, 
ty≥
, 
sc‹e_50
, 
id
);

119 
	`TAILQ_INSERT_TAIL
(
mou£_judge
->
obje˘_queue_¨øy
 + 
fwd
, 
po
, 
queue_íåy
);

121 
¥ev
--, 
fwd
++;

124 
i
 = 0; i < 
thªshﬁd_miss
; i++)

126 i‡(
¥ev
 > 0){

127 
po
 = 
	`obje˘_öô
(
pos_x
, 
pos_y
, 
ty≥
, 
sc‹e_miss
, 
id
);

128 
	`TAILQ_INSERT_TAIL
(
mou£_judge
->
obje˘_queue_¨øy
 + 
¥ev
, 
po
, 
queue_íåy
);

130 i‡(
fwd
 < 
Àngth
 && fwd < ()(
thªshﬁd_miss
 * 
œ°_øã
)){

131 
po
 = 
	`obje˘_öô
(
pos_x
, 
pos_y
, 
ty≥
, 
sc‹e_miss
, 
id
);

132 
	`TAILQ_INSERT_TAIL
(
mou£_judge
->
obje˘_queue_¨øy
 + 
fwd
, 
po
, 
queue_íåy
);

134 
¥ev
--, 
fwd
++;

138 
	}
}

139 
ölöe
 

140 
	$˛ick_judge
(
x1
, 
y1
, 
x2
, 
y2
, 
ªdius
)

142  (
x1
-
x2
)*(x1-x2Ë+ (
y1
-
y2
)*(y1-y2Ë< 
ªdius
 *Ñedius;

143 
	}
}

145 
obje˘_sc‹e


146 
	$mou£_judge_˛ick
(
mou£_judge_t
 *
mou£_judge
, 
pos_x
, 
pos_y
, 
size_t
 
time
, *
id_°‹e
, 
obje˘_ty≥
 *
ty≥_°‹e
)

148 
obje˘_t
 *
po
, *
mpo
, *
ço
;

150 
obje˘_queue_hód_t
 *
queue_hód
 = 
mou£_judge
->
obje˘_queue_¨øy
 + 
time
;

151 
föd
 = 0, 
i
;

152 
obje˘_sc‹e
 
sc‹e
;

154 
	`TAILQ_FOREACH
(
po
, 
queue_hód
, 
queue_íåy
){

155 i‡(
po
->
ty≥
 <
obje˘_¶ide_°¨t
 &&

156 
	`˛ick_judge
(
po
->
pos_x
,Öo->
pos_y
,

157 
pos_x
, 
pos_y
,

158 
mou£_judge
->
ªdius_hô
)){

159 
föd
 = 1;

163 i‡(!
föd
)

164  
sc‹e_n⁄hô
;

165 i‡(
id_°‹e
)

166 *
id_°‹e
 = 
po
->
id
;

167 i‡(
ty≥_°‹e
)

168 *
ty≥_°‹e
 = 
po
->
ty≥
;

169 
	`TAILQ_REMOVE
(
queue_hód
, 
po
, 
queue_íåy
);

172 
i
 = 0; i < 
mou£_judge
->
thªshﬁd_tŸÆ
 && 
time
 + i < mou£_judge->
Àngth
; i++)

174 
	`TAILQ_FOREACH_MUTABLE
(
mpo
, 
queue_hód
 + 
i
, 
queue_íåy
, 
ço
){

175 if(
	`OBJECT_EQ
(
po
, 
mpo
)){

176 
	`TAILQ_REMOVE
(
queue_hód
 + 
i
, 
mpo
, 
queue_íåy
);

181 
i
 = 0; i < 
mou£_judge
->
thªshﬁd_tŸÆ
 && 
time
 - i >= 0; i++)

183 
	`TAILQ_FOREACH_MUTABLE
(
mpo
, 
queue_hód
 - 
i
, 
queue_íåy
, 
ço
){

184 if(
	`OBJECT_EQ
(
po
, 
mpo
)){

185 
	`TAILQ_REMOVE
(
queue_hód
 - 
i
, 
mpo
, 
queue_íåy
);

191 
sc‹e
 = 
po
->score;

193  
sc‹e
;

194 
	}
}

196 
obje˘_sc‹e


197 
	$mou£_judge_up
(
mou£_judge_t
 *
mou£_judge
, 
pos_x
, 
pos_y
, 
size_t
 
time
, *
id_°‹e
, 
obje˘_ty≥
 *
ty≥_°‹e
)

199 
obje˘_t
 *
po
, *
mpo
, *
ço
;

201 
obje˘_queue_hód_t
 *
queue_hód
 = 
mou£_judge
->
obje˘_queue_¨øy
 + 
time
;

202 
föd
 = 0, 
i
;

203 
obje˘_sc‹e
 
sc‹e
;

205 
	`TAILQ_FOREACH
(
po
, 
queue_hód
, 
queue_íåy
){

206 i‡(
po
->
ty≥
 =
obje˘_¶ide_íd
 &&

207 
	`˛ick_judge
(
po
->
pos_x
,Öo->
pos_y
,

208 
pos_x
, 
pos_y
,

209 
mou£_judge
->
ªdius_hô
)){

210 
föd
 = 1;

214 i‡(!
föd
)

215  
sc‹e_n⁄hô
;

216 i‡(
id_°‹e
)

217 *
id_°‹e
 = 
po
->
id
;

218 i‡(
ty≥_°‹e
)

219 *
ty≥_°‹e
 = 
po
->
ty≥
;

220 
	`TAILQ_REMOVE
(
queue_hód
, 
po
, 
queue_íåy
);

223 
i
 = 0; i < 
mou£_judge
->
thªshﬁd_tŸÆ
 && 
time
 + i < mou£_judge->
Àngth
; i++)

225 
	`TAILQ_FOREACH_MUTABLE
(
mpo
, 
queue_hód
 + 
i
, 
queue_íåy
, 
ço
){

226 if(
	`OBJECT_EQ
(
po
, 
mpo
)){

227 
	`TAILQ_REMOVE
(
queue_hód
 + 
i
, 
mpo
, 
queue_íåy
);

232 
i
 = 0; i < 
mou£_judge
->
thªshﬁd_tŸÆ
 && 
time
 - i >= 0; i++)

234 
	`TAILQ_FOREACH_MUTABLE
(
mpo
, 
queue_hód
 - 
i
, 
queue_íåy
, 
ço
){

235 if(
	`OBJECT_EQ
(
po
, 
mpo
)){

236 
	`TAILQ_REMOVE
(
queue_hód
 - 
i
, 
mpo
, 
queue_íåy
);

242 
sc‹e
 = 
po
->score;

244  
sc‹e
;

245 
	}
}

248 
	$mou£_judge_ö£π_¶idî
(
mou£_judge_t
 *
mou£_judge
, 
DŸ
 *
p
,
dŸ_num
, 
ª≥©
, 
id
)

250 
i
,
j
,

251 
cuπime
 = 
p
[0].
time
,

252 
¶idî_°¨t_time
 = 
p
[0].
time
,

253 
¶idî_tŸÆ_time
 = 
p
[
dŸ_num
 - 1].
time
 -Ö[0].time,

254 
f‹w¨d
 = 1;

255 
obje˘_t
 *
po
;

256 
thªshﬁd_miss
 = 
mou£_judge
->threshold_miss,

257 
tŸÆ_Àngth
 = 
mou£_judge
->
Àngth
;

264 
ª≥©
){

265 
now_time
, 
√xt_time
, 
vÆid_°¨t
, 
vÆid_íd
;

267 if(
f‹w¨d
 % 2){

268 
i
 = 0; i < 
dŸ_num
 - 1; i ++){

269 
√xt_time
 = 
p
[
i
 + 1].
time
 - 
¶idî_°¨t_time
 + 
cuπime
;

270 
now_time
 = 
p
[
i
].
time
 - 
¶idî_°¨t_time
 + 
cuπime
;

271 if(
p
[
i
].
is_tick
){

272 
vÆid_°¨t
 = 
now_time
 - 
thªshﬁd_miss
 >= 0 ?Çow_time -Åhreshold_miss:0;

273 
vÆid_íd
 = 
now_time
 + 
thªshﬁd_miss
 < 
tŸÆ_Àngth
 ?Çow_time +Åhreshold_miss :Åotal_length - 1;

274 
j
 = 
vÆid_°¨t
; j < 
vÆid_íd
; j++){

275 
po
 = 
	`obje˘_öô
(
p
[
i
].
x
,Ö[i].
y
, 
obje˘_¶ide_tick
, 
sc‹e_n⁄hô
, 
id
);

276 
	`TAILQ_INSERT_TAIL
(
mou£_judge
->
obje˘_queue_¨øy
 + 
j
, 
po
, 
queue_íåy
);

278 
id
++;

286 
ª≥©
--, 
f‹w¨d
++;

287 
cuπime
 +
¶idî_tŸÆ_time
;

290 
i
 = 
dŸ_num
 - 1; i > 0; i--){

291 
√xt_time
 = 
¶idî_tŸÆ_time
 -

292 (
p
[
i
 - 1].
time
 - 
¶idî_°¨t_time
Ë+ 
cuπime
;

293 
now_time
 = 
¶idî_tŸÆ_time
 -

294 (
p
[
i
].
time
 - 
¶idî_°¨t_time
Ë+ 
cuπime
;

295 if(
p
[
i
].
is_tick
){

296 
vÆid_°¨t
 = 
now_time
 - 
thªshﬁd_miss
 >= 0 ?Çow_time -Åhreshold_miss:0;

297 
vÆid_íd
 = 
now_time
 + 
thªshﬁd_miss
 < 
tŸÆ_Àngth
 ?Çow_time +Åhreshold_miss :Åotal_length - 1;

298 
j
 = 
vÆid_°¨t
; j < 
vÆid_íd
; j++){

299 
po
 = 
	`obje˘_öô
(
p
[
i
].
x
,Ö[i].
y
, 
obje˘_¶ide_tick
, 
sc‹e_n⁄hô
, 
id
);

300 
	`TAILQ_INSERT_TAIL
(
mou£_judge
->
obje˘_queue_¨øy
 + 
j
, 
po
, 
queue_íåy
);

302 
id
++;

310 
ª≥©
--, 
f‹w¨d
++;

311 
cuπime
 +
¶idî_tŸÆ_time
;

320 
	}
}

322 
	$mou£_judge_døg
(
mou£_judge_t
 *
mou£_judge
, 
pos_x
, 
pos_y
, 
size_t
 
time
, *
id_°‹e
)

324 
obje˘_t
 *
po
, *
mpo
, *
ço
;

325 
obje˘_queue_hód_t
 *
queue_hód
 = 
mou£_judge
->
obje˘_queue_¨øy
 + 
time
;

326 
föd
 = 0,

327 
îa£_°¨t
,

328 
îa£_íd
,

329 
miss_thªshﬁd
 = 
mou£_judge
->
thªshﬁd_miss
,

330 
tŸÆ_Àngth
 = 
mou£_judge
->
Àngth
;

331 
i
;

332 
	`TAILQ_FOREACH
(
po
, 
queue_hód
, 
queue_íåy
){

333 i‡(
po
->
ty≥
 =
obje˘_¶ide_tick
 &&

334 
	`˛ick_judge
(
po
->
pos_x
,

335 
po
->
pos_y
,

336 
pos_x
,

337 
pos_y
,

338 
mou£_judge
->
ªdius_¶ide
)){

339 
föd
 = 1;

343 i‡(!
föd
)

345 i‡(
id_°‹e
)

346 *
id_°‹e
 = 
po
->
id
;

348 
îa£_°¨t
 = 
time
 - 
miss_thªshﬁd
 > 0 ?Åime - miss_threshold : 0;

349 
îa£_íd
 = 
time
 + 
miss_thªshﬁd
 < 
tŸÆ_Àngth
 ?Åime + miss_threshold :Åotal_length - 1;

350 
i
 = 
îa£_°¨t
; i < 
îa£_íd
; i ++)

351 
	`TAILQ_FOREACH_MUTABLE
(
mpo
, 
queue_hód
 + 
i
, 
queue_íåy
, 
ço
){

352 if(
	`OBJECT_EQ
(
po
, 
mpo
)){

353 
	`TAILQ_REMOVE
(
queue_hód
 + 
i
, 
mpo
, 
queue_íåy
);

360 
	}
}

	@utils/parser.c

1 
	~<öc/∑r£r.h
>

3 
	gbackGround
[100];

4 
	gvideo
[100];

5 
	gbackGroundOrVid€
[100];

6 
Obje˘Li°
 
	gHôQueueHód
;

7 
Cﬁ‹Li°
 
	gComboHód
;

8 
TimögPoötsLi°
 
	gTimögPoötsHód
;

9 
	$s°æí
 (* 
p
)

11 
i
;

12 
i
 = 0; *
p
 != '\0' && *p != '\n'; i++,Ö++);

13  
i
;

14 
	}
}

18 
	$föd_pos
(* 
⁄ñöe
)

20 
i
=0;

21  
⁄ñöe
[
i
] != ':')

22 
i
++;

23  
i
;

24 
	}
}

28 
	$föd_pos2
(* 
⁄ñöe
)

30 
i
=0;

31 
Àn
;

32 
Àn
 = 
	`s°æí
(
⁄ñöe
);

33  
⁄ñöe
[
i
] !',' && i < 
Àn
 )

34 
i
++;

35 i‡(
i
 =
Àn
)

37  
i
;

38 
	}
}

42 
	$föd_pos3
(* 
⁄ñöe
)

44 
i
=0,
Àn
;

45 
Àn
 = 
	`s°æí
(
⁄ñöe
);

46  
⁄ñöe
[
i
] !'|' && i < 
Àn
 )

47 
i
++;

48 i‡(
i
 =
Àn
)

50  
i
;

51 
	}
}

56 
	$fûl_curve_pos
–*
⁄ñöe
, 
num
, 
Slidî_r
 * 
¶idî
 )

58 
pos
,
tmp
,
Àn
,
i
;

59 
Àn
 = 
	`föd_pos2
(
⁄ñöe
);

60 
pos
 = 
	`föd_pos3
(
⁄ñöe
);

61 
tmp
 = 
	`föd_pos
(
⁄ñöe
);

62 i‡–
pos
 =-1 ||Öo†> 
Àn
)

64 
¶idî
->
pos
[
num
][0]
	`gënum
(
⁄ñöe
,
tmp
);

65 
¶idî
->
pos
[
num
][1]
	`gënum
(&
⁄ñöe
[
tmp
+1],
Àn
-tmp-1);

71 
¶idî
->
pos
[
num
][0]
	`gënum
(
⁄ñöe
,
tmp
);

72 
¶idî
->
pos
[
num
][1]
	`gënum
(&
⁄ñöe
[
tmp
+1],pos-tmp-1);

74 
	`fûl_curve_pos
(&
⁄ñöe
[
pos
+1], 
num
+1 , 
¶idî
);

75 
	}
}

82 
	$cou¡
(* 
⁄ñöe
)

84 
i
 = 0 , 
num
 = 0;

85  
⁄ñöe
[
i
] != '\n' )

87 
i
++;

89 i‡–
⁄ñöe
[
i
] == ',')

90 
num
++;

92  
num
;

93 
	}
}

96 
	$cou¡2
(* 
⁄ñöe
)

98 
i
 = 0 , 
num
 = 0;

99  
⁄ñöe
[
i
] != '\n' )

101 
i
++;

103 i‡–
⁄ñöe
[
i
] == '|')

104 
num
++;

105 i‡–
⁄ñöe
[
i
] == ',')

108  
num
;

109 
	}
}

115 
	$gënum
(* 
⁄ñöe
 , 
Àn
)

117 
tmp
 = 0 , 
i
 = 0,
m¨k
 = 1;

118 i‡(
⁄ñöe
[
i
] == '-')

120 
m¨k
 = -1;

121 
i
++;

123  
i
 < 
Àn
)

125 
tmp
 =Åm∞* 10 + 
⁄ñöe
[
i
] - '0';

126 
i
++;

128  
tmp
*
m¨k
;

129 
	}
}

131 
	$gënum2
(* 
⁄ñöe
, 
Àn
)

133 
ªs
=0;

134 
pos
=0,
tmp
=10;

136 
⁄ñöe
[
pos
] !'.' &&Öo†< 
Àn
)

137 
pos
++;

138 
ªs
 = 
	`gënum
(
⁄ñöe
 , 
pos
);

139 if(
⁄ñöe
[
pos
] == '.')

141 
pos
++;

142 i‡(
ªs
 >= 0)

144 
pos
 < 
Àn
)

147 
ªs
+(()(
⁄ñöe
[
pos
]-'0'))/
tmp
;

148 
tmp
 *= 10;

149 
pos
++;

155 
pos
 < 
Àn
)

158 
ªs
-(()(
⁄ñöe
[
pos
]-'0'))/
tmp
;

159 
tmp
 *= 10;

160 
pos
++;

165 i‡(
ªs
<0)

166  (-1)*
ªs
;

167  
ªs
;

168 
	}
}

170 
	$fûl_timögPoöts
(* 
⁄ñöe
, 
TimögPoöts
 * 
timögPoöts
, 
num
 )

172 
pos
,
tmp
;

174 i‡(
num
 == 7)

176 
pos
 = 
	`föd_pos2
(
⁄ñöe
);

179 i‡(
pos
 == -1 )

180 
pos
 = 
	`s°æí
(
⁄ñöe
) - 2;

182 
timögPoöts
->
isKüi
 = 
	`gënum
(
⁄ñöe
,
pos
);

187 
pos
 = 
	`föd_pos2
(
⁄ñöe
);

188 
tmp
 = 
	`gënum
(
⁄ñöe
, 
pos
);

189 i‡–
num
 == 0 )

191 
timögPoöts
->
off£t
 = 
	`gënum2
(
⁄ñöe
, 
pos
);

193 i‡–
num
 == 1 )

196 
	`ssˇnf
(
⁄ñöe
, "%lf", &
timögPoöts
->
bótLígth
);

199 i‡–
num
 == 2 )

201 
timögPoöts
-> 
timögSig«tuª
 = 
tmp
;

204 i‡–
num
 == 3 )

206 
timögPoöts
->
ßm∂eSëId
 = 
tmp
;

208 i‡–
num
 == 4 )

210 
timögPoöts
->
u£Cu°omSam∂ós
 = 
tmp
;

212 i‡–
num
 == 5 )

214 
timögPoöts
->
ßm∂eVﬁume
 = 
tmp
;

216 i‡–
num
 == 6 )

218 
timögPoöts
->
nŸInhîôed
 = 
tmp
;

221 
	`fûl_timögPoöts
(&
⁄ñöe
[
pos
+1], 
timögPoöts
, 
num
+1 );

223 
	}
}

227 
	$fûl_hô_cú˛e
(* 
⁄ñöe
, 
HôCú˛e
 * 
hôCú˛e
, 
num
 )

229 
pos
,
tmp
;

231 i‡(
num
 == 4)

233 
hôCú˛e
->
soundTy≥
 = 
⁄ñöe
[0]-'0';

239 
pos
 = 
	`föd_pos2
(
⁄ñöe
);

240 
tmp
 = 
	`gënum
(
⁄ñöe
, 
pos
);

241 i‡–
num
 == 0 )

243 
hôCú˛e
->
xPos
 = 
tmp
;

245 i‡–
num
 == 1 )

247 
hôCú˛e
->
yPos
 = 
tmp
;

250 i‡–
num
 == 2 )

252 
hôCú˛e
->
°¨tTimeMs
 = 
tmp
;

255 i‡–
num
 == 3 )

257 
hôCú˛e
->
obje˘Ty≥
 = 
tmp
;

259 
	`fûl_hô_cú˛e
(&
⁄ñöe
[
pos
+1], 
hôCú˛e
, 
num
+1 );

261 
	}
}

264 
	$fûl_¶idî
(* 
⁄ñöe
, 
Slidî_r
 * 
¶idî
, 
num
 )

266 
pos
,
tmp
;

267 i‡(
num
 == 7)

269 
pos
 = 
	`s°æí
(
⁄ñöe
) - 1;

272 
	`ssˇnf
(
⁄ñöe
, "%lf", &
¶idî
->
¶idîLígthPixñs
);

278 
pos
 = 
	`föd_pos2
(
⁄ñöe
);

279 
tmp
 = 
	`gënum
(
⁄ñöe
, 
pos
);

280 i‡–
num
 == 0 )

282 
¶idî
->
xPos
 = 
tmp
;

284 i‡–
num
 == 1 )

286 
¶idî
->
yPos
 = 
tmp
;

289 i‡–
num
 == 2 )

291 
¶idî
->
°¨tTimeMs
 = 
tmp
;

294 i‡–
num
 == 3 )

296 
¶idî
->
obje˘Ty≥
 = 
tmp
;

299 i‡–
num
 == 4 )

301 
¶idî
->
soundTy≥
 = 
tmp
;

303 i‡–
num
 == 5 )

306 
¶idî
->
curveTy≥
 = 
⁄ñöe
[0];

307 
¶idî
->
posNum
 = 
	`cou¡2
–
⁄ñöe
);

308 
	`fûl_curve_pos
(
⁄ñöe
 + 2, 0 , 
¶idî
);

312 i‡–
num
 == 6 )

314 
¶idî
->
ª≥©Cou¡
 = 
tmp
;

317 
	`fûl_¶idî
(&
⁄ñöe
[
pos
+1], 
¶idî
, 
num
+1);

321 
	}
}

323 
	$fûl_¶idî2
(* 
⁄ñöe
, 
Slidî_r
 * 
¶idî
, 
num
 )

325 
pos
,
tmp
;

326 i‡(
num
 == 8)

332 
pos
 = 
	`föd_pos2
(
⁄ñöe
);

333 
tmp
 = 
	`gënum
(
⁄ñöe
, 
pos
);

334 i‡–
num
 == 0 )

336 
¶idî
->
xPos
 = 
tmp
;

338 i‡–
num
 == 1 )

340 
¶idî
->
yPos
 = 
tmp
;

343 i‡–
num
 == 2 )

345 
¶idî
->
°¨tTimeMs
 = 
tmp
;

348 i‡–
num
 == 3 )

350 
¶idî
->
obje˘Ty≥
 = 
tmp
;

353 i‡–
num
 == 4 )

355 
¶idî
->
soundTy≥
 = 
tmp
;

357 i‡–
num
 == 5 )

360 
¶idî
->
curveTy≥
 = 
⁄ñöe
[0];

361 
¶idî
->
posNum
 = 
	`cou¡2
–
⁄ñöe
);

362 
	`fûl_curve_pos
(
⁄ñöe
 + 2, 0 , 
¶idî
);

366 i‡–
num
 == 6 )

368 
¶idî
->
ª≥©Cou¡
 = 
tmp
;

370 i‡–
num
 == 7 )

373 
	`ssˇnf
(
⁄ñöe
, "%lf", &
¶idî
->
¶idîLígthPixñs
);

376 
	`fûl_¶idî2
(&
⁄ñöe
[
pos
+1], 
¶idî
, 
num
+1);

380 
	}
}

383 
	$fûl_cﬁ‹
(* 
⁄ñöe
, 
Cﬁ‹_r
 * 
cﬁ‹
, 
num
 )

385 
pos
,
tmp
;

387 i‡(
num
 == 2)

389 
pos
 =
	`s°æí
(
⁄ñöe
) - 1;

390 
tmp
 = 
	`gënum
(
⁄ñöe
, 
pos
);

391 
cﬁ‹
->
b
 = 
tmp
;

397 
pos
 = 
	`föd_pos2
(
⁄ñöe
);

398 
tmp
 = 
	`gënum
(
⁄ñöe
, 
pos
);

399 i‡–
num
 == 0 )

401 
cﬁ‹
->
r
 = 
tmp
;

403 i‡–
num
 == 1 )

405 
cﬁ‹
->
g
 = 
tmp
;

407 
	`fûl_cﬁ‹
(&
⁄ñöe
[
pos
+1], 
cﬁ‹
 , 
num
+1 );

410 
	}
}

414 
	$ªad_£˘i⁄
–
FILE
 * 
f
 , * 
⁄ñöe
 )

416 
Àn
,
tmp
,
pos
,
i
,
cou¡î
;

417 i‡–
⁄ñöe
[1] == 'G')

423  
	`fgës
–
⁄ñöe
, 1024, 
f
 ) !
NULL
 )

426 
Àn
 = 
	`s°æí
(
⁄ñöe
);

427 i‡–
Àn
 == 2 )

431 if–
⁄ñöe
[0] == '[')

433 
	`ªad_£˘i⁄
–
f
, 
⁄ñöe
 );

436 
i
 = 0;

437  
⁄ñöe
[
i
] == ' ' )

439 
i
++;

441 i‡–
⁄ñöe
[
i
] == '/' || oneline[i] == '\n')

446 
pos
 = 
	`föd_pos
(
⁄ñöe
);

448 i‡(
pos
 =13 && 
⁄ñöe
[0] == 'A' )

450 
pos
++;

451  
⁄ñöe
[
pos
] == ' ')

452 
pos
++;

453 
	`°r˝y
–
gíîÆ
.
AudioFûíame
 , &
⁄ñöe
[
pos
]);

454 
Àn
 = 
	`s°æí
–
gíîÆ
.
AudioFûíame
);

455 
gíîÆ
.
AudioFûíame
[
Àn
-1]='\0';

458 i‡(
pos
 =11 && 
⁄ñöe
[0] == 'A' )

460 
pos
++;

461  
⁄ñöe
[
pos
] == ' ')

462 
pos
++;

463 
Àn
 = 
	`s°æí
(&
⁄ñöe
[
pos
]);

464 
gíîÆ
.
AudioLódIn
 = 
	`gënum
(&
⁄ñöe
[
pos
],
Àn
-1);

467 i‡(
pos
 =11 && 
⁄ñöe
[0] == 'P' )

469 
pos
++;

470  
⁄ñöe
[
pos
] == ' ')

471 
pos
++;

472 
Àn
 = 
	`s°æí
(&
⁄ñöe
[
pos
]);

473 
gíîÆ
.
PªvõwTime
 = 
	`gënum
(&
⁄ñöe
[
pos
],
Àn
-1);

476 i‡(
pos
 =9 && 
⁄ñöe
[0] == 'C' )

478 
pos
++;

479  
⁄ñöe
[
pos
] == ' ')

480 
pos
++;

481 
Àn
 = 
	`s°æí
(&
⁄ñöe
[
pos
]);

482 
gíîÆ
.
Cou¡down
 = 
	`gënum
(&
⁄ñöe
[
pos
],
Àn
-1);

485 i‡(
pos
 =9 && 
⁄ñöe
[0] == 'S' )

487 
pos
++;

488  
⁄ñöe
[
pos
] == ' ')

489 
pos
++;

490 i‡(
⁄ñöe
[
pos
]=='N')

491 
gíîÆ
.
Sam∂eSë
=0;

493 
gíîÆ
.
Sam∂eSë
=1;

496 i‡(
pos
 =13 && 
⁄ñöe
[0] == 'S' )

498 
pos
++;

499  
⁄ñöe
[
pos
] == ' ')

500 
pos
++;

501 
Àn
 = 
	`s°æí
(&
⁄ñöe
[
pos
]);

502 
gíîÆ
.
SèckLíõncy
 = 
	`gënum2
(&
⁄ñöe
[
pos
],
Àn
-1);

505 i‡(
pos
 =4 && 
⁄ñöe
[0] == 'M' )

507 
pos
++;

508  
⁄ñöe
[
pos
] == ' ')

509 
pos
++;

510 
Àn
 = 
	`s°æí
(&
⁄ñöe
[
pos
]);

511 
gíîÆ
.
Mode

	`gënum
(&
⁄ñöe
[
pos
],
Àn
-1);

514 i‡(
pos
 =17 && 
⁄ñöe
[0] == 'L' )

516 
pos
++;

517  
⁄ñöe
[
pos
] == ' ')

518 
pos
++;

519 
Àn
 = 
	`s°æí
(&
⁄ñöe
[
pos
]);

520 
gíîÆ
.
LëãrboxInBªaks
 = 
	`gënum
(&
⁄ñöe
[
pos
],
Àn
-1);

525 i‡–
⁄ñöe
[1] == 'M' )

531  
	`fgës
–
⁄ñöe
, 1024, 
f
 ) !
NULL
 )

534 
Àn
 = 
	`s°æí
(
⁄ñöe
);

535 i‡–
Àn
 == 2 )

539 if–
⁄ñöe
[0] == '[')

541 
	`ªad_£˘i⁄
–
f
, 
⁄ñöe
 );

544 
i
 = 0;

545  
⁄ñöe
[
i
] == ' ' )

547 
i
++;

549 i‡–
⁄ñöe
[
i
] == '/' || oneline[i] == '\n')

555 
pos
 = 
	`föd_pos
(
⁄ñöe
);

559 i‡–
⁄ñöe
[1] == 'D' )

565  
	`fgës
–
⁄ñöe
, 1024, 
f
 ) !
NULL
 )

569 
Àn
 = 
	`s°æí
(
⁄ñöe
);

570 i‡–
Àn
 == 2 )

574 if–
⁄ñöe
[0] == '[')

576 
	`ªad_£˘i⁄
–
f
, 
⁄ñöe
 );

579 
i
 = 0;

580  
⁄ñöe
[
i
] == ' ' )

582 
i
++;

584 i‡–
⁄ñöe
[
i
] == '/' || oneline[i] == '\n')

589 
pos
 = 
	`föd_pos
(
⁄ñöe
);

592 i‡(
pos
 =11 && 
⁄ñöe
[0] == 'H' )

594 
pos
++;

595  
⁄ñöe
[
pos
] == ' ')

596 
pos
++;

597 
Àn
 = 
	`s°æí
(&
⁄ñöe
[
pos
]);

598 
difficu…y
.
HPDøöR©e
 = 
	`gënum
(&
⁄ñöe
[
pos
],
Àn
-1);

602 i‡(
pos
 =10 && 
⁄ñöe
[0] == 'C' )

604 
pos
++;

605  
⁄ñöe
[
pos
] == ' ')

606 
pos
++;

607 
Àn
 = 
	`s°æí
(&
⁄ñöe
[
pos
]);

608 
difficu…y
.
Cú˛eSize
 = 
	`gënum
(&
⁄ñöe
[
pos
],
Àn
-1);

612 i‡(
pos
 =17 && 
⁄ñöe
[0] == 'O' )

614 
pos
++;

615  
⁄ñöe
[
pos
] == ' ')

616 
pos
++;

617 
Àn
 = 
	`s°æí
(&
⁄ñöe
[
pos
]);

618 
difficu…y
.
OvîÆlDifficu…y
 = 
	`gënum
(&
⁄ñöe
[
pos
],
Àn
-1);

622 i‡(
pos
 =16 && 
⁄ñöe
[0] == 'S' )

624 
pos
++;

625  
⁄ñöe
[
pos
] == ' ')

626 
pos
++;

627 
Àn
 = 
	`s°æí
(&
⁄ñöe
[
pos
]);

628 
difficu…y
.
SlidîMu…ùlõr
 = 
	`gënum2
(&
⁄ñöe
[
pos
],
Àn
-1);

632 i‡(
pos
 =14 && 
⁄ñöe
[0] == 'S' )

634 
pos
++;

635  
⁄ñöe
[
pos
] == ' ')

636 
pos
++;

637 
Àn
 = 
	`s°æí
(&
⁄ñöe
[
pos
]);

638 
difficu…y
.
SlidîTickR©e
 = 
	`gënum2
(&
⁄ñöe
[
pos
],
Àn
-1);

639 
	`¥ötf
("hzq: %f\n", 
difficu…y
.
SlidîTickR©e
);

644 i‡–
⁄ñöe
[1] == 'T' )

649 
TimögPoöts
 * 
timögPoötsP
;

651  
	`fgës
–
⁄ñöe
, 1024, 
f
 ) !
NULL
 )

655 
Àn
 = 
	`s°æí
(
⁄ñöe
);

656 i‡–
Àn
 == 1 )

660 if–
⁄ñöe
[0] == '[')

662 
	`ªad_£˘i⁄
–
f
, 
⁄ñöe
 );

665 
i
 = 0;

666  
⁄ñöe
[
i
] == ' ' )

668 
i
++;

670 i‡–
⁄ñöe
[
i
] == '/' || oneline[i] == '\n')

674 
	`fûl_timögPoöts
(&
⁄ñöe
[
pos
],&
timögPoöts
,0);

675 
timögPoötsP
 = 
	`mÆloc
((
TimögPoöts
));

676 *
timögPoötsP
 = 
timögPoöts
;

678 
	`TAILQ_INSERT_TAIL
(&
TimögPoötsHód
, 
timögPoötsP
, 
Tíåy
);

679 
	`¥ötf
("HZQ!!!!!\n");

683 i‡–
⁄ñöe
[1] == 'E' )

689  
	`fgës
–
⁄ñöe
, 1024, 
f
 ) !
NULL
 )

693 
Àn
 = 
	`s°æí
(
⁄ñöe
);

694 i‡–
Àn
 == 2 )

698 if–
⁄ñöe
[0] == '[')

700 
	`ªad_£˘i⁄
–
f
, 
⁄ñöe
 );

703 
i
 = 0;

704  
⁄ñöe
[
i
] == ' ' )

706 
i
++;

708 i‡(
⁄ñöe
[
i
] == '\n')

712 i‡–
⁄ñöe
[
i
] ='/' && 
	`s°æí
(oneline) == 30)

716 
	`fgës
–
⁄ñöe
, 1024, 
f
 ) !
NULL
)

718 i‡(
⁄ñöe
[0] == '/')

720 i‡(
⁄ñöe
[0] == '[')

722 
	`ªad_£˘i⁄
–
f
, 
⁄ñöe
 );

740 i‡–
⁄ñöe
[0] == '0' || oneline[0] == 'b' || oneline[0] == 'B')

742 
tmp
 = 
	`föd_pos2
(
⁄ñöe
);

743 
⁄ñöe
 = &⁄ñöe[
tmp
+1];

744 
tmp
 = 
	`föd_pos2
(
⁄ñöe
);

745 
	`°r˝y
(
backGround
,&
⁄ñöe
[
tmp
+2]);

746 
backGround
[
	`s°æí
(backGround)-2]='\0';

749 i‡–
⁄ñöe
[0] == '0' || oneline[0] == 'v' || oneline[0] == 'V')

751 
tmp
 = 
	`föd_pos2
(
⁄ñöe
);

752 
⁄ñöe
 =&⁄ñöe[
tmp
+1];

753 
tmp
 = 
	`föd_pos2
(
⁄ñöe
);

754 
	`°r˝y
(
video
,&
⁄ñöe
[
tmp
+2]);

755 
video
[
	`s°æí
(video)-2]='\0';

765 i‡–
⁄ñöe
[1] == 'C' )

771 
Cﬁ‹_r
 * 
cﬁ‹P
;

773  
	`fgës
–
⁄ñöe
, 1024, 
f
 ) !
NULL
 )

777 
Àn
 = 
	`s°æí
(
⁄ñöe
);

778 i‡–
Àn
 == 1 )

782 if–
⁄ñöe
[0] == '[')

784 
	`ªad_£˘i⁄
–
f
, 
⁄ñöe
 );

787 
i
 = 0;

788  
⁄ñöe
[
i
] == ' ' )

790 
i
++;

792 i‡–
⁄ñöe
[
i
] == '/' || oneline[i] == '\n')

796 
pos
 = 
	`föd_pos
(
⁄ñöe
);

798  
⁄ñöe
[
pos
+1] == ' ')

800 
pos
++;

802 
	`fûl_cﬁ‹
(&
⁄ñöe
[
pos
+1],&
cﬁ‹
,0);

803 
cﬁ‹P
 = 
	`mÆloc
((
Cﬁ‹_r
));

804 
	`¥ötf
("%d %d %d\n",
cﬁ‹
.
r
,cﬁ‹.
g
,cﬁ‹.
b
);

805 *
cﬁ‹P
 = 
cﬁ‹
;

806 
	`TAILQ_INSERT_TAIL
(&
ComboHód
, 
cﬁ‹P
, 
Cíåy
);

811 i‡–
⁄ñöe
[1] == 'H' )

816 
HôObje˘s
 * 
hôObje˘sP
;

818  
	`fgës
–
⁄ñöe
, 1024, 
f
 ) !
NULL
 )

822 
Àn
 = 
	`s°æí
(
⁄ñöe
);

823 i‡–
Àn
 == 2 )

827 if–
⁄ñöe
[0] == '[')

829 
	`ªad_£˘i⁄
–
f
, 
⁄ñöe
 );

832 
i
 = 0;

833  
⁄ñöe
[
i
] == ' ' )

835 
i
++;

837 i‡–
⁄ñöe
[
i
] == '/' || oneline[i] == '\n')

841 
cou¡î
 = 
	`cou¡
(
⁄ñöe
);

844 i‡(
cou¡î
 == 4)

846 
hôObje˘sP
 = 
	`mÆloc
((
HôObje˘s
));

848 
	`fûl_hô_cú˛e
–
⁄ñöe
 , &
hôCú˛e
, 0);

849 
hôObje˘sP
->
ty≥
 = 0;

850 
hôObje˘sP
->
hôCú˛e
 = hitCircle;

853 
	`TAILQ_INSERT_TAIL
(&
HôQueueHód
, 
hôObje˘sP
, 
Híåy
);

856 i‡(
cou¡î
==7 )

858 
hôObje˘sP
 = 
	`mÆloc
((
HôObje˘s
));

860 
	`fûl_¶idî
–
⁄ñöe
, &
¶idî
, 0);

861 
hôObje˘sP
->
ty≥
 = 1;

862 
hôObje˘sP
->
¶idî
 = slider;

863 
	`TAILQ_INSERT_TAIL
(&
HôQueueHód
, 
hôObje˘sP
, 
Híåy
);

872 i‡(
cou¡î
 > 7 )

874 
hôObje˘sP
 = 
	`mÆloc
((
HôObje˘s
));

876 
	`fûl_¶idî2
–
⁄ñöe
, &
¶idî
, 0);

877 
hôObje˘sP
->
ty≥
 = 1;

878 
hôObje˘sP
->
¶idî
 = slider;

879 
	`TAILQ_INSERT_TAIL
(&
HôQueueHód
, 
hôObje˘sP
, 
Híåy
);

894 
	}
}

897 
	$osu_ªad
(
FILE
 *
ö
)

899 
⁄ñöe
[1024];

900 
Àn
=0,
i
,
j
;

901 
pos
;

902 
FILE
 *
f
 = 
ö
;

903 
backGround
[0] = '\0';

904 
video
[0] = '\0';

905 
	`TAILQ_INIT
(&
HôQueueHód
);

906 
	`TAILQ_INIT
(&
ComboHód
);

907 
	`TAILQ_INIT
(&
TimögPoötsHód
);

908 i‡–
f
 =
NULL
 )

910 
	`≥º‹
("FailÅo open");

911 
	`exô
(1);

913  
	`fgës
–
⁄ñöe
, 200, 
f
 ) !
NULL
 )

915 
Àn
 = 
	`s°æí
(
⁄ñöe
);

918 i‡–
Àn
 == 2 )

922 
i
 = 0;

923  
⁄ñöe
[
i
] == ' ' )

925 
i
++;

927 i‡–
⁄ñöe
[
i
] == '/' || oneline[i] == '\n')

932 i‡–
⁄ñöe
[0] == '[')

934 
	`ªad_£˘i⁄
–
f
, 
⁄ñöe
 );

938 
	}
}

939 
Obje˘Li°
 *

940 
	$osu_gë_obje˘_li°
(){

941  &
HôQueueHód
;

942 
	}
}

944 
Cﬁ‹Li°
 *

945 
	$osu_gë_cﬁ‹_li°
()

947  &
ComboHód
;

948 
	}
}

950 
GíîÆ
 *

951 
	$osu_gë_gíîÆ
()

953  &
gíîÆ
;

954 
	}
}

956 
Difficu…y
 *

957 
	$osu_gë_difficu…y
()

959  &
difficu…y
;

960 
	}
}

962 
TimögPoötsLi°
 *

963 
	$osu_gë_timög_poöts
()

965  &
TimögPoötsHód
;

966 
	}
}

968 
	$is_HôCú˛e
(
HôObje˘s
 *
a
)

970 if(
a
->
ty≥
 == 0)

973 
	}
}

976 
	$osu_gë_backGround
()

978  
backGround
;

979 
	}
}

982 
	$osu_gë_video
()

984  
video
;

985 
	}
}

	@utils/sfx.c

1 
	~<öc/sfx.h
>

2 
	~<°dio.h
>

3 
	~<öc/ªs.h
>

4 
	~<as£π.h
>

5 
	~<°rög.h
>

7 
	mn‹mÆ_hôn‹mÆ
 = 0,

8 
	mn‹mÆ_hôwhi°À
,

9 
	mn‹mÆ_hôföish
,

10 
	mn‹mÆ_hô˛≠
,

11 
	mcombobªak
,

12 
	mn‹mÆ_¶idîtick
,

13 
	mn‹mÆ_¶idî¶ide
,

14 
	mn‹mÆ_¶idîwhi°À
,

15 
	mSFX_KIND_NUM
,

17 
sfx_t
 
	gsfx
[
SFX_KIND_NUM
];

19 
	$sfx_öô
()

21 
i
, 
j
;

22 c⁄° *
sfx_fûe_«me
[] =

24 
	`STR
(
MATERIAL_DIR
/
n‹mÆ
-
hôn‹mÆ
.
wav
),

25 
	`STR
(
MATERIAL_DIR
/
n‹mÆ
-
hôwhi°À
.
wav
),

26 
	`STR
(
MATERIAL_DIR
/
n‹mÆ
-
hôföish
.
wav
),

27 
	`STR
(
MATERIAL_DIR
/
n‹mÆ
-
hô˛≠
.
wav
),

28 
	`STR
(
MATERIAL_DIR
/
combobªak
.
wav
),

29 
	`STR
(
MATERIAL_DIR
/
n‹mÆ
-
¶idîtick
.
wav
),

30 
	`STR
(
MATERIAL_DIR
/
n‹mÆ
-
¶idî¶ide
.
wav
),

31 
	`STR
(
MATERIAL_DIR
/
n‹mÆ
-
¶idîwhi°À
.
wav
),

33 i‡(
	`SDL_Inô
(
SDL_INIT_AUDIO
) != 0) {

34 
	`Ârötf
(
°dîr
, "U«bÀÅÿöôülizêSDL: %s\n", 
	`SDL_GëEº‹
());

35 
	`exô
(1);

38 
audio_øã
 = 44100;

39 
Uöt16
 
audio_f‹m©
 = 
AUDIO_S16SYS
;

40 
audio_ch™√ls
 = 2;

41 
audio_buf„rs
 = 256;

43 if(
	`Mix_O≥nAudio
(
audio_øã
, 
audio_f‹m©
, 
audio_ch™√ls
, 
audio_buf„rs
) != 0) {

44 
	`Ârötf
(
°dîr
, "U«bÀÅÿöôülizêaudio: %s\n", 
	`Mix_GëEº‹
());

45 
	`exô
(1);

47 
i
 = 0; i < 
SFX_KIND_NUM
; i++){

48 
sfx
[
i
].
mix_chunk
 = 
	`Mix_LﬂdWAV
(
sfx_fûe_«me
[i]);

49 
	`Mix_VﬁumeChunk
(
sfx
[
i
].
mix_chunk
, 
MIX_MAX_VOLUME
/2.5);

50 i‡(!
sfx
[
i
].
mix_chunk
)

51 
	`Ârötf
(
°dîr
, "U«bÀÅÿlﬂd WAV fûe: %s\n", 
	`Mix_GëEº‹
());

53 
	`Mix_AŒoˇãCh™√ls
(11);

54 
	}
}

56 
	$sfx_combo_miss
()

58 
	`Mix_PœyCh™√l
(-1, 
sfx
[
combobªak
].
mix_chunk
, 0);

60 
	}
}

62 
	$sfx_tick
()

66 
	}
}

68 
	$sfx_∂ay_by_ty≥
(
sound_ty≥
)

70 
i
;

71 
	`Mix_PœyCh™√l
(-1, 
sfx
[
n‹mÆ_hôn‹mÆ
].
mix_chunk
, 0);

73 
i
 = 1; i < 
SFX_KIND_NUM
; i ++){

74 i‡(
sound_ty≥
 & (1 << 
i
)){

75 
	`Mix_PœyCh™√l
(-1, 
sfx
[
i
].
mix_chunk
, 0);

79 
	}
}

81 
	$sfx_de°roy
()

83 
i
;

84 
i
 = 0; i <
SFX_KIND_NUM
; i ++){

85 
	`Mix_FªeChunk
(
sfx
[
i
].
mix_chunk
);

87 
	`Mix_Clo£Audio
();

88 
	`SDL_Quô
();

89 
	}
}

	@utils/texture.c

9 
	~<°dio.h
>

10 
	~<as£π.h
>

11 
	~<j≥glib.h
>

13 
	~<öc/ãxtuª.h
>

15 
	$is_≤g
(c⁄° *
f
)

17 
Àn
 = 
	`°æí
(
f
);

18  !
	`°rˇ£cmp
(
f
 + 
Àn
 - 3, "png");

19 
	}
}

22 
	$is_j≥g
(c⁄° *
f
)

24 
Àn
 = 
	`°æí
(
f
);

25  !
	`°rˇ£cmp
(
f
 + 
Àn
 - 3, "jpg") || !strcasecmp(f +Üen - 4, "jpeg");

26 
	}
}

45 
	$≤g_lﬂd
(c⁄° *
fûíame
, 
size_t
 *
w_°‹e
, size_à*
h_°‹e
)

47 *
buf„r
;

48 *
image
;

49 
size_t
 
buf„rsize
, 
imagesize
 ;

50 
LodePNG_Decodî
 
decodî
;

51 
	`LodePNG_lﬂdFûe
(&
buf„r
, &
buf„rsize
, 
fûíame
);

52 
	`LodePNG_Decodî_öô
(&
decodî
);

55 
	`LodePNG_Decodî_decode
(&
decodî
, &
image
, &
imagesize
, 
buf„r
, 
buf„rsize
);

56 if(
decodî
.
îr‹
)

58 
	`Ârötf
(
°dîr
,"îr‹ %u: %s\n", 
decodî
.
îr‹
, 
	`LodePNG_îr‹_ãxt
(decoder.error));

59  
NULL
;

62 
w_°‹e
 ? *w_°‹ê
decodî
.
öfoPng
.
width
 : 0;

63 
h_°‹e
 ? *h_°‹ê
decodî
.
öfoPng
.
height
 : 0;

64 
	`‰ì
(
buf„r
);

65  
image
;

66 
	}
}

69 
	$j≥g_lﬂd
(c⁄° *
fûíame
, 
size_t
 *
w_°‹e
, size_à*
h_°‹e
)

72 
j≥g_decom¥ess_°ru˘
 
cöfo
;

73 
j≥g_îr‹_mgr
 
jîr
;

74 *
øw_image
;

76 
JSAMPROW
 
row_poöãr
[1];

78 
FILE
 *
öfûe
 = 
	`f›í
(
fûíame
, "rb");

79 
loˇti⁄
 = 0;

80 
i
 = 0;

82 i‡–!
öfûe
 )

84 
	`¥ötf
("Eº‹ o≥nög j≥g fûê%s\n!", 
fûíame
 );

85  
NULL
;

88 
cöfo
.
îr
 = 
	`j≥g_°d_îr‹
–&
jîr
 );

90 
	`j≥g_¸óã_decom¥ess
–&
cöfo
 );

92 
	`j≥g_°dio_§c
–&
cöfo
, 
öfûe
 );

94 
	`j≥g_ªad_hódî
–&
cöfo
, 
TRUE
 );

96 
	`¥ötf
( "JPEG File Information: \n" );

97 
	`¥ötf
–"Imagêwidthánd height: %dÖixñ†™d %dÖixñs.\n", 
cöfo
.
image_width
, cöfo.
image_height
 );

98 
	`¥ötf
–"Cﬁ‹ comp⁄ít†≥∏pixñ: %d.\n", 
cöfo
.
num_comp⁄íts
 );

99 
	`¥ötf
–"Cﬁ‹ s∑˚: %d.\n", 
cöfo
.
j≥g_cﬁ‹_•a˚
 );

101 
	`j≥g_°¨t_decom¥ess
–&
cöfo
 );

104 
øw_image
 = (*)
	`mÆloc
–
cöfo
.
ouçut_width
*cöfo.
ouçut_height
*4 );

106 
row_poöãr
[0] = (*)
	`mÆloc
–
cöfo
.
ouçut_width
*cöfo.
num_comp⁄íts
 );

108  
cöfo
.
ouçut_sˇ∆öe
 < cöfo.
image_height
 )

110 
	`j≥g_ªad_sˇ∆öes
–&
cöfo
, 
row_poöãr
, 1 );

111  
i
=0; i<
cöfo
.
image_width
*cöfo.
num_comp⁄íts
;){

112 if(
loˇti⁄
 % 4 == 3){

113 
øw_image
[
loˇti⁄
++] = 255;

116 
øw_image
[
loˇti⁄
++] = 
row_poöãr
[0][
i
];

117 
i
++;

120 *
w_°‹e
 = 
cöfo
.
image_width
;

121 *
h_°‹e
 = 
cöfo
.
image_height
;

123 
	`j≥g_föish_decom¥ess
–&
cöfo
 );

124 
	`j≥g_de°roy_decom¥ess
–&
cöfo
 );

125 
	`‰ì
–
row_poöãr
[0] );

126 
	`f˛o£
–
öfûe
 );

128  
øw_image
;

129 
	}
}

142 
GLuöt


143 
	$ãxtuª_böd_image
(*
img
, 
size_t
 
width
, size_à
height
)

145 
GLuöt
 
ãx«me
;

146 
	`glGíTextuªs
(1, &
ãx«me
);

147 
	`glBödTextuª
(
GL_TEXTURE_2D
, 
ãx«me
);

148 
	`glTexP¨amëîi
(
GL_TEXTURE_2D
, 
GL_TEXTURE_WRAP_S
, 
GL_REPEAT
);

149 
	`glTexP¨amëîi
(
GL_TEXTURE_2D
, 
GL_TEXTURE_WRAP_T
, 
GL_REPEAT
);

150 
	`glTexP¨amëîi
(
GL_TEXTURE_2D
, 
GL_TEXTURE_MAG_FILTER
, 
GL_NEAREST
);

151 
	`glTexP¨amëîi
(
GL_TEXTURE_2D
, 
GL_TEXTURE_MIN_FILTER
, 
GL_NEAREST
);

152 
	`glTexImage2D
(
GL_TEXTURE_2D
, 0, 
GL_RGBA
, 
width


153 , 
height
, 0, 
GL_RGBA
,

154 
GL_UNSIGNED_BYTE
, 
img
);

155  
ãx«me
;

156 
	}
}

158 
	$≤g_fûl
(*
img
, 
size_t
 
w
, size_à
h
, 
r
, 
g
, 
b
)

160 *
p
 = 
img
, *
±r
;

161 
i
,
j
;

162 
Æpha
;

163 
i
 = 0; i < 
h
; i++)

164 
j
 = 0; j < 
w
; j++){

166 
±r
 = 
p
 + 
i
 * 
w
 * 4 + 
j
 * 4;

167 
Æpha
 = 
±r
[3]/255.0;

168 
±r
[0] = 
r
*
Æpha
,Öå[1] = 
g
*Æpha,Öå[2] = 
b
*alpha;

170 
	}
}

172 
	$≤g_fûl_Æpha
(*
img
, 
size_t
 
w
, size_à
h
, 
Æpha
)

174 *
p
 = 
img
, *
±r
;

175 
i
,
j
;

176 
i
 = 0; i < 
h
; i++)

177 
j
 = 0; j < 
w
; j++){

178 
±r
 = 
p
 + 
i
 * 
w
 * 4 + 
j
 * 4;

179 
±r
[0] *
Æpha
,Ötr[1] *=álpha,Ötr[2] *=álpha;

182 
	}
}

193 
GLuöt


194 
	$ãxtuª_lﬂd
(c⁄° *
fûíame
)

196 *
img
 = 
NULL
;

197 
GLuöt
 
ãx«me
;

198 
size_t
 
w
,
h
;

199 i‡(
	`is_≤g
(
fûíame
))

200 
img
 = 
	`≤g_lﬂd
(
fûíame
, &
w
, &
h
);

201 i‡(
	`is_j≥g
(
fûíame
))

202 
img
 = 
	`j≥g_lﬂd
(
fûíame
, &
w
, &
h
);

204 
	`as£π
(
img
);

205  
	`ãxtuª_böd_image
(
img
, 
w
, 
h
);

206 
	}
}

218 
GLuöt


219 
	$ãxtuª_lﬂd_wôh_cﬁ‹
(c⁄° *
fûíame
, 
r
, 
g
, 
b
)

221 *
img
 = 
NULL
;

222 
GLuöt
 
ãx«me
;

223 
size_t
 
w
,
h
;

224 i‡(
	`is_≤g
(
fûíame
))

225 
img
 = 
	`≤g_lﬂd
(
fûíame
, &
w
, &
h
);

226 i‡(
	`is_j≥g
(
fûíame
))

227 
img
 = 
	`j≥g_lﬂd
(
fûíame
, &
w
, &
h
);

228 
	`as£π
(
img
);

229 
	`≤g_fûl
(
img
, 
w
, 
h
, 
r
, 
g
, 
b
);

230  
	`ãxtuª_böd_image
(
img
, 
w
, 
h
);

231 
	}
}

233 
GLuöt


234 
	$ãxtuª_lﬂd_wôh_Æpha
(c⁄° *
fûíame
, 
Æpha
)

236 *
img
 = 
NULL
;

237 
GLuöt
 
ãx«me
;

238 
size_t
 
w
,
h
;

239 i‡(
	`is_≤g
(
fûíame
))

240 
img
 = 
	`≤g_lﬂd
(
fûíame
, &
w
, &
h
);

241 i‡(
	`is_j≥g
(
fûíame
))

242 
img
 = 
	`j≥g_lﬂd
(
fûíame
, &
w
, &
h
);

243 
	`as£π
(
img
);

244 
	`≤g_fûl_Æpha
(
img
, 
w
, 
h
, 
Æpha
);

246  
	`ãxtuª_böd_image
(
img
, 
w
, 
h
);

247 
	}
}

	@utils/time_seq.c

1 
	~<öc/time_£q.h
>

3 
	~<as£π.h
>

4 
	~<°dlib.h
>

5 
	~<°dio.h
>

6 
	~<mem‹y.h
>

12 
time_£q_m≠
(
time_£q_t
 *
time_£q
, (* 
func
Ë(
evít_queue_hód_t
 *))

14 
i
;

15 
i
 = 0; i < 
time_£q
->
Àngth
; i++)

16 
	`func
(&(
time_£q
->
queue_¨øy_±r
[
i
]));

17 
	}
}

24 
	$time_£q_de°‹y
(
time_£q_t
 *
time_£q
)

26 
	`‰ì
(
time_£q
 -> 
queue_¨øy_±r
);

27 
	}
}

34 
	$time_£q_öô_m≠≥r
(
evít_queue_hód_t
 *
queue
)

40 
queue
->
tqh_fú°
 = 
NULL
;

41 
queue
->
tqh_œ°
 = &(queue->
tqh_fú°
);

42 
	`TAILQ_INIT
(
queue
);

43 
	}
}

45 
time_£q_t
* 
	$time_£q_öô
(
size_t
 
tŸÆ_mûli£c⁄d
)

47 
evít_queue_hód_t
 *
±r
;

48 
time_£q_t
 *
πn
;

49 
πn
 = (
time_£q_t
 *)
	`mÆloc
((time_seq_t));

50 
±r
 = (
evít_queue_hód_t
 *)
	`mÆloc
((evít_queue_hód_tË* 
tŸÆ_mûli£c⁄d
);

51 
πn
 -> 
queue_¨øy_±r
 = 
±r
;

52 
πn
 -> 
Àngth
 = 
tŸÆ_mûli£c⁄d
;

53 
	`time_£q_m≠
(
πn
, 
time_£q_öô_m≠≥r
);

54  
πn
;

55 
	}
}

60 
ölöe
 
	$time_£q_ö£π_hód
(
time_£q_t
 *
time_£q
, 
size_t
 
time
, 
evít_t
 *
evít
)

62 
	`as£π
(
time
 < 
time_£q
 -> 
Àngth
);

63 
evít_queue_hód_t
 *
queue
 = 
time_£q
 -> 
queue_¨øy_±r
 + 
time
;

65 
	`TAILQ_INSERT_HEAD
(
queue
, 
evít
, 
queue_íåy
);

66 
	}
}

71 
ölöe
 
	$time_£q_ö£π_èû
(
time_£q_t
 *
time_£q
, 
size_t
 
time
, 
evít_t
 *
evít
)

73 
	`as£π
(
time
 < 
time_£q
 -> 
Àngth
);

74 
	`TAILQ_INSERT_TAIL
(
time_£q
->
queue_¨øy_±r
 + 
time
, 
evít
, 
queue_íåy
);

75 
	}
}

81 
	$time_£q_åiggî_©
(
time_£q_t
 *
time_£q
, 
size_t
 
time
)

83 
evít_t
 *
evít
;

84 
evít_queue_hód_t
 *
queue_hód
 = 
time_£q
 -> 
queue_¨øy_±r
 + 
time
;

85 
no_m‹e_åiggî
 = 0;

86 if(
time
 >
time_£q
 -> 
Àngth
){

87 i‡(!
no_m‹e_åiggî
)

88 
	`¥ötf
("time_seq: No moreÅriggers!\n");

89 
no_m‹e_åiggî
 = 1;

93 
	`TAILQ_FOREACH
(
evít
, 
queue_hód
, 
queue_íåy
)

94 
evít
->
	`åiggî
”vít, 
time_£q
, 
time
);

95 
	}
}

101 
	$time_£q_de°‹y_©
(
time_£q_t
 *
time_£q
, 
size_t
 
time
)

103 
evít_queue_hód_t
 *
queue_hód
 = 
time_£q
 -> 
queue_¨øy_±r
 + 
time
;

104 
evít_t
 *
evít
, *
tmp
;

105 
	`as£π
(
time
 < 
time_£q
 -> 
Àngth
);

106 
	`TAILQ_FOREACH_MUTABLE
(
evít
, 
queue_hód
, 
queue_íåy
, 
tmp
)

108 
	`TAILQ_REMOVE
(
queue_hód
, 
evít
, 
queue_íåy
);

109 
	`‰ì
(
evít
);

111 
	}
}

	@utils/unfinevent.c

1 
	~<öc/time_£q.h
>

2 
	~<öc/˚Œ.h
>

3 
	~<öc/unföevít.h
>

4 
	~<öc/game_°©us.h
>

6 
	~<°dio.h
>

7 
	~<GL/glut.h
>

9 
	gcuºít_tick_id
 ;

10 
	gcuºít_¶idî_sc‹e
;

15 
	$add_unfö_evít
(
UnföEvít
 *
u_evít
, 
id
, 
x
, 
y
, 
time
, 
sound_ty≥
, 
obje˘_ty≥
)

17 
u_evít
[
id
].
px
 = 
x
;

18 
u_evít
[
id
].
py
 = 
y
;

19 
u_evít
[
id
].
föish_time
 = 
time
;

20 
u_evít
[
id
].
föished
 = 0;

21 
u_evít
[
id
].
sound_ty≥
 = sound_type;

22 
u_evít
[
id
].
obje˘_ty≥
 = object_type;

23 
	}
}

26 
	$föish_evít
(
UnföEvít
 *
u_evít
, 
id
, 
sc‹e
, 
time
, 
suc˚ss
 , 
time_£q_t
 *
time_£q
)

28 
u_evít
[
id
].
föished
 = 1;

29 if(
suc˚ss
)

30 
	`sfx_∂ay_by_ty≥
(
u_evít
[
id
].
sound_ty≥
);

31 if(
u_evít
[
id
].
obje˘_ty≥
 =
obje˘_hô
){

32 
	`¸óã_hôsc‹e_evít
(
u_evít
[
id
].
px
, u_evít[id].
py
, 
sc‹e
, 
time_£q
, 
time
);

34 if(
u_evít
[
id
].
obje˘_ty≥
 =
obje˘_¶ide_tick
){

36 
cuºít_¶idî_sc‹e
){

37 
HIT_miss
:

38 
cuºít_¶idî_sc‹e
 = 
HIT_50
;

40 
HIT_50
:

41 
cuºít_¶idî_sc‹e
 = 
HIT_100
;

45 
	`sfx_tick
();

47 if(
u_evít
[
id
].
obje˘_ty≥
 =
obje˘_¶ide_°¨t
){

48 if(
sc‹e
 =
HIT_miss
 && 
cuºít_¶idî_sc‹e
 == HIT_miss){

49 
	`sfx_combo_miss
();

50 
	`¸óã_hôsc‹e_evít
(
u_evít
[
id
].
px
, u_evít[id].
py
, 
sc‹e
, 
time_£q
, 
time
);

53 
sc‹e
){

54 
HIT_miss
:

55 
cuºít_¶idî_sc‹e
 = 
HIT_100
;

58 
cuºít_¶idî_sc‹e
 = 
HIT_300
;

63 if(
u_evít
[
id
].
obje˘_ty≥
 =
obje˘_¶ide_íd
){

64 if(
sc‹e
 =
HIT_miss
 && 
cuºít_¶idî_sc‹e
 == HIT_miss){

65 
	`sfx_combo_miss
();

66 
	`¸óã_hôsc‹e_evít
(
u_evít
[
id
].
px
, u_evít[id].
py
, 
sc‹e
, 
time_£q
, 
time
);

69 
sc‹e
){

70 
HIT_miss
:

71 if(
cuºít_¶idî_sc‹e
 =
HIT_100
)

72 
cuºít_¶idî_sc‹e
 = 
HIT_miss
;

74 
cuºít_¶idî_sc‹e
 = 
HIT_100
;

76 
HIT_50
:

77 if(
cuºít_¶idî_sc‹e
 =
HIT_300
)

78 
cuºít_¶idî_sc‹e
 = 
HIT_100
;

79 
HIT_300
:

80 if(
cuºít_¶idî_sc‹e
 =
HIT_miss
)

81 
cuºít_¶idî_sc‹e
 = 
HIT_100
;

83 
cuºít_¶idî_sc‹e
 = 
sc‹e
;

86 
	`¸óã_hôsc‹e_evít
(
u_evít
[
id
].
px
, u_evít[id].
py
, 
cuºít_¶idî_sc‹e
, 
time_£q
, 
time
);

87 if(
cuºít_¶idî_sc‹e
 =
HIT_miss
)

88 
	`sfx_combo_miss
();

93 
	}
}

95 
	$kûl_unfö_evít_bef‹e
(
UnföEvít
 *
u_evít
, 
evít_num
, 
time
, 
time_£q_t
 *
time_£q
)

97 
i
;

98 
Êag
 = 0;

99 
i
 = 0 ; i < 
evít_num
 ; i++)

101 if(
u_evít
[
i
].
föish_time
 > 
time
 - 120) ;

102 if(
u_evít
[
i
].
föished
 == 1) ;

103 
u_evít
[
i
].
obje˘_ty≥
){

104 
obje˘_¶ide_íd
:

109 
	`föish_evít
(
u_evít
, 
i
, 
HIT_miss
, u_evít[i].
föish_time
, 
EVENT_FAIL
, 
time_£q
);

111 
obje˘_¶ide_°¨t
:

114 
	`SET_GAME_STATUS
(
GAME_SF_ONSLIDER
);

115 
	`föish_evít
(
u_evít
, 
i
, 
HIT_miss
, u_evít[i].
föish_time
, 
EVENT_FAIL
, 
time_£q
);

117 
obje˘_hô
:

119 
	`föish_evít
(
u_evít
, 
i
, 
HIT_miss
, u_evít[i].
föish_time
,
EVENT_FAIL
,
time_£q
);

121 
obje˘_¶ide_tick
:

123 
	`£t_cuºít_tick_time
(
u_evít
, 
evít_num
, u_evít[
i
].
föish_time
);

126 
cuºít_¶idî_sc‹e
){

127 
HIT_300
:

128 
cuºít_¶idî_sc‹e
 = 
HIT_100
;

130 
HIT_100
:

131 
cuºít_¶idî_sc‹e
 = 
HIT_50
;

134 
	`sfx_combo_miss
();

135 
u_evít
[
i
].
föished
 = 1;

140 
	}
}

142 
	$£t_cuºít_tick_time
(
UnföEvít
 *
u_evít
, 
evít_num
, 
time
)

144 
i
;

145 if(
time
 =0Ë
cuºít_tick_id
 = 0;

146 
i
 = 0 ; i < 
evít_num
 ; i++){

147 if(
u_evít
[
i
].
obje˘_ty≥
 =
obje˘_¶ide_tick
 && u_evít[i].
föish_time
 > 
time
 && u_evít[i].
föished
 == 0){

148 
cuºít_tick_id
 = 
i
;

154 
	}
}

	@
1
.
0
27
374
functions.c
game.c
inc/audio.h
inc/cdefs.h
inc/cell.h
inc/curve.h
inc/game.h
inc/game_status.h
inc/lodepng.h
inc/mouse_judge.h
inc/parser.h
inc/queue.h
inc/res.h
inc/sfx.h
inc/texture.h
inc/time_seq.h
inc/unfinevent.h
utils/audio.c
utils/cell.c
utils/curve.c
utils/lodepng.c
utils/mouse_judge.c
utils/parser.c
utils/sfx.c
utils/texture.c
utils/time_seq.c
utils/unfinevent.c
